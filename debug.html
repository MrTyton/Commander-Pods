<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Pod Generation</title>
</head>

<body>
    <h1>Debug Pod Generation</h1>
    <button id="debug-btn">Run Debug</button>
    <div id="debug-output"></div>

    <script src="script.js"></script>
    <script>
        document.getElementById('debug-btn').addEventListener('click', function () {
            // Create the same scenario as the failing test
            const players = [
                // Tournament Group: high power players
                { id: 1, name: 'Tournament1', power: 9 },
                { id: 2, name: 'Tournament2', power: 9 },
                { id: 3, name: 'Tournament3', power: 8 },

                // Casual Group: medium power players
                { id: 4, name: 'Casual1', power: 6 },
                { id: 5, name: 'Casual2', power: 7 },
                { id: 6, name: 'Casual3', power: 6 },

                // Budget Group: low power players
                { id: 7, name: 'Budget1', power: 4 },
                { id: 8, name: 'Budget2', power: 5 },

                // Individual players scattered across power levels
                { id: 9, name: 'Solo1', power: 8 },
                { id: 10, name: 'Solo2', power: 7 },
                { id: 11, name: 'Solo3', power: 6 },
                { id: 12, name: 'Solo4', power: 9 },
                { id: 13, name: 'Solo5', power: 5 },
                { id: 14, name: 'Solo6', power: 8 },
                { id: 15, name: 'Solo7', power: 7 },
                { id: 16, name: 'Solo8', power: 6 },
                { id: 17, name: 'Solo9', power: 9 },
                { id: 18, name: 'Solo10', power: 4 },
                { id: 19, name: 'Solo11', power: 7 },
                { id: 20, name: 'Solo12', power: 8 },
                { id: 21, name: 'Solo13', power: 6 },
                { id: 22, name: 'Solo14', power: 7 },
                { id: 23, name: 'Solo15', power: 8 },
                { id: 24, name: 'Solo16', power: 5 },
            ];

            // Create groups
            const groups = new Map();

            // Tournament Group (avg power = 8.67 -> 8.5)
            groups.set('group-1', [players[0], players[1], players[2]]);

            // Casual Group (avg power = 6.33 -> 6.5)  
            groups.set('group-2', [players[3], players[4], players[5]]);

            // Budget Group (avg power = 4.5)
            groups.set('group-3', [players[6], players[7]]);

            // Individual players (9-24)
            const individualPlayers = players.slice(8);

            console.log('Groups:', groups);
            console.log('Individual players:', individualPlayers);
            console.log('Total players:', players.length);

            // This is what the algorithm should receive
            console.log('Starting debug...');

            // Try to simulate the algorithm call
            try {
                // Calculate what itemsToPod would be
                const processedGroups = [];

                groups.forEach((groupPlayers, groupId) => {
                    const totalPower = groupPlayers.reduce((sum, p) => sum + p.power, 0);
                    const averagePower = Math.round((totalPower / groupPlayers.length) * 2) / 2;
                    processedGroups.push({
                        id: groupId,
                        players: groupPlayers,
                        averagePower: averagePower,
                        size: groupPlayers.length
                    });
                });

                const itemsToPod = [...individualPlayers, ...processedGroups];

                console.log('Items to pod:', itemsToPod);
                console.log('Individual players:', individualPlayers.length);
                console.log('Groups:', processedGroups.length);

                // Calculate pod sizes for 24 players
                const calculatePodSizes = (n) => {
                    if (n < 3) return [];
                    if (n === 3) return [3];
                    if (n === 4) return [4];
                    if (n === 5) return [5];
                    if (n === 6) return [3, 3];
                    if (n === 7) return [4, 3];
                    if (n === 8) return [4, 4];
                    if (n === 9) return [3, 3, 3];
                    if (n === 10) return [5, 5];

                    let fours = Math.floor(n / 4);
                    let remainder = n % 4;

                    if (remainder === 0) return Array(fours).fill(4);
                    if (remainder === 1) {
                        if (fours >= 2) return [...Array(fours - 2).fill(4), 5, 4];
                        return [3, 3, 3, 2];
                    }
                    if (remainder === 2) {
                        if (fours >= 1) return [...Array(fours - 1).fill(4), 3, 3];
                        return [3, 3, 3, 3];
                    }
                    if (remainder === 3) return [...Array(fours).fill(4), 3];

                    return [];
                };

                const podSizes = calculatePodSizes(24);
                console.log('Pod sizes for 24 players:', podSizes);

                document.getElementById('debug-output').innerHTML = `
                    <h3>Debug Results:</h3>
                    <p>Total players: ${players.length}</p>
                    <p>Groups: ${groups.size}</p>
                    <p>Individual players: ${individualPlayers.length}</p>
                    <p>Items to pod: ${itemsToPod.length}</p>
                    <p>Expected pod sizes: [${podSizes.join(', ')}]</p>
                    <p><strong>Check browser console for detailed analysis.</strong></p>
                `;

            } catch (error) {
                console.error('Debug error:', error);
                document.getElementById('debug-output').innerHTML = `<p>Error: ${error.message}</p>`;
            }
        });
    </script>
</body>

</html>