"use strict";(()=>{function K(c){if(c<3)return[];if(c===3)return[3];if(c===4)return[4];if(c===5)return[5];if(c===6)return[3,3];if(c===7)return[4,3];if(c===8)return[4,4];if(c===9)return[3,3,3];if(c===10)return[5,5];let e=Math.floor(c/4),t=c%4;return t===0?Array(e).fill(4):t===1?e>=2?[...Array(e-2).fill(4),5,4]:[3,3,3,2]:t===2?e>=1?[...Array(e-1).fill(4),3,3]:[3,3,3,3]:t===3?[...Array(e).fill(4),3]:[]}function se(c){if(c<3)return[];if(c<9)return K(c);if(c===9)return[3,3,3];if(c===10)return[4,3,3];if(c===11)return[4,4,3];if(c===12)return[4,4,4];if(c===13)return[4,3,3,3];if(c===14)return[4,4,3,3];if(c===15)return[4,4,4,3];let e=[],t=c;for(;t>=7;)e.push(4),t-=4;if(t===6)e.push(3,3);else if(t===5)if(e.length>0)e.pop(),t+=4,e.push(3,3,3);else return K(c);else t===4?e.push(4):t===3&&e.push(3);return e.sort((n,r)=>r-n)}function le(){let c=document.getElementById("avoid-five-pods-radio");return c&&c.checked?"avoid-five":"balanced"}function ie(){let c=document.getElementById("bracket-radio");if(c&&c.checked)return{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0};let e=document.getElementById("no-leniency-radio"),t=document.getElementById("leniency-radio");return document.getElementById("super-leniency-radio").checked?{allowLeniency:!0,allowSuperLeniency:!0,maxTolerance:1}:t.checked?{allowLeniency:!0,allowSuperLeniency:!1,maxTolerance:.5}:{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0}}function ce(c){let e=[];if(c.forEach(r=>{if(r.checked){let a=parseFloat(r.value);isNaN(a)||e.push(a)}}),e.length===0)return{availablePowers:[],powerRange:"",averagePower:0};e.sort((r,a)=>r-a);let t;e.length===1?t=e[0].toString():t=e.join(", ");let n=e.reduce((r,a)=>r+a,0)/e.length;return{availablePowers:e,powerRange:t,averagePower:Math.round(n*2)/2}}function ue(){let c=document.querySelector("#leniency-radio");return document.querySelector("#super-leniency-radio")?.checked?1:c?.checked?.5:0}function W(c){let e=c.players.flatMap(a=>"players"in a?a.players:[a]);if(e.length===0)return c.power.toString();let t=ue(),n=[],r=new Set;e.forEach(a=>{a.availablePowers.forEach(o=>r.add(o))});for(let a of r)e.every(s=>s.availablePowers.some(l=>Math.abs(a-l)<=t))&&n.push(a);return n.sort((a,o)=>a-o),n.length===0?c.power.toString():n.length===1?n[0].toString():n.every((o,s)=>s===0||o-n[s-1]<=.5)&&n.length>2?`${n[0]}-${n[n.length-1]}`:n.join(", ")}function z(c,e){let t=[];if(Array.isArray(c.availablePowers))t=c.availablePowers;else if(typeof c.powerRange=="string")if(c.powerRange.includes("-")){let[r,a]=c.powerRange.split("-").map(o=>parseFloat(o.trim()));for(let o=r;o<=a;o+=.5)t.push(o)}else t=c.powerRange.split(",").map(r=>parseFloat(r.trim()));return t.map(r=>e.includes(r)?`<span class="power-highlight">${r}</span>`:r.toString()).join(", ")}function de(c,e){let t=[];if(Array.isArray(c.availableBrackets))t=c.availableBrackets;else if(typeof c.bracketRange=="string")if(c.bracketRange.includes("-")){let[r,a]=c.bracketRange.split("-").map(l=>l.trim()),o=parseInt(r),s=parseInt(a);if(!isNaN(o)&&!isNaN(s))for(let l=o;l<=s;l++)t.push(l.toString());else t=[r,a]}else t=c.bracketRange.split(",").map(r=>r.trim());return t.map(r=>e.includes(r)?`<span class="bracket-highlight">${r}</span>`:r.toString()).join(", ")}function U(c){let e=c.players.flatMap(o=>"players"in o?o.players:[o]);if(e.length===0)return[];let t=new Map,n=new Set;if(e.forEach(o=>{o.availablePowers.length===1&&n.add(o.availablePowers[0]),o.availablePowers.forEach(s=>{t.set(s,(t.get(s)||0)+1)})}),t.size===0)return[];let r=Math.max(...t.values()),a=[];for(let[o,s]of t.entries())(s===r||n.has(o))&&a.push(o);return a.sort((o,s)=>o-s),a}var j=class{constructor(){this.groups=new Map;this.nextPlayerId=0;this.nextGroupId=1;this.availableColors=[];this.groupColorAssignments=new Map;this.initializeAvailableColors()}initializeAvailableColors(){this.availableColors=Array.from({length:50},(e,t)=>t+1),this.shuffleArray(this.availableColors)}shuffleArray(e){for(let t=e.length-1;t>0;t--){let n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}assignRandomColor(e){if(this.groupColorAssignments.has(e))return this.groupColorAssignments.get(e);this.availableColors.length===0&&this.initializeAvailableColors();let t=this.availableColors.pop();return this.groupColorAssignments.set(e,t),t}releaseColor(e){let t=this.groupColorAssignments.get(e);t&&(this.availableColors.push(t),this.groupColorAssignments.delete(e))}getNextPlayerId(){return this.nextPlayerId++}resetPlayerIds(){this.nextPlayerId=0}getNextGroupId(){let e=new Set;document.querySelectorAll(".group-select").forEach(n=>{if(n.value.startsWith("group-")){let r=parseInt(n.value.split("-")[1]);isNaN(r)||e.add(r)}if(n.value==="new-group"&&n.dataset.createdGroupId&&n.dataset.createdGroupId.startsWith("group-")){let r=parseInt(n.dataset.createdGroupId.split("-")[1]);isNaN(r)||e.add(r)}});for(let n=1;n<=50;n++)if(!e.has(n))return n;return this.nextGroupId++}resetGroupIds(){this.nextGroupId=1}getGroups(){return this.groups}clearGroups(){this.groups.clear()}getPlayerFromRow(e){let t=e.querySelector(".player-name");t.classList.remove("input-error");let n=t.value.trim();if(!n)return t.classList.add("input-error"),null;if(document.getElementById("bracket-radio").checked){let o=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),s=[];if(o.forEach(h=>{h.checked&&s.push(h.value)}),s.length===0)return e.querySelector(".bracket-selector-btn").classList.add("error"),null;e.querySelector(".bracket-selector-btn").classList.remove("error");let l={1:1,2:2,3:3,4:4,cedh:10},i=s.map(h=>l[h]),u=i.reduce((h,d)=>h+d,0)/i.length;return{id:parseInt(e.dataset.playerId),name:n,power:Math.round(u*2)/2,availablePowers:i,powerRange:s.join(", "),brackets:s,bracketRange:s.join(", "),rowElement:e}}else{let o=e.querySelectorAll('.power-checkbox input[type="checkbox"]'),s=ce(o);return s.availablePowers.length===0?(e.querySelector(".power-selector-btn").classList.add("error"),null):(e.querySelector(".power-selector-btn").classList.remove("error"),{id:parseInt(e.dataset.playerId),name:n,power:s.averagePower,availablePowers:s.availablePowers,powerRange:s.powerRange,rowElement:e})}}handleGroupChange(e){this.groups.clear();let t=Array.from(e.querySelectorAll(".player-row"));t.forEach(r=>{for(let a=1;a<=50;a++)r.querySelector(".group-select").classList.remove(`group-${a}`)});let n=new Set;t.forEach(r=>{let a=r.querySelector(".group-select");a.dataset.createdGroupId?n.add(a.dataset.createdGroupId):a.value.startsWith("group-")&&n.add(a.value)}),t.forEach(r=>{let a=r.querySelector(".group-select"),o="";if(a.value==="new-group"){a.dataset.createdGroupId?o=a.dataset.createdGroupId:(o=`group-${this.getNextGroupId()}`,n.add(o),a.dataset.createdGroupId=o);let s=this.getPlayerFromRow(r);s&&(this.groups.has(o)||this.groups.set(o,[]),this.groups.get(o).push(s))}else if(a.value.startsWith("group-")){o=a.value;let s=this.getPlayerFromRow(r);s&&(this.groups.has(a.value)||this.groups.set(a.value,[]),this.groups.get(a.value).push(s))}else a.dataset.createdGroupId&&delete a.dataset.createdGroupId;if(o){let s=parseInt(o.split("-")[1]);s>=1&&s<=50&&a.classList.add(`group-${s}`)}}),this.cleanupUnusedGroups(n),this.updateAllGroupDropdowns(e)}updateAllGroupDropdowns(e){let t=new Set,n=Array.from(e.querySelectorAll(".player-row"));n.forEach(r=>{let a=r.querySelector(".group-select");a.value==="new-group"&&a.dataset.createdGroupId?t.add(a.dataset.createdGroupId):a.value.startsWith("group-")&&t.add(a.value)}),n.forEach(r=>{let a=r.querySelector(".group-select"),o=a.value,s=a.dataset.createdGroupId;if(Array.from(a.options).forEach(i=>{i.value.startsWith("group-")&&a.remove(i.index)}),t.forEach(i=>{let u=i.split("-")[1],h=new Option(`Group ${u}`,i);a.add(h)}),s&&t.has(s)&&(o==="new-group"||o==="no-group")){a.value=s;let i=parseInt(s.split("-")[1]);i>=1&&i<=50&&a.classList.add(`group-${i}`)}else if(o.startsWith("group-")&&t.has(o)){a.value=o;let i=parseInt(o.split("-")[1]);i>=1&&i<=50&&a.classList.add(`group-${i}`)}else{a.value="no-group";for(let i=1;i<=50;i++)a.classList.remove(`group-${i}`)}})}arePlayersCompatible(e,t,n){return e.availablePowers.some(a=>t.availablePowers.some(o=>Math.abs(a-o)<.01))?!0:n.allowLeniency?e.availablePowers.some(a=>t.availablePowers.some(o=>Math.abs(a-o)<=n.maxTolerance)):!1}findAllCommonPowers(e,t){return e.length===0?[]:[...new Set(e.flatMap(r=>r.availablePowers))].sort((r,a)=>r-a).filter(r=>e.every(a=>a.availablePowers.some(o=>{let s=Math.abs(o-r);return s<.01||t.allowLeniency&&s<=t.maxTolerance})))}findBestCommonPowerLevel(e){if(e.length===0)return null;let t=new Map;for(let a of e)for(let o of a.availablePowers)t.set(o,(t.get(o)||0)+1);if(t.size===0)return null;let n=e[0].availablePowers[0],r=0;for(let[a,o]of t.entries())o>r&&(r=o,n=a);return n}calculatePodPower(e){if(e.length===0)return 0;let t=e.reduce((n,r)=>{if("players"in r)return n+r.averagePower;{let a=r.powerRange.split(",").map(s=>parseFloat(s.trim())),o=a.reduce((s,l)=>s+l,0)/a.length;return n+o}},0);return Math.round(t/e.length*10)/10}cleanupUnusedGroups(e){Array.from(this.groupColorAssignments.keys()).forEach(a=>{e.has(a)||this.releaseColor(a)}),Array.from(this.groups.keys()).forEach(a=>{e.has(a)||this.groups.delete(a)}),document.querySelectorAll(".group-select").forEach(a=>{let o=a.dataset.createdGroupId;o&&!e.has(o)&&delete a.dataset.createdGroupId})}};var _=class{constructor(){this.shuffleSeed=null;this.sizeCache=new Map}setShuffleSeed(e){this.shuffleSeed=e,this.sizeCache.clear()}seededRandom(e){let t=e;return()=>(t=t*1103515245+12345&2147483647,t/2147483647)}shuffleArray(e){let t=[...e],n;this.shuffleSeed!==null?n=this.seededRandom(this.shuffleSeed):n=Math.random;for(let r=t.length-1;r>0;r--){let a=Math.floor(n()*(r+1));[t[r],t[a]]=[t[a],t[r]]}return t}getItemSize(e){let t="players"in e?`group-${e.id}`:`player-${e.id}`;if(!this.sizeCache.has(t)){let n="players"in e?e.size:1;this.sizeCache.set(t,n)}return this.sizeCache.get(t)}getItemId(e){return"players"in e?e.id:e.id.toString()}generatePodsWithBacktracking(e,t,n){let r=this.shuffleArray(e),a=r.reduce((i,u)=>i+("size"in u?u.size:1),0);if(a>=3&&a<=5){let i=r.flatMap(h=>"players"in h?h.players:[h]),u=this.findBestCommonPowerLevel(i);return u!==null?{pods:[{players:r,power:u}],unassigned:[]}:{pods:[],unassigned:r}}let o=this.findOptimalPodAssignment(r,t,n),s=new Set;for(let i of o)for(let u of i.players)"players"in u?s.add(u.id):s.add(u.id.toString());let l=r.filter(i=>"players"in i?!s.has(i.id):!s.has(i.id.toString()));return{pods:o,unassigned:l}}findOptimalPodAssignment(e,t,n){return this.optimizeVirtualPlayerAssignmentUnified(e,t,n)}optimizeVirtualPlayerAssignmentUnified(e,t,n){if(e.length===0)return[];let r=this.createVirtualPlayersUnified(e),a=new Map;for(let s of r)a.has(s.powerLevel)||a.set(s.powerLevel,[]),a.get(s.powerLevel).push(s);let o={pods:[],totalPods:0};return n.allowLeniency?this.backtrackVirtualPlayersWithLeniencyUnified(r,t,n.maxTolerance,[],new Set,t,o):this.backtrackVirtualPlayersUnified(Array.from(a.entries()),[],new Set,t,o),o.pods}createVirtualPlayersUnified(e){let t=[];for(let n of e)if("players"in n){let r=n.players.flatMap(u=>u.availablePowers),a=Math.min(...r),o=Math.max(...r),l=[n.averagePower,a,o],i=[...new Set(l)];for(let u of i)t.push({item:n,powerLevel:u})}else for(let r of n.availablePowers)t.push({item:n,powerLevel:r});return t}backtrackVirtualPlayersUnified(e,t,n,r,a){if(r.length===0){t.length>a.totalPods&&(a.pods=[...t],a.totalPods=t.length);return}if(t.length+r.length<=a.totalPods)return;let o=r[0],s=r.slice(1);for(let[l,i]of e){let u=i.filter(E=>{let y=this.getItemId(E.item);return!n.has(y)}),h=0;for(let E=0;E<u.length;E++)h+=this.getItemSize(u[E].item);let d=Math.max(3,o);if(h>=d){let E=u.sort((p,b)=>{let g=this.getItemSize(p.item);return this.getItemSize(b.item)-g}),y=[],L=new Set,m=0;for(let p of E){let b=this.getItemId(p.item),g=this.getItemSize(p.item);if(!L.has(b)&&m+g<=o&&(y.push(p),L.add(b),m+=g,m===o))break}if(m>=3){let p=y.map(f=>f.item),b={players:p,power:l},g=new Set(n);for(let f of p){let k="players"in f?f.id:f.id.toString();g.add(k)}this.backtrackVirtualPlayersUnified(e,[...t,b],g,s,a)}}}this.backtrackVirtualPlayersUnified(e,t,n,s,a)}backtrackVirtualPlayersWithLeniencyUnified(e,t,n,r,a,o,s){if(o.length===0){r.length>s.totalPods&&(s.pods=[...r],s.totalPods=r.length);return}if(r.length+o.length<=s.totalPods)return;let l=o[0],i=o.slice(1),u=e.filter(d=>{let E="players"in d.item?d.item.id:d.item.id.toString();return!a.has(E)}),h=[...new Set(u.map(d=>d.powerLevel))].sort((d,E)=>d-E);for(let d of h){let E=u.filter(g=>("players"in g.item,Math.abs(g.powerLevel-d)<=n)),y=new Map;for(let g of E){let f="players"in g.item?g.item.id:g.item.id.toString();if(!y.has(f))y.set(f,g);else{let k=y.get(f),S=Math.abs(k.powerLevel-d);Math.abs(g.powerLevel-d)<S&&y.set(f,g)}}let m=Array.from(y.values()).sort((g,f)=>{if("players"in g.item&&"players"in f.item){let k=Math.abs(g.powerLevel-g.item.averagePower)<.01,S=Math.abs(f.powerLevel-f.item.averagePower)<.01;return k&&!S?-1:!k&&S?1:Math.abs(g.powerLevel-d)-Math.abs(f.powerLevel-d)}return"players"in g.item&&!("players"in f.item)?1:!("players"in g.item)&&"players"in f.item?-1:Math.abs(g.powerLevel-d)-Math.abs(f.powerLevel-d)}),p=0;for(let g=0;g<m.length;g++)p+=this.getItemSize(m[g].item);let b=Math.max(3,l);if(p>=b){let g=m.sort((v,P)=>{let w=this.getItemSize(v.item);return this.getItemSize(P.item)-w}),f=[],k=new Set,S=0;for(let v of g){let P=this.getItemId(v.item),w=this.getItemSize(v.item);if(!k.has(P)&&S+w<=l&&(f.push(v),k.add(P),S+=w,S===l))break}if(S>=3){let v=f.map(x=>x.item);if(!this.isPodPowerSpreadValid(f,n))continue;let P=f.reduce((x,H)=>x+H.powerLevel,0)/f.length,w={players:v,power:Math.round(P*2)/2},T=new Set(a);for(let x of v){let H="players"in x?x.id:x.id.toString();T.add(H),e.forEach(D=>{let oe="players"in D.item?D.item.id:D.item.id.toString();oe===H&&T.add(oe)})}this.backtrackVirtualPlayersWithLeniencyUnified(e,t,n,[...r,w],T,i,s)}}}this.backtrackVirtualPlayersWithLeniencyUnified(e,t,n,r,a,i,s)}isPodPowerSpreadValid(e,t){if(e.length===0)return!0;let n=e.map(s=>s.powerLevel),r=Math.min(...n);return Math.max(...n)-r<=t}findBestCommonPowerLevel(e){if(e.length===0)return null;let t=new Map;for(let a of e)for(let o of a.availablePowers)t.set(o,(t.get(o)||0)+1);if(t.size===0)return null;let n=e[0].availablePowers[0],r=0;for(let[a,o]of t.entries())o>r&&(r=o,n=a);return n}};var Q=class{constructor(e,t){this.draggedElement=null;this.draggedItemData=null;this.currentPods=[];this.currentUnassigned=[];this.handleDragStart=e=>{let t=e.target;this.draggedElement=t,t.classList.add("dragging"),this.draggedItemData={type:t.dataset.itemType,id:t.dataset.itemId,podIndex:t.dataset.podIndex,itemIndex:t.dataset.itemIndex},e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",t.outerHTML)};this.handleDragEnd=e=>{e.target.classList.remove("dragging"),this.draggedElement=null,this.draggedItemData=null};this.handleDragOver=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",e.currentTarget.classList.add("drag-over")};this.handleDragLeave=e=>{e.currentTarget.classList.remove("drag-over")};this.handleDrop=e=>{e.preventDefault();let t=e.currentTarget;if(t.classList.remove("drag-over"),!this.draggedItemData)return;let n=t.dataset.podIndex,r=this.draggedItemData.podIndex;n!==r&&this.moveItemBetweenPods(this.draggedItemData,n)};this.playerManager=e,this.onPodsChanged=t}setCurrentPods(e,t=[]){this.currentPods=[...e],this.currentUnassigned=[...t]}moveItemBetweenPods(e,t){let n=e.podIndex,r=parseInt(e.itemIndex),a=null;if(n==="unassigned")a=this.currentUnassigned[r],this.currentUnassigned.splice(r,1);else{let o=this.currentPods[parseInt(n)];a=o.players[r],o.players.splice(r,1),o.power=this.playerManager.calculatePodPower(o.players)}if(a){if(t==="unassigned")this.currentUnassigned.push(a);else if(t==="new-pod"){let o={players:[a],power:this.playerManager.calculatePodPower([a])};this.currentPods.push(o)}else{let o=this.currentPods[parseInt(t)];o.players.push(a),o.power=this.playerManager.calculatePodPower(o.players)}this.cleanupEmptyPods(),this.onPodsChanged(this.currentPods,this.currentUnassigned)}}cleanupEmptyPods(){this.currentPods=this.currentPods.filter(e=>e.players.length>0)}};var Y=class{constructor(){this.isDisplayMode=!1;this.handleKeyDown=null;this.borderColors=["#FF6B6B","#4ECDC4","#45B7D1","#FFA726","#66BB6A","#AB47BC","#EF5350","#26A69A","#42A5F5","#FF7043","#9CCC65","#7E57C2","#EC407A","#29B6F6","#FFCA28","#8BC34A","#673AB7","#F06292","#00BCD4","#FFEB3B","#795548","#607D8B","#E91E63","#009688","#FF9800"]}getShuffledColors(e){let t=[...this.borderColors];for(let n=t.length-1;n>0;n--){let r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}if(e>t.length){let n=[];for(let r=0;r<e;r++)n.push(t[r%t.length]);return n}return t.slice(0,e)}calculateOptimalWidthForText(e){let t=0;for(let a of e)a===" "?t+=.3:/[iIl1]/.test(a)?t+=.4:/[mwMW]/.test(a)?t+=.8:/[A-Z]/.test(a)?t+=.7:t+=.6;let n=t*1.2,r=Math.min(85,Math.max(25,n/25*85));return Math.round(r)}calculateFontSizeForPod(e,t,n){let r=e*t,a=Math.ceil(Math.sqrt(n)),o=Math.ceil(n/a),s=(e-(a-1)*10)/a,l=(t-(o-1)*10)/o,i=Math.min(s,l),u=Math.min(i*.25,l*.35),h=Math.max(.9,1-(n-3)*.02),d=Math.max(24,Math.min(72,u*h));return`${Math.round(d)}px`}calculateValidBracketRange(e){let t=e.players.flatMap(o=>"players"in o?o.players:[o]);if(t.length===0)return"Unknown";let n=[],r=new Set;t.forEach(o=>{o.brackets&&o.brackets.forEach(s=>r.add(s))});for(let o of r)t.every(l=>l.brackets&&l.brackets.includes(o))&&n.push(o);let a=["1","2","3","4","cedh"];if(n.sort((o,s)=>a.indexOf(o)-a.indexOf(s)),n.length===0)return"Unknown";if(n.length===1)return n[0];{let o=n.filter(l=>l!=="cedh");return o.length>1&&o.every((l,i)=>{if(i===0)return!0;let u=parseInt(l),h=parseInt(o[i-1]);return u===h+1})&&o.length===n.length&&n.length>1?`${n[0]}-${n[n.length-1]}`:n.join(", ")}}getValidBracketsArrayForPod(e){let t=e.players.flatMap(s=>"players"in s?s.players:[s]);if(t.length===0)return[];let n=new Map;if(t.forEach(s=>{s.brackets&&s.brackets.forEach(l=>{n.set(l,(n.get(l)||0)+1)})}),n.size===0)return[];let r=Math.ceil(t.length/2),a=[];for(let[s,l]of n.entries())l>=r&&a.push(s);let o=["1","2","3","4","cedh"];return a.sort((s,l)=>o.indexOf(s)-o.indexOf(l)),a}enterDisplayMode(e){if(e.length===0)return;this.isDisplayMode=!0,document.body.classList.add("display-mode");let t=Math.ceil(Math.sqrt(e.length)),n=document.createElement("div");n.className="display-mode-container",n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100vw",n.style.height="100vh",n.style.background="#1a1a1a",n.style.zIndex="1000",n.style.padding="20px",n.style.boxSizing="border-box",n.style.overflow="hidden",n.innerHTML=`
            <div class="display-mode-controls">
                <button id="exit-display-btn">Exit Display Mode</button>
            </div>
            <h1 style="text-align: center; margin: 0 0 20px 0; font-size: 2.5rem; color: white;">MTG Commander Pods</h1>
            <div id="display-output" style="flex-grow: 1; height: calc(100vh - 140px);"></div>
        `;let r=document.querySelector(".container");r&&(r.style.display="none"),document.body.appendChild(n);let a=n.querySelector("#display-output"),o=document.createElement("div");o.style.display="grid",o.style.gap="20px",o.style.height="100%",o.style.gridTemplateColumns=`repeat(${t}, 1fr)`,o.style.gridTemplateRows=`repeat(${t}, 1fr)`;let s=this.getShuffledColors(e.length);e.forEach((i,u)=>{let h=document.createElement("div");h.style.display="flex",h.style.flexDirection="column",h.style.background="#2a2a2a",h.style.border=`3px solid ${s[u]}`,h.style.borderRadius="8px",h.style.padding="15px",h.style.boxSizing="border-box",h.style.minHeight="0",h.style.boxShadow=`0 0 10px ${s[u]}40`,h.classList.add("pod",`pod-color-${u%10}`);let d=document.createElement("h3"),E=document.getElementById("bracket-radio"),y=E&&E.checked;if(y){let v=this.calculateValidBracketRange(i);d.textContent=`Pod ${u+1} (Bracket: ${v})`}else{let v=W(i);d.textContent=`Pod ${u+1} (Power: ${v})`}d.style.fontSize="1.6rem",d.style.margin="0 0 15px 0",d.style.textAlign="center",d.style.color=s[u],d.style.fontWeight="bold",d.style.flexShrink="0",d.style.textShadow="1px 1px 2px rgba(0,0,0,0.8)",h.appendChild(d);let L=0;i.players.forEach(v=>{"players"in v?L+=v.players.length:L+=1});let m="";i.players.forEach(v=>{if("players"in v)v.players.forEach(P=>{let w=y&&P.bracketRange?`${P.name} (B: ${P.bracketRange})`:`${P.name} (P: ${P.powerRange})`;w.length>m.length&&(m=w)});else{let P=y&&v.bracketRange?`${v.name} (B: ${v.bracketRange})`:`${v.name} (P: ${v.powerRange})`;P.length>m.length&&(m=P)}});let p=document.createElement("ul");p.style.flexGrow="1",p.style.display="flex";let b=Math.ceil(Math.sqrt(L)),g=Math.ceil(L/b);p.style.display="grid",p.style.gridTemplateColumns=`repeat(${b}, 1fr)`,p.style.gridTemplateRows=`repeat(${g}, 1fr)`,p.style.gap="12px",p.style.margin="0",p.style.padding="0",p.style.listStyle="none",p.style.width="100%",p.style.height="100%",p.style.alignItems="stretch",p.style.justifyItems="stretch";let f=[];i.players.forEach(v=>{"players"in v?v.players.forEach(P=>f.push(P)):f.push(v)});let k=document.getElementById("bracket-radio"),S=k&&k.checked;f.forEach((v,P)=>{let w=document.createElement("li"),T=document.createElement("div");T.textContent=v.name,T.className="player-name";let x=document.createElement("div");if(S&&v.bracketRange){let H=this.getValidBracketsArrayForPod(i),D=de(v,H);x.innerHTML=`B: ${D}`}else{let H=U(i),D=z(v,H);x.innerHTML=`P: ${D}`}x.className="player-power",w.appendChild(T),w.appendChild(x),w.style.display="flex",w.style.flexDirection="column",w.style.justifyContent="center",w.style.alignItems="center",w.style.backgroundColor="rgba(255, 255, 255, 0.12)",w.style.border="2px solid rgba(255, 255, 255, 0.2)",w.style.borderRadius="12px",w.style.padding="8px",w.style.boxSizing="border-box",w.style.textAlign="center",w.style.height="100%",T.style.color="#ffffff",T.style.fontWeight="bold",T.style.lineHeight="1.1",T.style.marginBottom="4px",T.style.wordBreak="break-word",T.style.hyphens="auto",T.style.flexGrow="1",T.style.display="flex",T.style.alignItems="center",T.style.justifyContent="center",x.style.color="#b0b0b0",x.style.fontWeight="500",x.style.lineHeight="1",x.style.opacity="0.9",w.dataset.podRef=u.toString(),w.classList.add("dynamic-font-item"),p.appendChild(w)}),h.appendChild(p),o.appendChild(h)}),a.appendChild(o),requestAnimationFrame(()=>{o.querySelectorAll(".pod").forEach((u,h)=>{let d=u.getBoundingClientRect(),E=d.width,y=d.height,L=0;e[h].players.forEach(b=>{"players"in b?L+=b.players.length:L+=1});let m=this.calculateFontSizeForPod(E,y,L);u.querySelectorAll(".dynamic-font-item").forEach(b=>{let g=b.querySelector(".player-name"),f=b.querySelector(".player-power");if(g&&(g.style.fontSize=m),f){let k=Math.round(parseInt(m)*.75);f.style.fontSize=`${k}px`}})})}),n.querySelector("#exit-display-btn").addEventListener("click",()=>this.exitDisplayMode()),this.handleKeyDown=i=>{i.key==="Escape"&&this.isDisplayMode&&this.exitDisplayMode()},document.addEventListener("keydown",this.handleKeyDown)}exitDisplayMode(){this.isDisplayMode=!1,document.body.classList.remove("display-mode");let e=document.querySelector(".container");e&&(e.style.display="");let t=document.querySelector(".display-mode-container");t&&t.remove(),this.handleKeyDown&&(document.removeEventListener("keydown",this.handleKeyDown),this.handleKeyDown=null)}getIsDisplayMode(){return this.isDisplayMode}};var ee=class{constructor(){this.listeners=new Map;this.abortController=new AbortController}addEventListener(e,t,n,r){let a=this.generateId(),o={...typeof r=="object"?r:{capture:r},signal:this.abortController.signal};return e.addEventListener(t,n,o),this.listeners.set(a,{element:e,type:t,listener:n,options:o}),a}removeEventListener(e){let t=this.listeners.get(e);return t?(t.element.removeEventListener(t.type,t.listener,t.options),this.listeners.delete(e),!0):!1}removeAllFromElement(e){let t=0;for(let[n,r]of this.listeners.entries())r.element===e&&(r.element.removeEventListener(r.type,r.listener,r.options),this.listeners.delete(n),t++);return t}removeAll(){this.abortController.abort(),this.abortController=new AbortController,this.listeners.clear()}getListenerCount(){return this.listeners.size}generateId(){return`listener_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}},te=new ee;var M=class{static clearDuplicateErrors(e){e.forEach(t=>{let n=t.querySelector(".player-name");n&&n.classList.remove("name-duplicate-error",...this.DUPLICATE_ERROR_CLASSES)})}static highlightDuplicateNames(e){this.clearDuplicateErrors(e);let t=new Map;e.forEach(a=>{let o=a.querySelector(".player-name");if(o){let s=o.value.trim().toLowerCase();s&&(t.has(s)||t.set(s,[]),t.get(s).push(o))}});let n=[],r=0;return t.forEach((a,o)=>{if(a.length>1){n.push(o);let s=this.DUPLICATE_ERROR_CLASSES[r];a.forEach(l=>{l.classList.add(s)}),r=(r+1)%this.DUPLICATE_ERROR_CLASSES.length}}),n}static hasSelectedCheckboxes(e){return Array.from(e).some(t=>t.checked)}static getSelectedCheckboxValues(e){return Array.from(e).filter(t=>t.checked).map(t=>t.value)}static addValidationError(e,t="error"){e.classList.add(t),e.dataset&&(e.dataset.validationTriggered="true")}static removeValidationError(e,t="error"){e.classList.remove(t)}static hasValidationError(e,t="error"){return e.classList.contains(t)}};M.DUPLICATE_ERROR_CLASSES=["name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5"];var $=class{static formatPowerButtonText(e){if(e.length===0)return"Select Power Levels";if(e.sort((a,o)=>a-o),e.length===1)return`Power: ${e[0]}`;let t=e[0],n=e[e.length-1];return e.every((a,o)=>{if(o===0)return!0;let s=a-e[o-1];return s===.5||s===1})&&e.length>2?`Power: ${t}-${n}`:e.length<=4?`Power: ${e.join(", ")}`:`Power: ${t}-${n} (${e.length} levels)`}static formatBracketButtonText(e){return e.length===0?"Select Brackets":e.length===1?`Bracket: ${e[0]==="cedh"?"cEDH":e[0]}`:e.length<=3?`Brackets: ${e.join(", ")}`:`Brackets: ${e.length} selected`}static updateButtonState(e,t,n){e.textContent=t,n?(e.classList.add("has-selection"),M.removeValidationError(e)):(e.classList.remove("has-selection"),e.dataset.validationTriggered==="true"&&M.addValidationError(e))}},R=class{static getElement(e,t,n){let r=e.querySelector(t);return r?n&&!n(r)?(console.warn(`Element ${t} found but failed type check`),null):r:null}static getAllElements(e,t,n){let r=Array.from(e.querySelectorAll(t));return n?r.filter(n):r}static setClasses(e,t,n=!0){n?e.classList.add(...t):e.classList.remove(...t)}static toggleClass(e,t,n){n?e.classList.add(t):e.classList.remove(t)}},V=class{static addEventListener(e,t,n,r){return e.addEventListener(t,n,r),()=>{e.removeEventListener(t,n,r)}}static debounce(e,t){let n;return(...r)=>{clearTimeout(n),n=window.setTimeout(()=>e(...r),t)}}static throttle(e,t){let n;return(...r)=>{n||(e(...r),n=!0,setTimeout(()=>n=!1,t))}}};var G=class{static updatePowerButton(e){let t=R.getElement(e,".power-selector-btn");if(!t)return;let n=e.querySelectorAll('.power-checkbox input[type="checkbox"]'),r=[];n.forEach(s=>{s.checked&&r.push(parseFloat(s.value))});let a=$.formatPowerButtonText(r),o=r.length>0;$.updateButtonState(t,a,o)}static updateBracketButton(e){let t=R.getElement(e,".bracket-selector-btn");if(!t)return;let n=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),r=M.getSelectedCheckboxValues(n),a=$.formatBracketButtonText(r),o=r.length>0;$.updateButtonState(t,a,o)}static updateAllButtonsForRow(e){this.updatePowerButton(e),this.updateBracketButton(e)}static updateAllButtons(e){R.getAllElements(e,".player-row").forEach(n=>this.updateAllButtonsForRow(n))}static createPowerButtonUpdater(e){return()=>this.updatePowerButton(e)}static createBracketButtonUpdater(e){return()=>this.updateBracketButton(e)}static createRowButtonUpdater(e){return()=>this.updateAllButtonsForRow(e)}static triggerValidationForRow(e){let n=document.getElementById("bracket-radio")?.checked??!1,r=R.getElement(e,".power-selector-btn"),a=R.getElement(e,".bracket-selector-btn");if(r&&(r.dataset.validationTriggered="true"),a&&(a.dataset.validationTriggered="true"),n&&a){let o=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]');M.hasSelectedCheckboxes(o)||M.addValidationError(a)}else if(r){let o=e.querySelectorAll('.power-checkbox input[type="checkbox"]');M.hasSelectedCheckboxes(o)||M.addValidationError(r)}}static triggerValidationForAllRows(e){R.getAllElements(e,".player-row").forEach(n=>this.triggerValidationForRow(n))}};var ne=class{constructor(){this.cache=new Map;this.weakRefCache=new WeakMap}get(e,t=document){let n=this.getCacheKey(e,t);if(this.cache.has(n)){let a=this.cache.get(n);if(a&&a.isConnected)return a;this.cache.delete(n)}let r=t.querySelector(e);return r&&this.cache.set(n,r),r}getAll(e,t=document){let n=this.getCacheKey(e+":all",t);if(this.cache.has(n)){let a=this.cache.get(n);if(a&&a.length>0&&a[0].isConnected)return a;this.cache.delete(n)}let r=t.querySelectorAll(e);return this.cache.set(n,r),r}getFromRow(e,t){let n=this.weakRefCache.get(e);if(n||(n=new Map,this.weakRefCache.set(e,n)),n.has(t)){let a=n.get(t);if(a&&a.isConnected)return a;n.delete(t)}let r=e.querySelector(t);return r&&n.set(t,r),r}getAllFromRow(e,t){let n=this.weakRefCache.get(e);n||(n=new Map,this.weakRefCache.set(e,n));let r=t+":all";if(n.has(r)){let o=n.get(r);if(o&&o.length>0&&o[0].isConnected)return o;n.delete(r)}let a=e.querySelectorAll(t);return n.set(r,a),a}invalidate(e,t=document){if(e){let n=this.getCacheKey(e,t);this.cache.delete(n),this.cache.delete(n+":all")}else this.cache.clear()}clear(){this.cache.clear()}getCacheKey(e,t){return t===document?e:`${e}@${t.tagName}:${t.className}`}},C=new ne;var N=class N{constructor(){this.nameValidationCallbacks=new Map;this.duplicateCheckCallback=null}setupNameValidation(e,t){this.duplicateCheckCallback||(this.duplicateCheckCallback=V.debounce(t,N.VALIDATION_DEBOUNCE_MS));let n=V.debounce(()=>{e.dataset.touched="true",!e.value.trim()&&e.dataset.touched==="true"?M.addValidationError(e,"input-error"):M.removeValidationError(e,"input-error"),this.duplicateCheckCallback&&this.duplicateCheckCallback()},N.VALIDATION_DEBOUNCE_MS);this.nameValidationCallbacks.set(e,n),e.addEventListener("input",n)}setupDropdownToggle(e,t,n){let r=V.throttle(a=>{a.preventDefault();let o=t.style.display!=="none";n(),o||(t.style.display="block",e.classList.add("open"),setTimeout(()=>t.classList.add("show"),10))},N.DROPDOWN_THROTTLE_MS);e.addEventListener("click",r)}batchValidateRows(e){let t=performance.now(),n=Array.from(e.querySelectorAll(".player-row")),r=!1,a=M.highlightDuplicateNames(n);return a.length>0&&(r=!0),n.forEach(s=>{let l=s.querySelector(".player-name");l.value.trim()||(M.addValidationError(l,"input-error"),r=!0)}),G.triggerValidationForAllRows(e),{validationTime:performance.now()-t,duplicateNames:a,hasErrors:r}}cleanup(){this.nameValidationCallbacks.clear(),this.duplicateCheckCallback=null}static trackValidationPerformance(e){e>100&&console.warn(`Slow validation detected: ${e.toFixed(2)}ms`),"performance"in window&&"mark"in performance&&performance.mark(`validation-${Date.now()}`)}};N.VALIDATION_DEBOUNCE_MS=300,N.DROPDOWN_THROTTLE_MS=100;var re=N,J=new re;function A(c){return c instanceof HTMLElement}function F(c){return c instanceof HTMLInputElement}function q(c){return c instanceof HTMLButtonElement}function B(c,e){let t=document.getElementById(c);return t?e(t)?t:(console.warn(`Element #${c} exists but is not the expected type`),null):null}function O(c,e){let t=c.target;return!t||!e(t)?null:t}function I(c,e){if(c==null)throw new Error(e||"Assertion failed: value is null or undefined");return c}var ae=class{constructor(){this.metrics={bundleSize:"59.2kb",memoryUsage:0,domCacheHits:0,validationTime:0,podGenerationTime:0,lastUpdated:new Date}}updateMemoryUsage(){"memory"in performance&&(this.metrics.memoryUsage=Math.round((performance.memory?.usedJSHeapSize||0)/1024/1024*100)/100),this.metrics.lastUpdated=new Date}trackValidationTime(e){this.metrics.validationTime=Math.round(e*100)/100,this.metrics.lastUpdated=new Date}trackPodGenerationTime(e){this.metrics.podGenerationTime=Math.round(e*100)/100,this.metrics.lastUpdated=new Date}getMetrics(){return this.updateMemoryUsage(),{...this.metrics}}logMetrics(){let e=this.getMetrics();console.group("\u{1F50D} Performance Analysis"),console.log("\u{1F4E6} Bundle Size:",e.bundleSize,"(+7.1kb from 52.1kb baseline)"),console.log("\u{1F4CA} Growth Rate: +13.6% (efficient for added functionality)"),console.log("\u{1F4BE} Memory Usage:",`${e.memoryUsage}MB`),console.log("\u26A1 Validation Time:",`${e.validationTime}ms`),console.log("\u{1F3AF} Pod Generation:",`${e.podGenerationTime}ms`),console.group("\u{1F4C8} Helper Module Impact"),console.log("\u2705 ButtonTextManager: +2.7kb (display state management)"),console.log("\u2705 DOMCache: +1.2kb (query optimization)"),console.log("\u2705 RealTimeValidator: +1.5kb (instant feedback)"),console.log("\u2705 TypeGuards: +0.7kb (runtime type safety)"),console.log("\u2705 PerformanceMonitor: +1.0kb (metrics tracking)"),console.groupEnd(),console.log("\u{1F3AF} Next: Validation consolidation & event optimization"),console.groupEnd()}},Z=new ae,X=class{constructor(){this.currentPods=[];this.currentUnassigned=[];this.lastResetData=null;this.isRestoring=!1;this.displayModeBtnBottom=null;this.reusablePlayerArray=[];this.reusableItemArray=[];this.containerClickHandler=null;this.containerChangeHandler=null;this.containerInputHandler=null;this.documentClickHandler=null;this.playerRowsContainer=I(B("player-rows",A),"player-rows container is required"),this.outputSection=I(B("output-section",A),"output-section is required"),this.displayModeBtn=I(B("display-mode-btn",q),"display-mode-btn is required"),this.playerRowTemplate=I(document.getElementById("player-row-template"),"player-row-template is required"),this.playerManager=new j,this.podGenerator=new _,this.dragDropManager=new Q(this.playerManager,(e,t)=>this.renderPods(e,t)),this.displayModeManager=new Y,this.initializeEventListeners(),this.initializeRankingModeToggle(),this.setupRealTimeValidationForExistingRows(),window.performanceMonitor=Z}initializeEventListeners(){let e=I(B("add-player-btn",q),"add-player-btn is required"),t=I(B("bulk-add-btn",q),"bulk-add-btn is required"),n=I(B("generate-pods-btn",q),"generate-pods-btn is required"),r=I(B("reset-all-btn",q),"reset-all-btn is required"),a=I(B("help-btn",q),"help-btn is required");e.addEventListener("click",()=>this.addPlayerRow()),t.addEventListener("click",()=>this.bulkAddPlayers(4)),n.addEventListener("click",()=>this.generatePods()),r.addEventListener("click",()=>this.resetAllWithConfirmation()),this.displayModeBtn.addEventListener("click",()=>this.displayModeManager.enterDisplayMode(this.currentPods)),a.addEventListener("click",()=>this.showHelpModal()),this.setupEventDelegation(),this.initializeHelpModal(),this.initializeKeyboardShortcuts()}getCachedElements(e){return Array.from(this.playerRowsContainer.querySelectorAll(e))}clearDOMCache(){C.clear()}getBracketRadio(){return B("bracket-radio",F)}getPooledElement(e){return null}returnToPool(e,t){}getDropdownsOptimized(){return document.querySelectorAll(".bracket-selector-dropdown, .power-selector-dropdown")}getButtonsOptimized(){return document.querySelectorAll(".bracket-selector-btn, .power-selector-btn")}addEventListenerWithTracking(e,t,n){te.addEventListener(e,t,n)}removeAllEventListeners(e){te.removeAllFromElement(e)}setupEventDelegation(){this.containerClickHandler||(this.containerClickHandler=e=>this.handleContainerClick(e),this.playerRowsContainer.addEventListener("click",this.containerClickHandler)),this.containerChangeHandler||(this.containerChangeHandler=e=>this.handleContainerChange(e),this.playerRowsContainer.addEventListener("change",this.containerChangeHandler)),this.containerInputHandler||(this.containerInputHandler=e=>this.handleContainerInput(e),this.playerRowsContainer.addEventListener("input",this.containerInputHandler)),this.documentClickHandler||(this.documentClickHandler=e=>this.handleDocumentClick(e),document.addEventListener("click",this.documentClickHandler))}setupRealTimeValidationForExistingRows(){C.getAll(".player-row",this.playerRowsContainer).forEach(t=>{let n=C.getFromRow(t,".player-name");n&&J.setupNameValidation(n,()=>this.clearDuplicateErrorsOnInput())})}handleContainerClick(e){let t=O(e,A);if(t){if(t.classList.contains("power-selector-btn")){this.handlePowerSelectorClick(e,t);return}if(t.classList.contains("bracket-selector-btn")){this.handleBracketSelectorClick(e,t);return}if(t.classList.contains("range-btn")){this.handleRangeButtonClick(t);return}if(t.classList.contains("bracket-range-btn")){this.handleBracketRangeButtonClick(t);return}if(t.classList.contains("clear-btn")||t.classList.contains("bracket-clear-btn")){this.handleClearButtonClick(t);return}if(t.classList.contains("remove-player-btn")){this.handleRemoveButtonClick(t);return}}}handleContainerChange(e){let t=O(e,A);if(t){if(t.classList.contains("group-select")){this.playerManager.handleGroupChange(this.playerRowsContainer);return}if(F(t)&&t.type==="checkbox"&&t.closest(".power-checkbox")){this.handlePowerCheckboxChange(t);return}if(F(t)&&t.type==="checkbox"&&t.closest(".bracket-checkbox")){this.handleBracketCheckboxChange(t);return}if(t.classList.contains("player-name")&&F(t)){this.handlePlayerNameChange(t);return}}}handleContainerInput(e){let t=O(e,A);if(t&&t.classList.contains("player-name")){let n=O(e,F);n&&this.handlePlayerNameChange(n);return}}handleDocumentClick(e){let t=O(e,A);t&&!t.closest(".power-selector-btn")&&!t.closest(".power-selector-dropdown")&&!t.closest(".bracket-selector-btn")&&!t.closest(".bracket-selector-dropdown")&&this.closeAllDropdowns()}closeAllDropdowns(){this.getDropdownsOptimized().forEach(e=>{e.style.display="none",e.classList.remove("show")}),this.getButtonsOptimized().forEach(e=>{e.classList.remove("open")})}handlePowerSelectorClick(e,t){e.preventDefault();let n=t.closest(".player-row");if(!n)return;let r=C.getFromRow(n,".power-selector-dropdown");if(!r)return;let a=r.style.display!=="none";this.closeAllDropdowns(),a||(r.style.display="block",t.classList.add("open"),setTimeout(()=>r.classList.add("show"),10))}handleBracketSelectorClick(e,t){e.preventDefault();let n=t.closest(".player-row");if(!n)return;let r=C.getFromRow(n,".bracket-selector-dropdown");if(!r)return;let a=r.style.display!=="none";this.closeAllDropdowns(),a||(r.style.display="block",t.classList.add("open"),setTimeout(()=>r.classList.add("show"),10))}handleRangeButtonClick(e){let t=e.closest(".player-row");if(!t)return;let n=e.dataset.range,r=C.getAllFromRow(t,'.power-checkbox input[type="checkbox"]');r.forEach(s=>s.checked=!1);let[a,o]=n.split("-").map(Number);r.forEach(s=>{let l=parseFloat(s.value);(l===a||l===o)&&(s.checked=!0)}),this.updatePowerButtonText(t)}handleBracketRangeButtonClick(e){let t=e.closest(".player-row");if(!t)return;let n=e.dataset.range,r=C.getAllFromRow(t,'.bracket-checkbox input[type="checkbox"]');if(r.forEach(a=>a.checked=!1),n==="cedh"){let a=Array.from(r).find(o=>o.value==="cedh");a&&(a.checked=!0)}else{let[a,o]=n.split("-").map(s=>s==="cedh"?s:parseInt(s));r.forEach(s=>{let l=s.value==="cedh"?"cedh":parseInt(s.value);(l===a||l===o)&&(s.checked=!0)})}this.updateBracketButtonText(t)}handleClearButtonClick(e){let t=e.closest(".player-row");t&&(e.classList.contains("clear-btn")?(C.getAllFromRow(t,'.power-checkbox input[type="checkbox"]').forEach(r=>r.checked=!1),this.updatePowerButtonText(t)):e.classList.contains("bracket-clear-btn")&&(C.getAllFromRow(t,'.bracket-checkbox input[type="checkbox"]').forEach(r=>r.checked=!1),this.updateBracketButtonText(t)))}handleRemoveButtonClick(e){let t=e.closest(".player-row");t&&(this.removeAllEventListeners(t),this.playerRowsContainer.removeChild(t),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.updatePlayerNumbers(),this.clearDOMCache())}handlePowerCheckboxChange(e){let t=e.closest(".player-row");t&&this.updatePowerButtonText(t)}handleBracketCheckboxChange(e){let t=e.closest(".player-row");t&&this.updateBracketButtonText(t)}handlePlayerNameChange(e){}updatePowerButtonText(e){G.updatePowerButton(e)}updateBracketButtonText(e){G.updateBracketButton(e)}getPlayerRowsOptimized(){let e=C.getAll(".player-row",this.playerRowsContainer),t=[];for(let n=0;n<e.length;n++)t.push(e[n]);return t}clearReusableArrays(){this.reusablePlayerArray.length=0,this.reusableItemArray.length=0}addPlayerRow(){let t=this.playerRowTemplate.content.cloneNode(!0).querySelector(".player-row"),n=this.playerManager.getNextPlayerId();t.dataset.playerId=n.toString(),this.updatePowerButtonText(t),this.updateBracketButtonText(t),this.playerRowsContainer.appendChild(t);let r=C.getFromRow(t,".player-name");r&&J.setupNameValidation(r,()=>this.clearDuplicateErrorsOnInput()),this.clearDOMCache(),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.clearDOMCache(),this.updatePlayerNumbers();let o=this.getBracketRadio()?.checked??!1,s=C.getFromRow(t,".power-levels"),l=C.getFromRow(t,".bracket-levels");o&&s&&l?(s.style.display="none",l.style.display="block"):s&&l&&(s.style.display="block",l.style.display="none")}bulkAddPlayers(e){for(let t=0;t<e;t++)this.addPlayerRow()}initializeKeyboardShortcuts(){document.addEventListener("keydown",e=>{if(e.ctrlKey&&e.key==="p"){e.preventDefault(),Z.logMetrics();return}if(e.ctrlKey&&e.key==="Enter"){e.preventDefault(),this.addPlayerRow();let n=C.getAll(".player-row",this.playerRowsContainer),r=n[n.length-1],a=C.getFromRow(r,".player-name");a&&a.focus();return}let t=document.activeElement;if(A(t)&&t.classList.contains("bracket-selector-btn")){let n=null;e.key==="1"?n="1":e.key==="2"?n="2":e.key==="3"?n="3":e.key==="4"?n="4":(e.key==="5"||e.key==="c"||e.key==="C")&&(n="cedh"),n&&(e.preventDefault(),this.selectBracketByKeyboard(t,n))}})}selectBracketByKeyboard(e,t){let n=e.closest(".player-row");if(!n)return;C.getAllFromRow(n,'.bracket-checkbox input[type="checkbox"]').forEach(o=>o.checked=!1);let a=C.getFromRow(n,`.bracket-checkbox input[value="${t}"]`);a&&(a.checked=!0,a.dispatchEvent(new Event("change",{bubbles:!0})))}cleanupBottomDisplayButton(){if(this.displayModeBtnBottom){let e=this.displayModeBtnBottom.parentNode;e&&e.parentNode&&e.parentNode.removeChild(e),this.displayModeBtnBottom=null}}generatePods(){this.triggerValidationForAllFields(),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.playerManager.handleGroupChange(this.playerRowsContainer),this.clearReusableArrays();let e=this.getPlayerRowsOptimized();M.clearDuplicateErrors(e);let t=M.highlightDuplicateNames(e),n=t.length>0;for(let p=0;p<e.length;p++){let b=this.playerManager.getPlayerFromRow(e[p]);b?this.reusablePlayerArray.push(b):n=!0}if(n){let p="Please fix the errors before generating pods.";t.length>0&&(p+=`

Duplicate player names found: ${t.join(", ")}`),alert(p);return}let r=new Map;this.playerManager.getGroups().forEach((p,b)=>{let g=p.reduce((k,S)=>k+S.power,0),f=Math.round(g/p.length*2)/2;r.set(b,{id:b,players:p,averagePower:f,size:p.length})});let a=new Set([...this.playerManager.getGroups().values()].flat().map(p=>p.id)),o=this.reusablePlayerArray.filter(p=>!a.has(p.id));this.reusableItemArray.length=0,this.reusableItemArray.push(...o),r.forEach(p=>{this.reusableItemArray.push({id:p.id,players:p.players,averagePower:p.averagePower,size:p.size})});let s=this.reusablePlayerArray.length;if(s<3){alert("You need at least 3 players to form a pod.");return}let i=le()==="avoid-five"?se(s):K(s),u=ie();if(typeof window<"u"&&(window.location.protocol==="file:"||window.__playwright!==void 0||window.playwright!==void 0)){let p=this.reusablePlayerArray.map(g=>g.name).join(""),b=Array.from(p).reduce((g,f)=>g+f.charCodeAt(0),0);this.podGenerator.setShuffleSeed(b)}else this.podGenerator.setShuffleSeed(null);let d=performance.now(),E=this.podGenerator.generatePodsWithBacktracking(this.reusableItemArray,i,u),y=performance.now();Z.trackPodGenerationTime(y-d);let L=E.pods,m=E.unassigned;this.currentPods=[...L],this.currentUnassigned=[...m],this.renderPods(L,m)}renderPods(e,t=[]){if(this.currentPods=[...e],this.currentUnassigned=[...t],this.dragDropManager.setCurrentPods(this.currentPods,this.currentUnassigned),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",e.length===0){this.outputSection.textContent="Could not form pods with the given players.",this.displayModeBtn.style.display="none";return}this.displayModeBtn.style.display="inline-block";let n=Math.ceil(Math.sqrt(e.length)),r=document.createDocumentFragment(),a=this.getPooledElement("pods-container")||document.createElement("div");if(a.classList.add("pods-container"),a.style.gridTemplateColumns=`repeat(${n}, 1fr)`,a.style.gridTemplateRows=`repeat(${n}, 1fr)`,e.forEach((s,l)=>{let i=this.getPooledElement("pod")||document.createElement("div");i.classList.add("pod",`pod-color-${l%10}`),i.dataset.podIndex=l.toString(),i.addEventListener("dragover",this.dragDropManager.handleDragOver),i.addEventListener("drop",this.dragDropManager.handleDrop),i.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let u=this.getPooledElement("h3")||document.createElement("h3"),h=document.getElementById("bracket-radio");if(h&&h.checked){let y=this.calculateValidBracketRange(s);u.textContent=`Pod ${l+1} (Bracket: ${y})`}else{let y=W(s);u.textContent=`Pod ${l+1} (Power: ${y})`}i.appendChild(u);let E=this.getPooledElement("ul")||document.createElement("ul");s.players.forEach((y,L)=>{if("players"in y){let m=this.getPooledElement("li")||document.createElement("li");m.classList.add("pod-group"),m.draggable=!0,m.dataset.itemType="group",m.dataset.itemId=y.id,m.dataset.podIndex=l.toString(),m.dataset.itemIndex=L.toString(),m.addEventListener("dragstart",this.dragDropManager.handleDragStart),m.addEventListener("dragend",this.dragDropManager.handleDragEnd);let p=document.getElementById("bracket-radio"),b=p&&p.checked,g=document.createElement("strong");b?g.textContent=`Group ${y.id.split("-")[1]}:`:g.textContent=`Group ${y.id.split("-")[1]} (Avg Power: ${y.averagePower}):`,m.appendChild(g);let f=this.getPooledElement("ul")||document.createElement("ul");y.players.forEach(k=>{let S=this.getPooledElement("li")||document.createElement("li");if(b&&k.bracketRange)S.textContent=`${k.name} (B: ${k.bracketRange})`;else{let v=U(s),P=z(k,v);S.innerHTML=`${k.name} (P: ${P})`}f.appendChild(S)}),m.appendChild(f),E.appendChild(m)}else{let m=this.getPooledElement("li")||document.createElement("li");m.classList.add("pod-player"),m.draggable=!0,m.dataset.itemType="player",m.dataset.itemId=y.id.toString(),m.dataset.podIndex=l.toString(),m.dataset.itemIndex=L.toString(),m.addEventListener("dragstart",this.dragDropManager.handleDragStart),m.addEventListener("dragend",this.dragDropManager.handleDragEnd);let p=document.getElementById("bracket-radio");if(p&&p.checked&&y.bracketRange)m.textContent=`${y.name} (B: ${y.bracketRange})`;else{let g=U(s),f=z(y,g);m.innerHTML=`${y.name} (P: ${f})`}E.appendChild(m)}}),i.appendChild(E),a.appendChild(i)}),e.length>0){let s=document.createElement("div");s.classList.add("pod","new-pod","new-pod-target"),s.style.borderColor="#4CAF50",s.style.backgroundColor="#1f2a1f",s.style.borderStyle="dashed",s.dataset.podIndex="new-pod",s.addEventListener("dragover",this.dragDropManager.handleDragOver),s.addEventListener("drop",this.dragDropManager.handleDrop),s.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let l=document.createElement("h3");l.textContent="Create New Pod",l.style.color="#4CAF50",s.appendChild(l);let i=document.createElement("p");i.textContent="Drag players or groups here to create a new pod",i.style.color="#999",i.style.fontStyle="italic",i.style.textAlign="center",i.style.margin="20px 0",s.appendChild(i),a.appendChild(s)}if(t.length>0){let s=document.createElement("div");s.classList.add("pod","unassigned-pod"),s.style.borderColor="#ff6b6b",s.style.backgroundColor="#2a1f1f",s.dataset.podIndex="unassigned",s.addEventListener("dragover",this.dragDropManager.handleDragOver),s.addEventListener("drop",this.dragDropManager.handleDrop),s.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let l=document.createElement("h3");l.textContent="Unassigned Players",l.style.color="#ff6b6b",s.appendChild(l);let i=document.createElement("ul");t.forEach((u,h)=>{if("players"in u){let d=document.createElement("li");d.classList.add("pod-group"),d.draggable=!0,d.dataset.itemType="group",d.dataset.itemId=u.id,d.dataset.podIndex="unassigned",d.dataset.itemIndex=h.toString(),d.addEventListener("dragstart",this.dragDropManager.handleDragStart),d.addEventListener("dragend",this.dragDropManager.handleDragEnd);let E=document.getElementById("bracket-radio"),y=E&&E.checked;y?d.innerHTML=`<strong>Group ${u.id.split("-")[1]}:</strong>`:d.innerHTML=`<strong>Group ${u.id.split("-")[1]} (Avg Power: ${u.averagePower}):</strong>`;let L=document.createElement("ul");u.players.forEach(m=>{let p=document.createElement("li");y&&m.bracketRange?p.textContent=`${m.name} (B: ${m.bracketRange})`:p.textContent=`${m.name} (P: ${m.powerRange})`,L.appendChild(p)}),d.appendChild(L),i.appendChild(d)}else{let d=document.createElement("li");d.classList.add("pod-player"),d.draggable=!0,d.dataset.itemType="player",d.dataset.itemId=u.id.toString(),d.dataset.podIndex="unassigned",d.dataset.itemIndex=h.toString(),d.addEventListener("dragstart",this.dragDropManager.handleDragStart),d.addEventListener("dragend",this.dragDropManager.handleDragEnd);let E=document.getElementById("bracket-radio");E&&E.checked&&u.bracketRange?d.textContent=`${u.name} (B: ${u.bracketRange})`:d.textContent=`${u.name} (P: ${u.powerRange})`,i.appendChild(d)}}),s.appendChild(i),a.appendChild(s)}r.appendChild(a),this.outputSection.appendChild(r);let o=document.querySelector(".help-section");if(o&&o.parentNode){let s=document.createElement("div");s.style.textAlign="center",s.style.marginTop="20px",s.style.marginBottom="20px",this.displayModeBtnBottom=this.displayModeBtn.cloneNode(!0),this.displayModeBtnBottom.id="display-mode-btn-bottom",this.displayModeBtnBottom.style.display="inline-block",this.displayModeBtnBottom.addEventListener("click",()=>this.displayModeManager.enterDisplayMode(this.currentPods)),s.appendChild(this.displayModeBtnBottom),o.parentNode.insertBefore(s,o)}}captureCurrentPlayerData(){let e=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),t=[];e.forEach(r=>{let a=r.querySelector(".player-name"),o=r.querySelector(".group-select"),s=r.querySelectorAll('.power-checkbox input[type="checkbox"]'),l=[];s.forEach(h=>{h.checked&&l.push(h.value)});let i=r.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),u=[];i.forEach(h=>{h.checked&&u.push(h.value)}),t.push({name:a.value.trim(),groupValue:o.value,createdGroupId:o.dataset.createdGroupId,selectedPowers:l,selectedBrackets:u})});let n={noLeniency:document.getElementById("no-leniency-radio")?.checked||!1,leniency:document.getElementById("leniency-radio")?.checked||!1,superLeniency:document.getElementById("super-leniency-radio")?.checked||!1,bracket:document.getElementById("bracket-radio")?.checked||!1};return{players:t,leniencySettings:n,currentPods:[...this.currentPods],currentUnassigned:[...this.currentUnassigned]}}resetAllWithConfirmation(){if(!Array.from(this.playerRowsContainer.querySelectorAll(".player-row")).some(r=>{if(r.querySelector(".player-name").value.trim())return!0;let o=r.querySelectorAll('input[type="checkbox"]');return Array.from(o).some(s=>s.checked)})){this.resetAll();return}confirm(`Are you sure you want to reset all player data?

This will clear all players, groups, and generated pods. You will be able to undo this action immediately after.`)&&(this.lastResetData=this.captureCurrentPlayerData(),this.resetAll(),this.showUndoResetButton())}showUndoResetButton(){let e=document.getElementById("undo-reset-btn");e&&e.remove();let t=document.createElement("button");t.id="undo-reset-btn",t.textContent="Undo Reset",t.style.marginLeft="10px",t.style.backgroundColor="#28a745",t.style.color="white",t.style.border="none",t.style.padding="8px 16px",t.style.borderRadius="4px",t.style.cursor="pointer",t.style.fontSize="14px",t.addEventListener("click",()=>this.undoReset());let n=document.getElementById("reset-all-btn");n.parentNode.insertBefore(t,n.nextSibling),setTimeout(()=>{document.getElementById("undo-reset-btn")&&(t.remove(),this.lastResetData=null)},3e4)}undoReset(){if(!this.lastResetData){alert("No reset data available to restore.");return}this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds();let e=this.lastResetData.leniencySettings;e.noLeniency&&(document.getElementById("no-leniency-radio").checked=!0),e.leniency&&(document.getElementById("leniency-radio").checked=!0),e.superLeniency&&(document.getElementById("super-leniency-radio").checked=!0),e.bracket&&(document.getElementById("bracket-radio").checked=!0),this.lastResetData.players.forEach(r=>{this.addPlayerRow();let a=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),o=a[a.length-1],s=o.querySelector(".player-name");s.value=r.name;let l=o.querySelector(".group-select");r.createdGroupId&&(l.dataset.createdGroupId=r.createdGroupId),l.value=r.groupValue}),this.isRestoring=!0;let t=document.getElementById("no-leniency-radio"),n=document.getElementById("bracket-radio");if(t&&n){let r=new Event("change",{bubbles:!0});e.bracket?n.dispatchEvent(r):t.dispatchEvent(r)}setTimeout(()=>{this.restorePlayerSelections()},200)}restorePlayerSelections(){if(!this.lastResetData)return;this.lastResetData.players.forEach((t,n)=>{let a=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[n];if(!a)return;t.selectedPowers.forEach(l=>{let i=a.querySelector(`.power-checkbox input[type="checkbox"][value="${l}"]`);i&&(i.checked=!0)}),t.selectedBrackets.forEach(l=>{let i=a.querySelector(`.bracket-checkbox input[type="checkbox"][value="${l}"]`);i&&(i.checked=!0)}),a.querySelectorAll('input[type="checkbox"]').forEach(l=>{l.checked&&l.dispatchEvent(new Event("change",{bubbles:!0}))}),this.updateButtonTextsForRow(a);let s=a.querySelector(".group-select");t.groupValue&&t.groupValue!=="no-group"&&t.groupValue.startsWith("group-")&&(t.createdGroupId?s.dataset.createdGroupId=t.createdGroupId:s.dataset.createdGroupId=t.groupValue,s.value="new-group",s.dispatchEvent(new Event("change",{bubbles:!0})))}),this.lastResetData.players.forEach((t,n)=>{let o=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[n].querySelector(".group-select");t.groupValue&&t.groupValue!=="no-group"&&t.groupValue.startsWith("group-")&&(o.value=t.groupValue,o.dispatchEvent(new Event("change",{bubbles:!0})))}),this.currentPods=[...this.lastResetData.currentPods],this.currentUnassigned=[...this.lastResetData.currentUnassigned],(this.currentPods.length>0||this.currentUnassigned.length>0)&&this.renderPods(this.currentPods,this.currentUnassigned),this.playerManager.handleGroupChange(this.playerRowsContainer),this.isRestoring=!1;let e=document.getElementById("undo-reset-btn");e&&e.remove(),this.lastResetData=null,alert("Reset has been undone successfully!")}resetAll(){this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.displayModeBtn.style.display="none",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds(),this.currentPods=[],this.currentUnassigned=[];let e=document.getElementById("no-leniency-radio");e.checked=!0;for(let t=0;t<4;t++)this.addPlayerRow()}clearDuplicateErrorsOnInput(){let e=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"));M.clearDuplicateErrors(e),M.highlightDuplicateNames(e)}initializeRankingModeToggle(){let e=document.getElementById("power-level-radio"),t=document.getElementById("bracket-radio"),n=()=>{let r=t.checked;if(r){document.body.classList.add("bracket-mode");let o=document.getElementById("no-leniency-radio");o&&(o.checked=!0)}else document.body.classList.remove("bracket-mode");this.playerRowsContainer.querySelectorAll(".player-row").forEach(o=>{let s=o.querySelector(".power-levels"),l=o.querySelector(".bracket-levels");r?(s.style.display="none",l.style.display="block"):(s.style.display="block",l.style.display="none"),this.isRestoring||this.clearAllSelections(o)})};e.addEventListener("change",n),t.addEventListener("change",n),n()}clearAllSelections(e){e.querySelectorAll('.power-checkbox input[type="checkbox"]').forEach(o=>o.checked=!1),e.querySelectorAll('.bracket-checkbox input[type="checkbox"]').forEach(o=>o.checked=!1);let r=e.querySelector(".power-selector-btn"),a=e.querySelector(".bracket-selector-btn");r&&(r.textContent="Select Power Levels",r.classList.remove("has-selection")),a&&(a.textContent="Select Brackets",a.classList.remove("has-selection"))}initializeHelpModal(){let e=document.getElementById("help-modal");e.querySelector(".help-close").addEventListener("click",()=>this.hideHelpModal()),e.addEventListener("click",n=>{n.target===e&&this.hideHelpModal()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&e.style.display==="block"&&this.hideHelpModal()})}showHelpModal(){let e=document.getElementById("help-modal");e.style.display="block",document.body.style.overflow="hidden"}hideHelpModal(){let e=document.getElementById("help-modal");e.style.display="none",document.body.style.overflow=""}calculateValidBracketRange(e){let t=e.players.flatMap(o=>"players"in o?o.players:[o]);if(t.length===0)return"Unknown";let n=[],r=new Set;t.forEach(o=>{o.brackets&&o.brackets.forEach(s=>r.add(s))});for(let o of r)t.every(l=>l.brackets&&l.brackets.includes(o))&&n.push(o);let a=["1","2","3","4","cedh"];if(n.sort((o,s)=>a.indexOf(o)-a.indexOf(s)),n.length===0)return"Unknown";if(n.length===1)return n[0];{let o=n.filter(l=>l!=="cedh");return o.length>1&&o.every((l,i)=>{if(i===0)return!0;let u=parseInt(l),h=parseInt(o[i-1]);return u===h+1})&&o.length===n.length&&n.length>1?`${n[0]}-${n[n.length-1]}`:n.join(", ")}}triggerValidationForAllFields(){let e=J.batchValidateRows(this.playerRowsContainer);Z.trackValidationTime(e.validationTime),e.validationTime>100&&console.warn(`Slow validation detected: ${e.validationTime.toFixed(2)}ms`)}updateButtonTextsForRow(e){let t=e.querySelectorAll('.power-checkbox input[type="checkbox"]'),n=e.querySelector(".power-selector-btn");if(n){let o=[];if(t.forEach(s=>{s.checked&&o.push(parseFloat(s.value))}),o.length===0)n.textContent="Select Power Levels",n.classList.remove("has-selection");else{o.sort((l,i)=>l-i);let s;if(o.length===1)s=`Power: ${o[0]}`;else{let l=o[0],i=o[o.length-1];o.every((h,d)=>{if(d===0)return!0;let E=h-o[d-1];return E===.5||E===1})&&o.length>2?s=`Power: ${l}-${i}`:o.length<=4?s=`Power: ${o.join(", ")}`:s=`Power: ${l}-${i} (${o.length} levels)`}n.textContent=s,n.classList.add("has-selection")}}let r=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),a=e.querySelector(".bracket-selector-btn");if(a){let o=[];if(r.forEach(s=>{s.checked&&o.push(s.value)}),o.length===0)a.textContent="Select Brackets",a.classList.remove("has-selection");else{let s;o.length===1?s=`Bracket: ${o[0]}`:s=`Brackets: ${o.join(", ")}`,a.textContent=s,a.classList.add("has-selection")}}}updatePlayerNumbers(){this.playerRowsContainer.querySelectorAll(".player-row").forEach((t,n)=>{let r=t.querySelector(".player-number");r&&(r.textContent=(n+1).toString())})}};function pe(){let t=Math.floor(Math.random()*360),n=25,r=[];for(let s=0;s<50;s++){let i=(t+s*137.5)%360;r.push(Math.round(i))}let a="";for(let s=1;s<=50;s++){let l=r[s-1],i=70+Math.floor(Math.random()*20),u=50,h=28+Math.floor(Math.random()*8);a+=`
.player-row .group-select.group-${s} {
    border-color: hsl(${l}, ${i}%, ${u}%) !important;
    background-color: hsl(${l}, ${i}%, ${h}%) !important;
}`,a+=`
.group-select option[value="group-${s}"] {
    background-color: hsl(${l}, ${i}%, ${h}%);
}`}let o=document.createElement("style");o.id="dynamic-group-colors",o.textContent=a,document.head.appendChild(o)}document.addEventListener("DOMContentLoaded",()=>{pe(),new X().resetAll()});})();
