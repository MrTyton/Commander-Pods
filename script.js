"use strict";(()=>{function G(g){if(g<3)return[];if(g===3)return[3];if(g===4)return[4];if(g===5)return[5];if(g===6)return[3,3];if(g===7)return[4,3];if(g===8)return[4,4];if(g===9)return[3,3,3];if(g===10)return[5,5];let t=Math.floor(g/4),e=g%4;return e===0?Array(t).fill(4):e===1?t>=2?[...Array(t-2).fill(4),5,4]:[3,3,3,2]:e===2?t>=1?[...Array(t-1).fill(4),3,3]:[3,3,3,3]:e===3?[...Array(t).fill(4),3]:[]}function W(g){if(g<3)return[];if(g<9)return G(g);if(g===9)return[3,3,3];if(g===10)return[4,3,3];if(g===11)return[4,4,3];if(g===12)return[4,4,4];if(g===13)return[4,3,3,3];if(g===14)return[4,4,3,3];if(g===15)return[4,4,4,3];let t=[],e=g;for(;e>=7;)t.push(4),e-=4;if(e===6)t.push(3,3);else if(e===5)if(t.length>0)t.pop(),e+=4,t.push(3,3,3);else return G(g);else e===4?t.push(4):e===3&&t.push(3);return t.sort((n,s)=>s-n)}function j(){let g=document.getElementById("avoid-five-pods-radio");return g&&g.checked?"avoid-five":"balanced"}function K(){let g=document.getElementById("bracket-radio");if(g&&g.checked)return{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0};let t=document.getElementById("no-leniency-radio"),e=document.getElementById("leniency-radio");return document.getElementById("super-leniency-radio").checked?{allowLeniency:!0,allowSuperLeniency:!0,maxTolerance:1}:e.checked?{allowLeniency:!0,allowSuperLeniency:!1,maxTolerance:.5}:{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0}}function _(g){let t=[];if(g.forEach(s=>{if(s.checked){let a=parseFloat(s.value);isNaN(a)||t.push(a)}}),t.length===0)return{availablePowers:[],powerRange:"",averagePower:0};t.sort((s,a)=>s-a);let e;t.length===1?e=t[0].toString():e=t.join(", ");let n=t.reduce((s,a)=>s+a,0)/t.length;return{availablePowers:t,powerRange:e,averagePower:Math.round(n*2)/2}}function Q(){let g=document.querySelector("#leniency-radio");return document.querySelector("#super-leniency-radio")?.checked?1:g?.checked?.5:0}function N(g){let t=g.players.flatMap(a=>"players"in a?a.players:[a]);if(t.length===0)return g.power.toString();let e=Q(),n=[],s=new Set;t.forEach(a=>{a.availablePowers.forEach(r=>s.add(r))});for(let a of s)t.every(o=>o.availablePowers.some(l=>Math.abs(a-l)<=e))&&n.push(a);return n.sort((a,r)=>a-r),n.length===0?g.power.toString():n.length===1?n[0].toString():n.every((r,o)=>o===0||r-n[o-1]<=.5)&&n.length>2?`${n[0]}-${n[n.length-1]}`:n.join(", ")}function q(g,t){let e=[];if(Array.isArray(g.availablePowers))e=g.availablePowers;else if(typeof g.powerRange=="string")if(g.powerRange.includes("-")){let[s,a]=g.powerRange.split("-").map(r=>parseFloat(r.trim()));for(let r=s;r<=a;r+=.5)e.push(r)}else e=g.powerRange.split(",").map(s=>parseFloat(s.trim()));return e.map(s=>t.includes(s)?`<span class="power-highlight">${s}</span>`:s.toString()).join(", ")}function Y(g,t){let e=[];if(Array.isArray(g.availableBrackets))e=g.availableBrackets;else if(typeof g.bracketRange=="string")if(g.bracketRange.includes("-")){let[s,a]=g.bracketRange.split("-").map(l=>l.trim()),r=parseInt(s),o=parseInt(a);if(!isNaN(r)&&!isNaN(o))for(let l=r;l<=o;l++)e.push(l.toString());else e=[s,a]}else e=g.bracketRange.split(",").map(s=>s.trim());return e.map(s=>t.includes(s)?`<span class="bracket-highlight">${s}</span>`:s.toString()).join(", ")}function $(g){let t=g.players.flatMap(r=>"players"in r?r.players:[r]);if(t.length===0)return[];let e=new Map,n=new Set;if(t.forEach(r=>{r.availablePowers.length===1&&n.add(r.availablePowers[0]),r.availablePowers.forEach(o=>{e.set(o,(e.get(o)||0)+1)})}),e.size===0)return[];let s=Math.max(...e.values()),a=[];for(let[r,o]of e.entries())(o===s||n.has(r))&&a.push(r);return a.sort((r,o)=>r-o),a}var z=class{constructor(){this.groups=new Map;this.nextPlayerId=0;this.nextGroupId=1;this.availableColors=[];this.groupColorAssignments=new Map;this.initializeAvailableColors()}initializeAvailableColors(){this.availableColors=Array.from({length:50},(t,e)=>e+1),this.shuffleArray(this.availableColors)}shuffleArray(t){for(let e=t.length-1;e>0;e--){let n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}}assignRandomColor(t){if(this.groupColorAssignments.has(t))return this.groupColorAssignments.get(t);this.availableColors.length===0&&this.initializeAvailableColors();let e=this.availableColors.pop();return this.groupColorAssignments.set(t,e),e}releaseColor(t){let e=this.groupColorAssignments.get(t);e&&(this.availableColors.push(e),this.groupColorAssignments.delete(t))}getNextPlayerId(){return this.nextPlayerId++}resetPlayerIds(){this.nextPlayerId=0}getNextGroupId(){let t=new Set;document.querySelectorAll(".group-select").forEach(n=>{if(n.value.startsWith("group-")){let s=parseInt(n.value.split("-")[1]);isNaN(s)||t.add(s)}if(n.value==="new-group"&&n.dataset.createdGroupId&&n.dataset.createdGroupId.startsWith("group-")){let s=parseInt(n.dataset.createdGroupId.split("-")[1]);isNaN(s)||t.add(s)}});for(let n=1;n<=50;n++)if(!t.has(n))return n;return this.nextGroupId++}resetGroupIds(){this.nextGroupId=1}getGroups(){return this.groups}clearGroups(){this.groups.clear()}getPlayerFromRow(t){let e=t.querySelector(".player-name");e.classList.remove("input-error");let n=e.value.trim();if(!n)return e.classList.add("input-error"),null;if(document.getElementById("bracket-radio").checked){let r=t.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),o=[];if(r.forEach(c=>{c.checked&&o.push(c.value)}),o.length===0)return t.querySelector(".bracket-selector-btn").classList.add("error"),null;t.querySelector(".bracket-selector-btn").classList.remove("error");let l={1:1,2:2,3:3,4:4,cedh:10},i=o.map(c=>l[c]),p=i.reduce((c,m)=>c+m,0)/i.length;return{id:parseInt(t.dataset.playerId),name:n,power:Math.round(p*2)/2,availablePowers:i,powerRange:o.join(", "),brackets:o,bracketRange:o.join(", "),rowElement:t}}else{let r=t.querySelectorAll('.power-checkbox input[type="checkbox"]'),o=_(r);return o.availablePowers.length===0?(t.querySelector(".power-selector-btn").classList.add("error"),null):(t.querySelector(".power-selector-btn").classList.remove("error"),{id:parseInt(t.dataset.playerId),name:n,power:o.averagePower,availablePowers:o.availablePowers,powerRange:o.powerRange,rowElement:t})}}handleGroupChange(t){this.groups.clear();let e=Array.from(t.querySelectorAll(".player-row"));e.forEach(s=>{for(let a=1;a<=50;a++)s.querySelector(".group-select").classList.remove(`group-${a}`)});let n=new Set;e.forEach(s=>{let a=s.querySelector(".group-select");a.dataset.createdGroupId?n.add(a.dataset.createdGroupId):a.value.startsWith("group-")&&n.add(a.value)}),e.forEach(s=>{let a=s.querySelector(".group-select"),r="";if(a.value==="new-group"){a.dataset.createdGroupId?r=a.dataset.createdGroupId:(r=`group-${this.getNextGroupId()}`,n.add(r),a.dataset.createdGroupId=r);let o=this.getPlayerFromRow(s);o&&(this.groups.has(r)||this.groups.set(r,[]),this.groups.get(r).push(o))}else if(a.value.startsWith("group-")){r=a.value;let o=this.getPlayerFromRow(s);o&&(this.groups.has(a.value)||this.groups.set(a.value,[]),this.groups.get(a.value).push(o))}else a.dataset.createdGroupId&&delete a.dataset.createdGroupId;if(r){let o=parseInt(r.split("-")[1]);o>=1&&o<=50&&a.classList.add(`group-${o}`)}}),this.cleanupUnusedGroups(n),this.updateAllGroupDropdowns(t)}updateAllGroupDropdowns(t){let e=new Set,n=Array.from(t.querySelectorAll(".player-row"));n.forEach(s=>{let a=s.querySelector(".group-select");a.value==="new-group"&&a.dataset.createdGroupId?e.add(a.dataset.createdGroupId):a.value.startsWith("group-")&&e.add(a.value)}),n.forEach(s=>{let a=s.querySelector(".group-select"),r=a.value,o=a.dataset.createdGroupId;if(Array.from(a.options).forEach(i=>{i.value.startsWith("group-")&&a.remove(i.index)}),e.forEach(i=>{let p=i.split("-")[1],c=new Option(`Group ${p}`,i);a.add(c)}),o&&e.has(o)&&(r==="new-group"||r==="no-group")){a.value=o;let i=parseInt(o.split("-")[1]);i>=1&&i<=50&&a.classList.add(`group-${i}`)}else if(r.startsWith("group-")&&e.has(r)){a.value=r;let i=parseInt(r.split("-")[1]);i>=1&&i<=50&&a.classList.add(`group-${i}`)}else{a.value="no-group";for(let i=1;i<=50;i++)a.classList.remove(`group-${i}`)}})}arePlayersCompatible(t,e,n){return t.availablePowers.some(a=>e.availablePowers.some(r=>Math.abs(a-r)<.01))?!0:n.allowLeniency?t.availablePowers.some(a=>e.availablePowers.some(r=>Math.abs(a-r)<=n.maxTolerance)):!1}findAllCommonPowers(t,e){return t.length===0?[]:[...new Set(t.flatMap(s=>s.availablePowers))].sort((s,a)=>s-a).filter(s=>t.every(a=>a.availablePowers.some(r=>{let o=Math.abs(r-s);return o<.01||e.allowLeniency&&o<=e.maxTolerance})))}findBestCommonPowerLevel(t){if(t.length===0)return null;let e=new Map;for(let a of t)for(let r of a.availablePowers)e.set(r,(e.get(r)||0)+1);if(e.size===0)return null;let n=t[0].availablePowers[0],s=0;for(let[a,r]of e.entries())r>s&&(s=r,n=a);return n}calculatePodPower(t){if(t.length===0)return 0;let e=t.reduce((n,s)=>{if("players"in s)return n+s.averagePower;{let a=s.powerRange.split(",").map(o=>parseFloat(o.trim())),r=a.reduce((o,l)=>o+l,0)/a.length;return n+r}},0);return Math.round(e/t.length*10)/10}cleanupUnusedGroups(t){Array.from(this.groupColorAssignments.keys()).forEach(a=>{t.has(a)||this.releaseColor(a)}),Array.from(this.groups.keys()).forEach(a=>{t.has(a)||this.groups.delete(a)}),document.querySelectorAll(".group-select").forEach(a=>{let r=a.dataset.createdGroupId;r&&!t.has(r)&&delete a.dataset.createdGroupId})}};var F=class{constructor(){this.shuffleSeed=null;this.sizeCache=new Map}setShuffleSeed(t){this.shuffleSeed=t,this.sizeCache.clear()}seededRandom(t){let e=t;return()=>(e=e*1103515245+12345&2147483647,e/2147483647)}shuffleArray(t){let e=[...t],n;this.shuffleSeed!==null?n=this.seededRandom(this.shuffleSeed):n=Math.random;for(let s=e.length-1;s>0;s--){let a=Math.floor(n()*(s+1));[e[s],e[a]]=[e[a],e[s]]}return e}getItemSize(t){let e="players"in t?`group-${t.id}`:`player-${t.id}`;if(!this.sizeCache.has(e)){let n="players"in t?t.size:1;this.sizeCache.set(e,n)}return this.sizeCache.get(e)}getItemId(t){return"players"in t?t.id:t.id.toString()}generatePodsWithBacktracking(t,e,n){let s=this.shuffleArray(t),a=s.reduce((i,p)=>i+("size"in p?p.size:1),0);if(a>=3&&a<=5){let i=s.flatMap(c=>"players"in c?c.players:[c]),p=this.findBestCommonPowerLevel(i);return p!==null?{pods:[{players:s,power:p}],unassigned:[]}:{pods:[],unassigned:s}}let r=this.findOptimalPodAssignment(s,e,n),o=new Set;for(let i of r)for(let p of i.players)"players"in p?o.add(p.id):o.add(p.id.toString());let l=s.filter(i=>"players"in i?!o.has(i.id):!o.has(i.id.toString()));return{pods:r,unassigned:l}}findOptimalPodAssignment(t,e,n){return this.optimizeVirtualPlayerAssignmentUnified(t,e,n)}optimizeVirtualPlayerAssignmentUnified(t,e,n){if(t.length===0)return[];let s=this.createVirtualPlayersUnified(t),a=new Map;for(let o of s)a.has(o.powerLevel)||a.set(o.powerLevel,[]),a.get(o.powerLevel).push(o);let r={pods:[],totalPods:0};return n.allowLeniency?this.backtrackVirtualPlayersWithLeniencyUnified(s,e,n.maxTolerance,[],new Set,e,r):this.backtrackVirtualPlayersUnified(Array.from(a.entries()),[],new Set,e,r),r.pods}createVirtualPlayersUnified(t){let e=[];for(let n of t)if("players"in n){let s=n.players.flatMap(p=>p.availablePowers),a=Math.min(...s),r=Math.max(...s),l=[n.averagePower,a,r],i=[...new Set(l)];for(let p of i)e.push({item:n,powerLevel:p})}else for(let s of n.availablePowers)e.push({item:n,powerLevel:s});return e}backtrackVirtualPlayersUnified(t,e,n,s,a){if(s.length===0){e.length>a.totalPods&&(a.pods=[...e],a.totalPods=e.length);return}if(e.length+s.length<=a.totalPods)return;let r=s[0],o=s.slice(1);for(let[l,i]of t){let p=i.filter(y=>{let E=this.getItemId(y.item);return!n.has(E)}),c=0;for(let y=0;y<p.length;y++)c+=this.getItemSize(p[y].item);let m=Math.max(3,r);if(c>=m){let y=p.sort((d,L)=>{let h=this.getItemSize(d.item);return this.getItemSize(L.item)-h}),E=[],f=new Set,k=0;for(let d of y){let L=this.getItemId(d.item),h=this.getItemSize(d.item);if(!f.has(L)&&k+h<=r&&(E.push(d),f.add(L),k+=h,k===r))break}if(k>=3){let d=E.map(w=>w.item),L={players:d,power:l},h=new Set(n);for(let w of d){let B="players"in w?w.id:w.id.toString();h.add(B)}this.backtrackVirtualPlayersUnified(t,[...e,L],h,o,a)}}}this.backtrackVirtualPlayersUnified(t,e,n,o,a)}backtrackVirtualPlayersWithLeniencyUnified(t,e,n,s,a,r,o){if(r.length===0){s.length>o.totalPods&&(o.pods=[...s],o.totalPods=s.length);return}if(s.length+r.length<=o.totalPods)return;let l=r[0],i=r.slice(1),p=t.filter(m=>{let y="players"in m.item?m.item.id:m.item.id.toString();return!a.has(y)}),c=[...new Set(p.map(m=>m.powerLevel))].sort((m,y)=>m-y);for(let m of c){let y=p.filter(h=>("players"in h.item,Math.abs(h.powerLevel-m)<=n)),E=new Map;for(let h of y){let w="players"in h.item?h.item.id:h.item.id.toString();if(!E.has(w))E.set(w,h);else{let B=E.get(w),R=Math.abs(B.powerLevel-m);Math.abs(h.powerLevel-m)<R&&E.set(w,h)}}let k=Array.from(E.values()).sort((h,w)=>{if("players"in h.item&&"players"in w.item){let B=Math.abs(h.powerLevel-h.item.averagePower)<.01,R=Math.abs(w.powerLevel-w.item.averagePower)<.01;return B&&!R?-1:!B&&R?1:Math.abs(h.powerLevel-m)-Math.abs(w.powerLevel-m)}return"players"in h.item&&!("players"in w.item)?1:!("players"in h.item)&&"players"in w.item?-1:Math.abs(h.powerLevel-m)-Math.abs(w.powerLevel-m)}),d=0;for(let h=0;h<k.length;h++)d+=this.getItemSize(k[h].item);let L=Math.max(3,l);if(d>=L){let h=k.sort((P,x)=>{let M=this.getItemSize(P.item);return this.getItemSize(x.item)-M}),w=[],B=new Set,R=0;for(let P of h){let x=this.getItemId(P.item),M=this.getItemSize(P.item);if(!B.has(x)&&R+M<=l&&(w.push(P),B.add(x),R+=M,R===l))break}if(R>=3){let P=w.map(u=>u.item);if(!this.isPodPowerSpreadValid(w,n))continue;let x=w.reduce((u,v)=>u+v.powerLevel,0)/w.length,M={players:P,power:Math.round(x*2)/2},C=new Set(a);for(let u of P){let v="players"in u?u.id:u.id.toString();C.add(v),t.forEach(b=>{let S="players"in b.item?b.item.id:b.item.id.toString();S===v&&C.add(S)})}this.backtrackVirtualPlayersWithLeniencyUnified(t,e,n,[...s,M],C,i,o)}}}this.backtrackVirtualPlayersWithLeniencyUnified(t,e,n,s,a,i,o)}isPodPowerSpreadValid(t,e){if(t.length===0)return!0;let n=t.map(o=>o.powerLevel),s=Math.min(...n);return Math.max(...n)-s<=e}findBestCommonPowerLevel(t){if(t.length===0)return null;let e=new Map;for(let a of t)for(let r of a.availablePowers)e.set(r,(e.get(r)||0)+1);if(e.size===0)return null;let n=t[0].availablePowers[0],s=0;for(let[a,r]of e.entries())r>s&&(s=r,n=a);return n}};var V=class{constructor(t,e){this.draggedElement=null;this.draggedItemData=null;this.currentPods=[];this.currentUnassigned=[];this.handleDragStart=t=>{let e=t.target;this.draggedElement=e,e.classList.add("dragging"),this.draggedItemData={type:e.dataset.itemType,id:e.dataset.itemId,podIndex:e.dataset.podIndex,itemIndex:e.dataset.itemIndex},t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/html",e.outerHTML)};this.handleDragEnd=t=>{t.target.classList.remove("dragging"),this.draggedElement=null,this.draggedItemData=null};this.handleDragOver=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move",t.currentTarget.classList.add("drag-over")};this.handleDragLeave=t=>{t.currentTarget.classList.remove("drag-over")};this.handleDrop=t=>{t.preventDefault();let e=t.currentTarget;if(e.classList.remove("drag-over"),!this.draggedItemData)return;let n=e.dataset.podIndex,s=this.draggedItemData.podIndex;n!==s&&this.moveItemBetweenPods(this.draggedItemData,n)};this.playerManager=t,this.onPodsChanged=e}setCurrentPods(t,e=[]){this.currentPods=[...t],this.currentUnassigned=[...e]}moveItemBetweenPods(t,e){let n=t.podIndex,s=parseInt(t.itemIndex),a=null;if(n==="unassigned")a=this.currentUnassigned[s],this.currentUnassigned.splice(s,1);else{let r=this.currentPods[parseInt(n)];a=r.players[s],r.players.splice(s,1),r.power=this.playerManager.calculatePodPower(r.players)}if(a){if(e==="unassigned")this.currentUnassigned.push(a);else if(e==="new-pod"){let r={players:[a],power:this.playerManager.calculatePodPower([a])};this.currentPods.push(r)}else{let r=this.currentPods[parseInt(e)];r.players.push(a),r.power=this.playerManager.calculatePodPower(r.players)}this.cleanupEmptyPods(),this.onPodsChanged(this.currentPods,this.currentUnassigned)}}cleanupEmptyPods(){this.currentPods=this.currentPods.filter(t=>t.players.length>0)}};var O=class{constructor(){this.isDisplayMode=!1;this.handleKeyDown=null;this.borderColors=["#FF6B6B","#4ECDC4","#45B7D1","#FFA726","#66BB6A","#AB47BC","#EF5350","#26A69A","#42A5F5","#FF7043","#9CCC65","#7E57C2","#EC407A","#29B6F6","#FFCA28","#8BC34A","#673AB7","#F06292","#00BCD4","#FFEB3B","#795548","#607D8B","#E91E63","#009688","#FF9800"]}getShuffledColors(t){let e=[...this.borderColors];for(let n=e.length-1;n>0;n--){let s=Math.floor(Math.random()*(n+1));[e[n],e[s]]=[e[s],e[n]]}if(t>e.length){let n=[];for(let s=0;s<t;s++)n.push(e[s%e.length]);return n}return e.slice(0,t)}calculateOptimalWidthForText(t){let e=0;for(let a of t)a===" "?e+=.3:/[iIl1]/.test(a)?e+=.4:/[mwMW]/.test(a)?e+=.8:/[A-Z]/.test(a)?e+=.7:e+=.6;let n=e*1.2,s=Math.min(85,Math.max(25,n/25*85));return Math.round(s)}calculateFontSizeForPod(t,e,n){let s=t*e,a=Math.ceil(Math.sqrt(n)),r=Math.ceil(n/a),o=(t-(a-1)*10)/a,l=(e-(r-1)*10)/r,i=Math.min(o,l),p=Math.min(i*.25,l*.35),c=Math.max(.9,1-(n-3)*.02),m=Math.max(24,Math.min(72,p*c));return`${Math.round(m)}px`}calculateValidBracketRange(t){let e=t.players.flatMap(r=>"players"in r?r.players:[r]);if(e.length===0)return"Unknown";let n=[],s=new Set;e.forEach(r=>{r.brackets&&r.brackets.forEach(o=>s.add(o))});for(let r of s)e.every(l=>l.brackets&&l.brackets.includes(r))&&n.push(r);let a=["1","2","3","4","cedh"];if(n.sort((r,o)=>a.indexOf(r)-a.indexOf(o)),n.length===0)return"Unknown";if(n.length===1)return n[0];{let r=n.filter(l=>l!=="cedh");return r.length>1&&r.every((l,i)=>{if(i===0)return!0;let p=parseInt(l),c=parseInt(r[i-1]);return p===c+1})&&r.length===n.length&&n.length>1?`${n[0]}-${n[n.length-1]}`:n.join(", ")}}getValidBracketsArrayForPod(t){let e=t.players.flatMap(o=>"players"in o?o.players:[o]);if(e.length===0)return[];let n=new Map;if(e.forEach(o=>{o.brackets&&o.brackets.forEach(l=>{n.set(l,(n.get(l)||0)+1)})}),n.size===0)return[];let s=Math.ceil(e.length/2),a=[];for(let[o,l]of n.entries())l>=s&&a.push(o);let r=["1","2","3","4","cedh"];return a.sort((o,l)=>r.indexOf(o)-r.indexOf(l)),a}enterDisplayMode(t){if(t.length===0)return;this.isDisplayMode=!0,document.body.classList.add("display-mode");let e=Math.ceil(Math.sqrt(t.length)),n=document.createElement("div");n.className="display-mode-container",n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100vw",n.style.height="100vh",n.style.background="#1a1a1a",n.style.zIndex="1000",n.style.padding="20px",n.style.boxSizing="border-box",n.style.overflow="hidden",n.innerHTML=`
            <div class="display-mode-controls">
                <button id="exit-display-btn">Exit Display Mode</button>
            </div>
            <h1 style="text-align: center; margin: 0 0 20px 0; font-size: 2.5rem; color: white;">MTG Commander Pods</h1>
            <div id="display-output" style="flex-grow: 1; height: calc(100vh - 140px);"></div>
        `;let s=document.querySelector(".container");s&&(s.style.display="none"),document.body.appendChild(n);let a=n.querySelector("#display-output"),r=document.createElement("div");r.style.display="grid",r.style.gap="20px",r.style.height="100%",r.style.gridTemplateColumns=`repeat(${e}, 1fr)`,r.style.gridTemplateRows=`repeat(${e}, 1fr)`;let o=this.getShuffledColors(t.length);t.forEach((i,p)=>{let c=document.createElement("div");c.style.display="flex",c.style.flexDirection="column",c.style.background="#2a2a2a",c.style.border=`3px solid ${o[p]}`,c.style.borderRadius="8px",c.style.padding="15px",c.style.boxSizing="border-box",c.style.minHeight="0",c.style.boxShadow=`0 0 10px ${o[p]}40`,c.classList.add("pod",`pod-color-${p%10}`);let m=document.createElement("h3"),y=document.getElementById("bracket-radio"),E=y&&y.checked;if(E){let P=this.calculateValidBracketRange(i);m.textContent=`Pod ${p+1} (Bracket: ${P})`}else{let P=N(i);m.textContent=`Pod ${p+1} (Power: ${P})`}m.style.fontSize="1.6rem",m.style.margin="0 0 15px 0",m.style.textAlign="center",m.style.color=o[p],m.style.fontWeight="bold",m.style.flexShrink="0",m.style.textShadow="1px 1px 2px rgba(0,0,0,0.8)",c.appendChild(m);let f=0;i.players.forEach(P=>{"players"in P?f+=P.players.length:f+=1});let k="";i.players.forEach(P=>{if("players"in P)P.players.forEach(x=>{let M=E&&x.bracketRange?`${x.name} (B: ${x.bracketRange})`:`${x.name} (P: ${x.powerRange})`;M.length>k.length&&(k=M)});else{let x=E&&P.bracketRange?`${P.name} (B: ${P.bracketRange})`:`${P.name} (P: ${P.powerRange})`;x.length>k.length&&(k=x)}});let d=document.createElement("ul");d.style.flexGrow="1",d.style.display="flex";let L=Math.ceil(Math.sqrt(f)),h=Math.ceil(f/L);d.style.display="grid",d.style.gridTemplateColumns=`repeat(${L}, 1fr)`,d.style.gridTemplateRows=`repeat(${h}, 1fr)`,d.style.gap="12px",d.style.margin="0",d.style.padding="0",d.style.listStyle="none",d.style.width="100%",d.style.height="100%",d.style.alignItems="stretch",d.style.justifyItems="stretch";let w=[];i.players.forEach(P=>{"players"in P?P.players.forEach(x=>w.push(x)):w.push(P)});let B=document.getElementById("bracket-radio"),R=B&&B.checked;w.forEach((P,x)=>{let M=document.createElement("li"),C=document.createElement("div");C.textContent=P.name,C.className="player-name";let u=document.createElement("div");if(R&&P.bracketRange){let v=this.getValidBracketsArrayForPod(i),b=Y(P,v);u.innerHTML=`B: ${b}`}else{let v=$(i),b=q(P,v);u.innerHTML=`P: ${b}`}u.className="player-power",M.appendChild(C),M.appendChild(u),M.style.display="flex",M.style.flexDirection="column",M.style.justifyContent="center",M.style.alignItems="center",M.style.backgroundColor="rgba(255, 255, 255, 0.12)",M.style.border="2px solid rgba(255, 255, 255, 0.2)",M.style.borderRadius="12px",M.style.padding="8px",M.style.boxSizing="border-box",M.style.textAlign="center",M.style.height="100%",C.style.color="#ffffff",C.style.fontWeight="bold",C.style.lineHeight="1.1",C.style.marginBottom="4px",C.style.wordBreak="break-word",C.style.hyphens="auto",C.style.flexGrow="1",C.style.display="flex",C.style.alignItems="center",C.style.justifyContent="center",u.style.color="#b0b0b0",u.style.fontWeight="500",u.style.lineHeight="1",u.style.opacity="0.9",M.dataset.podRef=p.toString(),M.classList.add("dynamic-font-item"),d.appendChild(M)}),c.appendChild(d),r.appendChild(c)}),a.appendChild(r),requestAnimationFrame(()=>{r.querySelectorAll(".pod").forEach((p,c)=>{let m=p.getBoundingClientRect(),y=m.width,E=m.height,f=0;t[c].players.forEach(L=>{"players"in L?f+=L.players.length:f+=1});let k=this.calculateFontSizeForPod(y,E,f);p.querySelectorAll(".dynamic-font-item").forEach(L=>{let h=L.querySelector(".player-name"),w=L.querySelector(".player-power");if(h&&(h.style.fontSize=k),w){let B=Math.round(parseInt(k)*.75);w.style.fontSize=`${B}px`}})})}),n.querySelector("#exit-display-btn").addEventListener("click",()=>this.exitDisplayMode()),this.handleKeyDown=i=>{i.key==="Escape"&&this.isDisplayMode&&this.exitDisplayMode()},document.addEventListener("keydown",this.handleKeyDown)}exitDisplayMode(){this.isDisplayMode=!1,document.body.classList.remove("display-mode");let t=document.querySelector(".container");t&&(t.style.display="");let e=document.querySelector(".display-mode-container");e&&e.remove(),this.handleKeyDown&&(document.removeEventListener("keydown",this.handleKeyDown),this.handleKeyDown=null)}getIsDisplayMode(){return this.isDisplayMode}};var U=class{constructor(){this.currentPods=[];this.currentUnassigned=[];this.lastResetData=null;this.isRestoring=!1;this.displayModeBtnBottom=null;this.domCache=new Map;this.queryCache=new Map;this.reusablePlayerArray=[];this.reusableItemArray=[];this.playerRowsContainer=document.getElementById("player-rows"),this.outputSection=document.getElementById("output-section"),this.displayModeBtn=document.getElementById("display-mode-btn"),this.playerRowTemplate=document.getElementById("player-row-template"),this.playerManager=new z,this.podGenerator=new F,this.dragDropManager=new V(this.playerManager,(t,e)=>this.renderPods(t,e)),this.displayModeManager=new O,this.initializeEventListeners(),this.initializeRankingModeToggle()}initializeEventListeners(){let t=document.getElementById("add-player-btn"),e=document.getElementById("bulk-add-btn"),n=document.getElementById("generate-pods-btn"),s=document.getElementById("reset-all-btn"),a=document.getElementById("help-btn");t.addEventListener("click",()=>this.addPlayerRow()),e.addEventListener("click",()=>this.bulkAddPlayers(4)),n.addEventListener("click",()=>this.generatePods()),s.addEventListener("click",()=>this.resetAllWithConfirmation()),this.displayModeBtn.addEventListener("click",()=>this.displayModeManager.enterDisplayMode(this.currentPods)),a.addEventListener("click",()=>this.showHelpModal()),this.initializeHelpModal(),this.initializeKeyboardShortcuts()}getCachedElements(t){if(!this.domCache.has(t)){let e=Array.from(this.playerRowsContainer.querySelectorAll(t));this.domCache.set(t,e)}return this.domCache.get(t)}clearDOMCache(){this.domCache.clear(),this.queryCache.clear()}getPlayerRowsOptimized(){let t=this.playerRowsContainer.querySelectorAll(".player-row"),e=[];for(let n=0;n<t.length;n++)e.push(t[n]);return e}clearReusableArrays(){this.reusablePlayerArray.length=0,this.reusableItemArray.length=0}addPlayerRow(){let e=this.playerRowTemplate.content.cloneNode(!0).querySelector(".player-row"),n=this.playerManager.getNextPlayerId();e.dataset.playerId=n.toString();let s=e.querySelector(".power-selector-btn"),a=e.querySelector(".power-selector-dropdown"),r=e.querySelectorAll(".range-btn"),o=()=>{let u=e.querySelectorAll('.power-checkbox input[type="checkbox"]'),v=[];if(u.forEach(b=>{b.checked&&v.push(parseFloat(b.value))}),v.length===0)s.textContent="Select Power Levels",s.classList.remove("has-selection"),s.dataset.validationTriggered==="true"&&s.classList.add("error");else{s.classList.remove("error"),v.sort((S,I)=>S-I);let b;if(v.length===1)b=`Power: ${v[0]}`;else{let S=v[0],I=v[v.length-1];v.every((D,A)=>{if(A===0)return!0;let H=D-v[A-1];return H===.5||H===1})&&v.length>2?b=`Power: ${S}-${I}`:v.length<=4?b=`Power: ${v.join(", ")}`:b=`Power: ${S}-${I} (${v.length} levels)`}s.textContent=b,s.classList.add("has-selection")}};s.addEventListener("click",u=>{u.preventDefault();let v=a.style.display!=="none";document.querySelectorAll(".power-selector-dropdown").forEach(b=>{b.style.display="none",b.classList.remove("show")}),document.querySelectorAll(".power-selector-btn").forEach(b=>{b.classList.remove("open")}),v||(a.style.display="block",s.classList.add("open"),setTimeout(()=>a.classList.add("show"),10))}),document.addEventListener("click",u=>{!s.contains(u.target)&&!a.contains(u.target)&&(a.classList.remove("show"),s.classList.remove("open"),setTimeout(()=>{a.classList.contains("show")||(a.style.display="none")},200))});let l=e.querySelectorAll('.power-checkbox input[type="checkbox"]');l.forEach(u=>{u.addEventListener("change",o)}),r.forEach(u=>{u.addEventListener("click",()=>{let v=u.dataset.range;l.forEach(I=>I.checked=!1);let[b,S]=v.split("-").map(Number);l.forEach(I=>{let T=parseFloat(I.value);(T===b||T===S)&&(I.checked=!0)}),o()})}),e.querySelector(".clear-btn").addEventListener("click",()=>{l.forEach(u=>u.checked=!1),o()});let p=()=>{a.classList.remove("show"),s.classList.remove("open"),setTimeout(()=>{a.classList.contains("show")||(a.style.display="none")},200)},c="",m=null;document.addEventListener("keydown",u=>{let v=a.style.display==="block"&&a.classList.contains("show"),b=document.activeElement===s;(v||b)&&(u.key==="Escape"?(u.preventDefault(),v&&(p(),s.focus()),c="",m&&clearTimeout(m)):(u.key>="1"&&u.key<="9"||u.key==="."||u.key==="0"||u.key==="-")&&(u.preventDefault(),c+=u.key,m&&clearTimeout(m),m=setTimeout(()=>{if(c.includes("-")){let S=c.split("-");if(S.length===2){let I=parseFloat(S[0]),T=parseFloat(S[1]),D=S[0].includes(".")||S[1].includes(".");!isNaN(I)&&!isNaN(T)&&I>=1&&I<=10&&T>=1&&T<=10&&I<=T&&(l.forEach(A=>A.checked=!1),l.forEach(A=>{let H=parseFloat(A.value);if(H>=I&&H<=T){let J=H%1===0,Z=H%1===.5;(J||D&&Z)&&(A.checked=!0)}}),o(),v&&p())}}else{let S=parseFloat(c);if(!isNaN(S)&&S>=1&&S<=10){l.forEach(T=>T.checked=!1);let I=Array.from(l).find(T=>Math.abs(parseFloat(T.value)-S)<.01);I&&(I.checked=!0,o(),v&&p())}}c=""},500)))}),o();let y=e.querySelector(".bracket-selector-btn"),E=e.querySelector(".bracket-selector-dropdown"),f=e.querySelectorAll(".bracket-range-btn"),k=()=>{let u=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),v=[];if(u.forEach(b=>{b.checked&&v.push(b.value)}),v.length===0)y.textContent="Select Brackets",y.classList.remove("has-selection"),y.dataset.validationTriggered==="true"&&y.classList.add("error");else{y.classList.remove("error");let b;v.length===1?b=`Bracket: ${v[0]}`:b=`Brackets: ${v.join(", ")}`,y.textContent=b,y.classList.add("has-selection")}};y.addEventListener("click",u=>{u.preventDefault();let v=E.style.display!=="none";document.querySelectorAll(".bracket-selector-dropdown, .power-selector-dropdown").forEach(b=>{b.style.display="none",b.classList.remove("show")}),document.querySelectorAll(".bracket-selector-btn, .power-selector-btn").forEach(b=>{b.classList.remove("open")}),v||(E.style.display="block",y.classList.add("open"),setTimeout(()=>E.classList.add("show"),10))}),document.addEventListener("click",u=>{!y.contains(u.target)&&!E.contains(u.target)&&(E.classList.remove("show"),y.classList.remove("open"),setTimeout(()=>{E.classList.contains("show")||(E.style.display="none")},200))});let d=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]');d.forEach(u=>{u.addEventListener("change",k)}),f.forEach(u=>{u.addEventListener("click",()=>{let v=u.dataset.range;if(d.forEach(b=>b.checked=!1),v==="cedh")d.forEach(b=>{b.value==="cedh"&&(b.checked=!0)});else{let[b,S]=v.split("-"),I=parseInt(b),T=parseInt(S);d.forEach(D=>{let A=D.value;if(A!=="cedh"){let H=parseInt(A);H>=I&&H<=T&&(D.checked=!0)}})}k()})}),e.querySelector(".bracket-clear-btn").addEventListener("click",()=>{d.forEach(u=>u.checked=!1),k()});let h=()=>{E.classList.remove("show"),y.classList.remove("open"),setTimeout(()=>{E.classList.contains("show")||(E.style.display="none")},200)};document.addEventListener("keydown",u=>{let v=E.style.display==="block"&&E.classList.contains("show"),b=document.activeElement===y;if(v||b){if(u.key==="Escape")u.preventDefault(),v&&(h(),y.focus());else if(u.key>="1"&&u.key<="4"){u.preventDefault();let S=u.key;d.forEach(T=>T.checked=!1);let I=Array.from(d).find(T=>T.value===S);I&&(I.checked=!0,k(),v&&h())}else if(u.key==="5"||u.key.toLowerCase()==="c"){u.preventDefault(),d.forEach(I=>I.checked=!1);let S=Array.from(d).find(I=>I.value==="cedh");S&&(S.checked=!0,k(),v&&h())}}}),k(),e.querySelector(".remove-player-btn").addEventListener("click",()=>{this.playerRowsContainer.removeChild(e),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.updatePlayerNumbers()});let B=e.querySelector(".player-name");B.addEventListener("input",()=>{B.dataset.touched="true",!B.value.trim()&&B.dataset.touched==="true"?B.classList.add("input-error"):B.classList.remove("input-error"),this.clearDuplicateErrorsOnInput()}),e.querySelector(".group-select").addEventListener("change",()=>{this.playerManager.handleGroupChange(this.playerRowsContainer)}),this.playerRowsContainer.appendChild(e),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.clearDOMCache(),this.updatePlayerNumbers();let x=document.getElementById("bracket-radio").checked,M=e.querySelector(".power-levels"),C=e.querySelector(".bracket-levels");x?(M.style.display="none",C.style.display="block"):(M.style.display="block",C.style.display="none")}bulkAddPlayers(t){for(let e=0;e<t;e++)this.addPlayerRow()}initializeKeyboardShortcuts(){document.addEventListener("keydown",t=>{if(t.ctrlKey&&t.key==="Enter"){t.preventDefault(),this.addPlayerRow();let e=this.playerRowsContainer.querySelectorAll(".player-row"),s=e[e.length-1].querySelector(".player-name");s&&s.focus()}})}cleanupBottomDisplayButton(){if(this.displayModeBtnBottom){let t=this.displayModeBtnBottom.parentNode;t&&t.parentNode&&t.parentNode.removeChild(t),this.displayModeBtnBottom=null}}generatePods(){this.triggerValidationForAllFields(),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.playerManager.handleGroupChange(this.playerRowsContainer),this.clearReusableArrays();let t=this.getPlayerRowsOptimized(),e=!1;for(let d=0;d<t.length;d++)t[d].querySelector(".player-name").classList.remove("name-duplicate-error","name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5");for(let d=0;d<t.length;d++){let L=this.playerManager.getPlayerFromRow(t[d]);L?this.reusablePlayerArray.push(L):e=!0}let n=new Map;t.forEach(d=>{let h=d.querySelector(".player-name").value.trim().toLowerCase();h&&(n.has(h)||n.set(h,[]),n.get(h).push(d))});let s=[],a=1;if(n.forEach((d,L)=>{if(d.length>1){s.push(L);let h=`name-duplicate-error-${a}`;d.forEach(w=>{w.querySelector(".player-name").classList.add(h)}),a=a%5+1,e=!0}}),e){let d="Please fix the errors before generating pods.";s.length>0&&(d+=`

Duplicate player names found: ${s.join(", ")}`),alert(d);return}let r=new Map;this.playerManager.getGroups().forEach((d,L)=>{let h=d.reduce((B,R)=>B+R.power,0),w=Math.round(h/d.length*2)/2;r.set(L,{id:L,players:d,averagePower:w,size:d.length})});let o=new Set([...this.playerManager.getGroups().values()].flat().map(d=>d.id)),l=this.reusablePlayerArray.filter(d=>!o.has(d.id));this.reusableItemArray.length=0,this.reusableItemArray.push(...l),r.forEach(d=>{this.reusableItemArray.push({id:d.id,players:d.players,averagePower:d.averagePower,size:d.size})});let i=this.reusablePlayerArray.length;if(i<3){alert("You need at least 3 players to form a pod.");return}let c=j()==="avoid-five"?W(i):G(i),m=K();if(typeof window<"u"&&(window.location.protocol==="file:"||window.__playwright!==void 0||window.playwright!==void 0)){let d=this.reusablePlayerArray.map(h=>h.name).join(""),L=Array.from(d).reduce((h,w)=>h+w.charCodeAt(0),0);this.podGenerator.setShuffleSeed(L)}else this.podGenerator.setShuffleSeed(null);let E=this.podGenerator.generatePodsWithBacktracking(this.reusableItemArray,c,m),f=E.pods,k=E.unassigned;this.currentPods=[...f],this.currentUnassigned=[...k],this.renderPods(f,k)}renderPods(t,e=[]){if(this.currentPods=[...t],this.currentUnassigned=[...e],this.dragDropManager.setCurrentPods(this.currentPods,this.currentUnassigned),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",t.length===0){this.outputSection.textContent="Could not form pods with the given players.",this.displayModeBtn.style.display="none";return}this.displayModeBtn.style.display="inline-block";let n=Math.ceil(Math.sqrt(t.length)),s=document.createElement("div");if(s.classList.add("pods-container"),s.style.gridTemplateColumns=`repeat(${n}, 1fr)`,s.style.gridTemplateRows=`repeat(${n}, 1fr)`,t.forEach((r,o)=>{let l=document.createElement("div");l.classList.add("pod",`pod-color-${o%10}`),l.dataset.podIndex=o.toString(),l.addEventListener("dragover",this.dragDropManager.handleDragOver),l.addEventListener("drop",this.dragDropManager.handleDrop),l.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let i=document.createElement("h3"),p=document.getElementById("bracket-radio");if(p&&p.checked){let y=this.calculateValidBracketRange(r);i.textContent=`Pod ${o+1} (Bracket: ${y})`}else{let y=N(r);i.textContent=`Pod ${o+1} (Power: ${y})`}l.appendChild(i);let m=document.createElement("ul");r.players.forEach((y,E)=>{if("players"in y){let f=document.createElement("li");f.classList.add("pod-group"),f.draggable=!0,f.dataset.itemType="group",f.dataset.itemId=y.id,f.dataset.podIndex=o.toString(),f.dataset.itemIndex=E.toString(),f.addEventListener("dragstart",this.dragDropManager.handleDragStart),f.addEventListener("dragend",this.dragDropManager.handleDragEnd);let k=document.getElementById("bracket-radio"),d=k&&k.checked;d?f.innerHTML=`<strong>Group ${y.id.split("-")[1]}:</strong>`:f.innerHTML=`<strong>Group ${y.id.split("-")[1]} (Avg Power: ${y.averagePower}):</strong>`;let L=document.createElement("ul");y.players.forEach(h=>{let w=document.createElement("li");if(d&&h.bracketRange)w.textContent=`${h.name} (B: ${h.bracketRange})`;else{let B=$(r),R=q(h,B);w.innerHTML=`${h.name} (P: ${R})`}L.appendChild(w)}),f.appendChild(L),m.appendChild(f)}else{let f=document.createElement("li");f.classList.add("pod-player"),f.draggable=!0,f.dataset.itemType="player",f.dataset.itemId=y.id.toString(),f.dataset.podIndex=o.toString(),f.dataset.itemIndex=E.toString(),f.addEventListener("dragstart",this.dragDropManager.handleDragStart),f.addEventListener("dragend",this.dragDropManager.handleDragEnd);let k=document.getElementById("bracket-radio");if(k&&k.checked&&y.bracketRange)f.textContent=`${y.name} (B: ${y.bracketRange})`;else{let L=$(r),h=q(y,L);f.innerHTML=`${y.name} (P: ${h})`}m.appendChild(f)}}),l.appendChild(m),s.appendChild(l)}),t.length>0){let r=document.createElement("div");r.classList.add("pod","new-pod","new-pod-target"),r.style.borderColor="#4CAF50",r.style.backgroundColor="#1f2a1f",r.style.borderStyle="dashed",r.dataset.podIndex="new-pod",r.addEventListener("dragover",this.dragDropManager.handleDragOver),r.addEventListener("drop",this.dragDropManager.handleDrop),r.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let o=document.createElement("h3");o.textContent="Create New Pod",o.style.color="#4CAF50",r.appendChild(o);let l=document.createElement("p");l.textContent="Drag players or groups here to create a new pod",l.style.color="#999",l.style.fontStyle="italic",l.style.textAlign="center",l.style.margin="20px 0",r.appendChild(l),s.appendChild(r)}if(e.length>0){let r=document.createElement("div");r.classList.add("pod","unassigned-pod"),r.style.borderColor="#ff6b6b",r.style.backgroundColor="#2a1f1f",r.dataset.podIndex="unassigned",r.addEventListener("dragover",this.dragDropManager.handleDragOver),r.addEventListener("drop",this.dragDropManager.handleDrop),r.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let o=document.createElement("h3");o.textContent="Unassigned Players",o.style.color="#ff6b6b",r.appendChild(o);let l=document.createElement("ul");e.forEach((i,p)=>{if("players"in i){let c=document.createElement("li");c.classList.add("pod-group"),c.draggable=!0,c.dataset.itemType="group",c.dataset.itemId=i.id,c.dataset.podIndex="unassigned",c.dataset.itemIndex=p.toString(),c.addEventListener("dragstart",this.dragDropManager.handleDragStart),c.addEventListener("dragend",this.dragDropManager.handleDragEnd);let m=document.getElementById("bracket-radio"),y=m&&m.checked;y?c.innerHTML=`<strong>Group ${i.id.split("-")[1]}:</strong>`:c.innerHTML=`<strong>Group ${i.id.split("-")[1]} (Avg Power: ${i.averagePower}):</strong>`;let E=document.createElement("ul");i.players.forEach(f=>{let k=document.createElement("li");y&&f.bracketRange?k.textContent=`${f.name} (B: ${f.bracketRange})`:k.textContent=`${f.name} (P: ${f.powerRange})`,E.appendChild(k)}),c.appendChild(E),l.appendChild(c)}else{let c=document.createElement("li");c.classList.add("pod-player"),c.draggable=!0,c.dataset.itemType="player",c.dataset.itemId=i.id.toString(),c.dataset.podIndex="unassigned",c.dataset.itemIndex=p.toString(),c.addEventListener("dragstart",this.dragDropManager.handleDragStart),c.addEventListener("dragend",this.dragDropManager.handleDragEnd);let m=document.getElementById("bracket-radio");m&&m.checked&&i.bracketRange?c.textContent=`${i.name} (B: ${i.bracketRange})`:c.textContent=`${i.name} (P: ${i.powerRange})`,l.appendChild(c)}}),r.appendChild(l),s.appendChild(r)}this.outputSection.appendChild(s);let a=document.querySelector(".help-section");if(a&&a.parentNode){let r=document.createElement("div");r.style.textAlign="center",r.style.marginTop="20px",r.style.marginBottom="20px",this.displayModeBtnBottom=this.displayModeBtn.cloneNode(!0),this.displayModeBtnBottom.id="display-mode-btn-bottom",this.displayModeBtnBottom.style.display="inline-block",this.displayModeBtnBottom.addEventListener("click",()=>this.displayModeManager.enterDisplayMode(this.currentPods)),r.appendChild(this.displayModeBtnBottom),a.parentNode.insertBefore(r,a)}}captureCurrentPlayerData(){let t=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),e=[];t.forEach(s=>{let a=s.querySelector(".player-name"),r=s.querySelector(".group-select"),o=s.querySelectorAll('.power-checkbox input[type="checkbox"]'),l=[];o.forEach(c=>{c.checked&&l.push(c.value)});let i=s.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),p=[];i.forEach(c=>{c.checked&&p.push(c.value)}),e.push({name:a.value.trim(),groupValue:r.value,createdGroupId:r.dataset.createdGroupId,selectedPowers:l,selectedBrackets:p})});let n={noLeniency:document.getElementById("no-leniency-radio")?.checked||!1,leniency:document.getElementById("leniency-radio")?.checked||!1,superLeniency:document.getElementById("super-leniency-radio")?.checked||!1,bracket:document.getElementById("bracket-radio")?.checked||!1};return{players:e,leniencySettings:n,currentPods:[...this.currentPods],currentUnassigned:[...this.currentUnassigned]}}resetAllWithConfirmation(){if(!Array.from(this.playerRowsContainer.querySelectorAll(".player-row")).some(s=>{if(s.querySelector(".player-name").value.trim())return!0;let r=s.querySelectorAll('input[type="checkbox"]');return Array.from(r).some(o=>o.checked)})){this.resetAll();return}confirm(`Are you sure you want to reset all player data?

This will clear all players, groups, and generated pods. You will be able to undo this action immediately after.`)&&(this.lastResetData=this.captureCurrentPlayerData(),this.resetAll(),this.showUndoResetButton())}showUndoResetButton(){let t=document.getElementById("undo-reset-btn");t&&t.remove();let e=document.createElement("button");e.id="undo-reset-btn",e.textContent="Undo Reset",e.style.marginLeft="10px",e.style.backgroundColor="#28a745",e.style.color="white",e.style.border="none",e.style.padding="8px 16px",e.style.borderRadius="4px",e.style.cursor="pointer",e.style.fontSize="14px",e.addEventListener("click",()=>this.undoReset());let n=document.getElementById("reset-all-btn");n.parentNode.insertBefore(e,n.nextSibling),setTimeout(()=>{document.getElementById("undo-reset-btn")&&(e.remove(),this.lastResetData=null)},3e4)}undoReset(){if(!this.lastResetData){alert("No reset data available to restore.");return}this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds();let t=this.lastResetData.leniencySettings;t.noLeniency&&(document.getElementById("no-leniency-radio").checked=!0),t.leniency&&(document.getElementById("leniency-radio").checked=!0),t.superLeniency&&(document.getElementById("super-leniency-radio").checked=!0),t.bracket&&(document.getElementById("bracket-radio").checked=!0),this.lastResetData.players.forEach(s=>{this.addPlayerRow();let a=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),r=a[a.length-1],o=r.querySelector(".player-name");o.value=s.name;let l=r.querySelector(".group-select");s.createdGroupId&&(l.dataset.createdGroupId=s.createdGroupId),l.value=s.groupValue}),this.isRestoring=!0;let e=document.getElementById("no-leniency-radio"),n=document.getElementById("bracket-radio");if(e&&n){let s=new Event("change",{bubbles:!0});t.bracket?n.dispatchEvent(s):e.dispatchEvent(s)}setTimeout(()=>{this.restorePlayerSelections()},200)}restorePlayerSelections(){if(!this.lastResetData)return;this.lastResetData.players.forEach((e,n)=>{let a=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[n];if(!a)return;e.selectedPowers.forEach(l=>{let i=a.querySelector(`.power-checkbox input[type="checkbox"][value="${l}"]`);i&&(i.checked=!0)}),e.selectedBrackets.forEach(l=>{let i=a.querySelector(`.bracket-checkbox input[type="checkbox"][value="${l}"]`);i&&(i.checked=!0)}),a.querySelectorAll('input[type="checkbox"]').forEach(l=>{l.checked&&l.dispatchEvent(new Event("change",{bubbles:!0}))}),this.updateButtonTextsForRow(a);let o=a.querySelector(".group-select");e.groupValue&&e.groupValue!=="no-group"&&e.groupValue.startsWith("group-")&&(e.createdGroupId?o.dataset.createdGroupId=e.createdGroupId:o.dataset.createdGroupId=e.groupValue,o.value="new-group",o.dispatchEvent(new Event("change",{bubbles:!0})))}),this.lastResetData.players.forEach((e,n)=>{let r=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[n].querySelector(".group-select");e.groupValue&&e.groupValue!=="no-group"&&e.groupValue.startsWith("group-")&&(r.value=e.groupValue,r.dispatchEvent(new Event("change",{bubbles:!0})))}),this.currentPods=[...this.lastResetData.currentPods],this.currentUnassigned=[...this.lastResetData.currentUnassigned],(this.currentPods.length>0||this.currentUnassigned.length>0)&&this.renderPods(this.currentPods,this.currentUnassigned),this.playerManager.handleGroupChange(this.playerRowsContainer),this.isRestoring=!1;let t=document.getElementById("undo-reset-btn");t&&t.remove(),this.lastResetData=null,alert("Reset has been undone successfully!")}resetAll(){this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.displayModeBtn.style.display="none",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds(),this.currentPods=[],this.currentUnassigned=[];let t=document.getElementById("no-leniency-radio");t.checked=!0;for(let e=0;e<4;e++)this.addPlayerRow()}clearDuplicateErrorsOnInput(){let t=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),e=new Map;t.forEach(s=>{let a=s.querySelector(".player-name"),r=a.value.trim().toLowerCase();r&&(e.has(r)||e.set(r,[]),e.get(r).push(a))}),t.forEach(s=>{s.querySelector(".player-name").classList.remove("name-duplicate-error","name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5")});let n=1;e.forEach((s,a)=>{if(s.length>1){let r=`name-duplicate-error-${n}`;s.forEach(o=>{o.classList.add(r)}),n=n%5+1}})}initializeRankingModeToggle(){let t=document.getElementById("power-level-radio"),e=document.getElementById("bracket-radio"),n=()=>{let s=e.checked;if(s){document.body.classList.add("bracket-mode");let r=document.getElementById("no-leniency-radio");r&&(r.checked=!0)}else document.body.classList.remove("bracket-mode");this.playerRowsContainer.querySelectorAll(".player-row").forEach(r=>{let o=r.querySelector(".power-levels"),l=r.querySelector(".bracket-levels");s?(o.style.display="none",l.style.display="block"):(o.style.display="block",l.style.display="none"),this.isRestoring||this.clearAllSelections(r)})};t.addEventListener("change",n),e.addEventListener("change",n),n()}clearAllSelections(t){t.querySelectorAll('.power-checkbox input[type="checkbox"]').forEach(r=>r.checked=!1),t.querySelectorAll('.bracket-checkbox input[type="checkbox"]').forEach(r=>r.checked=!1);let s=t.querySelector(".power-selector-btn"),a=t.querySelector(".bracket-selector-btn");s&&(s.textContent="Select Power Levels",s.classList.remove("has-selection")),a&&(a.textContent="Select Brackets",a.classList.remove("has-selection"))}initializeHelpModal(){let t=document.getElementById("help-modal");t.querySelector(".help-close").addEventListener("click",()=>this.hideHelpModal()),t.addEventListener("click",n=>{n.target===t&&this.hideHelpModal()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&t.style.display==="block"&&this.hideHelpModal()})}showHelpModal(){let t=document.getElementById("help-modal");t.style.display="block",document.body.style.overflow="hidden"}hideHelpModal(){let t=document.getElementById("help-modal");t.style.display="none",document.body.style.overflow=""}calculateValidBracketRange(t){let e=t.players.flatMap(r=>"players"in r?r.players:[r]);if(e.length===0)return"Unknown";let n=[],s=new Set;e.forEach(r=>{r.brackets&&r.brackets.forEach(o=>s.add(o))});for(let r of s)e.every(l=>l.brackets&&l.brackets.includes(r))&&n.push(r);let a=["1","2","3","4","cedh"];if(n.sort((r,o)=>a.indexOf(r)-a.indexOf(o)),n.length===0)return"Unknown";if(n.length===1)return n[0];{let r=n.filter(l=>l!=="cedh");return r.length>1&&r.every((l,i)=>{if(i===0)return!0;let p=parseInt(l),c=parseInt(r[i-1]);return p===c+1})&&r.length===n.length&&n.length>1?`${n[0]}-${n[n.length-1]}`:n.join(", ")}}triggerValidationForAllFields(){let t=this.getPlayerRowsOptimized();for(let e=0;e<t.length;e++){let n=t[e],s=n.querySelector(".player-name");s.value.trim()||s.classList.add("input-error");let r=n.querySelector(".power-selector-btn"),o=n.querySelector(".bracket-selector-btn");if(r&&(r.dataset.validationTriggered="true"),o&&(o.dataset.validationTriggered="true"),document.getElementById("bracket-radio").checked){let p=n.querySelectorAll('.bracket-checkbox input[type="checkbox"]');Array.from(p).some(m=>m.checked)||o.classList.add("error")}else{let p=n.querySelectorAll('.power-checkbox input[type="checkbox"]');Array.from(p).some(m=>m.checked)||r.classList.add("error")}}}updateButtonTextsForRow(t){let e=t.querySelectorAll('.power-checkbox input[type="checkbox"]'),n=t.querySelector(".power-selector-btn");if(n){let r=[];if(e.forEach(o=>{o.checked&&r.push(parseFloat(o.value))}),r.length===0)n.textContent="Select Power Levels",n.classList.remove("has-selection");else{r.sort((l,i)=>l-i);let o;if(r.length===1)o=`Power: ${r[0]}`;else{let l=r[0],i=r[r.length-1];r.every((c,m)=>{if(m===0)return!0;let y=c-r[m-1];return y===.5||y===1})&&r.length>2?o=`Power: ${l}-${i}`:r.length<=4?o=`Power: ${r.join(", ")}`:o=`Power: ${l}-${i} (${r.length} levels)`}n.textContent=o,n.classList.add("has-selection")}}let s=t.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),a=t.querySelector(".bracket-selector-btn");if(a){let r=[];if(s.forEach(o=>{o.checked&&r.push(o.value)}),r.length===0)a.textContent="Select Brackets",a.classList.remove("has-selection");else{let o;r.length===1?o=`Bracket: ${r[0]}`:o=`Brackets: ${r.join(", ")}`,a.textContent=o,a.classList.add("has-selection")}}}updatePlayerNumbers(){this.playerRowsContainer.querySelectorAll(".player-row").forEach((e,n)=>{let s=e.querySelector(".player-number");s&&(s.textContent=(n+1).toString())})}};function X(){let e=Math.floor(Math.random()*360),n=25,s=[];for(let o=0;o<50;o++){let i=(e+o*137.5)%360;s.push(Math.round(i))}let a="";for(let o=1;o<=50;o++){let l=s[o-1],i=70+Math.floor(Math.random()*20),p=50,c=28+Math.floor(Math.random()*8);a+=`
.player-row .group-select.group-${o} {
    border-color: hsl(${l}, ${i}%, ${p}%) !important;
    background-color: hsl(${l}, ${i}%, ${c}%) !important;
}`,a+=`
.group-select option[value="group-${o}"] {
    background-color: hsl(${l}, ${i}%, ${c}%);
}`}let r=document.createElement("style");r.id="dynamic-group-colors",r.textContent=a,document.head.appendChild(r)}document.addEventListener("DOMContentLoaded",()=>{X(),new U().resetAll()});})();
