"use strict";(()=>{function G(p){if(p<3)return[];if(p===3)return[3];if(p===4)return[4];if(p===5)return[5];if(p===6)return[3,3];if(p===7)return[4,3];if(p===8)return[4,4];if(p===9)return[3,3,3];if(p===10)return[5,5];let e=Math.floor(p/4),t=p%4;return t===0?Array(e).fill(4):t===1?e>=2?[...Array(e-2).fill(4),5,4]:[3,3,3,2]:t===2?e>=1?[...Array(e-1).fill(4),3,3]:[3,3,3,3]:t===3?[...Array(e).fill(4),3]:[]}function _(p){if(p<3)return[];if(p<9)return G(p);if(p===9)return[3,3,3];if(p===10)return[4,3,3];if(p===11)return[4,4,3];if(p===12)return[4,4,4];if(p===13)return[4,3,3,3];if(p===14)return[4,4,3,3];if(p===15)return[4,4,4,3];let e=[],t=p;for(;t>=7;)e.push(4),t-=4;if(t===6)e.push(3,3);else if(t===5)if(e.length>0)e.pop(),t+=4,e.push(3,3,3);else return G(p);else t===4?e.push(4):t===3&&e.push(3);return e.sort((r,o)=>o-r)}function Y(){let p=document.getElementById("avoid-five-pods-radio");return p&&p.checked?"avoid-five":"balanced"}function Z(){let p=document.getElementById("bracket-radio");if(p&&p.checked)return{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0};let e=document.getElementById("no-leniency-radio"),t=document.getElementById("leniency-radio");return document.getElementById("super-leniency-radio").checked?{allowLeniency:!0,allowSuperLeniency:!0,maxTolerance:1}:t.checked?{allowLeniency:!0,allowSuperLeniency:!1,maxTolerance:.5}:{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0}}function J(p){let e=[];if(p.forEach(o=>{if(o.checked){let n=parseFloat(o.value);isNaN(n)||e.push(n)}}),e.length===0)return{availablePowers:[],powerRange:"",averagePower:0};e.sort((o,n)=>o-n);let t;e.length===1?t=e[0].toString():t=e.join(", ");let r=e.reduce((o,n)=>o+n,0)/e.length;return{availablePowers:e,powerRange:t,averagePower:Math.round(r*2)/2}}function X(){let p=document.querySelector("#leniency-radio");return document.querySelector("#super-leniency-radio")?.checked?1:p?.checked?.5:0}function q(p){let e=p.players.flatMap(n=>"players"in n?n.players:[n]);if(e.length===0)return p.power.toString();let t=X(),r=[],o=new Set;e.forEach(n=>{n.availablePowers.forEach(a=>o.add(a))});for(let n of o)e.every(s=>s.availablePowers.some(l=>Math.abs(n-l)<=t))&&r.push(n);return r.sort((n,a)=>n-a),r.length===0?p.power.toString():r.length===1?r[0].toString():r.every((a,s)=>s===0||a-r[s-1]<=.5)&&r.length>2?`${r[0]}-${r[r.length-1]}`:r.join(", ")}function A(p,e){let t=[];if(Array.isArray(p.availablePowers))t=p.availablePowers;else if(typeof p.powerRange=="string")if(p.powerRange.includes("-")){let[o,n]=p.powerRange.split("-").map(a=>parseFloat(a.trim()));for(let a=o;a<=n;a+=.5)t.push(a)}else t=p.powerRange.split(",").map(o=>parseFloat(o.trim()));return t.map(o=>e.includes(o)?`<span class="power-highlight">${o}</span>`:o.toString()).join(", ")}function Q(p,e){let t=[];if(Array.isArray(p.availableBrackets))t=p.availableBrackets;else if(typeof p.bracketRange=="string")if(p.bracketRange.includes("-")){let[o,n]=p.bracketRange.split("-").map(l=>l.trim()),a=parseInt(o),s=parseInt(n);if(!isNaN(a)&&!isNaN(s))for(let l=a;l<=s;l++)t.push(l.toString());else t=[o,n]}else t=p.bracketRange.split(",").map(o=>o.trim());return t.map(o=>e.includes(o)?`<span class="bracket-highlight">${o}</span>`:o.toString()).join(", ")}function D(p){let e=p.players.flatMap(a=>"players"in a?a.players:[a]);if(e.length===0)return[];let t=new Map,r=new Set;if(e.forEach(a=>{a.availablePowers.length===1&&r.add(a.availablePowers[0]),a.availablePowers.forEach(s=>{t.set(s,(t.get(s)||0)+1)})}),t.size===0)return[];let o=Math.max(...t.values()),n=[];for(let[a,s]of t.entries())(s===o||r.has(a))&&n.push(a);return n.sort((a,s)=>a-s),n}var N=class{constructor(){this.groups=new Map;this.nextPlayerId=0;this.nextGroupId=1;this.availableColors=[];this.groupColorAssignments=new Map;this.initializeAvailableColors()}initializeAvailableColors(){this.availableColors=Array.from({length:50},(e,t)=>t+1),this.shuffleArray(this.availableColors)}shuffleArray(e){for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}}assignRandomColor(e){if(this.groupColorAssignments.has(e))return this.groupColorAssignments.get(e);this.availableColors.length===0&&this.initializeAvailableColors();let t=this.availableColors.pop();return this.groupColorAssignments.set(e,t),t}releaseColor(e){let t=this.groupColorAssignments.get(e);t&&(this.availableColors.push(t),this.groupColorAssignments.delete(e))}getNextPlayerId(){return this.nextPlayerId++}resetPlayerIds(){this.nextPlayerId=0}getNextGroupId(){let e=new Set;document.querySelectorAll(".group-select").forEach(r=>{if(r.value.startsWith("group-")){let o=parseInt(r.value.split("-")[1]);isNaN(o)||e.add(o)}if(r.value==="new-group"&&r.dataset.createdGroupId&&r.dataset.createdGroupId.startsWith("group-")){let o=parseInt(r.dataset.createdGroupId.split("-")[1]);isNaN(o)||e.add(o)}});for(let r=1;r<=50;r++)if(!e.has(r))return r;return this.nextGroupId++}resetGroupIds(){this.nextGroupId=1}getGroups(){return this.groups}clearGroups(){this.groups.clear()}getPlayerFromRow(e){let t=e.querySelector(".player-name");t.classList.remove("input-error");let r=t.value.trim();if(!r)return t.classList.add("input-error"),null;if(document.getElementById("bracket-radio").checked){let a=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),s=[];if(a.forEach(h=>{h.checked&&s.push(h.value)}),s.length===0)return e.querySelector(".bracket-selector-btn").classList.add("error"),null;e.querySelector(".bracket-selector-btn").classList.remove("error");let l={1:1,2:2,3:3,4:4,cedh:10},i=s.map(h=>l[h]),u=i.reduce((h,c)=>h+c,0)/i.length;return{id:parseInt(e.dataset.playerId),name:r,power:Math.round(u*2)/2,availablePowers:i,powerRange:s.join(", "),brackets:s,bracketRange:s.join(", "),rowElement:e}}else{let a=e.querySelectorAll('.power-checkbox input[type="checkbox"]'),s=J(a);return s.availablePowers.length===0?(e.querySelector(".power-selector-btn").classList.add("error"),null):(e.querySelector(".power-selector-btn").classList.remove("error"),{id:parseInt(e.dataset.playerId),name:r,power:s.averagePower,availablePowers:s.availablePowers,powerRange:s.powerRange,rowElement:e})}}handleGroupChange(e){this.groups.clear();let t=Array.from(e.querySelectorAll(".player-row"));t.forEach(o=>{for(let n=1;n<=50;n++)o.querySelector(".group-select").classList.remove(`group-${n}`)});let r=new Set;t.forEach(o=>{let n=o.querySelector(".group-select");n.dataset.createdGroupId?r.add(n.dataset.createdGroupId):n.value.startsWith("group-")&&r.add(n.value)}),t.forEach(o=>{let n=o.querySelector(".group-select"),a="";if(n.value==="new-group"){n.dataset.createdGroupId?a=n.dataset.createdGroupId:(a=`group-${this.getNextGroupId()}`,r.add(a),n.dataset.createdGroupId=a);let s=this.getPlayerFromRow(o);s&&(this.groups.has(a)||this.groups.set(a,[]),this.groups.get(a).push(s))}else if(n.value.startsWith("group-")){a=n.value;let s=this.getPlayerFromRow(o);s&&(this.groups.has(n.value)||this.groups.set(n.value,[]),this.groups.get(n.value).push(s))}else n.dataset.createdGroupId&&delete n.dataset.createdGroupId;if(a){let s=parseInt(a.split("-")[1]);s>=1&&s<=50&&n.classList.add(`group-${s}`)}}),this.cleanupUnusedGroups(r),this.updateAllGroupDropdowns(e)}updateAllGroupDropdowns(e){let t=new Set,r=Array.from(e.querySelectorAll(".player-row"));r.forEach(o=>{let n=o.querySelector(".group-select");n.value==="new-group"&&n.dataset.createdGroupId?t.add(n.dataset.createdGroupId):n.value.startsWith("group-")&&t.add(n.value)}),r.forEach(o=>{let n=o.querySelector(".group-select"),a=n.value,s=n.dataset.createdGroupId;if(Array.from(n.options).forEach(i=>{i.value.startsWith("group-")&&n.remove(i.index)}),t.forEach(i=>{let u=i.split("-")[1],h=new Option(`Group ${u}`,i);n.add(h)}),s&&t.has(s)&&(a==="new-group"||a==="no-group")){n.value=s;let i=parseInt(s.split("-")[1]);i>=1&&i<=50&&n.classList.add(`group-${i}`)}else if(a.startsWith("group-")&&t.has(a)){n.value=a;let i=parseInt(a.split("-")[1]);i>=1&&i<=50&&n.classList.add(`group-${i}`)}else{n.value="no-group";for(let i=1;i<=50;i++)n.classList.remove(`group-${i}`)}})}arePlayersCompatible(e,t,r){return e.availablePowers.some(n=>t.availablePowers.some(a=>Math.abs(n-a)<.01))?!0:r.allowLeniency?e.availablePowers.some(n=>t.availablePowers.some(a=>Math.abs(n-a)<=r.maxTolerance)):!1}findAllCommonPowers(e,t){return e.length===0?[]:[...new Set(e.flatMap(o=>o.availablePowers))].sort((o,n)=>o-n).filter(o=>e.every(n=>n.availablePowers.some(a=>{let s=Math.abs(a-o);return s<.01||t.allowLeniency&&s<=t.maxTolerance})))}findBestCommonPowerLevel(e){if(e.length===0)return null;let t=new Map;for(let n of e)for(let a of n.availablePowers)t.set(a,(t.get(a)||0)+1);if(t.size===0)return null;let r=e[0].availablePowers[0],o=0;for(let[n,a]of t.entries())a>o&&(o=a,r=n);return r}calculatePodPower(e){if(e.length===0)return 0;let t=e.reduce((r,o)=>{if("players"in o)return r+o.averagePower;{let n=o.powerRange.split(",").map(s=>parseFloat(s.trim())),a=n.reduce((s,l)=>s+l,0)/n.length;return r+a}},0);return Math.round(t/e.length*10)/10}cleanupUnusedGroups(e){Array.from(this.groupColorAssignments.keys()).forEach(n=>{e.has(n)||this.releaseColor(n)}),Array.from(this.groups.keys()).forEach(n=>{e.has(n)||this.groups.delete(n)}),document.querySelectorAll(".group-select").forEach(n=>{let a=n.dataset.createdGroupId;a&&!e.has(a)&&delete n.dataset.createdGroupId})}};var F=class{constructor(){this.shuffleSeed=null;this.sizeCache=new Map}setShuffleSeed(e){this.shuffleSeed=e,this.sizeCache.clear()}seededRandom(e){let t=e;return()=>(t=t*1103515245+12345&2147483647,t/2147483647)}shuffleArray(e){let t=[...e],r;this.shuffleSeed!==null?r=this.seededRandom(this.shuffleSeed):r=Math.random;for(let o=t.length-1;o>0;o--){let n=Math.floor(r()*(o+1));[t[o],t[n]]=[t[n],t[o]]}return t}getItemSize(e){let t="players"in e?`group-${e.id}`:`player-${e.id}`;if(!this.sizeCache.has(t)){let r="players"in e?e.size:1;this.sizeCache.set(t,r)}return this.sizeCache.get(t)}getItemId(e){return"players"in e?e.id:e.id.toString()}generatePodsWithBacktracking(e,t,r){let o=this.shuffleArray(e),n=o.reduce((i,u)=>i+("size"in u?u.size:1),0);if(n>=3&&n<=5){let i=o.flatMap(h=>"players"in h?h.players:[h]),u=this.findBestCommonPowerLevel(i);return u!==null?{pods:[{players:o,power:u}],unassigned:[]}:{pods:[],unassigned:o}}let a=this.findOptimalPodAssignment(o,t,r),s=new Set;for(let i of a)for(let u of i.players)"players"in u?s.add(u.id):s.add(u.id.toString());let l=o.filter(i=>"players"in i?!s.has(i.id):!s.has(i.id.toString()));return{pods:a,unassigned:l}}findOptimalPodAssignment(e,t,r){return this.optimizeVirtualPlayerAssignmentUnified(e,t,r)}optimizeVirtualPlayerAssignmentUnified(e,t,r){if(e.length===0)return[];let o=this.createVirtualPlayersUnified(e),n=new Map;for(let s of o)n.has(s.powerLevel)||n.set(s.powerLevel,[]),n.get(s.powerLevel).push(s);let a={pods:[],totalPods:0};return r.allowLeniency?this.backtrackVirtualPlayersWithLeniencyUnified(o,t,r.maxTolerance,[],new Set,t,a):this.backtrackVirtualPlayersUnified(Array.from(n.entries()),[],new Set,t,a),a.pods}createVirtualPlayersUnified(e){let t=[];for(let r of e)if("players"in r){let o=r.players.flatMap(u=>u.availablePowers),n=Math.min(...o),a=Math.max(...o),l=[r.averagePower,n,a],i=[...new Set(l)];for(let u of i)t.push({item:r,powerLevel:u})}else for(let o of r.availablePowers)t.push({item:r,powerLevel:o});return t}backtrackVirtualPlayersUnified(e,t,r,o,n){if(o.length===0){t.length>n.totalPods&&(n.pods=[...t],n.totalPods=t.length);return}if(t.length+o.length<=n.totalPods)return;let a=o[0],s=o.slice(1);for(let[l,i]of e){let u=i.filter(b=>{let f=this.getItemId(b.item);return!r.has(f)}),h=0;for(let b=0;b<u.length;b++)h+=this.getItemSize(u[b].item);let c=Math.max(3,a);if(h>=c){let b=u.sort((d,E)=>{let m=this.getItemSize(d.item);return this.getItemSize(E.item)-m}),f=[],k=new Set,g=0;for(let d of b){let E=this.getItemId(d.item),m=this.getItemSize(d.item);if(!k.has(E)&&g+m<=a&&(f.push(d),k.add(E),g+=m,g===a))break}if(g>=3){let d=f.map(y=>y.item),E={players:d,power:l},m=new Set(r);for(let y of d){let L="players"in y?y.id:y.id.toString();m.add(L)}this.backtrackVirtualPlayersUnified(e,[...t,E],m,s,n)}}}this.backtrackVirtualPlayersUnified(e,t,r,s,n)}backtrackVirtualPlayersWithLeniencyUnified(e,t,r,o,n,a,s){if(a.length===0){o.length>s.totalPods&&(s.pods=[...o],s.totalPods=o.length);return}if(o.length+a.length<=s.totalPods)return;let l=a[0],i=a.slice(1),u=e.filter(c=>{let b="players"in c.item?c.item.id:c.item.id.toString();return!n.has(b)}),h=[...new Set(u.map(c=>c.powerLevel))].sort((c,b)=>c-b);for(let c of h){let b=u.filter(m=>("players"in m.item,Math.abs(m.powerLevel-c)<=r)),f=new Map;for(let m of b){let y="players"in m.item?m.item.id:m.item.id.toString();if(!f.has(y))f.set(y,m);else{let L=f.get(y),T=Math.abs(L.powerLevel-c);Math.abs(m.powerLevel-c)<T&&f.set(y,m)}}let g=Array.from(f.values()).sort((m,y)=>{if("players"in m.item&&"players"in y.item){let L=Math.abs(m.powerLevel-m.item.averagePower)<.01,T=Math.abs(y.powerLevel-y.item.averagePower)<.01;return L&&!T?-1:!L&&T?1:Math.abs(m.powerLevel-c)-Math.abs(y.powerLevel-c)}return"players"in m.item&&!("players"in y.item)?1:!("players"in m.item)&&"players"in y.item?-1:Math.abs(m.powerLevel-c)-Math.abs(y.powerLevel-c)}),d=0;for(let m=0;m<g.length;m++)d+=this.getItemSize(g[m].item);let E=Math.max(3,l);if(d>=E){let m=g.sort((v,M)=>{let w=this.getItemSize(v.item);return this.getItemSize(M.item)-w}),y=[],L=new Set,T=0;for(let v of m){let M=this.getItemId(v.item),w=this.getItemSize(v.item);if(!L.has(M)&&T+w<=l&&(y.push(v),L.add(M),T+=w,T===l))break}if(T>=3){let v=y.map(I=>I.item);if(!this.isPodPowerSpreadValid(y,r))continue;let M=y.reduce((I,x)=>I+x.powerLevel,0)/y.length,w={players:v,power:Math.round(M*2)/2},P=new Set(n);for(let I of v){let x="players"in I?I.id:I.id.toString();P.add(x),e.forEach(R=>{let j="players"in R.item?R.item.id:R.item.id.toString();j===x&&P.add(j)})}this.backtrackVirtualPlayersWithLeniencyUnified(e,t,r,[...o,w],P,i,s)}}}this.backtrackVirtualPlayersWithLeniencyUnified(e,t,r,o,n,i,s)}isPodPowerSpreadValid(e,t){if(e.length===0)return!0;let r=e.map(s=>s.powerLevel),o=Math.min(...r);return Math.max(...r)-o<=t}findBestCommonPowerLevel(e){if(e.length===0)return null;let t=new Map;for(let n of e)for(let a of n.availablePowers)t.set(a,(t.get(a)||0)+1);if(t.size===0)return null;let r=e[0].availablePowers[0],o=0;for(let[n,a]of t.entries())a>o&&(o=a,r=n);return r}};var z=class{constructor(e,t){this.draggedElement=null;this.draggedItemData=null;this.currentPods=[];this.currentUnassigned=[];this.handleDragStart=e=>{let t=e.target;this.draggedElement=t,t.classList.add("dragging"),this.draggedItemData={type:t.dataset.itemType,id:t.dataset.itemId,podIndex:t.dataset.podIndex,itemIndex:t.dataset.itemIndex},e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",t.outerHTML)};this.handleDragEnd=e=>{e.target.classList.remove("dragging"),this.draggedElement=null,this.draggedItemData=null};this.handleDragOver=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",e.currentTarget.classList.add("drag-over")};this.handleDragLeave=e=>{e.currentTarget.classList.remove("drag-over")};this.handleDrop=e=>{e.preventDefault();let t=e.currentTarget;if(t.classList.remove("drag-over"),!this.draggedItemData)return;let r=t.dataset.podIndex,o=this.draggedItemData.podIndex;r!==o&&this.moveItemBetweenPods(this.draggedItemData,r)};this.playerManager=e,this.onPodsChanged=t}setCurrentPods(e,t=[]){this.currentPods=[...e],this.currentUnassigned=[...t]}moveItemBetweenPods(e,t){let r=e.podIndex,o=parseInt(e.itemIndex),n=null;if(r==="unassigned")n=this.currentUnassigned[o],this.currentUnassigned.splice(o,1);else{let a=this.currentPods[parseInt(r)];n=a.players[o],a.players.splice(o,1),a.power=this.playerManager.calculatePodPower(a.players)}if(n){if(t==="unassigned")this.currentUnassigned.push(n);else if(t==="new-pod"){let a={players:[n],power:this.playerManager.calculatePodPower([n])};this.currentPods.push(a)}else{let a=this.currentPods[parseInt(t)];a.players.push(n),a.power=this.playerManager.calculatePodPower(a.players)}this.cleanupEmptyPods(),this.onPodsChanged(this.currentPods,this.currentUnassigned)}}cleanupEmptyPods(){this.currentPods=this.currentPods.filter(e=>e.players.length>0)}};var O=class{constructor(){this.isDisplayMode=!1;this.handleKeyDown=null;this.borderColors=["#FF6B6B","#4ECDC4","#45B7D1","#FFA726","#66BB6A","#AB47BC","#EF5350","#26A69A","#42A5F5","#FF7043","#9CCC65","#7E57C2","#EC407A","#29B6F6","#FFCA28","#8BC34A","#673AB7","#F06292","#00BCD4","#FFEB3B","#795548","#607D8B","#E91E63","#009688","#FF9800"]}getShuffledColors(e){let t=[...this.borderColors];for(let r=t.length-1;r>0;r--){let o=Math.floor(Math.random()*(r+1));[t[r],t[o]]=[t[o],t[r]]}if(e>t.length){let r=[];for(let o=0;o<e;o++)r.push(t[o%t.length]);return r}return t.slice(0,e)}calculateOptimalWidthForText(e){let t=0;for(let n of e)n===" "?t+=.3:/[iIl1]/.test(n)?t+=.4:/[mwMW]/.test(n)?t+=.8:/[A-Z]/.test(n)?t+=.7:t+=.6;let r=t*1.2,o=Math.min(85,Math.max(25,r/25*85));return Math.round(o)}calculateFontSizeForPod(e,t,r){let o=e*t,n=Math.ceil(Math.sqrt(r)),a=Math.ceil(r/n),s=(e-(n-1)*10)/n,l=(t-(a-1)*10)/a,i=Math.min(s,l),u=Math.min(i*.25,l*.35),h=Math.max(.9,1-(r-3)*.02),c=Math.max(24,Math.min(72,u*h));return`${Math.round(c)}px`}calculateValidBracketRange(e){let t=e.players.flatMap(a=>"players"in a?a.players:[a]);if(t.length===0)return"Unknown";let r=[],o=new Set;t.forEach(a=>{a.brackets&&a.brackets.forEach(s=>o.add(s))});for(let a of o)t.every(l=>l.brackets&&l.brackets.includes(a))&&r.push(a);let n=["1","2","3","4","cedh"];if(r.sort((a,s)=>n.indexOf(a)-n.indexOf(s)),r.length===0)return"Unknown";if(r.length===1)return r[0];{let a=r.filter(l=>l!=="cedh");return a.length>1&&a.every((l,i)=>{if(i===0)return!0;let u=parseInt(l),h=parseInt(a[i-1]);return u===h+1})&&a.length===r.length&&r.length>1?`${r[0]}-${r[r.length-1]}`:r.join(", ")}}getValidBracketsArrayForPod(e){let t=e.players.flatMap(s=>"players"in s?s.players:[s]);if(t.length===0)return[];let r=new Map;if(t.forEach(s=>{s.brackets&&s.brackets.forEach(l=>{r.set(l,(r.get(l)||0)+1)})}),r.size===0)return[];let o=Math.ceil(t.length/2),n=[];for(let[s,l]of r.entries())l>=o&&n.push(s);let a=["1","2","3","4","cedh"];return n.sort((s,l)=>a.indexOf(s)-a.indexOf(l)),n}enterDisplayMode(e){if(e.length===0)return;this.isDisplayMode=!0,document.body.classList.add("display-mode");let t=Math.ceil(Math.sqrt(e.length)),r=document.createElement("div");r.className="display-mode-container",r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="100vw",r.style.height="100vh",r.style.background="#1a1a1a",r.style.zIndex="1000",r.style.padding="20px",r.style.boxSizing="border-box",r.style.overflow="hidden",r.innerHTML=`
            <div class="display-mode-controls">
                <button id="exit-display-btn">Exit Display Mode</button>
            </div>
            <h1 style="text-align: center; margin: 0 0 20px 0; font-size: 2.5rem; color: white;">MTG Commander Pods</h1>
            <div id="display-output" style="flex-grow: 1; height: calc(100vh - 140px);"></div>
        `;let o=document.querySelector(".container");o&&(o.style.display="none"),document.body.appendChild(r);let n=r.querySelector("#display-output"),a=document.createElement("div");a.style.display="grid",a.style.gap="20px",a.style.height="100%",a.style.gridTemplateColumns=`repeat(${t}, 1fr)`,a.style.gridTemplateRows=`repeat(${t}, 1fr)`;let s=this.getShuffledColors(e.length);e.forEach((i,u)=>{let h=document.createElement("div");h.style.display="flex",h.style.flexDirection="column",h.style.background="#2a2a2a",h.style.border=`3px solid ${s[u]}`,h.style.borderRadius="8px",h.style.padding="15px",h.style.boxSizing="border-box",h.style.minHeight="0",h.style.boxShadow=`0 0 10px ${s[u]}40`,h.classList.add("pod",`pod-color-${u%10}`);let c=document.createElement("h3"),b=document.getElementById("bracket-radio"),f=b&&b.checked;if(f){let v=this.calculateValidBracketRange(i);c.textContent=`Pod ${u+1} (Bracket: ${v})`}else{let v=q(i);c.textContent=`Pod ${u+1} (Power: ${v})`}c.style.fontSize="1.6rem",c.style.margin="0 0 15px 0",c.style.textAlign="center",c.style.color=s[u],c.style.fontWeight="bold",c.style.flexShrink="0",c.style.textShadow="1px 1px 2px rgba(0,0,0,0.8)",h.appendChild(c);let k=0;i.players.forEach(v=>{"players"in v?k+=v.players.length:k+=1});let g="";i.players.forEach(v=>{if("players"in v)v.players.forEach(M=>{let w=f&&M.bracketRange?`${M.name} (B: ${M.bracketRange})`:`${M.name} (P: ${M.powerRange})`;w.length>g.length&&(g=w)});else{let M=f&&v.bracketRange?`${v.name} (B: ${v.bracketRange})`:`${v.name} (P: ${v.powerRange})`;M.length>g.length&&(g=M)}});let d=document.createElement("ul");d.style.flexGrow="1",d.style.display="flex";let E=Math.ceil(Math.sqrt(k)),m=Math.ceil(k/E);d.style.display="grid",d.style.gridTemplateColumns=`repeat(${E}, 1fr)`,d.style.gridTemplateRows=`repeat(${m}, 1fr)`,d.style.gap="12px",d.style.margin="0",d.style.padding="0",d.style.listStyle="none",d.style.width="100%",d.style.height="100%",d.style.alignItems="stretch",d.style.justifyItems="stretch";let y=[];i.players.forEach(v=>{"players"in v?v.players.forEach(M=>y.push(M)):y.push(v)});let L=document.getElementById("bracket-radio"),T=L&&L.checked;y.forEach((v,M)=>{let w=document.createElement("li"),P=document.createElement("div");P.textContent=v.name,P.className="player-name";let I=document.createElement("div");if(T&&v.bracketRange){let x=this.getValidBracketsArrayForPod(i),R=Q(v,x);I.innerHTML=`B: ${R}`}else{let x=D(i),R=A(v,x);I.innerHTML=`P: ${R}`}I.className="player-power",w.appendChild(P),w.appendChild(I),w.style.display="flex",w.style.flexDirection="column",w.style.justifyContent="center",w.style.alignItems="center",w.style.backgroundColor="rgba(255, 255, 255, 0.12)",w.style.border="2px solid rgba(255, 255, 255, 0.2)",w.style.borderRadius="12px",w.style.padding="8px",w.style.boxSizing="border-box",w.style.textAlign="center",w.style.height="100%",P.style.color="#ffffff",P.style.fontWeight="bold",P.style.lineHeight="1.1",P.style.marginBottom="4px",P.style.wordBreak="break-word",P.style.hyphens="auto",P.style.flexGrow="1",P.style.display="flex",P.style.alignItems="center",P.style.justifyContent="center",I.style.color="#b0b0b0",I.style.fontWeight="500",I.style.lineHeight="1",I.style.opacity="0.9",w.dataset.podRef=u.toString(),w.classList.add("dynamic-font-item"),d.appendChild(w)}),h.appendChild(d),a.appendChild(h)}),n.appendChild(a),requestAnimationFrame(()=>{a.querySelectorAll(".pod").forEach((u,h)=>{let c=u.getBoundingClientRect(),b=c.width,f=c.height,k=0;e[h].players.forEach(E=>{"players"in E?k+=E.players.length:k+=1});let g=this.calculateFontSizeForPod(b,f,k);u.querySelectorAll(".dynamic-font-item").forEach(E=>{let m=E.querySelector(".player-name"),y=E.querySelector(".player-power");if(m&&(m.style.fontSize=g),y){let L=Math.round(parseInt(g)*.75);y.style.fontSize=`${L}px`}})})}),r.querySelector("#exit-display-btn").addEventListener("click",()=>this.exitDisplayMode()),this.handleKeyDown=i=>{i.key==="Escape"&&this.isDisplayMode&&this.exitDisplayMode()},document.addEventListener("keydown",this.handleKeyDown)}exitDisplayMode(){this.isDisplayMode=!1,document.body.classList.remove("display-mode");let e=document.querySelector(".container");e&&(e.style.display="");let t=document.querySelector(".display-mode-container");t&&t.remove(),this.handleKeyDown&&(document.removeEventListener("keydown",this.handleKeyDown),this.handleKeyDown=null)}getIsDisplayMode(){return this.isDisplayMode}};var U=class{constructor(){this.listeners=new Map;this.abortController=new AbortController}addEventListener(e,t,r,o){let n=this.generateId(),a={...typeof o=="object"?o:{capture:o},signal:this.abortController.signal};return e.addEventListener(t,r,a),this.listeners.set(n,{element:e,type:t,listener:r,options:a}),n}removeEventListener(e){let t=this.listeners.get(e);return t?(t.element.removeEventListener(t.type,t.listener,t.options),this.listeners.delete(e),!0):!1}removeAllFromElement(e){let t=0;for(let[r,o]of this.listeners.entries())o.element===e&&(o.element.removeEventListener(o.type,o.listener,o.options),this.listeners.delete(r),t++);return t}removeAll(){this.abortController.abort(),this.abortController=new AbortController,this.listeners.clear()}getListenerCount(){return this.listeners.size}generateId(){return`listener_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}},W=new U;var S=class{static clearDuplicateErrors(e){e.forEach(t=>{let r=t.querySelector(".player-name");r&&r.classList.remove("name-duplicate-error",...this.DUPLICATE_ERROR_CLASSES)})}static highlightDuplicateNames(e){this.clearDuplicateErrors(e);let t=new Map;e.forEach(n=>{let a=n.querySelector(".player-name");if(a){let s=a.value.trim().toLowerCase();s&&(t.has(s)||t.set(s,[]),t.get(s).push(a))}});let r=[],o=0;return t.forEach((n,a)=>{if(n.length>1){r.push(a);let s=this.DUPLICATE_ERROR_CLASSES[o];n.forEach(l=>{l.classList.add(s)}),o=(o+1)%this.DUPLICATE_ERROR_CLASSES.length}}),r}static hasSelectedCheckboxes(e){return Array.from(e).some(t=>t.checked)}static getSelectedCheckboxValues(e){return Array.from(e).filter(t=>t.checked).map(t=>t.value)}static addValidationError(e,t="error"){e.classList.add(t),e.dataset&&(e.dataset.validationTriggered="true")}static removeValidationError(e,t="error"){e.classList.remove(t)}static hasValidationError(e,t="error"){return e.classList.contains(t)}};S.DUPLICATE_ERROR_CLASSES=["name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5"];var H=class{static formatPowerButtonText(e){if(e.length===0)return"Select Power Levels";if(e.sort((n,a)=>n-a),e.length===1)return`Power: ${e[0]}`;let t=e[0],r=e[e.length-1];return e.every((n,a)=>{if(a===0)return!0;let s=n-e[a-1];return s===.5||s===1})&&e.length>2?`Power: ${t}-${r}`:e.length<=4?`Power: ${e.join(", ")}`:`Power: ${t}-${r} (${e.length} levels)`}static formatBracketButtonText(e){return e.length===0?"Select Brackets":e.length===1?`Bracket: ${e[0]==="cedh"?"cEDH":e[0]}`:e.length<=3?`Brackets: ${e.join(", ")}`:`Brackets: ${e.length} selected`}static updateButtonState(e,t,r){e.textContent=t,r?(e.classList.add("has-selection"),S.removeValidationError(e)):(e.classList.remove("has-selection"),e.dataset.validationTriggered==="true"&&S.addValidationError(e))}},B=class{static getElement(e,t,r){let o=e.querySelector(t);return o?r&&!r(o)?(console.warn(`Element ${t} found but failed type check`),null):o:null}static getAllElements(e,t,r){let o=Array.from(e.querySelectorAll(t));return r?o.filter(r):o}static setClasses(e,t,r=!0){r?e.classList.add(...t):e.classList.remove(...t)}static toggleClass(e,t,r){r?e.classList.add(t):e.classList.remove(t)}};var $=class{static updatePowerButton(e){let t=B.getElement(e,".power-selector-btn");if(!t)return;let r=e.querySelectorAll('.power-checkbox input[type="checkbox"]'),o=[];r.forEach(s=>{s.checked&&o.push(parseFloat(s.value))});let n=H.formatPowerButtonText(o),a=o.length>0;H.updateButtonState(t,n,a)}static updateBracketButton(e){let t=B.getElement(e,".bracket-selector-btn");if(!t)return;let r=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),o=S.getSelectedCheckboxValues(r),n=H.formatBracketButtonText(o),a=o.length>0;H.updateButtonState(t,n,a)}static updateAllButtonsForRow(e){this.updatePowerButton(e),this.updateBracketButton(e)}static updateAllButtons(e){B.getAllElements(e,".player-row").forEach(r=>this.updateAllButtonsForRow(r))}static createPowerButtonUpdater(e){return()=>this.updatePowerButton(e)}static createBracketButtonUpdater(e){return()=>this.updateBracketButton(e)}static createRowButtonUpdater(e){return()=>this.updateAllButtonsForRow(e)}static triggerValidationForRow(e){let r=document.getElementById("bracket-radio")?.checked??!1,o=B.getElement(e,".power-selector-btn"),n=B.getElement(e,".bracket-selector-btn");if(o&&(o.dataset.validationTriggered="true"),n&&(n.dataset.validationTriggered="true"),r&&n){let a=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]');S.hasSelectedCheckboxes(a)||S.addValidationError(n)}else if(o){let a=e.querySelectorAll('.power-checkbox input[type="checkbox"]');S.hasSelectedCheckboxes(a)||S.addValidationError(o)}}static triggerValidationForAllRows(e){B.getAllElements(e,".player-row").forEach(r=>this.triggerValidationForRow(r))}};var K=class{constructor(){this.cache=new Map;this.weakRefCache=new WeakMap}get(e,t=document){let r=this.getCacheKey(e,t);if(this.cache.has(r)){let n=this.cache.get(r);if(n&&n.isConnected)return n;this.cache.delete(r)}let o=t.querySelector(e);return o&&this.cache.set(r,o),o}getAll(e,t=document){let r=this.getCacheKey(e+":all",t);if(this.cache.has(r)){let n=this.cache.get(r);if(n&&n.length>0&&n[0].isConnected)return n;this.cache.delete(r)}let o=t.querySelectorAll(e);return this.cache.set(r,o),o}getFromRow(e,t){let r=this.weakRefCache.get(e);if(r||(r=new Map,this.weakRefCache.set(e,r)),r.has(t)){let n=r.get(t);if(n&&n.isConnected)return n;r.delete(t)}let o=e.querySelector(t);return o&&r.set(t,o),o}getAllFromRow(e,t){let r=this.weakRefCache.get(e);r||(r=new Map,this.weakRefCache.set(e,r));let o=t+":all";if(r.has(o)){let a=r.get(o);if(a&&a.length>0&&a[0].isConnected)return a;r.delete(o)}let n=e.querySelectorAll(t);return r.set(o,n),n}invalidate(e,t=document){if(e){let r=this.getCacheKey(e,t);this.cache.delete(r),this.cache.delete(r+":all")}else this.cache.clear()}clear(){this.cache.clear()}getCacheKey(e,t){return t===document?e:`${e}@${t.tagName}:${t.className}`}},C=new K;var V=class{constructor(){this.currentPods=[];this.currentUnassigned=[];this.lastResetData=null;this.isRestoring=!1;this.displayModeBtnBottom=null;this.reusablePlayerArray=[];this.reusableItemArray=[];this.containerClickHandler=null;this.containerChangeHandler=null;this.containerInputHandler=null;this.documentClickHandler=null;this.playerRowsContainer=document.getElementById("player-rows"),this.outputSection=document.getElementById("output-section"),this.displayModeBtn=document.getElementById("display-mode-btn"),this.playerRowTemplate=document.getElementById("player-row-template"),this.playerManager=new N,this.podGenerator=new F,this.dragDropManager=new z(this.playerManager,(e,t)=>this.renderPods(e,t)),this.displayModeManager=new O,this.initializeEventListeners(),this.initializeRankingModeToggle()}initializeEventListeners(){let e=document.getElementById("add-player-btn"),t=document.getElementById("bulk-add-btn"),r=document.getElementById("generate-pods-btn"),o=document.getElementById("reset-all-btn"),n=document.getElementById("help-btn");e.addEventListener("click",()=>this.addPlayerRow()),t.addEventListener("click",()=>this.bulkAddPlayers(4)),r.addEventListener("click",()=>this.generatePods()),o.addEventListener("click",()=>this.resetAllWithConfirmation()),this.displayModeBtn.addEventListener("click",()=>this.displayModeManager.enterDisplayMode(this.currentPods)),n.addEventListener("click",()=>this.showHelpModal()),this.setupEventDelegation(),this.initializeHelpModal(),this.initializeKeyboardShortcuts()}getCachedElements(e){return Array.from(this.playerRowsContainer.querySelectorAll(e))}clearDOMCache(){C.clear()}getPooledElement(e){return null}returnToPool(e,t){}getDropdownsOptimized(){return document.querySelectorAll(".bracket-selector-dropdown, .power-selector-dropdown")}getButtonsOptimized(){return document.querySelectorAll(".bracket-selector-btn, .power-selector-btn")}addEventListenerWithTracking(e,t,r){W.addEventListener(e,t,r)}removeAllEventListeners(e){W.removeAllFromElement(e)}setupEventDelegation(){this.containerClickHandler||(this.containerClickHandler=e=>this.handleContainerClick(e),this.playerRowsContainer.addEventListener("click",this.containerClickHandler)),this.containerChangeHandler||(this.containerChangeHandler=e=>this.handleContainerChange(e),this.playerRowsContainer.addEventListener("change",this.containerChangeHandler)),this.containerInputHandler||(this.containerInputHandler=e=>this.handleContainerInput(e),this.playerRowsContainer.addEventListener("input",this.containerInputHandler)),this.documentClickHandler||(this.documentClickHandler=e=>this.handleDocumentClick(e),document.addEventListener("click",this.documentClickHandler))}handleContainerClick(e){let t=e.target;if(t.classList.contains("power-selector-btn")){this.handlePowerSelectorClick(e,t);return}if(t.classList.contains("bracket-selector-btn")){this.handleBracketSelectorClick(e,t);return}if(t.classList.contains("range-btn")){this.handleRangeButtonClick(t);return}if(t.classList.contains("bracket-range-btn")){this.handleBracketRangeButtonClick(t);return}if(t.classList.contains("clear-btn")||t.classList.contains("bracket-clear-btn")){this.handleClearButtonClick(t);return}if(t.classList.contains("remove-player-btn")){this.handleRemoveButtonClick(t);return}}handleContainerChange(e){let t=e.target;if(t.classList.contains("group-select")){this.playerManager.handleGroupChange(this.playerRowsContainer);return}if(t.type==="checkbox"&&t.closest(".power-checkbox")){this.handlePowerCheckboxChange(t);return}if(t.type==="checkbox"&&t.closest(".bracket-checkbox")){this.handleBracketCheckboxChange(t);return}if(t.classList.contains("player-name")){this.handlePlayerNameChange(t);return}}handleContainerInput(e){let t=e.target;if(t.classList.contains("player-name")){this.handlePlayerNameChange(t);return}}handleDocumentClick(e){let t=e.target;!t.closest(".power-selector-btn")&&!t.closest(".power-selector-dropdown")&&!t.closest(".bracket-selector-btn")&&!t.closest(".bracket-selector-dropdown")&&this.closeAllDropdowns()}closeAllDropdowns(){this.getDropdownsOptimized().forEach(e=>{e.style.display="none",e.classList.remove("show")}),this.getButtonsOptimized().forEach(e=>{e.classList.remove("open")})}handlePowerSelectorClick(e,t){e.preventDefault();let r=t.closest(".player-row");if(!r)return;let o=C.getFromRow(r,".power-selector-dropdown");if(!o)return;let n=o.style.display!=="none";this.closeAllDropdowns(),n||(o.style.display="block",t.classList.add("open"),setTimeout(()=>o.classList.add("show"),10))}handleBracketSelectorClick(e,t){e.preventDefault();let r=t.closest(".player-row");if(!r)return;let o=C.getFromRow(r,".bracket-selector-dropdown");if(!o)return;let n=o.style.display!=="none";this.closeAllDropdowns(),n||(o.style.display="block",t.classList.add("open"),setTimeout(()=>o.classList.add("show"),10))}handleRangeButtonClick(e){let t=e.closest(".player-row");if(!t)return;let r=e.dataset.range,o=C.getAllFromRow(t,'.power-checkbox input[type="checkbox"]');o.forEach(s=>s.checked=!1);let[n,a]=r.split("-").map(Number);o.forEach(s=>{let l=parseFloat(s.value);(l===n||l===a)&&(s.checked=!0)}),this.updatePowerButtonText(t)}handleBracketRangeButtonClick(e){let t=e.closest(".player-row");if(!t)return;let r=e.dataset.range,o=C.getAllFromRow(t,'.bracket-checkbox input[type="checkbox"]');if(o.forEach(n=>n.checked=!1),r==="cedh"){let n=Array.from(o).find(a=>a.value==="cedh");n&&(n.checked=!0)}else{let[n,a]=r.split("-").map(s=>s==="cedh"?s:parseInt(s));o.forEach(s=>{let l=s.value==="cedh"?"cedh":parseInt(s.value);(l===n||l===a)&&(s.checked=!0)})}this.updateBracketButtonText(t)}handleClearButtonClick(e){let t=e.closest(".player-row");t&&(e.classList.contains("clear-btn")?(C.getAllFromRow(t,'.power-checkbox input[type="checkbox"]').forEach(o=>o.checked=!1),this.updatePowerButtonText(t)):e.classList.contains("bracket-clear-btn")&&(C.getAllFromRow(t,'.bracket-checkbox input[type="checkbox"]').forEach(o=>o.checked=!1),this.updateBracketButtonText(t)))}handleRemoveButtonClick(e){let t=e.closest(".player-row");t&&(this.removeAllEventListeners(t),this.playerRowsContainer.removeChild(t),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.updatePlayerNumbers(),this.clearDOMCache())}handlePowerCheckboxChange(e){let t=e.closest(".player-row");t&&this.updatePowerButtonText(t)}handleBracketCheckboxChange(e){let t=e.closest(".player-row");t&&this.updateBracketButtonText(t)}handlePlayerNameChange(e){e.value.trim()?e.classList.remove("input-error"):e.classList.add("input-error"),this.clearDuplicateErrorsOnInput()}updatePowerButtonText(e){$.updatePowerButton(e)}updateBracketButtonText(e){$.updateBracketButton(e)}getPlayerRowsOptimized(){let e=C.getAll(".player-row",this.playerRowsContainer),t=[];for(let r=0;r<e.length;r++)t.push(e[r]);return t}clearReusableArrays(){this.reusablePlayerArray.length=0,this.reusableItemArray.length=0}addPlayerRow(){let t=this.playerRowTemplate.content.cloneNode(!0).querySelector(".player-row"),r=this.playerManager.getNextPlayerId();t.dataset.playerId=r.toString(),this.updatePowerButtonText(t),this.updateBracketButtonText(t),this.playerRowsContainer.appendChild(t),this.clearDOMCache(),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.clearDOMCache(),this.updatePlayerNumbers();let n=document.getElementById("bracket-radio").checked,a=C.getFromRow(t,".power-levels"),s=C.getFromRow(t,".bracket-levels");n&&a&&s?(a.style.display="none",s.style.display="block"):a&&s&&(a.style.display="block",s.style.display="none")}bulkAddPlayers(e){for(let t=0;t<e;t++)this.addPlayerRow()}initializeKeyboardShortcuts(){document.addEventListener("keydown",e=>{if(e.ctrlKey&&e.key==="Enter"){e.preventDefault(),this.addPlayerRow();let r=C.getAll(".player-row",this.playerRowsContainer),o=r[r.length-1],n=C.getFromRow(o,".player-name");n&&n.focus();return}let t=document.activeElement;if(t&&t.classList.contains("bracket-selector-btn")){let r=null;e.key==="1"?r="1":e.key==="2"?r="2":e.key==="3"?r="3":e.key==="4"?r="4":(e.key==="5"||e.key==="c"||e.key==="C")&&(r="cedh"),r&&(e.preventDefault(),this.selectBracketByKeyboard(t,r))}})}selectBracketByKeyboard(e,t){let r=e.closest(".player-row");if(!r)return;C.getAllFromRow(r,'.bracket-checkbox input[type="checkbox"]').forEach(a=>a.checked=!1);let n=C.getFromRow(r,`.bracket-checkbox input[value="${t}"]`);n&&(n.checked=!0,n.dispatchEvent(new Event("change",{bubbles:!0})))}cleanupBottomDisplayButton(){if(this.displayModeBtnBottom){let e=this.displayModeBtnBottom.parentNode;e&&e.parentNode&&e.parentNode.removeChild(e),this.displayModeBtnBottom=null}}generatePods(){this.triggerValidationForAllFields(),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.playerManager.handleGroupChange(this.playerRowsContainer),this.clearReusableArrays();let e=this.getPlayerRowsOptimized(),t=!1;for(let d=0;d<e.length;d++)e[d].querySelector(".player-name").classList.remove("name-duplicate-error","name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5");for(let d=0;d<e.length;d++){let E=this.playerManager.getPlayerFromRow(e[d]);E?this.reusablePlayerArray.push(E):t=!0}let r=new Map;e.forEach(d=>{let m=d.querySelector(".player-name").value.trim().toLowerCase();m&&(r.has(m)||r.set(m,[]),r.get(m).push(d))});let o=[],n=1;if(r.forEach((d,E)=>{if(d.length>1){o.push(E);let m=`name-duplicate-error-${n}`;d.forEach(y=>{y.querySelector(".player-name").classList.add(m)}),n=n%5+1,t=!0}}),t){let d="Please fix the errors before generating pods.";o.length>0&&(d+=`

Duplicate player names found: ${o.join(", ")}`),alert(d);return}let a=new Map;this.playerManager.getGroups().forEach((d,E)=>{let m=d.reduce((L,T)=>L+T.power,0),y=Math.round(m/d.length*2)/2;a.set(E,{id:E,players:d,averagePower:y,size:d.length})});let s=new Set([...this.playerManager.getGroups().values()].flat().map(d=>d.id)),l=this.reusablePlayerArray.filter(d=>!s.has(d.id));this.reusableItemArray.length=0,this.reusableItemArray.push(...l),a.forEach(d=>{this.reusableItemArray.push({id:d.id,players:d.players,averagePower:d.averagePower,size:d.size})});let i=this.reusablePlayerArray.length;if(i<3){alert("You need at least 3 players to form a pod.");return}let h=Y()==="avoid-five"?_(i):G(i),c=Z();if(typeof window<"u"&&(window.location.protocol==="file:"||window.__playwright!==void 0||window.playwright!==void 0)){let d=this.reusablePlayerArray.map(m=>m.name).join(""),E=Array.from(d).reduce((m,y)=>m+y.charCodeAt(0),0);this.podGenerator.setShuffleSeed(E)}else this.podGenerator.setShuffleSeed(null);let f=this.podGenerator.generatePodsWithBacktracking(this.reusableItemArray,h,c),k=f.pods,g=f.unassigned;this.currentPods=[...k],this.currentUnassigned=[...g],this.renderPods(k,g)}renderPods(e,t=[]){if(this.currentPods=[...e],this.currentUnassigned=[...t],this.dragDropManager.setCurrentPods(this.currentPods,this.currentUnassigned),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",e.length===0){this.outputSection.textContent="Could not form pods with the given players.",this.displayModeBtn.style.display="none";return}this.displayModeBtn.style.display="inline-block";let r=Math.ceil(Math.sqrt(e.length)),o=document.createDocumentFragment(),n=this.getPooledElement("pods-container")||document.createElement("div");if(n.classList.add("pods-container"),n.style.gridTemplateColumns=`repeat(${r}, 1fr)`,n.style.gridTemplateRows=`repeat(${r}, 1fr)`,e.forEach((s,l)=>{let i=this.getPooledElement("pod")||document.createElement("div");i.classList.add("pod",`pod-color-${l%10}`),i.dataset.podIndex=l.toString(),i.addEventListener("dragover",this.dragDropManager.handleDragOver),i.addEventListener("drop",this.dragDropManager.handleDrop),i.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let u=this.getPooledElement("h3")||document.createElement("h3"),h=document.getElementById("bracket-radio");if(h&&h.checked){let f=this.calculateValidBracketRange(s);u.textContent=`Pod ${l+1} (Bracket: ${f})`}else{let f=q(s);u.textContent=`Pod ${l+1} (Power: ${f})`}i.appendChild(u);let b=this.getPooledElement("ul")||document.createElement("ul");s.players.forEach((f,k)=>{if("players"in f){let g=this.getPooledElement("li")||document.createElement("li");g.classList.add("pod-group"),g.draggable=!0,g.dataset.itemType="group",g.dataset.itemId=f.id,g.dataset.podIndex=l.toString(),g.dataset.itemIndex=k.toString(),g.addEventListener("dragstart",this.dragDropManager.handleDragStart),g.addEventListener("dragend",this.dragDropManager.handleDragEnd);let d=document.getElementById("bracket-radio"),E=d&&d.checked,m=document.createElement("strong");E?m.textContent=`Group ${f.id.split("-")[1]}:`:m.textContent=`Group ${f.id.split("-")[1]} (Avg Power: ${f.averagePower}):`,g.appendChild(m);let y=this.getPooledElement("ul")||document.createElement("ul");f.players.forEach(L=>{let T=this.getPooledElement("li")||document.createElement("li");if(E&&L.bracketRange)T.textContent=`${L.name} (B: ${L.bracketRange})`;else{let v=D(s),M=A(L,v);T.innerHTML=`${L.name} (P: ${M})`}y.appendChild(T)}),g.appendChild(y),b.appendChild(g)}else{let g=this.getPooledElement("li")||document.createElement("li");g.classList.add("pod-player"),g.draggable=!0,g.dataset.itemType="player",g.dataset.itemId=f.id.toString(),g.dataset.podIndex=l.toString(),g.dataset.itemIndex=k.toString(),g.addEventListener("dragstart",this.dragDropManager.handleDragStart),g.addEventListener("dragend",this.dragDropManager.handleDragEnd);let d=document.getElementById("bracket-radio");if(d&&d.checked&&f.bracketRange)g.textContent=`${f.name} (B: ${f.bracketRange})`;else{let m=D(s),y=A(f,m);g.innerHTML=`${f.name} (P: ${y})`}b.appendChild(g)}}),i.appendChild(b),n.appendChild(i)}),e.length>0){let s=document.createElement("div");s.classList.add("pod","new-pod","new-pod-target"),s.style.borderColor="#4CAF50",s.style.backgroundColor="#1f2a1f",s.style.borderStyle="dashed",s.dataset.podIndex="new-pod",s.addEventListener("dragover",this.dragDropManager.handleDragOver),s.addEventListener("drop",this.dragDropManager.handleDrop),s.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let l=document.createElement("h3");l.textContent="Create New Pod",l.style.color="#4CAF50",s.appendChild(l);let i=document.createElement("p");i.textContent="Drag players or groups here to create a new pod",i.style.color="#999",i.style.fontStyle="italic",i.style.textAlign="center",i.style.margin="20px 0",s.appendChild(i),n.appendChild(s)}if(t.length>0){let s=document.createElement("div");s.classList.add("pod","unassigned-pod"),s.style.borderColor="#ff6b6b",s.style.backgroundColor="#2a1f1f",s.dataset.podIndex="unassigned",s.addEventListener("dragover",this.dragDropManager.handleDragOver),s.addEventListener("drop",this.dragDropManager.handleDrop),s.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let l=document.createElement("h3");l.textContent="Unassigned Players",l.style.color="#ff6b6b",s.appendChild(l);let i=document.createElement("ul");t.forEach((u,h)=>{if("players"in u){let c=document.createElement("li");c.classList.add("pod-group"),c.draggable=!0,c.dataset.itemType="group",c.dataset.itemId=u.id,c.dataset.podIndex="unassigned",c.dataset.itemIndex=h.toString(),c.addEventListener("dragstart",this.dragDropManager.handleDragStart),c.addEventListener("dragend",this.dragDropManager.handleDragEnd);let b=document.getElementById("bracket-radio"),f=b&&b.checked;f?c.innerHTML=`<strong>Group ${u.id.split("-")[1]}:</strong>`:c.innerHTML=`<strong>Group ${u.id.split("-")[1]} (Avg Power: ${u.averagePower}):</strong>`;let k=document.createElement("ul");u.players.forEach(g=>{let d=document.createElement("li");f&&g.bracketRange?d.textContent=`${g.name} (B: ${g.bracketRange})`:d.textContent=`${g.name} (P: ${g.powerRange})`,k.appendChild(d)}),c.appendChild(k),i.appendChild(c)}else{let c=document.createElement("li");c.classList.add("pod-player"),c.draggable=!0,c.dataset.itemType="player",c.dataset.itemId=u.id.toString(),c.dataset.podIndex="unassigned",c.dataset.itemIndex=h.toString(),c.addEventListener("dragstart",this.dragDropManager.handleDragStart),c.addEventListener("dragend",this.dragDropManager.handleDragEnd);let b=document.getElementById("bracket-radio");b&&b.checked&&u.bracketRange?c.textContent=`${u.name} (B: ${u.bracketRange})`:c.textContent=`${u.name} (P: ${u.powerRange})`,i.appendChild(c)}}),s.appendChild(i),n.appendChild(s)}o.appendChild(n),this.outputSection.appendChild(o);let a=document.querySelector(".help-section");if(a&&a.parentNode){let s=document.createElement("div");s.style.textAlign="center",s.style.marginTop="20px",s.style.marginBottom="20px",this.displayModeBtnBottom=this.displayModeBtn.cloneNode(!0),this.displayModeBtnBottom.id="display-mode-btn-bottom",this.displayModeBtnBottom.style.display="inline-block",this.displayModeBtnBottom.addEventListener("click",()=>this.displayModeManager.enterDisplayMode(this.currentPods)),s.appendChild(this.displayModeBtnBottom),a.parentNode.insertBefore(s,a)}}captureCurrentPlayerData(){let e=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),t=[];e.forEach(o=>{let n=o.querySelector(".player-name"),a=o.querySelector(".group-select"),s=o.querySelectorAll('.power-checkbox input[type="checkbox"]'),l=[];s.forEach(h=>{h.checked&&l.push(h.value)});let i=o.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),u=[];i.forEach(h=>{h.checked&&u.push(h.value)}),t.push({name:n.value.trim(),groupValue:a.value,createdGroupId:a.dataset.createdGroupId,selectedPowers:l,selectedBrackets:u})});let r={noLeniency:document.getElementById("no-leniency-radio")?.checked||!1,leniency:document.getElementById("leniency-radio")?.checked||!1,superLeniency:document.getElementById("super-leniency-radio")?.checked||!1,bracket:document.getElementById("bracket-radio")?.checked||!1};return{players:t,leniencySettings:r,currentPods:[...this.currentPods],currentUnassigned:[...this.currentUnassigned]}}resetAllWithConfirmation(){if(!Array.from(this.playerRowsContainer.querySelectorAll(".player-row")).some(o=>{if(o.querySelector(".player-name").value.trim())return!0;let a=o.querySelectorAll('input[type="checkbox"]');return Array.from(a).some(s=>s.checked)})){this.resetAll();return}confirm(`Are you sure you want to reset all player data?

This will clear all players, groups, and generated pods. You will be able to undo this action immediately after.`)&&(this.lastResetData=this.captureCurrentPlayerData(),this.resetAll(),this.showUndoResetButton())}showUndoResetButton(){let e=document.getElementById("undo-reset-btn");e&&e.remove();let t=document.createElement("button");t.id="undo-reset-btn",t.textContent="Undo Reset",t.style.marginLeft="10px",t.style.backgroundColor="#28a745",t.style.color="white",t.style.border="none",t.style.padding="8px 16px",t.style.borderRadius="4px",t.style.cursor="pointer",t.style.fontSize="14px",t.addEventListener("click",()=>this.undoReset());let r=document.getElementById("reset-all-btn");r.parentNode.insertBefore(t,r.nextSibling),setTimeout(()=>{document.getElementById("undo-reset-btn")&&(t.remove(),this.lastResetData=null)},3e4)}undoReset(){if(!this.lastResetData){alert("No reset data available to restore.");return}this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds();let e=this.lastResetData.leniencySettings;e.noLeniency&&(document.getElementById("no-leniency-radio").checked=!0),e.leniency&&(document.getElementById("leniency-radio").checked=!0),e.superLeniency&&(document.getElementById("super-leniency-radio").checked=!0),e.bracket&&(document.getElementById("bracket-radio").checked=!0),this.lastResetData.players.forEach(o=>{this.addPlayerRow();let n=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),a=n[n.length-1],s=a.querySelector(".player-name");s.value=o.name;let l=a.querySelector(".group-select");o.createdGroupId&&(l.dataset.createdGroupId=o.createdGroupId),l.value=o.groupValue}),this.isRestoring=!0;let t=document.getElementById("no-leniency-radio"),r=document.getElementById("bracket-radio");if(t&&r){let o=new Event("change",{bubbles:!0});e.bracket?r.dispatchEvent(o):t.dispatchEvent(o)}setTimeout(()=>{this.restorePlayerSelections()},200)}restorePlayerSelections(){if(!this.lastResetData)return;this.lastResetData.players.forEach((t,r)=>{let n=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[r];if(!n)return;t.selectedPowers.forEach(l=>{let i=n.querySelector(`.power-checkbox input[type="checkbox"][value="${l}"]`);i&&(i.checked=!0)}),t.selectedBrackets.forEach(l=>{let i=n.querySelector(`.bracket-checkbox input[type="checkbox"][value="${l}"]`);i&&(i.checked=!0)}),n.querySelectorAll('input[type="checkbox"]').forEach(l=>{l.checked&&l.dispatchEvent(new Event("change",{bubbles:!0}))}),this.updateButtonTextsForRow(n);let s=n.querySelector(".group-select");t.groupValue&&t.groupValue!=="no-group"&&t.groupValue.startsWith("group-")&&(t.createdGroupId?s.dataset.createdGroupId=t.createdGroupId:s.dataset.createdGroupId=t.groupValue,s.value="new-group",s.dispatchEvent(new Event("change",{bubbles:!0})))}),this.lastResetData.players.forEach((t,r)=>{let a=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[r].querySelector(".group-select");t.groupValue&&t.groupValue!=="no-group"&&t.groupValue.startsWith("group-")&&(a.value=t.groupValue,a.dispatchEvent(new Event("change",{bubbles:!0})))}),this.currentPods=[...this.lastResetData.currentPods],this.currentUnassigned=[...this.lastResetData.currentUnassigned],(this.currentPods.length>0||this.currentUnassigned.length>0)&&this.renderPods(this.currentPods,this.currentUnassigned),this.playerManager.handleGroupChange(this.playerRowsContainer),this.isRestoring=!1;let e=document.getElementById("undo-reset-btn");e&&e.remove(),this.lastResetData=null,alert("Reset has been undone successfully!")}resetAll(){this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.displayModeBtn.style.display="none",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds(),this.currentPods=[],this.currentUnassigned=[];let e=document.getElementById("no-leniency-radio");e.checked=!0;for(let t=0;t<4;t++)this.addPlayerRow()}clearDuplicateErrorsOnInput(){let e=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),t=new Map;e.forEach(o=>{let n=o.querySelector(".player-name"),a=n.value.trim().toLowerCase();a&&(t.has(a)||t.set(a,[]),t.get(a).push(n))}),e.forEach(o=>{o.querySelector(".player-name").classList.remove("name-duplicate-error","name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5")});let r=1;t.forEach((o,n)=>{if(o.length>1){let a=`name-duplicate-error-${r}`;o.forEach(s=>{s.classList.add(a)}),r=r%5+1}})}initializeRankingModeToggle(){let e=document.getElementById("power-level-radio"),t=document.getElementById("bracket-radio"),r=()=>{let o=t.checked;if(o){document.body.classList.add("bracket-mode");let a=document.getElementById("no-leniency-radio");a&&(a.checked=!0)}else document.body.classList.remove("bracket-mode");this.playerRowsContainer.querySelectorAll(".player-row").forEach(a=>{let s=a.querySelector(".power-levels"),l=a.querySelector(".bracket-levels");o?(s.style.display="none",l.style.display="block"):(s.style.display="block",l.style.display="none"),this.isRestoring||this.clearAllSelections(a)})};e.addEventListener("change",r),t.addEventListener("change",r),r()}clearAllSelections(e){e.querySelectorAll('.power-checkbox input[type="checkbox"]').forEach(a=>a.checked=!1),e.querySelectorAll('.bracket-checkbox input[type="checkbox"]').forEach(a=>a.checked=!1);let o=e.querySelector(".power-selector-btn"),n=e.querySelector(".bracket-selector-btn");o&&(o.textContent="Select Power Levels",o.classList.remove("has-selection")),n&&(n.textContent="Select Brackets",n.classList.remove("has-selection"))}initializeHelpModal(){let e=document.getElementById("help-modal");e.querySelector(".help-close").addEventListener("click",()=>this.hideHelpModal()),e.addEventListener("click",r=>{r.target===e&&this.hideHelpModal()}),document.addEventListener("keydown",r=>{r.key==="Escape"&&e.style.display==="block"&&this.hideHelpModal()})}showHelpModal(){let e=document.getElementById("help-modal");e.style.display="block",document.body.style.overflow="hidden"}hideHelpModal(){let e=document.getElementById("help-modal");e.style.display="none",document.body.style.overflow=""}calculateValidBracketRange(e){let t=e.players.flatMap(a=>"players"in a?a.players:[a]);if(t.length===0)return"Unknown";let r=[],o=new Set;t.forEach(a=>{a.brackets&&a.brackets.forEach(s=>o.add(s))});for(let a of o)t.every(l=>l.brackets&&l.brackets.includes(a))&&r.push(a);let n=["1","2","3","4","cedh"];if(r.sort((a,s)=>n.indexOf(a)-n.indexOf(s)),r.length===0)return"Unknown";if(r.length===1)return r[0];{let a=r.filter(l=>l!=="cedh");return a.length>1&&a.every((l,i)=>{if(i===0)return!0;let u=parseInt(l),h=parseInt(a[i-1]);return u===h+1})&&a.length===r.length&&r.length>1?`${r[0]}-${r[r.length-1]}`:r.join(", ")}}triggerValidationForAllFields(){let e=this.getPlayerRowsOptimized();for(let t=0;t<e.length;t++){let r=e[t],o=r.querySelector(".player-name");o.value.trim()||o.classList.add("input-error");let a=r.querySelector(".power-selector-btn"),s=r.querySelector(".bracket-selector-btn");if(a&&(a.dataset.validationTriggered="true"),s&&(s.dataset.validationTriggered="true"),document.getElementById("bracket-radio").checked){let u=r.querySelectorAll('.bracket-checkbox input[type="checkbox"]');Array.from(u).some(c=>c.checked)||s.classList.add("error")}else{let u=r.querySelectorAll('.power-checkbox input[type="checkbox"]');Array.from(u).some(c=>c.checked)||a.classList.add("error")}}}updateButtonTextsForRow(e){let t=e.querySelectorAll('.power-checkbox input[type="checkbox"]'),r=e.querySelector(".power-selector-btn");if(r){let a=[];if(t.forEach(s=>{s.checked&&a.push(parseFloat(s.value))}),a.length===0)r.textContent="Select Power Levels",r.classList.remove("has-selection");else{a.sort((l,i)=>l-i);let s;if(a.length===1)s=`Power: ${a[0]}`;else{let l=a[0],i=a[a.length-1];a.every((h,c)=>{if(c===0)return!0;let b=h-a[c-1];return b===.5||b===1})&&a.length>2?s=`Power: ${l}-${i}`:a.length<=4?s=`Power: ${a.join(", ")}`:s=`Power: ${l}-${i} (${a.length} levels)`}r.textContent=s,r.classList.add("has-selection")}}let o=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),n=e.querySelector(".bracket-selector-btn");if(n){let a=[];if(o.forEach(s=>{s.checked&&a.push(s.value)}),a.length===0)n.textContent="Select Brackets",n.classList.remove("has-selection");else{let s;a.length===1?s=`Bracket: ${a[0]}`:s=`Brackets: ${a.join(", ")}`,n.textContent=s,n.classList.add("has-selection")}}}updatePlayerNumbers(){this.playerRowsContainer.querySelectorAll(".player-row").forEach((t,r)=>{let o=t.querySelector(".player-number");o&&(o.textContent=(r+1).toString())})}};function ee(){let t=Math.floor(Math.random()*360),r=25,o=[];for(let s=0;s<50;s++){let i=(t+s*137.5)%360;o.push(Math.round(i))}let n="";for(let s=1;s<=50;s++){let l=o[s-1],i=70+Math.floor(Math.random()*20),u=50,h=28+Math.floor(Math.random()*8);n+=`
.player-row .group-select.group-${s} {
    border-color: hsl(${l}, ${i}%, ${u}%) !important;
    background-color: hsl(${l}, ${i}%, ${h}%) !important;
}`,n+=`
.group-select option[value="group-${s}"] {
    background-color: hsl(${l}, ${i}%, ${h}%);
}`}let a=document.createElement("style");a.id="dynamic-group-colors",a.textContent=n,document.head.appendChild(a)}document.addEventListener("DOMContentLoaded",()=>{ee(),new V().resetAll()});})();
