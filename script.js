"use strict";(()=>{function R(h){if(h<3)return[];if(h===3)return[3];if(h===4)return[4];if(h===5)return[5];if(h===6)return[3,3];if(h===7)return[4,3];if(h===8)return[4,4];if(h===9)return[3,3,3];if(h===10)return[5,5];let t=Math.floor(h/4),e=h%4;return e===0?Array(t).fill(4):e===1?t>=2?[...Array(t-2).fill(4),5,4]:[3,3,3,2]:e===2?t>=1?[...Array(t-1).fill(4),3,3]:[3,3,3,3]:e===3?[...Array(t).fill(4),3]:[]}function F(h){if(h<3)return[];if(h<9)return R(h);if(h===9)return[3,3,3];if(h===10)return[4,3,3];if(h===11)return[4,4,3];if(h===12)return[4,4,4];if(h===13)return[4,3,3,3];if(h===14)return[4,4,3,3];if(h===15)return[4,4,4,3];let t=[],e=h;for(;e>=7;)t.push(4),e-=4;if(e===6)t.push(3,3);else if(e===5)if(t.length>0)t.pop(),e+=4,t.push(3,3,3);else return R(h);else e===4?t.push(4):e===3&&t.push(3);return t.sort((r,a)=>a-r)}function V(){let h=document.getElementById("avoid-five-pods-radio");return h&&h.checked?"avoid-five":"balanced"}function U(){let h=document.getElementById("bracket-radio");if(h&&h.checked)return{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0};let t=document.getElementById("no-leniency-radio"),e=document.getElementById("leniency-radio");return document.getElementById("super-leniency-radio").checked?{allowLeniency:!0,allowSuperLeniency:!0,maxTolerance:1}:e.checked?{allowLeniency:!0,allowSuperLeniency:!1,maxTolerance:.5}:{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0}}function W(h){let t=[];if(h.forEach(a=>{if(a.checked){let n=parseFloat(a.value);isNaN(n)||t.push(n)}}),t.length===0)return{availablePowers:[],powerRange:"",averagePower:0};t.sort((a,n)=>a-n);let e;t.length===1?e=t[0].toString():e=t.join(", ");let r=t.reduce((a,n)=>a+n,0)/t.length;return{availablePowers:t,powerRange:e,averagePower:Math.round(r*2)/2}}function K(){let h=document.querySelector("#leniency-radio");return document.querySelector("#super-leniency-radio")?.checked?1:h?.checked?.5:0}function H(h){let t=h.players.flatMap(n=>"players"in n?n.players:[n]);if(t.length===0)return h.power.toString();let e=K(),r=[],a=new Set;t.forEach(n=>{n.availablePowers.forEach(o=>a.add(o))});for(let n of a)t.every(s=>s.availablePowers.some(i=>Math.abs(n-i)<=e))&&r.push(n);return r.sort((n,o)=>n-o),r.length===0?h.power.toString():r.length===1?r[0].toString():r.every((o,s)=>s===0||o-r[s-1]<=.5)&&r.length>2?`${r[0]}-${r[r.length-1]}`:r.join(", ")}function x(h,t){let e=[];if(Array.isArray(h.availablePowers))e=h.availablePowers;else if(typeof h.powerRange=="string")if(h.powerRange.includes("-")){let[a,n]=h.powerRange.split("-").map(o=>parseFloat(o.trim()));for(let o=a;o<=n;o+=.5)e.push(o)}else e=h.powerRange.split(",").map(a=>parseFloat(a.trim()));return e.map(a=>t.includes(a)?`<span class="power-highlight">${a}</span>`:a.toString()).join(", ")}function j(h,t){let e=[];if(Array.isArray(h.availableBrackets))e=h.availableBrackets;else if(typeof h.bracketRange=="string")if(h.bracketRange.includes("-")){let[a,n]=h.bracketRange.split("-").map(i=>i.trim()),o=parseInt(a),s=parseInt(n);if(!isNaN(o)&&!isNaN(s))for(let i=o;i<=s;i++)e.push(i.toString());else e=[a,n]}else e=h.bracketRange.split(",").map(a=>a.trim());return e.map(a=>t.includes(a)?`<span class="bracket-highlight">${a}</span>`:a.toString()).join(", ")}function T(h){let t=h.players.flatMap(o=>"players"in o?o.players:[o]);if(t.length===0)return[];let e=new Map,r=new Set;if(t.forEach(o=>{o.availablePowers.length===1&&r.add(o.availablePowers[0]),o.availablePowers.forEach(s=>{e.set(s,(e.get(s)||0)+1)})}),e.size===0)return[];let a=Math.max(...e.values()),n=[];for(let[o,s]of e.entries())(s===a||r.has(o))&&n.push(o);return n.sort((o,s)=>o-s),n}var A=class{constructor(){this.groups=new Map;this.nextPlayerId=0;this.nextGroupId=1;this.availableColors=[];this.groupColorAssignments=new Map;this.initializeAvailableColors()}initializeAvailableColors(){this.availableColors=Array.from({length:50},(t,e)=>e+1),this.shuffleArray(this.availableColors)}shuffleArray(t){for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}}assignRandomColor(t){if(this.groupColorAssignments.has(t))return this.groupColorAssignments.get(t);this.availableColors.length===0&&this.initializeAvailableColors();let e=this.availableColors.pop();return this.groupColorAssignments.set(t,e),e}releaseColor(t){let e=this.groupColorAssignments.get(t);e&&(this.availableColors.push(e),this.groupColorAssignments.delete(t))}getNextPlayerId(){return this.nextPlayerId++}resetPlayerIds(){this.nextPlayerId=0}getNextGroupId(){let t=new Set;document.querySelectorAll(".group-select").forEach(r=>{if(r.value.startsWith("group-")){let a=parseInt(r.value.split("-")[1]);isNaN(a)||t.add(a)}if(r.value==="new-group"&&r.dataset.createdGroupId&&r.dataset.createdGroupId.startsWith("group-")){let a=parseInt(r.dataset.createdGroupId.split("-")[1]);isNaN(a)||t.add(a)}});for(let r=1;r<=50;r++)if(!t.has(r))return r;return this.nextGroupId++}resetGroupIds(){this.nextGroupId=1}getGroups(){return this.groups}clearGroups(){this.groups.clear()}getPlayerFromRow(t){let e=t.querySelector(".player-name");e.classList.remove("input-error");let r=e.value.trim();if(!r)return e.classList.add("input-error"),null;if(document.getElementById("bracket-radio").checked){let o=t.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),s=[];if(o.forEach(p=>{p.checked&&s.push(p.value)}),s.length===0)return t.querySelector(".bracket-selector-btn").classList.add("error"),null;t.querySelector(".bracket-selector-btn").classList.remove("error");let i={1:1,2:2,3:3,4:4,cedh:10},l=s.map(p=>i[p]),c=l.reduce((p,d)=>p+d,0)/l.length;return{id:parseInt(t.dataset.playerId),name:r,power:Math.round(c*2)/2,availablePowers:l,powerRange:s.join(", "),brackets:s,bracketRange:s.join(", "),rowElement:t}}else{let o=t.querySelectorAll('.power-checkbox input[type="checkbox"]'),s=W(o);return s.availablePowers.length===0?(t.querySelector(".power-selector-btn").classList.add("error"),null):(t.querySelector(".power-selector-btn").classList.remove("error"),{id:parseInt(t.dataset.playerId),name:r,power:s.averagePower,availablePowers:s.availablePowers,powerRange:s.powerRange,rowElement:t})}}handleGroupChange(t){this.groups.clear();let e=Array.from(t.querySelectorAll(".player-row"));e.forEach(a=>{for(let n=1;n<=50;n++)a.querySelector(".group-select").classList.remove(`group-${n}`)});let r=new Set;e.forEach(a=>{let n=a.querySelector(".group-select");n.dataset.createdGroupId?r.add(n.dataset.createdGroupId):n.value.startsWith("group-")&&r.add(n.value)}),e.forEach(a=>{let n=a.querySelector(".group-select"),o="";if(n.value==="new-group"){n.dataset.createdGroupId?o=n.dataset.createdGroupId:(o=`group-${this.getNextGroupId()}`,r.add(o),n.dataset.createdGroupId=o);let s=this.getPlayerFromRow(a);s&&(this.groups.has(o)||this.groups.set(o,[]),this.groups.get(o).push(s))}else if(n.value.startsWith("group-")){o=n.value;let s=this.getPlayerFromRow(a);s&&(this.groups.has(n.value)||this.groups.set(n.value,[]),this.groups.get(n.value).push(s))}else n.dataset.createdGroupId&&delete n.dataset.createdGroupId;if(o){let s=parseInt(o.split("-")[1]);s>=1&&s<=50&&n.classList.add(`group-${s}`)}}),this.cleanupUnusedGroups(r),this.updateAllGroupDropdowns(t)}updateAllGroupDropdowns(t){let e=new Set,r=Array.from(t.querySelectorAll(".player-row"));r.forEach(a=>{let n=a.querySelector(".group-select");n.value==="new-group"&&n.dataset.createdGroupId?e.add(n.dataset.createdGroupId):n.value.startsWith("group-")&&e.add(n.value)}),r.forEach(a=>{let n=a.querySelector(".group-select"),o=n.value,s=n.dataset.createdGroupId;if(Array.from(n.options).forEach(l=>{l.value.startsWith("group-")&&n.remove(l.index)}),e.forEach(l=>{let c=l.split("-")[1],p=new Option(`Group ${c}`,l);n.add(p)}),s&&e.has(s)&&(o==="new-group"||o==="no-group")){n.value=s;let l=parseInt(s.split("-")[1]);l>=1&&l<=50&&n.classList.add(`group-${l}`)}else if(o.startsWith("group-")&&e.has(o)){n.value=o;let l=parseInt(o.split("-")[1]);l>=1&&l<=50&&n.classList.add(`group-${l}`)}else{n.value="no-group";for(let l=1;l<=50;l++)n.classList.remove(`group-${l}`)}})}arePlayersCompatible(t,e,r){return t.availablePowers.some(n=>e.availablePowers.some(o=>Math.abs(n-o)<.01))?!0:r.allowLeniency?t.availablePowers.some(n=>e.availablePowers.some(o=>Math.abs(n-o)<=r.maxTolerance)):!1}findAllCommonPowers(t,e){return t.length===0?[]:[...new Set(t.flatMap(a=>a.availablePowers))].sort((a,n)=>a-n).filter(a=>t.every(n=>n.availablePowers.some(o=>{let s=Math.abs(o-a);return s<.01||e.allowLeniency&&s<=e.maxTolerance})))}findBestCommonPowerLevel(t){if(t.length===0)return null;let e=new Map;for(let n of t)for(let o of n.availablePowers)e.set(o,(e.get(o)||0)+1);if(e.size===0)return null;let r=t[0].availablePowers[0],a=0;for(let[n,o]of e.entries())o>a&&(a=o,r=n);return r}calculatePodPower(t){if(t.length===0)return 0;let e=t.reduce((r,a)=>{if("players"in a)return r+a.averagePower;{let n=a.powerRange.split(",").map(s=>parseFloat(s.trim())),o=n.reduce((s,i)=>s+i,0)/n.length;return r+o}},0);return Math.round(e/t.length*10)/10}cleanupUnusedGroups(t){Array.from(this.groupColorAssignments.keys()).forEach(n=>{t.has(n)||this.releaseColor(n)}),Array.from(this.groups.keys()).forEach(n=>{t.has(n)||this.groups.delete(n)}),document.querySelectorAll(".group-select").forEach(n=>{let o=n.dataset.createdGroupId;o&&!t.has(o)&&delete n.dataset.createdGroupId})}};var D=class{constructor(){this.shuffleSeed=null;this.sizeCache=new Map}setShuffleSeed(t){this.shuffleSeed=t,this.sizeCache.clear()}seededRandom(t){let e=t;return()=>(e=e*1103515245+12345&2147483647,e/2147483647)}shuffleArray(t){let e=[...t],r;this.shuffleSeed!==null?r=this.seededRandom(this.shuffleSeed):r=Math.random;for(let a=e.length-1;a>0;a--){let n=Math.floor(r()*(a+1));[e[a],e[n]]=[e[n],e[a]]}return e}getItemSize(t){let e="players"in t?`group-${t.id}`:`player-${t.id}`;if(!this.sizeCache.has(e)){let r="players"in t?t.size:1;this.sizeCache.set(e,r)}return this.sizeCache.get(e)}getItemId(t){return"players"in t?t.id:t.id.toString()}generatePodsWithBacktracking(t,e,r){let a=this.shuffleArray(t),n=a.reduce((l,c)=>l+("size"in c?c.size:1),0);if(n>=3&&n<=5){let l=a.flatMap(p=>"players"in p?p.players:[p]),c=this.findBestCommonPowerLevel(l);return c!==null?{pods:[{players:a,power:c}],unassigned:[]}:{pods:[],unassigned:a}}let o=this.findOptimalPodAssignment(a,e,r),s=new Set;for(let l of o)for(let c of l.players)"players"in c?s.add(c.id):s.add(c.id.toString());let i=a.filter(l=>"players"in l?!s.has(l.id):!s.has(l.id.toString()));return{pods:o,unassigned:i}}findOptimalPodAssignment(t,e,r){return this.optimizeVirtualPlayerAssignmentUnified(t,e,r)}optimizeVirtualPlayerAssignmentUnified(t,e,r){if(t.length===0)return[];let a=this.createVirtualPlayersUnified(t),n=new Map;for(let s of a)n.has(s.powerLevel)||n.set(s.powerLevel,[]),n.get(s.powerLevel).push(s);let o={pods:[],totalPods:0};return r.allowLeniency?this.backtrackVirtualPlayersWithLeniencyUnified(a,e,r.maxTolerance,[],new Set,e,o):this.backtrackVirtualPlayersUnified(Array.from(n.entries()),[],new Set,e,o),o.pods}createVirtualPlayersUnified(t){let e=[];for(let r of t)if("players"in r){let a=r.players.flatMap(c=>c.availablePowers),n=Math.min(...a),o=Math.max(...a),i=[r.averagePower,n,o],l=[...new Set(i)];for(let c of l)e.push({item:r,powerLevel:c})}else for(let a of r.availablePowers)e.push({item:r,powerLevel:a});return e}backtrackVirtualPlayersUnified(t,e,r,a,n){if(a.length===0){e.length>n.totalPods&&(n.pods=[...e],n.totalPods=e.length);return}if(e.length+a.length<=n.totalPods)return;let o=a[0],s=a.slice(1);for(let[i,l]of t){let c=l.filter(w=>{let f=this.getItemId(w.item);return!r.has(f)}),p=0;for(let w=0;w<c.length;w++)p+=this.getItemSize(c[w].item);let d=Math.max(3,o);if(p>=d){let w=c.sort((u,b)=>{let m=this.getItemSize(u.item);return this.getItemSize(b.item)-m}),f=[],L=new Set,g=0;for(let u of w){let b=this.getItemId(u.item),m=this.getItemSize(u.item);if(!L.has(b)&&g+m<=o&&(f.push(u),L.add(b),g+=m,g===o))break}if(g>=3){let u=f.map(y=>y.item),b={players:u,power:i},m=new Set(r);for(let y of u){let k="players"in y?y.id:y.id.toString();m.add(k)}this.backtrackVirtualPlayersUnified(t,[...e,b],m,s,n)}}}this.backtrackVirtualPlayersUnified(t,e,r,s,n)}backtrackVirtualPlayersWithLeniencyUnified(t,e,r,a,n,o,s){if(o.length===0){a.length>s.totalPods&&(s.pods=[...a],s.totalPods=a.length);return}if(a.length+o.length<=s.totalPods)return;let i=o[0],l=o.slice(1),c=t.filter(d=>{let w="players"in d.item?d.item.id:d.item.id.toString();return!n.has(w)}),p=[...new Set(c.map(d=>d.powerLevel))].sort((d,w)=>d-w);for(let d of p){let w=c.filter(m=>("players"in m.item,Math.abs(m.powerLevel-d)<=r)),f=new Map;for(let m of w){let y="players"in m.item?m.item.id:m.item.id.toString();if(!f.has(y))f.set(y,m);else{let k=f.get(y),I=Math.abs(k.powerLevel-d);Math.abs(m.powerLevel-d)<I&&f.set(y,m)}}let g=Array.from(f.values()).sort((m,y)=>{if("players"in m.item&&"players"in y.item){let k=Math.abs(m.powerLevel-m.item.averagePower)<.01,I=Math.abs(y.powerLevel-y.item.averagePower)<.01;return k&&!I?-1:!k&&I?1:Math.abs(m.powerLevel-d)-Math.abs(y.powerLevel-d)}return"players"in m.item&&!("players"in y.item)?1:!("players"in m.item)&&"players"in y.item?-1:Math.abs(m.powerLevel-d)-Math.abs(y.powerLevel-d)}),u=0;for(let m=0;m<g.length;m++)u+=this.getItemSize(g[m].item);let b=Math.max(3,i);if(u>=b){let m=g.sort((v,M)=>{let E=this.getItemSize(v.item);return this.getItemSize(M.item)-E}),y=[],k=new Set,I=0;for(let v of m){let M=this.getItemId(v.item),E=this.getItemSize(v.item);if(!k.has(M)&&I+E<=i&&(y.push(v),k.add(M),I+=E,I===i))break}if(I>=3){let v=y.map(S=>S.item);if(!this.isPodPowerSpreadValid(y,r))continue;let M=y.reduce((S,C)=>S+C.powerLevel,0)/y.length,E={players:v,power:Math.round(M*2)/2},P=new Set(n);for(let S of v){let C="players"in S?S.id:S.id.toString();P.add(C),t.forEach(B=>{let O="players"in B.item?B.item.id:B.item.id.toString();O===C&&P.add(O)})}this.backtrackVirtualPlayersWithLeniencyUnified(t,e,r,[...a,E],P,l,s)}}}this.backtrackVirtualPlayersWithLeniencyUnified(t,e,r,a,n,l,s)}isPodPowerSpreadValid(t,e){if(t.length===0)return!0;let r=t.map(s=>s.powerLevel),a=Math.min(...r);return Math.max(...r)-a<=e}findBestCommonPowerLevel(t){if(t.length===0)return null;let e=new Map;for(let n of t)for(let o of n.availablePowers)e.set(o,(e.get(o)||0)+1);if(e.size===0)return null;let r=t[0].availablePowers[0],a=0;for(let[n,o]of e.entries())o>a&&(a=o,r=n);return r}};var $=class{constructor(t,e){this.draggedElement=null;this.draggedItemData=null;this.currentPods=[];this.currentUnassigned=[];this.handleDragStart=t=>{let e=t.target;this.draggedElement=e,e.classList.add("dragging"),this.draggedItemData={type:e.dataset.itemType,id:e.dataset.itemId,podIndex:e.dataset.podIndex,itemIndex:e.dataset.itemIndex},t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/html",e.outerHTML)};this.handleDragEnd=t=>{t.target.classList.remove("dragging"),this.draggedElement=null,this.draggedItemData=null};this.handleDragOver=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move",t.currentTarget.classList.add("drag-over")};this.handleDragLeave=t=>{t.currentTarget.classList.remove("drag-over")};this.handleDrop=t=>{t.preventDefault();let e=t.currentTarget;if(e.classList.remove("drag-over"),!this.draggedItemData)return;let r=e.dataset.podIndex,a=this.draggedItemData.podIndex;r!==a&&this.moveItemBetweenPods(this.draggedItemData,r)};this.playerManager=t,this.onPodsChanged=e}setCurrentPods(t,e=[]){this.currentPods=[...t],this.currentUnassigned=[...e]}moveItemBetweenPods(t,e){let r=t.podIndex,a=parseInt(t.itemIndex),n=null;if(r==="unassigned")n=this.currentUnassigned[a],this.currentUnassigned.splice(a,1);else{let o=this.currentPods[parseInt(r)];n=o.players[a],o.players.splice(a,1),o.power=this.playerManager.calculatePodPower(o.players)}if(n){if(e==="unassigned")this.currentUnassigned.push(n);else if(e==="new-pod"){let o={players:[n],power:this.playerManager.calculatePodPower([n])};this.currentPods.push(o)}else{let o=this.currentPods[parseInt(e)];o.players.push(n),o.power=this.playerManager.calculatePodPower(o.players)}this.cleanupEmptyPods(),this.onPodsChanged(this.currentPods,this.currentUnassigned)}}cleanupEmptyPods(){this.currentPods=this.currentPods.filter(t=>t.players.length>0)}};var q=class{constructor(){this.isDisplayMode=!1;this.handleKeyDown=null;this.borderColors=["#FF6B6B","#4ECDC4","#45B7D1","#FFA726","#66BB6A","#AB47BC","#EF5350","#26A69A","#42A5F5","#FF7043","#9CCC65","#7E57C2","#EC407A","#29B6F6","#FFCA28","#8BC34A","#673AB7","#F06292","#00BCD4","#FFEB3B","#795548","#607D8B","#E91E63","#009688","#FF9800"]}getShuffledColors(t){let e=[...this.borderColors];for(let r=e.length-1;r>0;r--){let a=Math.floor(Math.random()*(r+1));[e[r],e[a]]=[e[a],e[r]]}if(t>e.length){let r=[];for(let a=0;a<t;a++)r.push(e[a%e.length]);return r}return e.slice(0,t)}calculateOptimalWidthForText(t){let e=0;for(let n of t)n===" "?e+=.3:/[iIl1]/.test(n)?e+=.4:/[mwMW]/.test(n)?e+=.8:/[A-Z]/.test(n)?e+=.7:e+=.6;let r=e*1.2,a=Math.min(85,Math.max(25,r/25*85));return Math.round(a)}calculateFontSizeForPod(t,e,r){let a=t*e,n=Math.ceil(Math.sqrt(r)),o=Math.ceil(r/n),s=(t-(n-1)*10)/n,i=(e-(o-1)*10)/o,l=Math.min(s,i),c=Math.min(l*.25,i*.35),p=Math.max(.9,1-(r-3)*.02),d=Math.max(24,Math.min(72,c*p));return`${Math.round(d)}px`}calculateValidBracketRange(t){let e=t.players.flatMap(o=>"players"in o?o.players:[o]);if(e.length===0)return"Unknown";let r=[],a=new Set;e.forEach(o=>{o.brackets&&o.brackets.forEach(s=>a.add(s))});for(let o of a)e.every(i=>i.brackets&&i.brackets.includes(o))&&r.push(o);let n=["1","2","3","4","cedh"];if(r.sort((o,s)=>n.indexOf(o)-n.indexOf(s)),r.length===0)return"Unknown";if(r.length===1)return r[0];{let o=r.filter(i=>i!=="cedh");return o.length>1&&o.every((i,l)=>{if(l===0)return!0;let c=parseInt(i),p=parseInt(o[l-1]);return c===p+1})&&o.length===r.length&&r.length>1?`${r[0]}-${r[r.length-1]}`:r.join(", ")}}getValidBracketsArrayForPod(t){let e=t.players.flatMap(s=>"players"in s?s.players:[s]);if(e.length===0)return[];let r=new Map;if(e.forEach(s=>{s.brackets&&s.brackets.forEach(i=>{r.set(i,(r.get(i)||0)+1)})}),r.size===0)return[];let a=Math.ceil(e.length/2),n=[];for(let[s,i]of r.entries())i>=a&&n.push(s);let o=["1","2","3","4","cedh"];return n.sort((s,i)=>o.indexOf(s)-o.indexOf(i)),n}enterDisplayMode(t){if(t.length===0)return;this.isDisplayMode=!0,document.body.classList.add("display-mode");let e=Math.ceil(Math.sqrt(t.length)),r=document.createElement("div");r.className="display-mode-container",r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="100vw",r.style.height="100vh",r.style.background="#1a1a1a",r.style.zIndex="1000",r.style.padding="20px",r.style.boxSizing="border-box",r.style.overflow="hidden",r.innerHTML=`
            <div class="display-mode-controls">
                <button id="exit-display-btn">Exit Display Mode</button>
            </div>
            <h1 style="text-align: center; margin: 0 0 20px 0; font-size: 2.5rem; color: white;">MTG Commander Pods</h1>
            <div id="display-output" style="flex-grow: 1; height: calc(100vh - 140px);"></div>
        `;let a=document.querySelector(".container");a&&(a.style.display="none"),document.body.appendChild(r);let n=r.querySelector("#display-output"),o=document.createElement("div");o.style.display="grid",o.style.gap="20px",o.style.height="100%",o.style.gridTemplateColumns=`repeat(${e}, 1fr)`,o.style.gridTemplateRows=`repeat(${e}, 1fr)`;let s=this.getShuffledColors(t.length);t.forEach((l,c)=>{let p=document.createElement("div");p.style.display="flex",p.style.flexDirection="column",p.style.background="#2a2a2a",p.style.border=`3px solid ${s[c]}`,p.style.borderRadius="8px",p.style.padding="15px",p.style.boxSizing="border-box",p.style.minHeight="0",p.style.boxShadow=`0 0 10px ${s[c]}40`,p.classList.add("pod",`pod-color-${c%10}`);let d=document.createElement("h3"),w=document.getElementById("bracket-radio"),f=w&&w.checked;if(f){let v=this.calculateValidBracketRange(l);d.textContent=`Pod ${c+1} (Bracket: ${v})`}else{let v=H(l);d.textContent=`Pod ${c+1} (Power: ${v})`}d.style.fontSize="1.6rem",d.style.margin="0 0 15px 0",d.style.textAlign="center",d.style.color=s[c],d.style.fontWeight="bold",d.style.flexShrink="0",d.style.textShadow="1px 1px 2px rgba(0,0,0,0.8)",p.appendChild(d);let L=0;l.players.forEach(v=>{"players"in v?L+=v.players.length:L+=1});let g="";l.players.forEach(v=>{if("players"in v)v.players.forEach(M=>{let E=f&&M.bracketRange?`${M.name} (B: ${M.bracketRange})`:`${M.name} (P: ${M.powerRange})`;E.length>g.length&&(g=E)});else{let M=f&&v.bracketRange?`${v.name} (B: ${v.bracketRange})`:`${v.name} (P: ${v.powerRange})`;M.length>g.length&&(g=M)}});let u=document.createElement("ul");u.style.flexGrow="1",u.style.display="flex";let b=Math.ceil(Math.sqrt(L)),m=Math.ceil(L/b);u.style.display="grid",u.style.gridTemplateColumns=`repeat(${b}, 1fr)`,u.style.gridTemplateRows=`repeat(${m}, 1fr)`,u.style.gap="12px",u.style.margin="0",u.style.padding="0",u.style.listStyle="none",u.style.width="100%",u.style.height="100%",u.style.alignItems="stretch",u.style.justifyItems="stretch";let y=[];l.players.forEach(v=>{"players"in v?v.players.forEach(M=>y.push(M)):y.push(v)});let k=document.getElementById("bracket-radio"),I=k&&k.checked;y.forEach((v,M)=>{let E=document.createElement("li"),P=document.createElement("div");P.textContent=v.name,P.className="player-name";let S=document.createElement("div");if(I&&v.bracketRange){let C=this.getValidBracketsArrayForPod(l),B=j(v,C);S.innerHTML=`B: ${B}`}else{let C=T(l),B=x(v,C);S.innerHTML=`P: ${B}`}S.className="player-power",E.appendChild(P),E.appendChild(S),E.style.display="flex",E.style.flexDirection="column",E.style.justifyContent="center",E.style.alignItems="center",E.style.backgroundColor="rgba(255, 255, 255, 0.12)",E.style.border="2px solid rgba(255, 255, 255, 0.2)",E.style.borderRadius="12px",E.style.padding="8px",E.style.boxSizing="border-box",E.style.textAlign="center",E.style.height="100%",P.style.color="#ffffff",P.style.fontWeight="bold",P.style.lineHeight="1.1",P.style.marginBottom="4px",P.style.wordBreak="break-word",P.style.hyphens="auto",P.style.flexGrow="1",P.style.display="flex",P.style.alignItems="center",P.style.justifyContent="center",S.style.color="#b0b0b0",S.style.fontWeight="500",S.style.lineHeight="1",S.style.opacity="0.9",E.dataset.podRef=c.toString(),E.classList.add("dynamic-font-item"),u.appendChild(E)}),p.appendChild(u),o.appendChild(p)}),n.appendChild(o),requestAnimationFrame(()=>{o.querySelectorAll(".pod").forEach((c,p)=>{let d=c.getBoundingClientRect(),w=d.width,f=d.height,L=0;t[p].players.forEach(b=>{"players"in b?L+=b.players.length:L+=1});let g=this.calculateFontSizeForPod(w,f,L);c.querySelectorAll(".dynamic-font-item").forEach(b=>{let m=b.querySelector(".player-name"),y=b.querySelector(".player-power");if(m&&(m.style.fontSize=g),y){let k=Math.round(parseInt(g)*.75);y.style.fontSize=`${k}px`}})})}),r.querySelector("#exit-display-btn").addEventListener("click",()=>this.exitDisplayMode()),this.handleKeyDown=l=>{l.key==="Escape"&&this.isDisplayMode&&this.exitDisplayMode()},document.addEventListener("keydown",this.handleKeyDown)}exitDisplayMode(){this.isDisplayMode=!1,document.body.classList.remove("display-mode");let t=document.querySelector(".container");t&&(t.style.display="");let e=document.querySelector(".display-mode-container");e&&e.remove(),this.handleKeyDown&&(document.removeEventListener("keydown",this.handleKeyDown),this.handleKeyDown=null)}getIsDisplayMode(){return this.isDisplayMode}};var z=class{constructor(){this.listeners=new Map;this.abortController=new AbortController}addEventListener(t,e,r,a){let n=this.generateId(),o={...typeof a=="object"?a:{capture:a},signal:this.abortController.signal};return t.addEventListener(e,r,o),this.listeners.set(n,{element:t,type:e,listener:r,options:o}),n}removeEventListener(t){let e=this.listeners.get(t);return e?(e.element.removeEventListener(e.type,e.listener,e.options),this.listeners.delete(t),!0):!1}removeAllFromElement(t){let e=0;for(let[r,a]of this.listeners.entries())a.element===t&&(a.element.removeEventListener(a.type,a.listener,a.options),this.listeners.delete(r),e++);return e}removeAll(){this.abortController.abort(),this.abortController=new AbortController,this.listeners.clear()}getListenerCount(){return this.listeners.size}generateId(){return`listener_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}},N=new z;var G=class{constructor(){this.currentPods=[];this.currentUnassigned=[];this.lastResetData=null;this.isRestoring=!1;this.displayModeBtnBottom=null;this.reusablePlayerArray=[];this.reusableItemArray=[];this.containerClickHandler=null;this.containerChangeHandler=null;this.containerInputHandler=null;this.documentClickHandler=null;this.playerRowsContainer=document.getElementById("player-rows"),this.outputSection=document.getElementById("output-section"),this.displayModeBtn=document.getElementById("display-mode-btn"),this.playerRowTemplate=document.getElementById("player-row-template"),this.playerManager=new A,this.podGenerator=new D,this.dragDropManager=new $(this.playerManager,(t,e)=>this.renderPods(t,e)),this.displayModeManager=new q,this.initializeEventListeners(),this.initializeRankingModeToggle()}initializeEventListeners(){let t=document.getElementById("add-player-btn"),e=document.getElementById("bulk-add-btn"),r=document.getElementById("generate-pods-btn"),a=document.getElementById("reset-all-btn"),n=document.getElementById("help-btn");t.addEventListener("click",()=>this.addPlayerRow()),e.addEventListener("click",()=>this.bulkAddPlayers(4)),r.addEventListener("click",()=>this.generatePods()),a.addEventListener("click",()=>this.resetAllWithConfirmation()),this.displayModeBtn.addEventListener("click",()=>this.displayModeManager.enterDisplayMode(this.currentPods)),n.addEventListener("click",()=>this.showHelpModal()),this.setupEventDelegation(),this.initializeHelpModal(),this.initializeKeyboardShortcuts()}getCachedElements(t){return Array.from(this.playerRowsContainer.querySelectorAll(t))}clearDOMCache(){}getPooledElement(t){return null}returnToPool(t,e){}getDropdownsOptimized(){return document.querySelectorAll(".bracket-selector-dropdown, .power-selector-dropdown")}getButtonsOptimized(){return document.querySelectorAll(".bracket-selector-btn, .power-selector-btn")}addEventListenerWithTracking(t,e,r){N.addEventListener(t,e,r)}removeAllEventListeners(t){N.removeAllFromElement(t)}setupEventDelegation(){this.containerClickHandler||(this.containerClickHandler=t=>this.handleContainerClick(t),this.playerRowsContainer.addEventListener("click",this.containerClickHandler)),this.containerChangeHandler||(this.containerChangeHandler=t=>this.handleContainerChange(t),this.playerRowsContainer.addEventListener("change",this.containerChangeHandler)),this.containerInputHandler||(this.containerInputHandler=t=>this.handleContainerInput(t),this.playerRowsContainer.addEventListener("input",this.containerInputHandler)),this.documentClickHandler||(this.documentClickHandler=t=>this.handleDocumentClick(t),document.addEventListener("click",this.documentClickHandler))}handleContainerClick(t){let e=t.target;if(e.classList.contains("power-selector-btn")){this.handlePowerSelectorClick(t,e);return}if(e.classList.contains("bracket-selector-btn")){this.handleBracketSelectorClick(t,e);return}if(e.classList.contains("range-btn")){this.handleRangeButtonClick(e);return}if(e.classList.contains("bracket-range-btn")){this.handleBracketRangeButtonClick(e);return}if(e.classList.contains("clear-btn")||e.classList.contains("bracket-clear-btn")){this.handleClearButtonClick(e);return}if(e.classList.contains("remove-player-btn")){this.handleRemoveButtonClick(e);return}}handleContainerChange(t){let e=t.target;if(e.classList.contains("group-select")){this.playerManager.handleGroupChange(this.playerRowsContainer);return}if(e.type==="checkbox"&&e.closest(".power-checkbox")){this.handlePowerCheckboxChange(e);return}if(e.type==="checkbox"&&e.closest(".bracket-checkbox")){this.handleBracketCheckboxChange(e);return}if(e.classList.contains("player-name")){this.handlePlayerNameChange(e);return}}handleContainerInput(t){let e=t.target;if(e.classList.contains("player-name")){this.handlePlayerNameChange(e);return}}handleDocumentClick(t){let e=t.target;!e.closest(".power-selector-btn")&&!e.closest(".power-selector-dropdown")&&!e.closest(".bracket-selector-btn")&&!e.closest(".bracket-selector-dropdown")&&this.closeAllDropdowns()}closeAllDropdowns(){this.getDropdownsOptimized().forEach(t=>{t.style.display="none",t.classList.remove("show")}),this.getButtonsOptimized().forEach(t=>{t.classList.remove("open")})}handlePowerSelectorClick(t,e){t.preventDefault();let r=e.closest(".player-row");if(!r)return;let a=r.querySelector(".power-selector-dropdown");if(!a)return;let n=a.style.display!=="none";this.closeAllDropdowns(),n||(a.style.display="block",e.classList.add("open"),setTimeout(()=>a.classList.add("show"),10))}handleBracketSelectorClick(t,e){t.preventDefault();let r=e.closest(".player-row");if(!r)return;let a=r.querySelector(".bracket-selector-dropdown");if(!a)return;let n=a.style.display!=="none";this.closeAllDropdowns(),n||(a.style.display="block",e.classList.add("open"),setTimeout(()=>a.classList.add("show"),10))}handleRangeButtonClick(t){let e=t.closest(".player-row");if(!e)return;let r=t.dataset.range,a=e.querySelectorAll('.power-checkbox input[type="checkbox"]');a.forEach(s=>s.checked=!1);let[n,o]=r.split("-").map(Number);a.forEach(s=>{let i=parseFloat(s.value);(i===n||i===o)&&(s.checked=!0)}),this.updatePowerButtonText(e)}handleBracketRangeButtonClick(t){let e=t.closest(".player-row");if(!e)return;let r=t.dataset.range,a=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]');if(a.forEach(n=>n.checked=!1),r==="cedh"){let n=Array.from(a).find(o=>o.value==="cedh");n&&(n.checked=!0)}else{let[n,o]=r.split("-").map(s=>s==="cedh"?s:parseInt(s));a.forEach(s=>{let i=s.value==="cedh"?"cedh":parseInt(s.value);(i===n||i===o)&&(s.checked=!0)})}this.updateBracketButtonText(e)}handleClearButtonClick(t){let e=t.closest(".player-row");e&&(t.classList.contains("clear-btn")?(e.querySelectorAll('.power-checkbox input[type="checkbox"]').forEach(a=>a.checked=!1),this.updatePowerButtonText(e)):t.classList.contains("bracket-clear-btn")&&(e.querySelectorAll('.bracket-checkbox input[type="checkbox"]').forEach(a=>a.checked=!1),this.updateBracketButtonText(e)))}handleRemoveButtonClick(t){let e=t.closest(".player-row");e&&(this.removeAllEventListeners(e),this.playerRowsContainer.removeChild(e),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.updatePlayerNumbers(),this.clearDOMCache())}handlePowerCheckboxChange(t){let e=t.closest(".player-row");e&&this.updatePowerButtonText(e)}handleBracketCheckboxChange(t){let e=t.closest(".player-row");e&&this.updateBracketButtonText(e)}handlePlayerNameChange(t){t.value.trim()?t.classList.remove("input-error"):t.classList.add("input-error"),this.clearDuplicateErrorsOnInput()}updatePowerButtonText(t){let e=t.querySelector(".power-selector-btn"),r=t.querySelectorAll('.power-checkbox input[type="checkbox"]'),a=[];if(r.forEach(n=>{n.checked&&a.push(parseFloat(n.value))}),a.length===0)e.textContent="Select Power Levels",e.classList.remove("has-selection"),e.dataset.validationTriggered==="true"&&e.classList.add("error");else{e.classList.remove("error"),a.sort((o,s)=>o-s);let n;if(a.length===1)n=`Power: ${a[0]}`;else{let o=a[0],s=a[a.length-1];a.every((l,c)=>{if(c===0)return!0;let p=l-a[c-1];return p===.5||p===1})&&a.length>2?n=`Power: ${o}-${s}`:a.length<=4?n=`Power: ${a.join(", ")}`:n=`Power: ${o}-${s} (${a.length} levels)`}e.textContent=n,e.classList.add("has-selection")}}updateBracketButtonText(t){let e=t.querySelector(".bracket-selector-btn"),r=t.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),a=[];if(r.forEach(n=>{n.checked&&a.push(n.value)}),a.length===0)e.textContent="Select Brackets",e.classList.remove("has-selection"),e.dataset.validationTriggered==="true"&&e.classList.add("error");else{e.classList.remove("error");let n;a.length===1?n=a[0]==="cedh"?"Bracket: cEDH":`Bracket: ${a[0]}`:n=a.length<=3?`Brackets: ${a.join(", ")}`:`Brackets: ${a.length} selected`,e.textContent=n,e.classList.add("has-selection")}}getPlayerRowsOptimized(){let t=this.playerRowsContainer.querySelectorAll(".player-row"),e=[];for(let r=0;r<t.length;r++)e.push(t[r]);return e}clearReusableArrays(){this.reusablePlayerArray.length=0,this.reusableItemArray.length=0}addPlayerRow(){let e=this.playerRowTemplate.content.cloneNode(!0).querySelector(".player-row"),r=this.playerManager.getNextPlayerId();e.dataset.playerId=r.toString(),this.updatePowerButtonText(e),this.updateBracketButtonText(e),this.playerRowsContainer.appendChild(e),this.clearDOMCache(),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.clearDOMCache(),this.updatePlayerNumbers();let n=document.getElementById("bracket-radio").checked,o=e.querySelector(".power-levels"),s=e.querySelector(".bracket-levels");n?(o.style.display="none",s.style.display="block"):(o.style.display="block",s.style.display="none")}bulkAddPlayers(t){for(let e=0;e<t;e++)this.addPlayerRow()}initializeKeyboardShortcuts(){document.addEventListener("keydown",t=>{if(t.ctrlKey&&t.key==="Enter"){t.preventDefault(),this.addPlayerRow();let r=this.playerRowsContainer.querySelectorAll(".player-row"),n=r[r.length-1].querySelector(".player-name");n&&n.focus();return}let e=document.activeElement;if(e&&e.classList.contains("bracket-selector-btn")){let r=null;t.key==="1"?r="1":t.key==="2"?r="2":t.key==="3"?r="3":t.key==="4"?r="4":(t.key==="5"||t.key==="c"||t.key==="C")&&(r="cedh"),r&&(t.preventDefault(),this.selectBracketByKeyboard(e,r))}})}selectBracketByKeyboard(t,e){let r=t.closest(".player-row");if(!r)return;r.querySelectorAll('.bracket-checkbox input[type="checkbox"]').forEach(o=>o.checked=!1);let n=r.querySelector(`.bracket-checkbox input[value="${e}"]`);n&&(n.checked=!0,n.dispatchEvent(new Event("change",{bubbles:!0})))}cleanupBottomDisplayButton(){if(this.displayModeBtnBottom){let t=this.displayModeBtnBottom.parentNode;t&&t.parentNode&&t.parentNode.removeChild(t),this.displayModeBtnBottom=null}}generatePods(){this.triggerValidationForAllFields(),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.playerManager.handleGroupChange(this.playerRowsContainer),this.clearReusableArrays();let t=this.getPlayerRowsOptimized(),e=!1;for(let u=0;u<t.length;u++)t[u].querySelector(".player-name").classList.remove("name-duplicate-error","name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5");for(let u=0;u<t.length;u++){let b=this.playerManager.getPlayerFromRow(t[u]);b?this.reusablePlayerArray.push(b):e=!0}let r=new Map;t.forEach(u=>{let m=u.querySelector(".player-name").value.trim().toLowerCase();m&&(r.has(m)||r.set(m,[]),r.get(m).push(u))});let a=[],n=1;if(r.forEach((u,b)=>{if(u.length>1){a.push(b);let m=`name-duplicate-error-${n}`;u.forEach(y=>{y.querySelector(".player-name").classList.add(m)}),n=n%5+1,e=!0}}),e){let u="Please fix the errors before generating pods.";a.length>0&&(u+=`

Duplicate player names found: ${a.join(", ")}`),alert(u);return}let o=new Map;this.playerManager.getGroups().forEach((u,b)=>{let m=u.reduce((k,I)=>k+I.power,0),y=Math.round(m/u.length*2)/2;o.set(b,{id:b,players:u,averagePower:y,size:u.length})});let s=new Set([...this.playerManager.getGroups().values()].flat().map(u=>u.id)),i=this.reusablePlayerArray.filter(u=>!s.has(u.id));this.reusableItemArray.length=0,this.reusableItemArray.push(...i),o.forEach(u=>{this.reusableItemArray.push({id:u.id,players:u.players,averagePower:u.averagePower,size:u.size})});let l=this.reusablePlayerArray.length;if(l<3){alert("You need at least 3 players to form a pod.");return}let p=V()==="avoid-five"?F(l):R(l),d=U();if(typeof window<"u"&&(window.location.protocol==="file:"||window.__playwright!==void 0||window.playwright!==void 0)){let u=this.reusablePlayerArray.map(m=>m.name).join(""),b=Array.from(u).reduce((m,y)=>m+y.charCodeAt(0),0);this.podGenerator.setShuffleSeed(b)}else this.podGenerator.setShuffleSeed(null);let f=this.podGenerator.generatePodsWithBacktracking(this.reusableItemArray,p,d),L=f.pods,g=f.unassigned;this.currentPods=[...L],this.currentUnassigned=[...g],this.renderPods(L,g)}renderPods(t,e=[]){if(this.currentPods=[...t],this.currentUnassigned=[...e],this.dragDropManager.setCurrentPods(this.currentPods,this.currentUnassigned),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",t.length===0){this.outputSection.textContent="Could not form pods with the given players.",this.displayModeBtn.style.display="none";return}this.displayModeBtn.style.display="inline-block";let r=Math.ceil(Math.sqrt(t.length)),a=document.createDocumentFragment(),n=this.getPooledElement("pods-container")||document.createElement("div");if(n.classList.add("pods-container"),n.style.gridTemplateColumns=`repeat(${r}, 1fr)`,n.style.gridTemplateRows=`repeat(${r}, 1fr)`,t.forEach((s,i)=>{let l=this.getPooledElement("pod")||document.createElement("div");l.classList.add("pod",`pod-color-${i%10}`),l.dataset.podIndex=i.toString(),l.addEventListener("dragover",this.dragDropManager.handleDragOver),l.addEventListener("drop",this.dragDropManager.handleDrop),l.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let c=this.getPooledElement("h3")||document.createElement("h3"),p=document.getElementById("bracket-radio");if(p&&p.checked){let f=this.calculateValidBracketRange(s);c.textContent=`Pod ${i+1} (Bracket: ${f})`}else{let f=H(s);c.textContent=`Pod ${i+1} (Power: ${f})`}l.appendChild(c);let w=this.getPooledElement("ul")||document.createElement("ul");s.players.forEach((f,L)=>{if("players"in f){let g=this.getPooledElement("li")||document.createElement("li");g.classList.add("pod-group"),g.draggable=!0,g.dataset.itemType="group",g.dataset.itemId=f.id,g.dataset.podIndex=i.toString(),g.dataset.itemIndex=L.toString(),g.addEventListener("dragstart",this.dragDropManager.handleDragStart),g.addEventListener("dragend",this.dragDropManager.handleDragEnd);let u=document.getElementById("bracket-radio"),b=u&&u.checked,m=document.createElement("strong");b?m.textContent=`Group ${f.id.split("-")[1]}:`:m.textContent=`Group ${f.id.split("-")[1]} (Avg Power: ${f.averagePower}):`,g.appendChild(m);let y=this.getPooledElement("ul")||document.createElement("ul");f.players.forEach(k=>{let I=this.getPooledElement("li")||document.createElement("li");if(b&&k.bracketRange)I.textContent=`${k.name} (B: ${k.bracketRange})`;else{let v=T(s),M=x(k,v);I.innerHTML=`${k.name} (P: ${M})`}y.appendChild(I)}),g.appendChild(y),w.appendChild(g)}else{let g=this.getPooledElement("li")||document.createElement("li");g.classList.add("pod-player"),g.draggable=!0,g.dataset.itemType="player",g.dataset.itemId=f.id.toString(),g.dataset.podIndex=i.toString(),g.dataset.itemIndex=L.toString(),g.addEventListener("dragstart",this.dragDropManager.handleDragStart),g.addEventListener("dragend",this.dragDropManager.handleDragEnd);let u=document.getElementById("bracket-radio");if(u&&u.checked&&f.bracketRange)g.textContent=`${f.name} (B: ${f.bracketRange})`;else{let m=T(s),y=x(f,m);g.innerHTML=`${f.name} (P: ${y})`}w.appendChild(g)}}),l.appendChild(w),n.appendChild(l)}),t.length>0){let s=document.createElement("div");s.classList.add("pod","new-pod","new-pod-target"),s.style.borderColor="#4CAF50",s.style.backgroundColor="#1f2a1f",s.style.borderStyle="dashed",s.dataset.podIndex="new-pod",s.addEventListener("dragover",this.dragDropManager.handleDragOver),s.addEventListener("drop",this.dragDropManager.handleDrop),s.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let i=document.createElement("h3");i.textContent="Create New Pod",i.style.color="#4CAF50",s.appendChild(i);let l=document.createElement("p");l.textContent="Drag players or groups here to create a new pod",l.style.color="#999",l.style.fontStyle="italic",l.style.textAlign="center",l.style.margin="20px 0",s.appendChild(l),n.appendChild(s)}if(e.length>0){let s=document.createElement("div");s.classList.add("pod","unassigned-pod"),s.style.borderColor="#ff6b6b",s.style.backgroundColor="#2a1f1f",s.dataset.podIndex="unassigned",s.addEventListener("dragover",this.dragDropManager.handleDragOver),s.addEventListener("drop",this.dragDropManager.handleDrop),s.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let i=document.createElement("h3");i.textContent="Unassigned Players",i.style.color="#ff6b6b",s.appendChild(i);let l=document.createElement("ul");e.forEach((c,p)=>{if("players"in c){let d=document.createElement("li");d.classList.add("pod-group"),d.draggable=!0,d.dataset.itemType="group",d.dataset.itemId=c.id,d.dataset.podIndex="unassigned",d.dataset.itemIndex=p.toString(),d.addEventListener("dragstart",this.dragDropManager.handleDragStart),d.addEventListener("dragend",this.dragDropManager.handleDragEnd);let w=document.getElementById("bracket-radio"),f=w&&w.checked;f?d.innerHTML=`<strong>Group ${c.id.split("-")[1]}:</strong>`:d.innerHTML=`<strong>Group ${c.id.split("-")[1]} (Avg Power: ${c.averagePower}):</strong>`;let L=document.createElement("ul");c.players.forEach(g=>{let u=document.createElement("li");f&&g.bracketRange?u.textContent=`${g.name} (B: ${g.bracketRange})`:u.textContent=`${g.name} (P: ${g.powerRange})`,L.appendChild(u)}),d.appendChild(L),l.appendChild(d)}else{let d=document.createElement("li");d.classList.add("pod-player"),d.draggable=!0,d.dataset.itemType="player",d.dataset.itemId=c.id.toString(),d.dataset.podIndex="unassigned",d.dataset.itemIndex=p.toString(),d.addEventListener("dragstart",this.dragDropManager.handleDragStart),d.addEventListener("dragend",this.dragDropManager.handleDragEnd);let w=document.getElementById("bracket-radio");w&&w.checked&&c.bracketRange?d.textContent=`${c.name} (B: ${c.bracketRange})`:d.textContent=`${c.name} (P: ${c.powerRange})`,l.appendChild(d)}}),s.appendChild(l),n.appendChild(s)}a.appendChild(n),this.outputSection.appendChild(a);let o=document.querySelector(".help-section");if(o&&o.parentNode){let s=document.createElement("div");s.style.textAlign="center",s.style.marginTop="20px",s.style.marginBottom="20px",this.displayModeBtnBottom=this.displayModeBtn.cloneNode(!0),this.displayModeBtnBottom.id="display-mode-btn-bottom",this.displayModeBtnBottom.style.display="inline-block",this.displayModeBtnBottom.addEventListener("click",()=>this.displayModeManager.enterDisplayMode(this.currentPods)),s.appendChild(this.displayModeBtnBottom),o.parentNode.insertBefore(s,o)}}captureCurrentPlayerData(){let t=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),e=[];t.forEach(a=>{let n=a.querySelector(".player-name"),o=a.querySelector(".group-select"),s=a.querySelectorAll('.power-checkbox input[type="checkbox"]'),i=[];s.forEach(p=>{p.checked&&i.push(p.value)});let l=a.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),c=[];l.forEach(p=>{p.checked&&c.push(p.value)}),e.push({name:n.value.trim(),groupValue:o.value,createdGroupId:o.dataset.createdGroupId,selectedPowers:i,selectedBrackets:c})});let r={noLeniency:document.getElementById("no-leniency-radio")?.checked||!1,leniency:document.getElementById("leniency-radio")?.checked||!1,superLeniency:document.getElementById("super-leniency-radio")?.checked||!1,bracket:document.getElementById("bracket-radio")?.checked||!1};return{players:e,leniencySettings:r,currentPods:[...this.currentPods],currentUnassigned:[...this.currentUnassigned]}}resetAllWithConfirmation(){if(!Array.from(this.playerRowsContainer.querySelectorAll(".player-row")).some(a=>{if(a.querySelector(".player-name").value.trim())return!0;let o=a.querySelectorAll('input[type="checkbox"]');return Array.from(o).some(s=>s.checked)})){this.resetAll();return}confirm(`Are you sure you want to reset all player data?

This will clear all players, groups, and generated pods. You will be able to undo this action immediately after.`)&&(this.lastResetData=this.captureCurrentPlayerData(),this.resetAll(),this.showUndoResetButton())}showUndoResetButton(){let t=document.getElementById("undo-reset-btn");t&&t.remove();let e=document.createElement("button");e.id="undo-reset-btn",e.textContent="Undo Reset",e.style.marginLeft="10px",e.style.backgroundColor="#28a745",e.style.color="white",e.style.border="none",e.style.padding="8px 16px",e.style.borderRadius="4px",e.style.cursor="pointer",e.style.fontSize="14px",e.addEventListener("click",()=>this.undoReset());let r=document.getElementById("reset-all-btn");r.parentNode.insertBefore(e,r.nextSibling),setTimeout(()=>{document.getElementById("undo-reset-btn")&&(e.remove(),this.lastResetData=null)},3e4)}undoReset(){if(!this.lastResetData){alert("No reset data available to restore.");return}this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds();let t=this.lastResetData.leniencySettings;t.noLeniency&&(document.getElementById("no-leniency-radio").checked=!0),t.leniency&&(document.getElementById("leniency-radio").checked=!0),t.superLeniency&&(document.getElementById("super-leniency-radio").checked=!0),t.bracket&&(document.getElementById("bracket-radio").checked=!0),this.lastResetData.players.forEach(a=>{this.addPlayerRow();let n=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),o=n[n.length-1],s=o.querySelector(".player-name");s.value=a.name;let i=o.querySelector(".group-select");a.createdGroupId&&(i.dataset.createdGroupId=a.createdGroupId),i.value=a.groupValue}),this.isRestoring=!0;let e=document.getElementById("no-leniency-radio"),r=document.getElementById("bracket-radio");if(e&&r){let a=new Event("change",{bubbles:!0});t.bracket?r.dispatchEvent(a):e.dispatchEvent(a)}setTimeout(()=>{this.restorePlayerSelections()},200)}restorePlayerSelections(){if(!this.lastResetData)return;this.lastResetData.players.forEach((e,r)=>{let n=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[r];if(!n)return;e.selectedPowers.forEach(i=>{let l=n.querySelector(`.power-checkbox input[type="checkbox"][value="${i}"]`);l&&(l.checked=!0)}),e.selectedBrackets.forEach(i=>{let l=n.querySelector(`.bracket-checkbox input[type="checkbox"][value="${i}"]`);l&&(l.checked=!0)}),n.querySelectorAll('input[type="checkbox"]').forEach(i=>{i.checked&&i.dispatchEvent(new Event("change",{bubbles:!0}))}),this.updateButtonTextsForRow(n);let s=n.querySelector(".group-select");e.groupValue&&e.groupValue!=="no-group"&&e.groupValue.startsWith("group-")&&(e.createdGroupId?s.dataset.createdGroupId=e.createdGroupId:s.dataset.createdGroupId=e.groupValue,s.value="new-group",s.dispatchEvent(new Event("change",{bubbles:!0})))}),this.lastResetData.players.forEach((e,r)=>{let o=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[r].querySelector(".group-select");e.groupValue&&e.groupValue!=="no-group"&&e.groupValue.startsWith("group-")&&(o.value=e.groupValue,o.dispatchEvent(new Event("change",{bubbles:!0})))}),this.currentPods=[...this.lastResetData.currentPods],this.currentUnassigned=[...this.lastResetData.currentUnassigned],(this.currentPods.length>0||this.currentUnassigned.length>0)&&this.renderPods(this.currentPods,this.currentUnassigned),this.playerManager.handleGroupChange(this.playerRowsContainer),this.isRestoring=!1;let t=document.getElementById("undo-reset-btn");t&&t.remove(),this.lastResetData=null,alert("Reset has been undone successfully!")}resetAll(){this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.displayModeBtn.style.display="none",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds(),this.currentPods=[],this.currentUnassigned=[];let t=document.getElementById("no-leniency-radio");t.checked=!0;for(let e=0;e<4;e++)this.addPlayerRow()}clearDuplicateErrorsOnInput(){let t=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),e=new Map;t.forEach(a=>{let n=a.querySelector(".player-name"),o=n.value.trim().toLowerCase();o&&(e.has(o)||e.set(o,[]),e.get(o).push(n))}),t.forEach(a=>{a.querySelector(".player-name").classList.remove("name-duplicate-error","name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5")});let r=1;e.forEach((a,n)=>{if(a.length>1){let o=`name-duplicate-error-${r}`;a.forEach(s=>{s.classList.add(o)}),r=r%5+1}})}initializeRankingModeToggle(){let t=document.getElementById("power-level-radio"),e=document.getElementById("bracket-radio"),r=()=>{let a=e.checked;if(a){document.body.classList.add("bracket-mode");let o=document.getElementById("no-leniency-radio");o&&(o.checked=!0)}else document.body.classList.remove("bracket-mode");this.playerRowsContainer.querySelectorAll(".player-row").forEach(o=>{let s=o.querySelector(".power-levels"),i=o.querySelector(".bracket-levels");a?(s.style.display="none",i.style.display="block"):(s.style.display="block",i.style.display="none"),this.isRestoring||this.clearAllSelections(o)})};t.addEventListener("change",r),e.addEventListener("change",r),r()}clearAllSelections(t){t.querySelectorAll('.power-checkbox input[type="checkbox"]').forEach(o=>o.checked=!1),t.querySelectorAll('.bracket-checkbox input[type="checkbox"]').forEach(o=>o.checked=!1);let a=t.querySelector(".power-selector-btn"),n=t.querySelector(".bracket-selector-btn");a&&(a.textContent="Select Power Levels",a.classList.remove("has-selection")),n&&(n.textContent="Select Brackets",n.classList.remove("has-selection"))}initializeHelpModal(){let t=document.getElementById("help-modal");t.querySelector(".help-close").addEventListener("click",()=>this.hideHelpModal()),t.addEventListener("click",r=>{r.target===t&&this.hideHelpModal()}),document.addEventListener("keydown",r=>{r.key==="Escape"&&t.style.display==="block"&&this.hideHelpModal()})}showHelpModal(){let t=document.getElementById("help-modal");t.style.display="block",document.body.style.overflow="hidden"}hideHelpModal(){let t=document.getElementById("help-modal");t.style.display="none",document.body.style.overflow=""}calculateValidBracketRange(t){let e=t.players.flatMap(o=>"players"in o?o.players:[o]);if(e.length===0)return"Unknown";let r=[],a=new Set;e.forEach(o=>{o.brackets&&o.brackets.forEach(s=>a.add(s))});for(let o of a)e.every(i=>i.brackets&&i.brackets.includes(o))&&r.push(o);let n=["1","2","3","4","cedh"];if(r.sort((o,s)=>n.indexOf(o)-n.indexOf(s)),r.length===0)return"Unknown";if(r.length===1)return r[0];{let o=r.filter(i=>i!=="cedh");return o.length>1&&o.every((i,l)=>{if(l===0)return!0;let c=parseInt(i),p=parseInt(o[l-1]);return c===p+1})&&o.length===r.length&&r.length>1?`${r[0]}-${r[r.length-1]}`:r.join(", ")}}triggerValidationForAllFields(){let t=this.getPlayerRowsOptimized();for(let e=0;e<t.length;e++){let r=t[e],a=r.querySelector(".player-name");a.value.trim()||a.classList.add("input-error");let o=r.querySelector(".power-selector-btn"),s=r.querySelector(".bracket-selector-btn");if(o&&(o.dataset.validationTriggered="true"),s&&(s.dataset.validationTriggered="true"),document.getElementById("bracket-radio").checked){let c=r.querySelectorAll('.bracket-checkbox input[type="checkbox"]');Array.from(c).some(d=>d.checked)||s.classList.add("error")}else{let c=r.querySelectorAll('.power-checkbox input[type="checkbox"]');Array.from(c).some(d=>d.checked)||o.classList.add("error")}}}updateButtonTextsForRow(t){let e=t.querySelectorAll('.power-checkbox input[type="checkbox"]'),r=t.querySelector(".power-selector-btn");if(r){let o=[];if(e.forEach(s=>{s.checked&&o.push(parseFloat(s.value))}),o.length===0)r.textContent="Select Power Levels",r.classList.remove("has-selection");else{o.sort((i,l)=>i-l);let s;if(o.length===1)s=`Power: ${o[0]}`;else{let i=o[0],l=o[o.length-1];o.every((p,d)=>{if(d===0)return!0;let w=p-o[d-1];return w===.5||w===1})&&o.length>2?s=`Power: ${i}-${l}`:o.length<=4?s=`Power: ${o.join(", ")}`:s=`Power: ${i}-${l} (${o.length} levels)`}r.textContent=s,r.classList.add("has-selection")}}let a=t.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),n=t.querySelector(".bracket-selector-btn");if(n){let o=[];if(a.forEach(s=>{s.checked&&o.push(s.value)}),o.length===0)n.textContent="Select Brackets",n.classList.remove("has-selection");else{let s;o.length===1?s=`Bracket: ${o[0]}`:s=`Brackets: ${o.join(", ")}`,n.textContent=s,n.classList.add("has-selection")}}}updatePlayerNumbers(){this.playerRowsContainer.querySelectorAll(".player-row").forEach((e,r)=>{let a=e.querySelector(".player-number");a&&(a.textContent=(r+1).toString())})}};function _(){let e=Math.floor(Math.random()*360),r=25,a=[];for(let s=0;s<50;s++){let l=(e+s*137.5)%360;a.push(Math.round(l))}let n="";for(let s=1;s<=50;s++){let i=a[s-1],l=70+Math.floor(Math.random()*20),c=50,p=28+Math.floor(Math.random()*8);n+=`
.player-row .group-select.group-${s} {
    border-color: hsl(${i}, ${l}%, ${c}%) !important;
    background-color: hsl(${i}, ${l}%, ${p}%) !important;
}`,n+=`
.group-select option[value="group-${s}"] {
    background-color: hsl(${i}, ${l}%, ${p}%);
}`}let o=document.createElement("style");o.id="dynamic-group-colors",o.textContent=n,document.head.appendChild(o)}document.addEventListener("DOMContentLoaded",()=>{_(),new G().resetAll()});})();
