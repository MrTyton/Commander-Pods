"use strict";(()=>{function G(h){if(h<3)return[];if(h===3)return[3];if(h===4)return[4];if(h===5)return[5];if(h===6)return[3,3];if(h===7)return[4,3];if(h===8)return[4,4];if(h===9)return[3,3,3];if(h===10)return[5,5];let r=Math.floor(h/4),e=h%4;return e===0?Array(r).fill(4):e===1?r>=2?[...Array(r-2).fill(4),5,4]:[3,3,3,2]:e===2?r>=1?[...Array(r-1).fill(4),3,3]:[3,3,3,3]:e===3?[...Array(r).fill(4),3]:[]}function W(h){if(h<3)return[];if(h<9)return G(h);if(h===9)return[3,3,3];if(h===10)return[4,3,3];if(h===11)return[4,4,3];if(h===12)return[4,4,4];if(h===13)return[4,3,3,3];if(h===14)return[4,4,3,3];if(h===15)return[4,4,4,3];let r=[],e=h;for(;e>=7;)r.push(4),e-=4;if(e===6)r.push(3,3);else if(e===5)if(r.length>0)r.pop(),e+=4,r.push(3,3,3);else return G(h);else e===4?r.push(4):e===3&&r.push(3);return r.sort((n,o)=>o-n)}function j(){let h=document.getElementById("avoid-five-pods-radio");return h&&h.checked?"avoid-five":"balanced"}function K(){let h=document.getElementById("bracket-radio");if(h&&h.checked)return{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0};let r=document.getElementById("no-leniency-radio"),e=document.getElementById("leniency-radio");return document.getElementById("super-leniency-radio").checked?{allowLeniency:!0,allowSuperLeniency:!0,maxTolerance:1}:e.checked?{allowLeniency:!0,allowSuperLeniency:!1,maxTolerance:.5}:{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0}}function _(h){let r=[];if(h.forEach(o=>{if(o.checked){let a=parseFloat(o.value);isNaN(a)||r.push(a)}}),r.length===0)return{availablePowers:[],powerRange:"",averagePower:0};r.sort((o,a)=>o-a);let e;r.length===1?e=r[0].toString():e=r.join(", ");let n=r.reduce((o,a)=>o+a,0)/r.length;return{availablePowers:r,powerRange:e,averagePower:Math.round(n*2)/2}}function Q(){let h=document.querySelector("#leniency-radio");return document.querySelector("#super-leniency-radio")?.checked?1:h?.checked?.5:0}function N(h){let r=h.players.flatMap(a=>"players"in a?a.players:[a]);if(r.length===0)return h.power.toString();let e=Q(),n=[],o=new Set;r.forEach(a=>{a.availablePowers.forEach(t=>o.add(t))});for(let a of o)r.every(s=>s.availablePowers.some(l=>Math.abs(a-l)<=e))&&n.push(a);return n.sort((a,t)=>a-t),n.length===0?h.power.toString():n.length===1?n[0].toString():n.every((t,s)=>s===0||t-n[s-1]<=.5)&&n.length>2?`${n[0]}-${n[n.length-1]}`:n.join(", ")}function q(h,r){let e=[];if(Array.isArray(h.availablePowers))e=h.availablePowers;else if(typeof h.powerRange=="string")if(h.powerRange.includes("-")){let[o,a]=h.powerRange.split("-").map(t=>parseFloat(t.trim()));for(let t=o;t<=a;t+=.5)e.push(t)}else e=h.powerRange.split(",").map(o=>parseFloat(o.trim()));return e.map(o=>r.includes(o)?`<span class="power-highlight">${o}</span>`:o.toString()).join(", ")}function Y(h,r){let e=[];if(Array.isArray(h.availableBrackets))e=h.availableBrackets;else if(typeof h.bracketRange=="string")if(h.bracketRange.includes("-")){let[o,a]=h.bracketRange.split("-").map(l=>l.trim()),t=parseInt(o),s=parseInt(a);if(!isNaN(t)&&!isNaN(s))for(let l=t;l<=s;l++)e.push(l.toString());else e=[o,a]}else e=h.bracketRange.split(",").map(o=>o.trim());return e.map(o=>r.includes(o)?`<span class="bracket-highlight">${o}</span>`:o.toString()).join(", ")}function $(h){let r=h.players.flatMap(t=>"players"in t?t.players:[t]);if(r.length===0)return[];let e=new Map,n=new Set;if(r.forEach(t=>{t.availablePowers.length===1&&n.add(t.availablePowers[0]),t.availablePowers.forEach(s=>{e.set(s,(e.get(s)||0)+1)})}),e.size===0)return[];let o=Math.max(...e.values()),a=[];for(let[t,s]of e.entries())(s===o||n.has(t))&&a.push(t);return a.sort((t,s)=>t-s),a}var z=class{constructor(){this.groups=new Map;this.nextPlayerId=0;this.nextGroupId=1;this.availableColors=[];this.groupColorAssignments=new Map;this.initializeAvailableColors()}initializeAvailableColors(){this.availableColors=Array.from({length:50},(r,e)=>e+1),this.shuffleArray(this.availableColors)}shuffleArray(r){for(let e=r.length-1;e>0;e--){let n=Math.floor(Math.random()*(e+1));[r[e],r[n]]=[r[n],r[e]]}}assignRandomColor(r){if(this.groupColorAssignments.has(r))return this.groupColorAssignments.get(r);this.availableColors.length===0&&this.initializeAvailableColors();let e=this.availableColors.pop();return this.groupColorAssignments.set(r,e),e}releaseColor(r){let e=this.groupColorAssignments.get(r);e&&(this.availableColors.push(e),this.groupColorAssignments.delete(r))}getNextPlayerId(){return this.nextPlayerId++}resetPlayerIds(){this.nextPlayerId=0}getNextGroupId(){let r=new Set;document.querySelectorAll(".group-select").forEach(n=>{if(n.value.startsWith("group-")){let o=parseInt(n.value.split("-")[1]);isNaN(o)||r.add(o)}if(n.value==="new-group"&&n.dataset.createdGroupId&&n.dataset.createdGroupId.startsWith("group-")){let o=parseInt(n.dataset.createdGroupId.split("-")[1]);isNaN(o)||r.add(o)}});for(let n=1;n<=50;n++)if(!r.has(n))return n;return this.nextGroupId++}resetGroupIds(){this.nextGroupId=1}getGroups(){return this.groups}clearGroups(){this.groups.clear()}getPlayerFromRow(r){let e=r.querySelector(".player-name");e.classList.remove("input-error");let n=e.value.trim();if(!n)return e.classList.add("input-error"),null;if(document.getElementById("bracket-radio").checked){let t=r.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),s=[];if(t.forEach(c=>{c.checked&&s.push(c.value)}),s.length===0)return r.querySelector(".bracket-selector-btn").classList.add("error"),null;r.querySelector(".bracket-selector-btn").classList.remove("error");let l={1:1,2:2,3:3,4:4,cedh:10},i=s.map(c=>l[c]),p=i.reduce((c,m)=>c+m,0)/i.length;return{id:parseInt(r.dataset.playerId),name:n,power:Math.round(p*2)/2,availablePowers:i,powerRange:s.join(", "),brackets:s,bracketRange:s.join(", "),rowElement:r}}else{let t=r.querySelectorAll('.power-checkbox input[type="checkbox"]'),s=_(t);return s.availablePowers.length===0?(r.querySelector(".power-selector-btn").classList.add("error"),null):(r.querySelector(".power-selector-btn").classList.remove("error"),{id:parseInt(r.dataset.playerId),name:n,power:s.averagePower,availablePowers:s.availablePowers,powerRange:s.powerRange,rowElement:r})}}handleGroupChange(r){this.groups.clear();let e=Array.from(r.querySelectorAll(".player-row"));e.forEach(o=>{for(let a=1;a<=50;a++)o.querySelector(".group-select").classList.remove(`group-${a}`)});let n=new Set;e.forEach(o=>{let a=o.querySelector(".group-select");a.dataset.createdGroupId?n.add(a.dataset.createdGroupId):a.value.startsWith("group-")&&n.add(a.value)}),e.forEach(o=>{let a=o.querySelector(".group-select"),t="";if(a.value==="new-group"){a.dataset.createdGroupId?t=a.dataset.createdGroupId:(t=`group-${this.getNextGroupId()}`,n.add(t),a.dataset.createdGroupId=t);let s=this.getPlayerFromRow(o);s&&(this.groups.has(t)||this.groups.set(t,[]),this.groups.get(t).push(s))}else if(a.value.startsWith("group-")){t=a.value;let s=this.getPlayerFromRow(o);s&&(this.groups.has(a.value)||this.groups.set(a.value,[]),this.groups.get(a.value).push(s))}else a.dataset.createdGroupId&&delete a.dataset.createdGroupId;if(t){let s=parseInt(t.split("-")[1]);s>=1&&s<=50&&a.classList.add(`group-${s}`)}}),this.cleanupUnusedGroups(n),this.updateAllGroupDropdowns(r)}updateAllGroupDropdowns(r){let e=new Set,n=Array.from(r.querySelectorAll(".player-row"));n.forEach(o=>{let a=o.querySelector(".group-select");a.value==="new-group"&&a.dataset.createdGroupId?e.add(a.dataset.createdGroupId):a.value.startsWith("group-")&&e.add(a.value)}),n.forEach(o=>{let a=o.querySelector(".group-select"),t=a.value,s=a.dataset.createdGroupId;if(Array.from(a.options).forEach(i=>{i.value.startsWith("group-")&&a.remove(i.index)}),e.forEach(i=>{let p=i.split("-")[1],c=new Option(`Group ${p}`,i);a.add(c)}),s&&e.has(s)&&(t==="new-group"||t==="no-group")){a.value=s;let i=parseInt(s.split("-")[1]);i>=1&&i<=50&&a.classList.add(`group-${i}`)}else if(t.startsWith("group-")&&e.has(t)){a.value=t;let i=parseInt(t.split("-")[1]);i>=1&&i<=50&&a.classList.add(`group-${i}`)}else{a.value="no-group";for(let i=1;i<=50;i++)a.classList.remove(`group-${i}`)}})}arePlayersCompatible(r,e,n){return r.availablePowers.some(a=>e.availablePowers.some(t=>Math.abs(a-t)<.01))?!0:n.allowLeniency?r.availablePowers.some(a=>e.availablePowers.some(t=>Math.abs(a-t)<=n.maxTolerance)):!1}findAllCommonPowers(r,e){return r.length===0?[]:[...new Set(r.flatMap(o=>o.availablePowers))].sort((o,a)=>o-a).filter(o=>r.every(a=>a.availablePowers.some(t=>{let s=Math.abs(t-o);return s<.01||e.allowLeniency&&s<=e.maxTolerance})))}findBestCommonPowerLevel(r){if(r.length===0)return null;let e=new Map;for(let a of r)for(let t of a.availablePowers)e.set(t,(e.get(t)||0)+1);if(e.size===0)return null;let n=r[0].availablePowers[0],o=0;for(let[a,t]of e.entries())t>o&&(o=t,n=a);return n}calculatePodPower(r){if(r.length===0)return 0;let e=r.reduce((n,o)=>{if("players"in o)return n+o.averagePower;{let a=o.powerRange.split(",").map(s=>parseFloat(s.trim())),t=a.reduce((s,l)=>s+l,0)/a.length;return n+t}},0);return Math.round(e/r.length*10)/10}cleanupUnusedGroups(r){Array.from(this.groupColorAssignments.keys()).forEach(a=>{r.has(a)||this.releaseColor(a)}),Array.from(this.groups.keys()).forEach(a=>{r.has(a)||this.groups.delete(a)}),document.querySelectorAll(".group-select").forEach(a=>{let t=a.dataset.createdGroupId;t&&!r.has(t)&&delete a.dataset.createdGroupId})}};var F=class{constructor(){this.shuffleSeed=null;this.sizeCache=new Map}setShuffleSeed(r){this.shuffleSeed=r,this.sizeCache.clear()}seededRandom(r){let e=r;return()=>(e=e*1103515245+12345&2147483647,e/2147483647)}shuffleArray(r){let e=[...r],n;this.shuffleSeed!==null?n=this.seededRandom(this.shuffleSeed):n=Math.random;for(let o=e.length-1;o>0;o--){let a=Math.floor(n()*(o+1));[e[o],e[a]]=[e[a],e[o]]}return e}getItemSize(r){let e="players"in r?`group-${r.id}`:`player-${r.id}`;if(!this.sizeCache.has(e)){let n="players"in r?r.size:1;this.sizeCache.set(e,n)}return this.sizeCache.get(e)}getItemId(r){return"players"in r?r.id:r.id.toString()}generatePodsWithBacktracking(r,e,n){let o=this.shuffleArray(r),a=o.reduce((i,p)=>i+("size"in p?p.size:1),0);if(a>=3&&a<=5){let i=o.flatMap(c=>"players"in c?c.players:[c]),p=this.findBestCommonPowerLevel(i);return p!==null?{pods:[{players:o,power:p}],unassigned:[]}:{pods:[],unassigned:o}}let t=this.findOptimalPodAssignment(o,e,n),s=new Set;for(let i of t)for(let p of i.players)"players"in p?s.add(p.id):s.add(p.id.toString());let l=o.filter(i=>"players"in i?!s.has(i.id):!s.has(i.id.toString()));return{pods:t,unassigned:l}}findOptimalPodAssignment(r,e,n){return this.optimizeVirtualPlayerAssignmentUnified(r,e,n)}optimizeVirtualPlayerAssignmentUnified(r,e,n){if(r.length===0)return[];let o=this.createVirtualPlayersUnified(r),a=new Map;for(let s of o)a.has(s.powerLevel)||a.set(s.powerLevel,[]),a.get(s.powerLevel).push(s);let t={pods:[],totalPods:0};return n.allowLeniency?this.backtrackVirtualPlayersWithLeniencyUnified(o,e,n.maxTolerance,[],new Set,e,t):this.backtrackVirtualPlayersUnified(Array.from(a.entries()),[],new Set,e,t),t.pods}createVirtualPlayersUnified(r){let e=[];for(let n of r)if("players"in n){let o=n.players.flatMap(p=>p.availablePowers),a=Math.min(...o),t=Math.max(...o),l=[n.averagePower,a,t],i=[...new Set(l)];for(let p of i)e.push({item:n,powerLevel:p})}else for(let o of n.availablePowers)e.push({item:n,powerLevel:o});return e}backtrackVirtualPlayersUnified(r,e,n,o,a){if(o.length===0){e.length>a.totalPods&&(a.pods=[...e],a.totalPods=e.length);return}if(e.length+o.length<=a.totalPods)return;let t=o[0],s=o.slice(1);for(let[l,i]of r){let p=i.filter(g=>{let k=this.getItemId(g.item);return!n.has(k)}),c=0;for(let g=0;g<p.length;g++)c+=this.getItemSize(p[g].item);let m=Math.max(3,t);if(c>=m){let g=p.sort((w,B)=>{let d=this.getItemSize(w.item);return this.getItemSize(B.item)-d}),k=[],v=new Set,L=0;for(let w of g){let B=this.getItemId(w.item),d=this.getItemSize(w.item);if(!v.has(B)&&L+d<=t&&(k.push(w),v.add(B),L+=d,L===t))break}if(L>=3){let w=k.map(y=>y.item),B={players:w,power:l},d=new Set(n);for(let y of w){let P="players"in y?y.id:y.id.toString();d.add(P)}this.backtrackVirtualPlayersUnified(r,[...e,B],d,s,a)}}}this.backtrackVirtualPlayersUnified(r,e,n,s,a)}backtrackVirtualPlayersWithLeniencyUnified(r,e,n,o,a,t,s){if(t.length===0){o.length>s.totalPods&&(s.pods=[...o],s.totalPods=o.length);return}if(o.length+t.length<=s.totalPods)return;let l=t[0],i=t.slice(1),p=r.filter(m=>{let g="players"in m.item?m.item.id:m.item.id.toString();return!a.has(g)}),c=[...new Set(p.map(m=>m.powerLevel))].sort((m,g)=>m-g);for(let m of c){let g=p.filter(d=>("players"in d.item,Math.abs(d.powerLevel-m)<=n)),k=new Map;for(let d of g){let y="players"in d.item?d.item.id:d.item.id.toString();if(!k.has(y))k.set(y,d);else{let P=k.get(y),T=Math.abs(P.powerLevel-m);Math.abs(d.powerLevel-m)<T&&k.set(y,d)}}let L=Array.from(k.values()).sort((d,y)=>{if("players"in d.item&&"players"in y.item){let P=Math.abs(d.powerLevel-d.item.averagePower)<.01,T=Math.abs(y.powerLevel-y.item.averagePower)<.01;return P&&!T?-1:!P&&T?1:Math.abs(d.powerLevel-m)-Math.abs(y.powerLevel-m)}return"players"in d.item&&!("players"in y.item)?1:!("players"in d.item)&&"players"in y.item?-1:Math.abs(d.powerLevel-m)-Math.abs(y.powerLevel-m)}),w=0;for(let d=0;d<L.length;d++)w+=this.getItemSize(L[d].item);let B=Math.max(3,l);if(w>=B){let d=L.sort((E,x)=>{let M=this.getItemSize(E.item);return this.getItemSize(x.item)-M}),y=[],P=new Set,T=0;for(let E of d){let x=this.getItemId(E.item),M=this.getItemSize(E.item);if(!P.has(x)&&T+M<=l&&(y.push(E),P.add(x),T+=M,T===l))break}if(T>=3){let E=y.map(u=>u.item);if(!this.isPodPowerSpreadValid(y,n))continue;let x=y.reduce((u,f)=>u+f.powerLevel,0)/y.length,M={players:E,power:Math.round(x*2)/2},C=new Set(a);for(let u of E){let f="players"in u?u.id:u.id.toString();C.add(f),r.forEach(b=>{let S="players"in b.item?b.item.id:b.item.id.toString();S===f&&C.add(S)})}this.backtrackVirtualPlayersWithLeniencyUnified(r,e,n,[...o,M],C,i,s)}}}this.backtrackVirtualPlayersWithLeniencyUnified(r,e,n,o,a,i,s)}isPodPowerSpreadValid(r,e){if(r.length===0)return!0;let n=r.map(s=>s.powerLevel),o=Math.min(...n);return Math.max(...n)-o<=e}findBestCommonPowerLevel(r){if(r.length===0)return null;let e=new Map;for(let a of r)for(let t of a.availablePowers)e.set(t,(e.get(t)||0)+1);if(e.size===0)return null;let n=r[0].availablePowers[0],o=0;for(let[a,t]of e.entries())t>o&&(o=t,n=a);return n}};var V=class{constructor(r,e){this.draggedElement=null;this.draggedItemData=null;this.currentPods=[];this.currentUnassigned=[];this.handleDragStart=r=>{let e=r.target;this.draggedElement=e,e.classList.add("dragging"),this.draggedItemData={type:e.dataset.itemType,id:e.dataset.itemId,podIndex:e.dataset.podIndex,itemIndex:e.dataset.itemIndex},r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("text/html",e.outerHTML)};this.handleDragEnd=r=>{r.target.classList.remove("dragging"),this.draggedElement=null,this.draggedItemData=null};this.handleDragOver=r=>{r.preventDefault(),r.dataTransfer.dropEffect="move",r.currentTarget.classList.add("drag-over")};this.handleDragLeave=r=>{r.currentTarget.classList.remove("drag-over")};this.handleDrop=r=>{r.preventDefault();let e=r.currentTarget;if(e.classList.remove("drag-over"),!this.draggedItemData)return;let n=e.dataset.podIndex,o=this.draggedItemData.podIndex;n!==o&&this.moveItemBetweenPods(this.draggedItemData,n)};this.playerManager=r,this.onPodsChanged=e}setCurrentPods(r,e=[]){this.currentPods=[...r],this.currentUnassigned=[...e]}moveItemBetweenPods(r,e){let n=r.podIndex,o=parseInt(r.itemIndex),a=null;if(n==="unassigned")a=this.currentUnassigned[o],this.currentUnassigned.splice(o,1);else{let t=this.currentPods[parseInt(n)];a=t.players[o],t.players.splice(o,1),t.power=this.playerManager.calculatePodPower(t.players)}if(a){if(e==="unassigned")this.currentUnassigned.push(a);else if(e==="new-pod"){let t={players:[a],power:this.playerManager.calculatePodPower([a])};this.currentPods.push(t)}else{let t=this.currentPods[parseInt(e)];t.players.push(a),t.power=this.playerManager.calculatePodPower(t.players)}this.cleanupEmptyPods(),this.onPodsChanged(this.currentPods,this.currentUnassigned)}}cleanupEmptyPods(){this.currentPods=this.currentPods.filter(r=>r.players.length>0)}};var O=class{constructor(){this.isDisplayMode=!1;this.handleKeyDown=null;this.borderColors=["#FF6B6B","#4ECDC4","#45B7D1","#FFA726","#66BB6A","#AB47BC","#EF5350","#26A69A","#42A5F5","#FF7043","#9CCC65","#7E57C2","#EC407A","#29B6F6","#FFCA28","#8BC34A","#673AB7","#F06292","#00BCD4","#FFEB3B","#795548","#607D8B","#E91E63","#009688","#FF9800"]}getShuffledColors(r){let e=[...this.borderColors];for(let n=e.length-1;n>0;n--){let o=Math.floor(Math.random()*(n+1));[e[n],e[o]]=[e[o],e[n]]}if(r>e.length){let n=[];for(let o=0;o<r;o++)n.push(e[o%e.length]);return n}return e.slice(0,r)}calculateOptimalWidthForText(r){let e=0;for(let a of r)a===" "?e+=.3:/[iIl1]/.test(a)?e+=.4:/[mwMW]/.test(a)?e+=.8:/[A-Z]/.test(a)?e+=.7:e+=.6;let n=e*1.2,o=Math.min(85,Math.max(25,n/25*85));return Math.round(o)}calculateFontSizeForPod(r,e,n){let o=r*e,a=Math.ceil(Math.sqrt(n)),t=Math.ceil(n/a),s=(r-(a-1)*10)/a,l=(e-(t-1)*10)/t,i=Math.min(s,l),p=Math.min(i*.25,l*.35),c=Math.max(.9,1-(n-3)*.02),m=Math.max(24,Math.min(72,p*c));return`${Math.round(m)}px`}calculateValidBracketRange(r){let e=r.players.flatMap(t=>"players"in t?t.players:[t]);if(e.length===0)return"Unknown";let n=[],o=new Set;e.forEach(t=>{t.brackets&&t.brackets.forEach(s=>o.add(s))});for(let t of o)e.every(l=>l.brackets&&l.brackets.includes(t))&&n.push(t);let a=["1","2","3","4","cedh"];if(n.sort((t,s)=>a.indexOf(t)-a.indexOf(s)),n.length===0)return"Unknown";if(n.length===1)return n[0];{let t=n.filter(l=>l!=="cedh");return t.length>1&&t.every((l,i)=>{if(i===0)return!0;let p=parseInt(l),c=parseInt(t[i-1]);return p===c+1})&&t.length===n.length&&n.length>1?`${n[0]}-${n[n.length-1]}`:n.join(", ")}}getValidBracketsArrayForPod(r){let e=r.players.flatMap(s=>"players"in s?s.players:[s]);if(e.length===0)return[];let n=new Map;if(e.forEach(s=>{s.brackets&&s.brackets.forEach(l=>{n.set(l,(n.get(l)||0)+1)})}),n.size===0)return[];let o=Math.ceil(e.length/2),a=[];for(let[s,l]of n.entries())l>=o&&a.push(s);let t=["1","2","3","4","cedh"];return a.sort((s,l)=>t.indexOf(s)-t.indexOf(l)),a}enterDisplayMode(r){if(r.length===0)return;this.isDisplayMode=!0,document.body.classList.add("display-mode");let e=Math.ceil(Math.sqrt(r.length)),n=document.createElement("div");n.className="display-mode-container",n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100vw",n.style.height="100vh",n.style.background="#1a1a1a",n.style.zIndex="1000",n.style.padding="20px",n.style.boxSizing="border-box",n.style.overflow="hidden",n.innerHTML=`
            <div class="display-mode-controls">
                <button id="exit-display-btn">Exit Display Mode</button>
            </div>
            <h1 style="text-align: center; margin: 0 0 20px 0; font-size: 2.5rem; color: white;">MTG Commander Pods</h1>
            <div id="display-output" style="flex-grow: 1; height: calc(100vh - 140px);"></div>
        `;let o=document.querySelector(".container");o&&(o.style.display="none"),document.body.appendChild(n);let a=n.querySelector("#display-output"),t=document.createElement("div");t.style.display="grid",t.style.gap="20px",t.style.height="100%",t.style.gridTemplateColumns=`repeat(${e}, 1fr)`,t.style.gridTemplateRows=`repeat(${e}, 1fr)`;let s=this.getShuffledColors(r.length);r.forEach((i,p)=>{let c=document.createElement("div");c.style.display="flex",c.style.flexDirection="column",c.style.background="#2a2a2a",c.style.border=`3px solid ${s[p]}`,c.style.borderRadius="8px",c.style.padding="15px",c.style.boxSizing="border-box",c.style.minHeight="0",c.style.boxShadow=`0 0 10px ${s[p]}40`,c.classList.add("pod",`pod-color-${p%10}`);let m=document.createElement("h3"),g=document.getElementById("bracket-radio"),k=g&&g.checked;if(k){let E=this.calculateValidBracketRange(i);m.textContent=`Pod ${p+1} (Bracket: ${E})`}else{let E=N(i);m.textContent=`Pod ${p+1} (Power: ${E})`}m.style.fontSize="1.6rem",m.style.margin="0 0 15px 0",m.style.textAlign="center",m.style.color=s[p],m.style.fontWeight="bold",m.style.flexShrink="0",m.style.textShadow="1px 1px 2px rgba(0,0,0,0.8)",c.appendChild(m);let v=0;i.players.forEach(E=>{"players"in E?v+=E.players.length:v+=1});let L="";i.players.forEach(E=>{if("players"in E)E.players.forEach(x=>{let M=k&&x.bracketRange?`${x.name} (B: ${x.bracketRange})`:`${x.name} (P: ${x.powerRange})`;M.length>L.length&&(L=M)});else{let x=k&&E.bracketRange?`${E.name} (B: ${E.bracketRange})`:`${E.name} (P: ${E.powerRange})`;x.length>L.length&&(L=x)}});let w=document.createElement("ul");w.style.flexGrow="1",w.style.display="flex";let B=Math.ceil(Math.sqrt(v)),d=Math.ceil(v/B);w.style.display="grid",w.style.gridTemplateColumns=`repeat(${B}, 1fr)`,w.style.gridTemplateRows=`repeat(${d}, 1fr)`,w.style.gap="12px",w.style.margin="0",w.style.padding="0",w.style.listStyle="none",w.style.width="100%",w.style.height="100%",w.style.alignItems="stretch",w.style.justifyItems="stretch";let y=[];i.players.forEach(E=>{"players"in E?E.players.forEach(x=>y.push(x)):y.push(E)});let P=document.getElementById("bracket-radio"),T=P&&P.checked;y.forEach((E,x)=>{let M=document.createElement("li"),C=document.createElement("div");C.textContent=E.name,C.className="player-name";let u=document.createElement("div");if(T&&E.bracketRange){let f=this.getValidBracketsArrayForPod(i),b=Y(E,f);u.innerHTML=`B: ${b}`}else{let f=$(i),b=q(E,f);u.innerHTML=`P: ${b}`}u.className="player-power",M.appendChild(C),M.appendChild(u),M.style.display="flex",M.style.flexDirection="column",M.style.justifyContent="center",M.style.alignItems="center",M.style.backgroundColor="rgba(255, 255, 255, 0.12)",M.style.border="2px solid rgba(255, 255, 255, 0.2)",M.style.borderRadius="12px",M.style.padding="8px",M.style.boxSizing="border-box",M.style.textAlign="center",M.style.height="100%",C.style.color="#ffffff",C.style.fontWeight="bold",C.style.lineHeight="1.1",C.style.marginBottom="4px",C.style.wordBreak="break-word",C.style.hyphens="auto",C.style.flexGrow="1",C.style.display="flex",C.style.alignItems="center",C.style.justifyContent="center",u.style.color="#b0b0b0",u.style.fontWeight="500",u.style.lineHeight="1",u.style.opacity="0.9",M.dataset.podRef=p.toString(),M.classList.add("dynamic-font-item"),w.appendChild(M)}),c.appendChild(w),t.appendChild(c)}),a.appendChild(t),requestAnimationFrame(()=>{t.querySelectorAll(".pod").forEach((p,c)=>{let m=p.getBoundingClientRect(),g=m.width,k=m.height,v=0;r[c].players.forEach(B=>{"players"in B?v+=B.players.length:v+=1});let L=this.calculateFontSizeForPod(g,k,v);p.querySelectorAll(".dynamic-font-item").forEach(B=>{let d=B.querySelector(".player-name"),y=B.querySelector(".player-power");if(d&&(d.style.fontSize=L),y){let P=Math.round(parseInt(L)*.75);y.style.fontSize=`${P}px`}})})}),n.querySelector("#exit-display-btn").addEventListener("click",()=>this.exitDisplayMode()),this.handleKeyDown=i=>{i.key==="Escape"&&this.isDisplayMode&&this.exitDisplayMode()},document.addEventListener("keydown",this.handleKeyDown)}exitDisplayMode(){this.isDisplayMode=!1,document.body.classList.remove("display-mode");let r=document.querySelector(".container");r&&(r.style.display="");let e=document.querySelector(".display-mode-container");e&&e.remove(),this.handleKeyDown&&(document.removeEventListener("keydown",this.handleKeyDown),this.handleKeyDown=null)}getIsDisplayMode(){return this.isDisplayMode}};var U=class{constructor(){this.currentPods=[];this.currentUnassigned=[];this.lastResetData=null;this.isRestoring=!1;this.displayModeBtnBottom=null;this.playerRowsContainer=document.getElementById("player-rows"),this.outputSection=document.getElementById("output-section"),this.displayModeBtn=document.getElementById("display-mode-btn"),this.playerRowTemplate=document.getElementById("player-row-template"),this.playerManager=new z,this.podGenerator=new F,this.dragDropManager=new V(this.playerManager,(r,e)=>this.renderPods(r,e)),this.displayModeManager=new O,this.initializeEventListeners(),this.initializeRankingModeToggle()}initializeEventListeners(){let r=document.getElementById("add-player-btn"),e=document.getElementById("bulk-add-btn"),n=document.getElementById("generate-pods-btn"),o=document.getElementById("reset-all-btn"),a=document.getElementById("help-btn");r.addEventListener("click",()=>this.addPlayerRow()),e.addEventListener("click",()=>this.bulkAddPlayers(4)),n.addEventListener("click",()=>this.generatePods()),o.addEventListener("click",()=>this.resetAllWithConfirmation()),this.displayModeBtn.addEventListener("click",()=>this.displayModeManager.enterDisplayMode(this.currentPods)),a.addEventListener("click",()=>this.showHelpModal()),this.initializeHelpModal(),this.initializeKeyboardShortcuts()}addPlayerRow(){let e=this.playerRowTemplate.content.cloneNode(!0).querySelector(".player-row"),n=this.playerManager.getNextPlayerId();e.dataset.playerId=n.toString();let o=e.querySelector(".power-selector-btn"),a=e.querySelector(".power-selector-dropdown"),t=e.querySelectorAll(".range-btn"),s=()=>{let u=e.querySelectorAll('.power-checkbox input[type="checkbox"]'),f=[];if(u.forEach(b=>{b.checked&&f.push(parseFloat(b.value))}),f.length===0)o.textContent="Select Power Levels",o.classList.remove("has-selection"),o.dataset.validationTriggered==="true"&&o.classList.add("error");else{o.classList.remove("error"),f.sort((S,I)=>S-I);let b;if(f.length===1)b=`Power: ${f[0]}`;else{let S=f[0],I=f[f.length-1];f.every((D,H)=>{if(H===0)return!0;let A=D-f[H-1];return A===.5||A===1})&&f.length>2?b=`Power: ${S}-${I}`:f.length<=4?b=`Power: ${f.join(", ")}`:b=`Power: ${S}-${I} (${f.length} levels)`}o.textContent=b,o.classList.add("has-selection")}};o.addEventListener("click",u=>{u.preventDefault();let f=a.style.display!=="none";document.querySelectorAll(".power-selector-dropdown").forEach(b=>{b.style.display="none",b.classList.remove("show")}),document.querySelectorAll(".power-selector-btn").forEach(b=>{b.classList.remove("open")}),f||(a.style.display="block",o.classList.add("open"),setTimeout(()=>a.classList.add("show"),10))}),document.addEventListener("click",u=>{!o.contains(u.target)&&!a.contains(u.target)&&(a.classList.remove("show"),o.classList.remove("open"),setTimeout(()=>{a.classList.contains("show")||(a.style.display="none")},200))});let l=e.querySelectorAll('.power-checkbox input[type="checkbox"]');l.forEach(u=>{u.addEventListener("change",s)}),t.forEach(u=>{u.addEventListener("click",()=>{let f=u.dataset.range;l.forEach(I=>I.checked=!1);let[b,S]=f.split("-").map(Number);l.forEach(I=>{let R=parseFloat(I.value);(R===b||R===S)&&(I.checked=!0)}),s()})}),e.querySelector(".clear-btn").addEventListener("click",()=>{l.forEach(u=>u.checked=!1),s()});let p=()=>{a.classList.remove("show"),o.classList.remove("open"),setTimeout(()=>{a.classList.contains("show")||(a.style.display="none")},200)},c="",m=null;document.addEventListener("keydown",u=>{let f=a.style.display==="block"&&a.classList.contains("show"),b=document.activeElement===o;(f||b)&&(u.key==="Escape"?(u.preventDefault(),f&&(p(),o.focus()),c="",m&&clearTimeout(m)):(u.key>="1"&&u.key<="9"||u.key==="."||u.key==="0"||u.key==="-")&&(u.preventDefault(),c+=u.key,m&&clearTimeout(m),m=setTimeout(()=>{if(c.includes("-")){let S=c.split("-");if(S.length===2){let I=parseFloat(S[0]),R=parseFloat(S[1]),D=S[0].includes(".")||S[1].includes(".");!isNaN(I)&&!isNaN(R)&&I>=1&&I<=10&&R>=1&&R<=10&&I<=R&&(l.forEach(H=>H.checked=!1),l.forEach(H=>{let A=parseFloat(H.value);if(A>=I&&A<=R){let J=A%1===0,Z=A%1===.5;(J||D&&Z)&&(H.checked=!0)}}),s(),f&&p())}}else{let S=parseFloat(c);if(!isNaN(S)&&S>=1&&S<=10){l.forEach(R=>R.checked=!1);let I=Array.from(l).find(R=>Math.abs(parseFloat(R.value)-S)<.01);I&&(I.checked=!0,s(),f&&p())}}c=""},500)))}),s();let g=e.querySelector(".bracket-selector-btn"),k=e.querySelector(".bracket-selector-dropdown"),v=e.querySelectorAll(".bracket-range-btn"),L=()=>{let u=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),f=[];if(u.forEach(b=>{b.checked&&f.push(b.value)}),f.length===0)g.textContent="Select Brackets",g.classList.remove("has-selection"),g.dataset.validationTriggered==="true"&&g.classList.add("error");else{g.classList.remove("error");let b;f.length===1?b=`Bracket: ${f[0]}`:b=`Brackets: ${f.join(", ")}`,g.textContent=b,g.classList.add("has-selection")}};g.addEventListener("click",u=>{u.preventDefault();let f=k.style.display!=="none";document.querySelectorAll(".bracket-selector-dropdown, .power-selector-dropdown").forEach(b=>{b.style.display="none",b.classList.remove("show")}),document.querySelectorAll(".bracket-selector-btn, .power-selector-btn").forEach(b=>{b.classList.remove("open")}),f||(k.style.display="block",g.classList.add("open"),setTimeout(()=>k.classList.add("show"),10))}),document.addEventListener("click",u=>{!g.contains(u.target)&&!k.contains(u.target)&&(k.classList.remove("show"),g.classList.remove("open"),setTimeout(()=>{k.classList.contains("show")||(k.style.display="none")},200))});let w=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]');w.forEach(u=>{u.addEventListener("change",L)}),v.forEach(u=>{u.addEventListener("click",()=>{let f=u.dataset.range;if(w.forEach(b=>b.checked=!1),f==="cedh")w.forEach(b=>{b.value==="cedh"&&(b.checked=!0)});else{let[b,S]=f.split("-"),I=parseInt(b),R=parseInt(S);w.forEach(D=>{let H=D.value;if(H!=="cedh"){let A=parseInt(H);A>=I&&A<=R&&(D.checked=!0)}})}L()})}),e.querySelector(".bracket-clear-btn").addEventListener("click",()=>{w.forEach(u=>u.checked=!1),L()});let d=()=>{k.classList.remove("show"),g.classList.remove("open"),setTimeout(()=>{k.classList.contains("show")||(k.style.display="none")},200)};document.addEventListener("keydown",u=>{let f=k.style.display==="block"&&k.classList.contains("show"),b=document.activeElement===g;if(f||b){if(u.key==="Escape")u.preventDefault(),f&&(d(),g.focus());else if(u.key>="1"&&u.key<="4"){u.preventDefault();let S=u.key;w.forEach(R=>R.checked=!1);let I=Array.from(w).find(R=>R.value===S);I&&(I.checked=!0,L(),f&&d())}else if(u.key==="5"||u.key.toLowerCase()==="c"){u.preventDefault(),w.forEach(I=>I.checked=!1);let S=Array.from(w).find(I=>I.value==="cedh");S&&(S.checked=!0,L(),f&&d())}}}),L(),e.querySelector(".remove-player-btn").addEventListener("click",()=>{this.playerRowsContainer.removeChild(e),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.updatePlayerNumbers()});let P=e.querySelector(".player-name");P.addEventListener("input",()=>{P.dataset.touched="true",!P.value.trim()&&P.dataset.touched==="true"?P.classList.add("input-error"):P.classList.remove("input-error"),this.clearDuplicateErrorsOnInput()}),e.querySelector(".group-select").addEventListener("change",()=>{this.playerManager.handleGroupChange(this.playerRowsContainer)}),this.playerRowsContainer.appendChild(e),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.updatePlayerNumbers();let x=document.getElementById("bracket-radio").checked,M=e.querySelector(".power-levels"),C=e.querySelector(".bracket-levels");x?(M.style.display="none",C.style.display="block"):(M.style.display="block",C.style.display="none")}bulkAddPlayers(r){for(let e=0;e<r;e++)this.addPlayerRow()}initializeKeyboardShortcuts(){document.addEventListener("keydown",r=>{if(r.ctrlKey&&r.key==="Enter"){r.preventDefault(),this.addPlayerRow();let e=this.playerRowsContainer.querySelectorAll(".player-row"),o=e[e.length-1].querySelector(".player-name");o&&o.focus()}})}cleanupBottomDisplayButton(){if(this.displayModeBtnBottom){let r=this.displayModeBtnBottom.parentNode;r&&r.parentNode&&r.parentNode.removeChild(r),this.displayModeBtnBottom=null}}generatePods(){this.triggerValidationForAllFields(),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.playerManager.handleGroupChange(this.playerRowsContainer);let r=[],e=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),n=!1;e.forEach(d=>{d.querySelector(".player-name").classList.remove("name-duplicate-error","name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5")});for(let d of e){let y=this.playerManager.getPlayerFromRow(d);y?r.push(y):n=!0}let o=new Map;e.forEach(d=>{let P=d.querySelector(".player-name").value.trim().toLowerCase();P&&(o.has(P)||o.set(P,[]),o.get(P).push(d))});let a=[],t=1;if(o.forEach((d,y)=>{if(d.length>1){a.push(y);let P=`name-duplicate-error-${t}`;d.forEach(T=>{T.querySelector(".player-name").classList.add(P)}),t=t%5+1,n=!0}}),n){let d="Please fix the errors before generating pods.";a.length>0&&(d+=`

Duplicate player names found: ${a.join(", ")}`),alert(d);return}let s=new Map;this.playerManager.getGroups().forEach((d,y)=>{let P=d.reduce((E,x)=>E+x.power,0),T=Math.round(P/d.length*2)/2;s.set(y,{id:y,players:d,averagePower:T,size:d.length})});let l=new Set([...this.playerManager.getGroups().values()].flat().map(d=>d.id)),p=[...r.filter(d=>!l.has(d.id))];s.forEach(d=>{p.push({id:d.id,players:d.players,averagePower:d.averagePower,size:d.size})});let c=r.length;if(c<3){alert("You need at least 3 players to form a pod.");return}let g=j()==="avoid-five"?W(c):G(c),k=K();if(typeof window<"u"&&(window.location.protocol==="file:"||window.__playwright!==void 0||window.playwright!==void 0)){let d=r.map(P=>P.name).join(""),y=Array.from(d).reduce((P,T)=>P+T.charCodeAt(0),0);this.podGenerator.setShuffleSeed(y)}else this.podGenerator.setShuffleSeed(null);let L=this.podGenerator.generatePodsWithBacktracking(p,g,k),w=L.pods,B=L.unassigned;this.currentPods=[...w],this.currentUnassigned=[...B],this.renderPods(w,B)}renderPods(r,e=[]){if(this.currentPods=[...r],this.currentUnassigned=[...e],this.dragDropManager.setCurrentPods(this.currentPods,this.currentUnassigned),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",r.length===0){this.outputSection.textContent="Could not form pods with the given players.",this.displayModeBtn.style.display="none";return}this.displayModeBtn.style.display="inline-block";let n=Math.ceil(Math.sqrt(r.length)),o=document.createElement("div");if(o.classList.add("pods-container"),o.style.gridTemplateColumns=`repeat(${n}, 1fr)`,o.style.gridTemplateRows=`repeat(${n}, 1fr)`,r.forEach((t,s)=>{let l=document.createElement("div");l.classList.add("pod",`pod-color-${s%10}`),l.dataset.podIndex=s.toString(),l.addEventListener("dragover",this.dragDropManager.handleDragOver),l.addEventListener("drop",this.dragDropManager.handleDrop),l.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let i=document.createElement("h3"),p=document.getElementById("bracket-radio");if(p&&p.checked){let g=this.calculateValidBracketRange(t);i.textContent=`Pod ${s+1} (Bracket: ${g})`}else{let g=N(t);i.textContent=`Pod ${s+1} (Power: ${g})`}l.appendChild(i);let m=document.createElement("ul");t.players.forEach((g,k)=>{if("players"in g){let v=document.createElement("li");v.classList.add("pod-group"),v.draggable=!0,v.dataset.itemType="group",v.dataset.itemId=g.id,v.dataset.podIndex=s.toString(),v.dataset.itemIndex=k.toString(),v.addEventListener("dragstart",this.dragDropManager.handleDragStart),v.addEventListener("dragend",this.dragDropManager.handleDragEnd);let L=document.getElementById("bracket-radio"),w=L&&L.checked;w?v.innerHTML=`<strong>Group ${g.id.split("-")[1]}:</strong>`:v.innerHTML=`<strong>Group ${g.id.split("-")[1]} (Avg Power: ${g.averagePower}):</strong>`;let B=document.createElement("ul");g.players.forEach(d=>{let y=document.createElement("li");if(w&&d.bracketRange)y.textContent=`${d.name} (B: ${d.bracketRange})`;else{let P=$(t),T=q(d,P);y.innerHTML=`${d.name} (P: ${T})`}B.appendChild(y)}),v.appendChild(B),m.appendChild(v)}else{let v=document.createElement("li");v.classList.add("pod-player"),v.draggable=!0,v.dataset.itemType="player",v.dataset.itemId=g.id.toString(),v.dataset.podIndex=s.toString(),v.dataset.itemIndex=k.toString(),v.addEventListener("dragstart",this.dragDropManager.handleDragStart),v.addEventListener("dragend",this.dragDropManager.handleDragEnd);let L=document.getElementById("bracket-radio");if(L&&L.checked&&g.bracketRange)v.textContent=`${g.name} (B: ${g.bracketRange})`;else{let B=$(t),d=q(g,B);v.innerHTML=`${g.name} (P: ${d})`}m.appendChild(v)}}),l.appendChild(m),o.appendChild(l)}),r.length>0){let t=document.createElement("div");t.classList.add("pod","new-pod","new-pod-target"),t.style.borderColor="#4CAF50",t.style.backgroundColor="#1f2a1f",t.style.borderStyle="dashed",t.dataset.podIndex="new-pod",t.addEventListener("dragover",this.dragDropManager.handleDragOver),t.addEventListener("drop",this.dragDropManager.handleDrop),t.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let s=document.createElement("h3");s.textContent="Create New Pod",s.style.color="#4CAF50",t.appendChild(s);let l=document.createElement("p");l.textContent="Drag players or groups here to create a new pod",l.style.color="#999",l.style.fontStyle="italic",l.style.textAlign="center",l.style.margin="20px 0",t.appendChild(l),o.appendChild(t)}if(e.length>0){let t=document.createElement("div");t.classList.add("pod","unassigned-pod"),t.style.borderColor="#ff6b6b",t.style.backgroundColor="#2a1f1f",t.dataset.podIndex="unassigned",t.addEventListener("dragover",this.dragDropManager.handleDragOver),t.addEventListener("drop",this.dragDropManager.handleDrop),t.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let s=document.createElement("h3");s.textContent="Unassigned Players",s.style.color="#ff6b6b",t.appendChild(s);let l=document.createElement("ul");e.forEach((i,p)=>{if("players"in i){let c=document.createElement("li");c.classList.add("pod-group"),c.draggable=!0,c.dataset.itemType="group",c.dataset.itemId=i.id,c.dataset.podIndex="unassigned",c.dataset.itemIndex=p.toString(),c.addEventListener("dragstart",this.dragDropManager.handleDragStart),c.addEventListener("dragend",this.dragDropManager.handleDragEnd);let m=document.getElementById("bracket-radio"),g=m&&m.checked;g?c.innerHTML=`<strong>Group ${i.id.split("-")[1]}:</strong>`:c.innerHTML=`<strong>Group ${i.id.split("-")[1]} (Avg Power: ${i.averagePower}):</strong>`;let k=document.createElement("ul");i.players.forEach(v=>{let L=document.createElement("li");g&&v.bracketRange?L.textContent=`${v.name} (B: ${v.bracketRange})`:L.textContent=`${v.name} (P: ${v.powerRange})`,k.appendChild(L)}),c.appendChild(k),l.appendChild(c)}else{let c=document.createElement("li");c.classList.add("pod-player"),c.draggable=!0,c.dataset.itemType="player",c.dataset.itemId=i.id.toString(),c.dataset.podIndex="unassigned",c.dataset.itemIndex=p.toString(),c.addEventListener("dragstart",this.dragDropManager.handleDragStart),c.addEventListener("dragend",this.dragDropManager.handleDragEnd);let m=document.getElementById("bracket-radio");m&&m.checked&&i.bracketRange?c.textContent=`${i.name} (B: ${i.bracketRange})`:c.textContent=`${i.name} (P: ${i.powerRange})`,l.appendChild(c)}}),t.appendChild(l),o.appendChild(t)}this.outputSection.appendChild(o);let a=document.querySelector(".help-section");if(a&&a.parentNode){let t=document.createElement("div");t.style.textAlign="center",t.style.marginTop="20px",t.style.marginBottom="20px",this.displayModeBtnBottom=this.displayModeBtn.cloneNode(!0),this.displayModeBtnBottom.id="display-mode-btn-bottom",this.displayModeBtnBottom.style.display="inline-block",this.displayModeBtnBottom.addEventListener("click",()=>this.displayModeManager.enterDisplayMode(this.currentPods)),t.appendChild(this.displayModeBtnBottom),a.parentNode.insertBefore(t,a)}}captureCurrentPlayerData(){let r=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),e=[];r.forEach(o=>{let a=o.querySelector(".player-name"),t=o.querySelector(".group-select"),s=o.querySelectorAll('.power-checkbox input[type="checkbox"]'),l=[];s.forEach(c=>{c.checked&&l.push(c.value)});let i=o.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),p=[];i.forEach(c=>{c.checked&&p.push(c.value)}),e.push({name:a.value.trim(),groupValue:t.value,createdGroupId:t.dataset.createdGroupId,selectedPowers:l,selectedBrackets:p})});let n={noLeniency:document.getElementById("no-leniency-radio")?.checked||!1,leniency:document.getElementById("leniency-radio")?.checked||!1,superLeniency:document.getElementById("super-leniency-radio")?.checked||!1,bracket:document.getElementById("bracket-radio")?.checked||!1};return{players:e,leniencySettings:n,currentPods:[...this.currentPods],currentUnassigned:[...this.currentUnassigned]}}resetAllWithConfirmation(){if(!Array.from(this.playerRowsContainer.querySelectorAll(".player-row")).some(o=>{if(o.querySelector(".player-name").value.trim())return!0;let t=o.querySelectorAll('input[type="checkbox"]');return Array.from(t).some(s=>s.checked)})){this.resetAll();return}confirm(`Are you sure you want to reset all player data?

This will clear all players, groups, and generated pods. You will be able to undo this action immediately after.`)&&(this.lastResetData=this.captureCurrentPlayerData(),this.resetAll(),this.showUndoResetButton())}showUndoResetButton(){let r=document.getElementById("undo-reset-btn");r&&r.remove();let e=document.createElement("button");e.id="undo-reset-btn",e.textContent="Undo Reset",e.style.marginLeft="10px",e.style.backgroundColor="#28a745",e.style.color="white",e.style.border="none",e.style.padding="8px 16px",e.style.borderRadius="4px",e.style.cursor="pointer",e.style.fontSize="14px",e.addEventListener("click",()=>this.undoReset());let n=document.getElementById("reset-all-btn");n.parentNode.insertBefore(e,n.nextSibling),setTimeout(()=>{document.getElementById("undo-reset-btn")&&(e.remove(),this.lastResetData=null)},3e4)}undoReset(){if(!this.lastResetData){alert("No reset data available to restore.");return}this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds();let r=this.lastResetData.leniencySettings;r.noLeniency&&(document.getElementById("no-leniency-radio").checked=!0),r.leniency&&(document.getElementById("leniency-radio").checked=!0),r.superLeniency&&(document.getElementById("super-leniency-radio").checked=!0),r.bracket&&(document.getElementById("bracket-radio").checked=!0),this.lastResetData.players.forEach(o=>{this.addPlayerRow();let a=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),t=a[a.length-1],s=t.querySelector(".player-name");s.value=o.name;let l=t.querySelector(".group-select");o.createdGroupId&&(l.dataset.createdGroupId=o.createdGroupId),l.value=o.groupValue}),this.isRestoring=!0;let e=document.getElementById("no-leniency-radio"),n=document.getElementById("bracket-radio");if(e&&n){let o=new Event("change",{bubbles:!0});r.bracket?n.dispatchEvent(o):e.dispatchEvent(o)}setTimeout(()=>{this.restorePlayerSelections()},200)}restorePlayerSelections(){if(!this.lastResetData)return;this.lastResetData.players.forEach((e,n)=>{let a=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[n];if(!a)return;e.selectedPowers.forEach(l=>{let i=a.querySelector(`.power-checkbox input[type="checkbox"][value="${l}"]`);i&&(i.checked=!0)}),e.selectedBrackets.forEach(l=>{let i=a.querySelector(`.bracket-checkbox input[type="checkbox"][value="${l}"]`);i&&(i.checked=!0)}),a.querySelectorAll('input[type="checkbox"]').forEach(l=>{l.checked&&l.dispatchEvent(new Event("change",{bubbles:!0}))}),this.updateButtonTextsForRow(a);let s=a.querySelector(".group-select");e.groupValue&&e.groupValue!=="no-group"&&e.groupValue.startsWith("group-")&&(e.createdGroupId?s.dataset.createdGroupId=e.createdGroupId:s.dataset.createdGroupId=e.groupValue,s.value="new-group",s.dispatchEvent(new Event("change",{bubbles:!0})))}),this.lastResetData.players.forEach((e,n)=>{let t=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[n].querySelector(".group-select");e.groupValue&&e.groupValue!=="no-group"&&e.groupValue.startsWith("group-")&&(t.value=e.groupValue,t.dispatchEvent(new Event("change",{bubbles:!0})))}),this.currentPods=[...this.lastResetData.currentPods],this.currentUnassigned=[...this.lastResetData.currentUnassigned],(this.currentPods.length>0||this.currentUnassigned.length>0)&&this.renderPods(this.currentPods,this.currentUnassigned),this.playerManager.handleGroupChange(this.playerRowsContainer),this.isRestoring=!1;let r=document.getElementById("undo-reset-btn");r&&r.remove(),this.lastResetData=null,alert("Reset has been undone successfully!")}resetAll(){this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.displayModeBtn.style.display="none",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds(),this.currentPods=[],this.currentUnassigned=[];let r=document.getElementById("no-leniency-radio");r.checked=!0;for(let e=0;e<4;e++)this.addPlayerRow()}clearDuplicateErrorsOnInput(){let r=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),e=new Map;r.forEach(o=>{let a=o.querySelector(".player-name"),t=a.value.trim().toLowerCase();t&&(e.has(t)||e.set(t,[]),e.get(t).push(a))}),r.forEach(o=>{o.querySelector(".player-name").classList.remove("name-duplicate-error","name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5")});let n=1;e.forEach((o,a)=>{if(o.length>1){let t=`name-duplicate-error-${n}`;o.forEach(s=>{s.classList.add(t)}),n=n%5+1}})}initializeRankingModeToggle(){let r=document.getElementById("power-level-radio"),e=document.getElementById("bracket-radio"),n=()=>{let o=e.checked;if(o){document.body.classList.add("bracket-mode");let t=document.getElementById("no-leniency-radio");t&&(t.checked=!0)}else document.body.classList.remove("bracket-mode");this.playerRowsContainer.querySelectorAll(".player-row").forEach(t=>{let s=t.querySelector(".power-levels"),l=t.querySelector(".bracket-levels");o?(s.style.display="none",l.style.display="block"):(s.style.display="block",l.style.display="none"),this.isRestoring||this.clearAllSelections(t)})};r.addEventListener("change",n),e.addEventListener("change",n),n()}clearAllSelections(r){r.querySelectorAll('.power-checkbox input[type="checkbox"]').forEach(t=>t.checked=!1),r.querySelectorAll('.bracket-checkbox input[type="checkbox"]').forEach(t=>t.checked=!1);let o=r.querySelector(".power-selector-btn"),a=r.querySelector(".bracket-selector-btn");o&&(o.textContent="Select Power Levels",o.classList.remove("has-selection")),a&&(a.textContent="Select Brackets",a.classList.remove("has-selection"))}initializeHelpModal(){let r=document.getElementById("help-modal");r.querySelector(".help-close").addEventListener("click",()=>this.hideHelpModal()),r.addEventListener("click",n=>{n.target===r&&this.hideHelpModal()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&r.style.display==="block"&&this.hideHelpModal()})}showHelpModal(){let r=document.getElementById("help-modal");r.style.display="block",document.body.style.overflow="hidden"}hideHelpModal(){let r=document.getElementById("help-modal");r.style.display="none",document.body.style.overflow=""}calculateValidBracketRange(r){let e=r.players.flatMap(t=>"players"in t?t.players:[t]);if(e.length===0)return"Unknown";let n=[],o=new Set;e.forEach(t=>{t.brackets&&t.brackets.forEach(s=>o.add(s))});for(let t of o)e.every(l=>l.brackets&&l.brackets.includes(t))&&n.push(t);let a=["1","2","3","4","cedh"];if(n.sort((t,s)=>a.indexOf(t)-a.indexOf(s)),n.length===0)return"Unknown";if(n.length===1)return n[0];{let t=n.filter(l=>l!=="cedh");return t.length>1&&t.every((l,i)=>{if(i===0)return!0;let p=parseInt(l),c=parseInt(t[i-1]);return p===c+1})&&t.length===n.length&&n.length>1?`${n[0]}-${n[n.length-1]}`:n.join(", ")}}triggerValidationForAllFields(){Array.from(this.playerRowsContainer.querySelectorAll(".player-row")).forEach(e=>{let n=e.querySelector(".player-name");n.value.trim()||n.classList.add("input-error");let a=e.querySelector(".power-selector-btn"),t=e.querySelector(".bracket-selector-btn");if(a&&(a.dataset.validationTriggered="true"),t&&(t.dataset.validationTriggered="true"),document.getElementById("bracket-radio").checked){let i=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]');Array.from(i).some(c=>c.checked)||t.classList.add("error")}else{let i=e.querySelectorAll('.power-checkbox input[type="checkbox"]');Array.from(i).some(c=>c.checked)||a.classList.add("error")}})}updateButtonTextsForRow(r){let e=r.querySelectorAll('.power-checkbox input[type="checkbox"]'),n=r.querySelector(".power-selector-btn");if(n){let t=[];if(e.forEach(s=>{s.checked&&t.push(parseFloat(s.value))}),t.length===0)n.textContent="Select Power Levels",n.classList.remove("has-selection");else{t.sort((l,i)=>l-i);let s;if(t.length===1)s=`Power: ${t[0]}`;else{let l=t[0],i=t[t.length-1];t.every((c,m)=>{if(m===0)return!0;let g=c-t[m-1];return g===.5||g===1})&&t.length>2?s=`Power: ${l}-${i}`:t.length<=4?s=`Power: ${t.join(", ")}`:s=`Power: ${l}-${i} (${t.length} levels)`}n.textContent=s,n.classList.add("has-selection")}}let o=r.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),a=r.querySelector(".bracket-selector-btn");if(a){let t=[];if(o.forEach(s=>{s.checked&&t.push(s.value)}),t.length===0)a.textContent="Select Brackets",a.classList.remove("has-selection");else{let s;t.length===1?s=`Bracket: ${t[0]}`:s=`Brackets: ${t.join(", ")}`,a.textContent=s,a.classList.add("has-selection")}}}updatePlayerNumbers(){this.playerRowsContainer.querySelectorAll(".player-row").forEach((e,n)=>{let o=e.querySelector(".player-number");o&&(o.textContent=(n+1).toString())})}};function X(){let e=Math.floor(Math.random()*360),n=25,o=[];for(let s=0;s<50;s++){let i=(e+s*137.5)%360;o.push(Math.round(i))}let a="";for(let s=1;s<=50;s++){let l=o[s-1],i=70+Math.floor(Math.random()*20),p=50,c=28+Math.floor(Math.random()*8);a+=`
.player-row .group-select.group-${s} {
    border-color: hsl(${l}, ${i}%, ${p}%) !important;
    background-color: hsl(${l}, ${i}%, ${c}%) !important;
}`,a+=`
.group-select option[value="group-${s}"] {
    background-color: hsl(${l}, ${i}%, ${c}%);
}`}let t=document.createElement("style");t.id="dynamic-group-colors",t.textContent=a,document.head.appendChild(t)}document.addEventListener("DOMContentLoaded",()=>{X(),new U().resetAll()});})();
