"use strict";(()=>{function G(m){if(m<3)return[];if(m===3)return[3];if(m===4)return[4];if(m===5)return[5];if(m===6)return[3,3];if(m===7)return[4,3];if(m===8)return[4,4];if(m===9)return[3,3,3];if(m===10)return[5,5];let t=Math.floor(m/4),e=m%4;return e===0?Array(t).fill(4):e===1?t>=2?[...Array(t-2).fill(4),5,4]:[3,3,3,2]:e===2?t>=1?[...Array(t-1).fill(4),3,3]:[3,3,3,3]:e===3?[...Array(t).fill(4),3]:[]}function W(m){if(m<3)return[];if(m<9)return G(m);if(m===9)return[3,3,3];if(m===10)return[4,3,3];if(m===11)return[4,4,3];if(m===12)return[4,4,4];if(m===13)return[4,3,3,3];if(m===14)return[4,4,3,3];if(m===15)return[4,4,4,3];let t=[],e=m;for(;e>=7;)t.push(4),e-=4;if(e===6)t.push(3,3);else if(e===5)if(t.length>0)t.pop(),e+=4,t.push(3,3,3);else return G(m);else e===4?t.push(4):e===3&&t.push(3);return t.sort((r,s)=>s-r)}function j(){let m=document.getElementById("avoid-five-pods-radio");return m&&m.checked?"avoid-five":"balanced"}function K(){let m=document.getElementById("bracket-radio");if(m&&m.checked)return{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0};let t=document.getElementById("no-leniency-radio"),e=document.getElementById("leniency-radio");return document.getElementById("super-leniency-radio").checked?{allowLeniency:!0,allowSuperLeniency:!0,maxTolerance:1}:e.checked?{allowLeniency:!0,allowSuperLeniency:!1,maxTolerance:.5}:{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0}}function _(m){let t=[];if(m.forEach(s=>{if(s.checked){let a=parseFloat(s.value);isNaN(a)||t.push(a)}}),t.length===0)return{availablePowers:[],powerRange:"",averagePower:0};t.sort((s,a)=>s-a);let e;t.length===1?e=t[0].toString():e=t.join(", ");let r=t.reduce((s,a)=>s+a,0)/t.length;return{availablePowers:t,powerRange:e,averagePower:Math.round(r*2)/2}}function Q(){let m=document.querySelector("#leniency-radio");return document.querySelector("#super-leniency-radio")?.checked?1:m?.checked?.5:0}function N(m){let t=m.players.flatMap(a=>"players"in a?a.players:[a]);if(t.length===0)return m.power.toString();let e=Q(),r=[],s=new Set;t.forEach(a=>{a.availablePowers.forEach(n=>s.add(n))});for(let a of s)t.every(o=>o.availablePowers.some(l=>Math.abs(a-l)<=e))&&r.push(a);return r.sort((a,n)=>a-n),r.length===0?m.power.toString():r.length===1?r[0].toString():r.every((n,o)=>o===0||n-r[o-1]<=.5)&&r.length>2?`${r[0]}-${r[r.length-1]}`:r.join(", ")}function q(m,t){let e=[];if(Array.isArray(m.availablePowers))e=m.availablePowers;else if(typeof m.powerRange=="string")if(m.powerRange.includes("-")){let[s,a]=m.powerRange.split("-").map(n=>parseFloat(n.trim()));for(let n=s;n<=a;n+=.5)e.push(n)}else e=m.powerRange.split(",").map(s=>parseFloat(s.trim()));return e.map(s=>t.includes(s)?`<span class="power-highlight">${s}</span>`:s.toString()).join(", ")}function Y(m,t){let e=[];if(Array.isArray(m.availableBrackets))e=m.availableBrackets;else if(typeof m.bracketRange=="string")if(m.bracketRange.includes("-")){let[s,a]=m.bracketRange.split("-").map(l=>l.trim()),n=parseInt(s),o=parseInt(a);if(!isNaN(n)&&!isNaN(o))for(let l=n;l<=o;l++)e.push(l.toString());else e=[s,a]}else e=m.bracketRange.split(",").map(s=>s.trim());return e.map(s=>t.includes(s)?`<span class="bracket-highlight">${s}</span>`:s.toString()).join(", ")}function $(m){let t=m.players.flatMap(n=>"players"in n?n.players:[n]);if(t.length===0)return[];let e=new Map,r=new Set;if(t.forEach(n=>{n.availablePowers.length===1&&r.add(n.availablePowers[0]),n.availablePowers.forEach(o=>{e.set(o,(e.get(o)||0)+1)})}),e.size===0)return[];let s=Math.max(...e.values()),a=[];for(let[n,o]of e.entries())(o===s||r.has(n))&&a.push(n);return a.sort((n,o)=>n-o),a}var z=class{constructor(){this.groups=new Map;this.nextPlayerId=0;this.nextGroupId=1;this.availableColors=[];this.groupColorAssignments=new Map;this.initializeAvailableColors()}initializeAvailableColors(){this.availableColors=Array.from({length:50},(t,e)=>e+1),this.shuffleArray(this.availableColors)}shuffleArray(t){for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}}assignRandomColor(t){if(this.groupColorAssignments.has(t))return this.groupColorAssignments.get(t);this.availableColors.length===0&&this.initializeAvailableColors();let e=this.availableColors.pop();return this.groupColorAssignments.set(t,e),e}releaseColor(t){let e=this.groupColorAssignments.get(t);e&&(this.availableColors.push(e),this.groupColorAssignments.delete(t))}getNextPlayerId(){return this.nextPlayerId++}resetPlayerIds(){this.nextPlayerId=0}getNextGroupId(){let t=new Set;document.querySelectorAll(".group-select").forEach(r=>{if(r.value.startsWith("group-")){let s=parseInt(r.value.split("-")[1]);isNaN(s)||t.add(s)}if(r.value==="new-group"&&r.dataset.createdGroupId&&r.dataset.createdGroupId.startsWith("group-")){let s=parseInt(r.dataset.createdGroupId.split("-")[1]);isNaN(s)||t.add(s)}});for(let r=1;r<=50;r++)if(!t.has(r))return r;return this.nextGroupId++}resetGroupIds(){this.nextGroupId=1}getGroups(){return this.groups}clearGroups(){this.groups.clear()}getPlayerFromRow(t){let e=t.querySelector(".player-name");e.classList.remove("input-error");let r=e.value.trim();if(!r)return e.classList.add("input-error"),null;if(document.getElementById("bracket-radio").checked){let n=t.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),o=[];if(n.forEach(p=>{p.checked&&o.push(p.value)}),o.length===0)return t.querySelector(".bracket-selector-btn").classList.add("error"),null;t.querySelector(".bracket-selector-btn").classList.remove("error");let l={1:1,2:2,3:3,4:4,cedh:10},i=o.map(p=>l[p]),u=i.reduce((p,d)=>p+d,0)/i.length;return{id:parseInt(t.dataset.playerId),name:r,power:Math.round(u*2)/2,availablePowers:i,powerRange:o.join(", "),brackets:o,bracketRange:o.join(", "),rowElement:t}}else{let n=t.querySelectorAll('.power-checkbox input[type="checkbox"]'),o=_(n);return o.availablePowers.length===0?(t.querySelector(".power-selector-btn").classList.add("error"),null):(t.querySelector(".power-selector-btn").classList.remove("error"),{id:parseInt(t.dataset.playerId),name:r,power:o.averagePower,availablePowers:o.availablePowers,powerRange:o.powerRange,rowElement:t})}}handleGroupChange(t){this.groups.clear();let e=Array.from(t.querySelectorAll(".player-row"));e.forEach(s=>{for(let a=1;a<=50;a++)s.querySelector(".group-select").classList.remove(`group-${a}`)});let r=new Set;e.forEach(s=>{let a=s.querySelector(".group-select");a.dataset.createdGroupId?r.add(a.dataset.createdGroupId):a.value.startsWith("group-")&&r.add(a.value)}),e.forEach(s=>{let a=s.querySelector(".group-select"),n="";if(a.value==="new-group"){a.dataset.createdGroupId?n=a.dataset.createdGroupId:(n=`group-${this.getNextGroupId()}`,r.add(n),a.dataset.createdGroupId=n);let o=this.getPlayerFromRow(s);o&&(this.groups.has(n)||this.groups.set(n,[]),this.groups.get(n).push(o))}else if(a.value.startsWith("group-")){n=a.value;let o=this.getPlayerFromRow(s);o&&(this.groups.has(a.value)||this.groups.set(a.value,[]),this.groups.get(a.value).push(o))}else a.dataset.createdGroupId&&delete a.dataset.createdGroupId;if(n){let o=parseInt(n.split("-")[1]);o>=1&&o<=50&&a.classList.add(`group-${o}`)}}),this.cleanupUnusedGroups(r),this.updateAllGroupDropdowns(t)}updateAllGroupDropdowns(t){let e=new Set,r=Array.from(t.querySelectorAll(".player-row"));r.forEach(s=>{let a=s.querySelector(".group-select");a.value==="new-group"&&a.dataset.createdGroupId?e.add(a.dataset.createdGroupId):a.value.startsWith("group-")&&e.add(a.value)}),r.forEach(s=>{let a=s.querySelector(".group-select"),n=a.value,o=a.dataset.createdGroupId;if(Array.from(a.options).forEach(i=>{i.value.startsWith("group-")&&a.remove(i.index)}),e.forEach(i=>{let u=i.split("-")[1],p=new Option(`Group ${u}`,i);a.add(p)}),o&&e.has(o)&&(n==="new-group"||n==="no-group")){a.value=o;let i=parseInt(o.split("-")[1]);i>=1&&i<=50&&a.classList.add(`group-${i}`)}else if(n.startsWith("group-")&&e.has(n)){a.value=n;let i=parseInt(n.split("-")[1]);i>=1&&i<=50&&a.classList.add(`group-${i}`)}else{a.value="no-group";for(let i=1;i<=50;i++)a.classList.remove(`group-${i}`)}})}arePlayersCompatible(t,e,r){return t.availablePowers.some(a=>e.availablePowers.some(n=>Math.abs(a-n)<.01))?!0:r.allowLeniency?t.availablePowers.some(a=>e.availablePowers.some(n=>Math.abs(a-n)<=r.maxTolerance)):!1}findAllCommonPowers(t,e){return t.length===0?[]:[...new Set(t.flatMap(s=>s.availablePowers))].sort((s,a)=>s-a).filter(s=>t.every(a=>a.availablePowers.some(n=>{let o=Math.abs(n-s);return o<.01||e.allowLeniency&&o<=e.maxTolerance})))}findBestCommonPowerLevel(t){if(t.length===0)return null;let e=new Map;for(let a of t)for(let n of a.availablePowers)e.set(n,(e.get(n)||0)+1);if(e.size===0)return null;let r=t[0].availablePowers[0],s=0;for(let[a,n]of e.entries())n>s&&(s=n,r=a);return r}calculatePodPower(t){if(t.length===0)return 0;let e=t.reduce((r,s)=>{if("players"in s)return r+s.averagePower;{let a=s.powerRange.split(",").map(o=>parseFloat(o.trim())),n=a.reduce((o,l)=>o+l,0)/a.length;return r+n}},0);return Math.round(e/t.length*10)/10}cleanupUnusedGroups(t){Array.from(this.groupColorAssignments.keys()).forEach(a=>{t.has(a)||this.releaseColor(a)}),Array.from(this.groups.keys()).forEach(a=>{t.has(a)||this.groups.delete(a)}),document.querySelectorAll(".group-select").forEach(a=>{let n=a.dataset.createdGroupId;n&&!t.has(n)&&delete a.dataset.createdGroupId})}};var F=class{constructor(){this.shuffleSeed=null;this.sizeCache=new Map}setShuffleSeed(t){this.shuffleSeed=t,this.sizeCache.clear()}seededRandom(t){let e=t;return()=>(e=e*1103515245+12345&2147483647,e/2147483647)}shuffleArray(t){let e=[...t],r;this.shuffleSeed!==null?r=this.seededRandom(this.shuffleSeed):r=Math.random;for(let s=e.length-1;s>0;s--){let a=Math.floor(r()*(s+1));[e[s],e[a]]=[e[a],e[s]]}return e}getItemSize(t){let e="players"in t?`group-${t.id}`:`player-${t.id}`;if(!this.sizeCache.has(e)){let r="players"in t?t.size:1;this.sizeCache.set(e,r)}return this.sizeCache.get(e)}getItemId(t){return"players"in t?t.id:t.id.toString()}generatePodsWithBacktracking(t,e,r){let s=this.shuffleArray(t),a=s.reduce((i,u)=>i+("size"in u?u.size:1),0);if(a>=3&&a<=5){let i=s.flatMap(p=>"players"in p?p.players:[p]),u=this.findBestCommonPowerLevel(i);return u!==null?{pods:[{players:s,power:u}],unassigned:[]}:{pods:[],unassigned:s}}let n=this.findOptimalPodAssignment(s,e,r),o=new Set;for(let i of n)for(let u of i.players)"players"in u?o.add(u.id):o.add(u.id.toString());let l=s.filter(i=>"players"in i?!o.has(i.id):!o.has(i.id.toString()));return{pods:n,unassigned:l}}findOptimalPodAssignment(t,e,r){return this.optimizeVirtualPlayerAssignmentUnified(t,e,r)}optimizeVirtualPlayerAssignmentUnified(t,e,r){if(t.length===0)return[];let s=this.createVirtualPlayersUnified(t),a=new Map;for(let o of s)a.has(o.powerLevel)||a.set(o.powerLevel,[]),a.get(o.powerLevel).push(o);let n={pods:[],totalPods:0};return r.allowLeniency?this.backtrackVirtualPlayersWithLeniencyUnified(s,e,r.maxTolerance,[],new Set,e,n):this.backtrackVirtualPlayersUnified(Array.from(a.entries()),[],new Set,e,n),n.pods}createVirtualPlayersUnified(t){let e=[];for(let r of t)if("players"in r){let s=r.players.flatMap(u=>u.availablePowers),a=Math.min(...s),n=Math.max(...s),l=[r.averagePower,a,n],i=[...new Set(l)];for(let u of i)e.push({item:r,powerLevel:u})}else for(let s of r.availablePowers)e.push({item:r,powerLevel:s});return e}backtrackVirtualPlayersUnified(t,e,r,s,a){if(s.length===0){e.length>a.totalPods&&(a.pods=[...e],a.totalPods=e.length);return}if(e.length+s.length<=a.totalPods)return;let n=s[0],o=s.slice(1);for(let[l,i]of t){let u=i.filter(b=>{let f=this.getItemId(b.item);return!r.has(f)}),p=0;for(let b=0;b<u.length;b++)p+=this.getItemSize(u[b].item);let d=Math.max(3,n);if(p>=d){let b=u.sort((c,k)=>{let g=this.getItemSize(c.item);return this.getItemSize(k.item)-g}),f=[],B=new Set,y=0;for(let c of b){let k=this.getItemId(c.item),g=this.getItemSize(c.item);if(!B.has(k)&&y+g<=n&&(f.push(c),B.add(k),y+=g,y===n))break}if(y>=3){let c=f.map(E=>E.item),k={players:c,power:l},g=new Set(r);for(let E of c){let P="players"in E?E.id:E.id.toString();g.add(P)}this.backtrackVirtualPlayersUnified(t,[...e,k],g,o,a)}}}this.backtrackVirtualPlayersUnified(t,e,r,o,a)}backtrackVirtualPlayersWithLeniencyUnified(t,e,r,s,a,n,o){if(n.length===0){s.length>o.totalPods&&(o.pods=[...s],o.totalPods=s.length);return}if(s.length+n.length<=o.totalPods)return;let l=n[0],i=n.slice(1),u=t.filter(d=>{let b="players"in d.item?d.item.id:d.item.id.toString();return!a.has(b)}),p=[...new Set(u.map(d=>d.powerLevel))].sort((d,b)=>d-b);for(let d of p){let b=u.filter(g=>("players"in g.item,Math.abs(g.powerLevel-d)<=r)),f=new Map;for(let g of b){let E="players"in g.item?g.item.id:g.item.id.toString();if(!f.has(E))f.set(E,g);else{let P=f.get(E),R=Math.abs(P.powerLevel-d);Math.abs(g.powerLevel-d)<R&&f.set(E,g)}}let y=Array.from(f.values()).sort((g,E)=>{if("players"in g.item&&"players"in E.item){let P=Math.abs(g.powerLevel-g.item.averagePower)<.01,R=Math.abs(E.powerLevel-E.item.averagePower)<.01;return P&&!R?-1:!P&&R?1:Math.abs(g.powerLevel-d)-Math.abs(E.powerLevel-d)}return"players"in g.item&&!("players"in E.item)?1:!("players"in g.item)&&"players"in E.item?-1:Math.abs(g.powerLevel-d)-Math.abs(E.powerLevel-d)}),c=0;for(let g=0;g<y.length;g++)c+=this.getItemSize(y[g].item);let k=Math.max(3,l);if(c>=k){let g=y.sort((L,C)=>{let M=this.getItemSize(L.item);return this.getItemSize(C.item)-M}),E=[],P=new Set,R=0;for(let L of g){let C=this.getItemId(L.item),M=this.getItemSize(L.item);if(!P.has(C)&&R+M<=l&&(E.push(L),P.add(C),R+=M,R===l))break}if(R>=3){let L=E.map(h=>h.item);if(!this.isPodPowerSpreadValid(E,r))continue;let C=E.reduce((h,v)=>h+v.powerLevel,0)/E.length,M={players:L,power:Math.round(C*2)/2},x=new Set(a);for(let h of L){let v="players"in h?h.id:h.id.toString();x.add(v),t.forEach(w=>{let S="players"in w.item?w.item.id:w.item.id.toString();S===v&&x.add(S)})}this.backtrackVirtualPlayersWithLeniencyUnified(t,e,r,[...s,M],x,i,o)}}}this.backtrackVirtualPlayersWithLeniencyUnified(t,e,r,s,a,i,o)}isPodPowerSpreadValid(t,e){if(t.length===0)return!0;let r=t.map(o=>o.powerLevel),s=Math.min(...r);return Math.max(...r)-s<=e}findBestCommonPowerLevel(t){if(t.length===0)return null;let e=new Map;for(let a of t)for(let n of a.availablePowers)e.set(n,(e.get(n)||0)+1);if(e.size===0)return null;let r=t[0].availablePowers[0],s=0;for(let[a,n]of e.entries())n>s&&(s=n,r=a);return r}};var O=class{constructor(t,e){this.draggedElement=null;this.draggedItemData=null;this.currentPods=[];this.currentUnassigned=[];this.handleDragStart=t=>{let e=t.target;this.draggedElement=e,e.classList.add("dragging"),this.draggedItemData={type:e.dataset.itemType,id:e.dataset.itemId,podIndex:e.dataset.podIndex,itemIndex:e.dataset.itemIndex},t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/html",e.outerHTML)};this.handleDragEnd=t=>{t.target.classList.remove("dragging"),this.draggedElement=null,this.draggedItemData=null};this.handleDragOver=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move",t.currentTarget.classList.add("drag-over")};this.handleDragLeave=t=>{t.currentTarget.classList.remove("drag-over")};this.handleDrop=t=>{t.preventDefault();let e=t.currentTarget;if(e.classList.remove("drag-over"),!this.draggedItemData)return;let r=e.dataset.podIndex,s=this.draggedItemData.podIndex;r!==s&&this.moveItemBetweenPods(this.draggedItemData,r)};this.playerManager=t,this.onPodsChanged=e}setCurrentPods(t,e=[]){this.currentPods=[...t],this.currentUnassigned=[...e]}moveItemBetweenPods(t,e){let r=t.podIndex,s=parseInt(t.itemIndex),a=null;if(r==="unassigned")a=this.currentUnassigned[s],this.currentUnassigned.splice(s,1);else{let n=this.currentPods[parseInt(r)];a=n.players[s],n.players.splice(s,1),n.power=this.playerManager.calculatePodPower(n.players)}if(a){if(e==="unassigned")this.currentUnassigned.push(a);else if(e==="new-pod"){let n={players:[a],power:this.playerManager.calculatePodPower([a])};this.currentPods.push(n)}else{let n=this.currentPods[parseInt(e)];n.players.push(a),n.power=this.playerManager.calculatePodPower(n.players)}this.cleanupEmptyPods(),this.onPodsChanged(this.currentPods,this.currentUnassigned)}}cleanupEmptyPods(){this.currentPods=this.currentPods.filter(t=>t.players.length>0)}};var V=class{constructor(){this.isDisplayMode=!1;this.handleKeyDown=null;this.borderColors=["#FF6B6B","#4ECDC4","#45B7D1","#FFA726","#66BB6A","#AB47BC","#EF5350","#26A69A","#42A5F5","#FF7043","#9CCC65","#7E57C2","#EC407A","#29B6F6","#FFCA28","#8BC34A","#673AB7","#F06292","#00BCD4","#FFEB3B","#795548","#607D8B","#E91E63","#009688","#FF9800"]}getShuffledColors(t){let e=[...this.borderColors];for(let r=e.length-1;r>0;r--){let s=Math.floor(Math.random()*(r+1));[e[r],e[s]]=[e[s],e[r]]}if(t>e.length){let r=[];for(let s=0;s<t;s++)r.push(e[s%e.length]);return r}return e.slice(0,t)}calculateOptimalWidthForText(t){let e=0;for(let a of t)a===" "?e+=.3:/[iIl1]/.test(a)?e+=.4:/[mwMW]/.test(a)?e+=.8:/[A-Z]/.test(a)?e+=.7:e+=.6;let r=e*1.2,s=Math.min(85,Math.max(25,r/25*85));return Math.round(s)}calculateFontSizeForPod(t,e,r){let s=t*e,a=Math.ceil(Math.sqrt(r)),n=Math.ceil(r/a),o=(t-(a-1)*10)/a,l=(e-(n-1)*10)/n,i=Math.min(o,l),u=Math.min(i*.25,l*.35),p=Math.max(.9,1-(r-3)*.02),d=Math.max(24,Math.min(72,u*p));return`${Math.round(d)}px`}calculateValidBracketRange(t){let e=t.players.flatMap(n=>"players"in n?n.players:[n]);if(e.length===0)return"Unknown";let r=[],s=new Set;e.forEach(n=>{n.brackets&&n.brackets.forEach(o=>s.add(o))});for(let n of s)e.every(l=>l.brackets&&l.brackets.includes(n))&&r.push(n);let a=["1","2","3","4","cedh"];if(r.sort((n,o)=>a.indexOf(n)-a.indexOf(o)),r.length===0)return"Unknown";if(r.length===1)return r[0];{let n=r.filter(l=>l!=="cedh");return n.length>1&&n.every((l,i)=>{if(i===0)return!0;let u=parseInt(l),p=parseInt(n[i-1]);return u===p+1})&&n.length===r.length&&r.length>1?`${r[0]}-${r[r.length-1]}`:r.join(", ")}}getValidBracketsArrayForPod(t){let e=t.players.flatMap(o=>"players"in o?o.players:[o]);if(e.length===0)return[];let r=new Map;if(e.forEach(o=>{o.brackets&&o.brackets.forEach(l=>{r.set(l,(r.get(l)||0)+1)})}),r.size===0)return[];let s=Math.ceil(e.length/2),a=[];for(let[o,l]of r.entries())l>=s&&a.push(o);let n=["1","2","3","4","cedh"];return a.sort((o,l)=>n.indexOf(o)-n.indexOf(l)),a}enterDisplayMode(t){if(t.length===0)return;this.isDisplayMode=!0,document.body.classList.add("display-mode");let e=Math.ceil(Math.sqrt(t.length)),r=document.createElement("div");r.className="display-mode-container",r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="100vw",r.style.height="100vh",r.style.background="#1a1a1a",r.style.zIndex="1000",r.style.padding="20px",r.style.boxSizing="border-box",r.style.overflow="hidden",r.innerHTML=`
            <div class="display-mode-controls">
                <button id="exit-display-btn">Exit Display Mode</button>
            </div>
            <h1 style="text-align: center; margin: 0 0 20px 0; font-size: 2.5rem; color: white;">MTG Commander Pods</h1>
            <div id="display-output" style="flex-grow: 1; height: calc(100vh - 140px);"></div>
        `;let s=document.querySelector(".container");s&&(s.style.display="none"),document.body.appendChild(r);let a=r.querySelector("#display-output"),n=document.createElement("div");n.style.display="grid",n.style.gap="20px",n.style.height="100%",n.style.gridTemplateColumns=`repeat(${e}, 1fr)`,n.style.gridTemplateRows=`repeat(${e}, 1fr)`;let o=this.getShuffledColors(t.length);t.forEach((i,u)=>{let p=document.createElement("div");p.style.display="flex",p.style.flexDirection="column",p.style.background="#2a2a2a",p.style.border=`3px solid ${o[u]}`,p.style.borderRadius="8px",p.style.padding="15px",p.style.boxSizing="border-box",p.style.minHeight="0",p.style.boxShadow=`0 0 10px ${o[u]}40`,p.classList.add("pod",`pod-color-${u%10}`);let d=document.createElement("h3"),b=document.getElementById("bracket-radio"),f=b&&b.checked;if(f){let L=this.calculateValidBracketRange(i);d.textContent=`Pod ${u+1} (Bracket: ${L})`}else{let L=N(i);d.textContent=`Pod ${u+1} (Power: ${L})`}d.style.fontSize="1.6rem",d.style.margin="0 0 15px 0",d.style.textAlign="center",d.style.color=o[u],d.style.fontWeight="bold",d.style.flexShrink="0",d.style.textShadow="1px 1px 2px rgba(0,0,0,0.8)",p.appendChild(d);let B=0;i.players.forEach(L=>{"players"in L?B+=L.players.length:B+=1});let y="";i.players.forEach(L=>{if("players"in L)L.players.forEach(C=>{let M=f&&C.bracketRange?`${C.name} (B: ${C.bracketRange})`:`${C.name} (P: ${C.powerRange})`;M.length>y.length&&(y=M)});else{let C=f&&L.bracketRange?`${L.name} (B: ${L.bracketRange})`:`${L.name} (P: ${L.powerRange})`;C.length>y.length&&(y=C)}});let c=document.createElement("ul");c.style.flexGrow="1",c.style.display="flex";let k=Math.ceil(Math.sqrt(B)),g=Math.ceil(B/k);c.style.display="grid",c.style.gridTemplateColumns=`repeat(${k}, 1fr)`,c.style.gridTemplateRows=`repeat(${g}, 1fr)`,c.style.gap="12px",c.style.margin="0",c.style.padding="0",c.style.listStyle="none",c.style.width="100%",c.style.height="100%",c.style.alignItems="stretch",c.style.justifyItems="stretch";let E=[];i.players.forEach(L=>{"players"in L?L.players.forEach(C=>E.push(C)):E.push(L)});let P=document.getElementById("bracket-radio"),R=P&&P.checked;E.forEach((L,C)=>{let M=document.createElement("li"),x=document.createElement("div");x.textContent=L.name,x.className="player-name";let h=document.createElement("div");if(R&&L.bracketRange){let v=this.getValidBracketsArrayForPod(i),w=Y(L,v);h.innerHTML=`B: ${w}`}else{let v=$(i),w=q(L,v);h.innerHTML=`P: ${w}`}h.className="player-power",M.appendChild(x),M.appendChild(h),M.style.display="flex",M.style.flexDirection="column",M.style.justifyContent="center",M.style.alignItems="center",M.style.backgroundColor="rgba(255, 255, 255, 0.12)",M.style.border="2px solid rgba(255, 255, 255, 0.2)",M.style.borderRadius="12px",M.style.padding="8px",M.style.boxSizing="border-box",M.style.textAlign="center",M.style.height="100%",x.style.color="#ffffff",x.style.fontWeight="bold",x.style.lineHeight="1.1",x.style.marginBottom="4px",x.style.wordBreak="break-word",x.style.hyphens="auto",x.style.flexGrow="1",x.style.display="flex",x.style.alignItems="center",x.style.justifyContent="center",h.style.color="#b0b0b0",h.style.fontWeight="500",h.style.lineHeight="1",h.style.opacity="0.9",M.dataset.podRef=u.toString(),M.classList.add("dynamic-font-item"),c.appendChild(M)}),p.appendChild(c),n.appendChild(p)}),a.appendChild(n),requestAnimationFrame(()=>{n.querySelectorAll(".pod").forEach((u,p)=>{let d=u.getBoundingClientRect(),b=d.width,f=d.height,B=0;t[p].players.forEach(k=>{"players"in k?B+=k.players.length:B+=1});let y=this.calculateFontSizeForPod(b,f,B);u.querySelectorAll(".dynamic-font-item").forEach(k=>{let g=k.querySelector(".player-name"),E=k.querySelector(".player-power");if(g&&(g.style.fontSize=y),E){let P=Math.round(parseInt(y)*.75);E.style.fontSize=`${P}px`}})})}),r.querySelector("#exit-display-btn").addEventListener("click",()=>this.exitDisplayMode()),this.handleKeyDown=i=>{i.key==="Escape"&&this.isDisplayMode&&this.exitDisplayMode()},document.addEventListener("keydown",this.handleKeyDown)}exitDisplayMode(){this.isDisplayMode=!1,document.body.classList.remove("display-mode");let t=document.querySelector(".container");t&&(t.style.display="");let e=document.querySelector(".display-mode-container");e&&e.remove(),this.handleKeyDown&&(document.removeEventListener("keydown",this.handleKeyDown),this.handleKeyDown=null)}getIsDisplayMode(){return this.isDisplayMode}};var U=class{constructor(){this.currentPods=[];this.currentUnassigned=[];this.lastResetData=null;this.isRestoring=!1;this.displayModeBtnBottom=null;this.domCache=new Map;this.queryCache=new Map;this.reusablePlayerArray=[];this.elementPool=new Map;this.reusableFragment=document.createDocumentFragment();this.dropdownsCache=null;this.buttonsCache=null;this.reusableItemArray=[];this.playerRowsContainer=document.getElementById("player-rows"),this.outputSection=document.getElementById("output-section"),this.displayModeBtn=document.getElementById("display-mode-btn"),this.playerRowTemplate=document.getElementById("player-row-template"),this.playerManager=new z,this.podGenerator=new F,this.dragDropManager=new O(this.playerManager,(t,e)=>this.renderPods(t,e)),this.displayModeManager=new V,this.initializeEventListeners(),this.initializeRankingModeToggle()}initializeEventListeners(){let t=document.getElementById("add-player-btn"),e=document.getElementById("bulk-add-btn"),r=document.getElementById("generate-pods-btn"),s=document.getElementById("reset-all-btn"),a=document.getElementById("help-btn");t.addEventListener("click",()=>this.addPlayerRow()),e.addEventListener("click",()=>this.bulkAddPlayers(4)),r.addEventListener("click",()=>this.generatePods()),s.addEventListener("click",()=>this.resetAllWithConfirmation()),this.displayModeBtn.addEventListener("click",()=>this.displayModeManager.enterDisplayMode(this.currentPods)),a.addEventListener("click",()=>this.showHelpModal()),this.initializeHelpModal(),this.initializeKeyboardShortcuts()}getCachedElements(t){if(!this.domCache.has(t)){let e=Array.from(this.playerRowsContainer.querySelectorAll(t));this.domCache.set(t,e)}return this.domCache.get(t)}clearDOMCache(){this.domCache.clear(),this.queryCache.clear(),this.dropdownsCache=null,this.buttonsCache=null}getPooledElement(t){let e=this.elementPool.get(t);return e&&e.length>0?e.pop():null}returnToPool(t,e){e.innerHTML="",e.className="",e.removeAttribute("style"),e.removeAttribute("data-pod-index"),e.removeAttribute("data-item-index"),e.removeAttribute("data-item-id"),e.removeAttribute("data-item-type"),e.draggable=!1,this.elementPool.has(t)||this.elementPool.set(t,[]);let r=this.elementPool.get(t);r.length<20&&r.push(e)}getDropdownsOptimized(){return document.querySelectorAll(".bracket-selector-dropdown, .power-selector-dropdown")}getButtonsOptimized(){return document.querySelectorAll(".bracket-selector-btn, .power-selector-btn")}getPlayerRowsOptimized(){let t=this.playerRowsContainer.querySelectorAll(".player-row"),e=[];for(let r=0;r<t.length;r++)e.push(t[r]);return e}clearReusableArrays(){this.reusablePlayerArray.length=0,this.reusableItemArray.length=0}addPlayerRow(){let e=this.playerRowTemplate.content.cloneNode(!0).querySelector(".player-row"),r=this.playerManager.getNextPlayerId();e.dataset.playerId=r.toString();let s=e.querySelector(".power-selector-btn"),a=e.querySelector(".power-selector-dropdown"),n=e.querySelectorAll(".range-btn"),o=()=>{let h=e.querySelectorAll('.power-checkbox input[type="checkbox"]'),v=[];if(h.forEach(w=>{w.checked&&v.push(parseFloat(w.value))}),v.length===0)s.textContent="Select Power Levels",s.classList.remove("has-selection"),s.dataset.validationTriggered==="true"&&s.classList.add("error");else{s.classList.remove("error"),v.sort((S,I)=>S-I);let w;if(v.length===1)w=`Power: ${v[0]}`;else{let S=v[0],I=v[v.length-1];v.every((D,A)=>{if(A===0)return!0;let H=D-v[A-1];return H===.5||H===1})&&v.length>2?w=`Power: ${S}-${I}`:v.length<=4?w=`Power: ${v.join(", ")}`:w=`Power: ${S}-${I} (${v.length} levels)`}s.textContent=w,s.classList.add("has-selection")}};s.addEventListener("click",h=>{h.preventDefault();let v=a.style.display!=="none";this.getDropdownsOptimized().forEach(w=>{w.style.display="none",w.classList.remove("show")}),this.getButtonsOptimized().forEach(w=>{w.classList.remove("open")}),v||(a.style.display="block",s.classList.add("open"),setTimeout(()=>a.classList.add("show"),10))}),document.addEventListener("click",h=>{!s.contains(h.target)&&!a.contains(h.target)&&(a.classList.remove("show"),s.classList.remove("open"),setTimeout(()=>{a.classList.contains("show")||(a.style.display="none")},200))});let l=e.querySelectorAll('.power-checkbox input[type="checkbox"]');l.forEach(h=>{h.addEventListener("change",o)}),n.forEach(h=>{h.addEventListener("click",()=>{let v=h.dataset.range;l.forEach(I=>I.checked=!1);let[w,S]=v.split("-").map(Number);l.forEach(I=>{let T=parseFloat(I.value);(T===w||T===S)&&(I.checked=!0)}),o()})}),e.querySelector(".clear-btn").addEventListener("click",()=>{l.forEach(h=>h.checked=!1),o()});let u=()=>{a.classList.remove("show"),s.classList.remove("open"),setTimeout(()=>{a.classList.contains("show")||(a.style.display="none")},200)},p="",d=null;document.addEventListener("keydown",h=>{let v=a.style.display==="block"&&a.classList.contains("show"),w=document.activeElement===s;(v||w)&&(h.key==="Escape"?(h.preventDefault(),v&&(u(),s.focus()),p="",d&&clearTimeout(d)):(h.key>="1"&&h.key<="9"||h.key==="."||h.key==="0"||h.key==="-")&&(h.preventDefault(),p+=h.key,d&&clearTimeout(d),d=setTimeout(()=>{if(p.includes("-")){let S=p.split("-");if(S.length===2){let I=parseFloat(S[0]),T=parseFloat(S[1]),D=S[0].includes(".")||S[1].includes(".");!isNaN(I)&&!isNaN(T)&&I>=1&&I<=10&&T>=1&&T<=10&&I<=T&&(l.forEach(A=>A.checked=!1),l.forEach(A=>{let H=parseFloat(A.value);if(H>=I&&H<=T){let J=H%1===0,Z=H%1===.5;(J||D&&Z)&&(A.checked=!0)}}),o(),v&&u())}}else{let S=parseFloat(p);if(!isNaN(S)&&S>=1&&S<=10){l.forEach(T=>T.checked=!1);let I=Array.from(l).find(T=>Math.abs(parseFloat(T.value)-S)<.01);I&&(I.checked=!0,o(),v&&u())}}p=""},500)))}),o();let b=e.querySelector(".bracket-selector-btn"),f=e.querySelector(".bracket-selector-dropdown"),B=e.querySelectorAll(".bracket-range-btn"),y=()=>{let h=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),v=[];if(h.forEach(w=>{w.checked&&v.push(w.value)}),v.length===0)b.textContent="Select Brackets",b.classList.remove("has-selection"),b.dataset.validationTriggered==="true"&&b.classList.add("error");else{b.classList.remove("error");let w;v.length===1?w=`Bracket: ${v[0]}`:w=`Brackets: ${v.join(", ")}`,b.textContent=w,b.classList.add("has-selection")}};b.addEventListener("click",h=>{h.preventDefault();let v=f.style.display!=="none";this.getDropdownsOptimized().forEach(w=>{w.style.display="none",w.classList.remove("show")}),this.getButtonsOptimized().forEach(w=>{w.classList.remove("open")}),v||(f.style.display="block",b.classList.add("open"),setTimeout(()=>f.classList.add("show"),10))}),document.addEventListener("click",h=>{!b.contains(h.target)&&!f.contains(h.target)&&(f.classList.remove("show"),b.classList.remove("open"),setTimeout(()=>{f.classList.contains("show")||(f.style.display="none")},200))});let c=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]');c.forEach(h=>{h.addEventListener("change",y)}),B.forEach(h=>{h.addEventListener("click",()=>{let v=h.dataset.range;if(c.forEach(w=>w.checked=!1),v==="cedh")c.forEach(w=>{w.value==="cedh"&&(w.checked=!0)});else{let[w,S]=v.split("-"),I=parseInt(w),T=parseInt(S);c.forEach(D=>{let A=D.value;if(A!=="cedh"){let H=parseInt(A);H>=I&&H<=T&&(D.checked=!0)}})}y()})}),e.querySelector(".bracket-clear-btn").addEventListener("click",()=>{c.forEach(h=>h.checked=!1),y()});let g=()=>{f.classList.remove("show"),b.classList.remove("open"),setTimeout(()=>{f.classList.contains("show")||(f.style.display="none")},200)};document.addEventListener("keydown",h=>{let v=f.style.display==="block"&&f.classList.contains("show"),w=document.activeElement===b;if(v||w){if(h.key==="Escape")h.preventDefault(),v&&(g(),b.focus());else if(h.key>="1"&&h.key<="4"){h.preventDefault();let S=h.key;c.forEach(T=>T.checked=!1);let I=Array.from(c).find(T=>T.value===S);I&&(I.checked=!0,y(),v&&g())}else if(h.key==="5"||h.key.toLowerCase()==="c"){h.preventDefault(),c.forEach(I=>I.checked=!1);let S=Array.from(c).find(I=>I.value==="cedh");S&&(S.checked=!0,y(),v&&g())}}}),y(),e.querySelector(".remove-player-btn").addEventListener("click",()=>{this.playerRowsContainer.removeChild(e),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.updatePlayerNumbers(),this.clearDOMCache()});let P=e.querySelector(".player-name");P.addEventListener("input",()=>{P.dataset.touched="true",!P.value.trim()&&P.dataset.touched==="true"?P.classList.add("input-error"):P.classList.remove("input-error"),this.clearDuplicateErrorsOnInput()}),e.querySelector(".group-select").addEventListener("change",()=>{this.playerManager.handleGroupChange(this.playerRowsContainer)}),this.playerRowsContainer.appendChild(e),this.clearDOMCache(),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.clearDOMCache(),this.updatePlayerNumbers();let C=document.getElementById("bracket-radio").checked,M=e.querySelector(".power-levels"),x=e.querySelector(".bracket-levels");C?(M.style.display="none",x.style.display="block"):(M.style.display="block",x.style.display="none")}bulkAddPlayers(t){for(let e=0;e<t;e++)this.addPlayerRow()}initializeKeyboardShortcuts(){document.addEventListener("keydown",t=>{if(t.ctrlKey&&t.key==="Enter"){t.preventDefault(),this.addPlayerRow();let e=this.playerRowsContainer.querySelectorAll(".player-row"),s=e[e.length-1].querySelector(".player-name");s&&s.focus()}})}cleanupBottomDisplayButton(){if(this.displayModeBtnBottom){let t=this.displayModeBtnBottom.parentNode;t&&t.parentNode&&t.parentNode.removeChild(t),this.displayModeBtnBottom=null}}generatePods(){this.triggerValidationForAllFields(),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.playerManager.handleGroupChange(this.playerRowsContainer),this.clearReusableArrays();let t=this.getPlayerRowsOptimized(),e=!1;for(let c=0;c<t.length;c++)t[c].querySelector(".player-name").classList.remove("name-duplicate-error","name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5");for(let c=0;c<t.length;c++){let k=this.playerManager.getPlayerFromRow(t[c]);k?this.reusablePlayerArray.push(k):e=!0}let r=new Map;t.forEach(c=>{let g=c.querySelector(".player-name").value.trim().toLowerCase();g&&(r.has(g)||r.set(g,[]),r.get(g).push(c))});let s=[],a=1;if(r.forEach((c,k)=>{if(c.length>1){s.push(k);let g=`name-duplicate-error-${a}`;c.forEach(E=>{E.querySelector(".player-name").classList.add(g)}),a=a%5+1,e=!0}}),e){let c="Please fix the errors before generating pods.";s.length>0&&(c+=`

Duplicate player names found: ${s.join(", ")}`),alert(c);return}let n=new Map;this.playerManager.getGroups().forEach((c,k)=>{let g=c.reduce((P,R)=>P+R.power,0),E=Math.round(g/c.length*2)/2;n.set(k,{id:k,players:c,averagePower:E,size:c.length})});let o=new Set([...this.playerManager.getGroups().values()].flat().map(c=>c.id)),l=this.reusablePlayerArray.filter(c=>!o.has(c.id));this.reusableItemArray.length=0,this.reusableItemArray.push(...l),n.forEach(c=>{this.reusableItemArray.push({id:c.id,players:c.players,averagePower:c.averagePower,size:c.size})});let i=this.reusablePlayerArray.length;if(i<3){alert("You need at least 3 players to form a pod.");return}let p=j()==="avoid-five"?W(i):G(i),d=K();if(typeof window<"u"&&(window.location.protocol==="file:"||window.__playwright!==void 0||window.playwright!==void 0)){let c=this.reusablePlayerArray.map(g=>g.name).join(""),k=Array.from(c).reduce((g,E)=>g+E.charCodeAt(0),0);this.podGenerator.setShuffleSeed(k)}else this.podGenerator.setShuffleSeed(null);let f=this.podGenerator.generatePodsWithBacktracking(this.reusableItemArray,p,d),B=f.pods,y=f.unassigned;this.currentPods=[...B],this.currentUnassigned=[...y],this.renderPods(B,y)}renderPods(t,e=[]){if(this.currentPods=[...t],this.currentUnassigned=[...e],this.dragDropManager.setCurrentPods(this.currentPods,this.currentUnassigned),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",t.length===0){this.outputSection.textContent="Could not form pods with the given players.",this.displayModeBtn.style.display="none";return}this.displayModeBtn.style.display="inline-block";let r=Math.ceil(Math.sqrt(t.length)),s=document.createDocumentFragment(),a=this.getPooledElement("pods-container")||document.createElement("div");if(a.classList.add("pods-container"),a.style.gridTemplateColumns=`repeat(${r}, 1fr)`,a.style.gridTemplateRows=`repeat(${r}, 1fr)`,t.forEach((o,l)=>{let i=this.getPooledElement("pod")||document.createElement("div");i.classList.add("pod",`pod-color-${l%10}`),i.dataset.podIndex=l.toString(),i.addEventListener("dragover",this.dragDropManager.handleDragOver),i.addEventListener("drop",this.dragDropManager.handleDrop),i.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let u=this.getPooledElement("h3")||document.createElement("h3"),p=document.getElementById("bracket-radio");if(p&&p.checked){let f=this.calculateValidBracketRange(o);u.textContent=`Pod ${l+1} (Bracket: ${f})`}else{let f=N(o);u.textContent=`Pod ${l+1} (Power: ${f})`}i.appendChild(u);let b=this.getPooledElement("ul")||document.createElement("ul");o.players.forEach((f,B)=>{if("players"in f){let y=this.getPooledElement("li")||document.createElement("li");y.classList.add("pod-group"),y.draggable=!0,y.dataset.itemType="group",y.dataset.itemId=f.id,y.dataset.podIndex=l.toString(),y.dataset.itemIndex=B.toString(),y.addEventListener("dragstart",this.dragDropManager.handleDragStart),y.addEventListener("dragend",this.dragDropManager.handleDragEnd);let c=document.getElementById("bracket-radio"),k=c&&c.checked,g=document.createElement("strong");k?g.textContent=`Group ${f.id.split("-")[1]}:`:g.textContent=`Group ${f.id.split("-")[1]} (Avg Power: ${f.averagePower}):`,y.appendChild(g);let E=this.getPooledElement("ul")||document.createElement("ul");f.players.forEach(P=>{let R=this.getPooledElement("li")||document.createElement("li");if(k&&P.bracketRange)R.textContent=`${P.name} (B: ${P.bracketRange})`;else{let L=$(o),C=q(P,L);R.innerHTML=`${P.name} (P: ${C})`}E.appendChild(R)}),y.appendChild(E),b.appendChild(y)}else{let y=this.getPooledElement("li")||document.createElement("li");y.classList.add("pod-player"),y.draggable=!0,y.dataset.itemType="player",y.dataset.itemId=f.id.toString(),y.dataset.podIndex=l.toString(),y.dataset.itemIndex=B.toString(),y.addEventListener("dragstart",this.dragDropManager.handleDragStart),y.addEventListener("dragend",this.dragDropManager.handleDragEnd);let c=document.getElementById("bracket-radio");if(c&&c.checked&&f.bracketRange)y.textContent=`${f.name} (B: ${f.bracketRange})`;else{let g=$(o),E=q(f,g);y.innerHTML=`${f.name} (P: ${E})`}b.appendChild(y)}}),i.appendChild(b),a.appendChild(i)}),t.length>0){let o=document.createElement("div");o.classList.add("pod","new-pod","new-pod-target"),o.style.borderColor="#4CAF50",o.style.backgroundColor="#1f2a1f",o.style.borderStyle="dashed",o.dataset.podIndex="new-pod",o.addEventListener("dragover",this.dragDropManager.handleDragOver),o.addEventListener("drop",this.dragDropManager.handleDrop),o.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let l=document.createElement("h3");l.textContent="Create New Pod",l.style.color="#4CAF50",o.appendChild(l);let i=document.createElement("p");i.textContent="Drag players or groups here to create a new pod",i.style.color="#999",i.style.fontStyle="italic",i.style.textAlign="center",i.style.margin="20px 0",o.appendChild(i),a.appendChild(o)}if(e.length>0){let o=document.createElement("div");o.classList.add("pod","unassigned-pod"),o.style.borderColor="#ff6b6b",o.style.backgroundColor="#2a1f1f",o.dataset.podIndex="unassigned",o.addEventListener("dragover",this.dragDropManager.handleDragOver),o.addEventListener("drop",this.dragDropManager.handleDrop),o.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let l=document.createElement("h3");l.textContent="Unassigned Players",l.style.color="#ff6b6b",o.appendChild(l);let i=document.createElement("ul");e.forEach((u,p)=>{if("players"in u){let d=document.createElement("li");d.classList.add("pod-group"),d.draggable=!0,d.dataset.itemType="group",d.dataset.itemId=u.id,d.dataset.podIndex="unassigned",d.dataset.itemIndex=p.toString(),d.addEventListener("dragstart",this.dragDropManager.handleDragStart),d.addEventListener("dragend",this.dragDropManager.handleDragEnd);let b=document.getElementById("bracket-radio"),f=b&&b.checked;f?d.innerHTML=`<strong>Group ${u.id.split("-")[1]}:</strong>`:d.innerHTML=`<strong>Group ${u.id.split("-")[1]} (Avg Power: ${u.averagePower}):</strong>`;let B=document.createElement("ul");u.players.forEach(y=>{let c=document.createElement("li");f&&y.bracketRange?c.textContent=`${y.name} (B: ${y.bracketRange})`:c.textContent=`${y.name} (P: ${y.powerRange})`,B.appendChild(c)}),d.appendChild(B),i.appendChild(d)}else{let d=document.createElement("li");d.classList.add("pod-player"),d.draggable=!0,d.dataset.itemType="player",d.dataset.itemId=u.id.toString(),d.dataset.podIndex="unassigned",d.dataset.itemIndex=p.toString(),d.addEventListener("dragstart",this.dragDropManager.handleDragStart),d.addEventListener("dragend",this.dragDropManager.handleDragEnd);let b=document.getElementById("bracket-radio");b&&b.checked&&u.bracketRange?d.textContent=`${u.name} (B: ${u.bracketRange})`:d.textContent=`${u.name} (P: ${u.powerRange})`,i.appendChild(d)}}),o.appendChild(i),a.appendChild(o)}s.appendChild(a),this.outputSection.appendChild(s);let n=document.querySelector(".help-section");if(n&&n.parentNode){let o=document.createElement("div");o.style.textAlign="center",o.style.marginTop="20px",o.style.marginBottom="20px",this.displayModeBtnBottom=this.displayModeBtn.cloneNode(!0),this.displayModeBtnBottom.id="display-mode-btn-bottom",this.displayModeBtnBottom.style.display="inline-block",this.displayModeBtnBottom.addEventListener("click",()=>this.displayModeManager.enterDisplayMode(this.currentPods)),o.appendChild(this.displayModeBtnBottom),n.parentNode.insertBefore(o,n)}}captureCurrentPlayerData(){let t=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),e=[];t.forEach(s=>{let a=s.querySelector(".player-name"),n=s.querySelector(".group-select"),o=s.querySelectorAll('.power-checkbox input[type="checkbox"]'),l=[];o.forEach(p=>{p.checked&&l.push(p.value)});let i=s.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),u=[];i.forEach(p=>{p.checked&&u.push(p.value)}),e.push({name:a.value.trim(),groupValue:n.value,createdGroupId:n.dataset.createdGroupId,selectedPowers:l,selectedBrackets:u})});let r={noLeniency:document.getElementById("no-leniency-radio")?.checked||!1,leniency:document.getElementById("leniency-radio")?.checked||!1,superLeniency:document.getElementById("super-leniency-radio")?.checked||!1,bracket:document.getElementById("bracket-radio")?.checked||!1};return{players:e,leniencySettings:r,currentPods:[...this.currentPods],currentUnassigned:[...this.currentUnassigned]}}resetAllWithConfirmation(){if(!Array.from(this.playerRowsContainer.querySelectorAll(".player-row")).some(s=>{if(s.querySelector(".player-name").value.trim())return!0;let n=s.querySelectorAll('input[type="checkbox"]');return Array.from(n).some(o=>o.checked)})){this.resetAll();return}confirm(`Are you sure you want to reset all player data?

This will clear all players, groups, and generated pods. You will be able to undo this action immediately after.`)&&(this.lastResetData=this.captureCurrentPlayerData(),this.resetAll(),this.showUndoResetButton())}showUndoResetButton(){let t=document.getElementById("undo-reset-btn");t&&t.remove();let e=document.createElement("button");e.id="undo-reset-btn",e.textContent="Undo Reset",e.style.marginLeft="10px",e.style.backgroundColor="#28a745",e.style.color="white",e.style.border="none",e.style.padding="8px 16px",e.style.borderRadius="4px",e.style.cursor="pointer",e.style.fontSize="14px",e.addEventListener("click",()=>this.undoReset());let r=document.getElementById("reset-all-btn");r.parentNode.insertBefore(e,r.nextSibling),setTimeout(()=>{document.getElementById("undo-reset-btn")&&(e.remove(),this.lastResetData=null)},3e4)}undoReset(){if(!this.lastResetData){alert("No reset data available to restore.");return}this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds();let t=this.lastResetData.leniencySettings;t.noLeniency&&(document.getElementById("no-leniency-radio").checked=!0),t.leniency&&(document.getElementById("leniency-radio").checked=!0),t.superLeniency&&(document.getElementById("super-leniency-radio").checked=!0),t.bracket&&(document.getElementById("bracket-radio").checked=!0),this.lastResetData.players.forEach(s=>{this.addPlayerRow();let a=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),n=a[a.length-1],o=n.querySelector(".player-name");o.value=s.name;let l=n.querySelector(".group-select");s.createdGroupId&&(l.dataset.createdGroupId=s.createdGroupId),l.value=s.groupValue}),this.isRestoring=!0;let e=document.getElementById("no-leniency-radio"),r=document.getElementById("bracket-radio");if(e&&r){let s=new Event("change",{bubbles:!0});t.bracket?r.dispatchEvent(s):e.dispatchEvent(s)}setTimeout(()=>{this.restorePlayerSelections()},200)}restorePlayerSelections(){if(!this.lastResetData)return;this.lastResetData.players.forEach((e,r)=>{let a=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[r];if(!a)return;e.selectedPowers.forEach(l=>{let i=a.querySelector(`.power-checkbox input[type="checkbox"][value="${l}"]`);i&&(i.checked=!0)}),e.selectedBrackets.forEach(l=>{let i=a.querySelector(`.bracket-checkbox input[type="checkbox"][value="${l}"]`);i&&(i.checked=!0)}),a.querySelectorAll('input[type="checkbox"]').forEach(l=>{l.checked&&l.dispatchEvent(new Event("change",{bubbles:!0}))}),this.updateButtonTextsForRow(a);let o=a.querySelector(".group-select");e.groupValue&&e.groupValue!=="no-group"&&e.groupValue.startsWith("group-")&&(e.createdGroupId?o.dataset.createdGroupId=e.createdGroupId:o.dataset.createdGroupId=e.groupValue,o.value="new-group",o.dispatchEvent(new Event("change",{bubbles:!0})))}),this.lastResetData.players.forEach((e,r)=>{let n=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[r].querySelector(".group-select");e.groupValue&&e.groupValue!=="no-group"&&e.groupValue.startsWith("group-")&&(n.value=e.groupValue,n.dispatchEvent(new Event("change",{bubbles:!0})))}),this.currentPods=[...this.lastResetData.currentPods],this.currentUnassigned=[...this.lastResetData.currentUnassigned],(this.currentPods.length>0||this.currentUnassigned.length>0)&&this.renderPods(this.currentPods,this.currentUnassigned),this.playerManager.handleGroupChange(this.playerRowsContainer),this.isRestoring=!1;let t=document.getElementById("undo-reset-btn");t&&t.remove(),this.lastResetData=null,alert("Reset has been undone successfully!")}resetAll(){this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.displayModeBtn.style.display="none",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds(),this.currentPods=[],this.currentUnassigned=[];let t=document.getElementById("no-leniency-radio");t.checked=!0;for(let e=0;e<4;e++)this.addPlayerRow()}clearDuplicateErrorsOnInput(){let t=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),e=new Map;t.forEach(s=>{let a=s.querySelector(".player-name"),n=a.value.trim().toLowerCase();n&&(e.has(n)||e.set(n,[]),e.get(n).push(a))}),t.forEach(s=>{s.querySelector(".player-name").classList.remove("name-duplicate-error","name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5")});let r=1;e.forEach((s,a)=>{if(s.length>1){let n=`name-duplicate-error-${r}`;s.forEach(o=>{o.classList.add(n)}),r=r%5+1}})}initializeRankingModeToggle(){let t=document.getElementById("power-level-radio"),e=document.getElementById("bracket-radio"),r=()=>{let s=e.checked;if(s){document.body.classList.add("bracket-mode");let n=document.getElementById("no-leniency-radio");n&&(n.checked=!0)}else document.body.classList.remove("bracket-mode");this.playerRowsContainer.querySelectorAll(".player-row").forEach(n=>{let o=n.querySelector(".power-levels"),l=n.querySelector(".bracket-levels");s?(o.style.display="none",l.style.display="block"):(o.style.display="block",l.style.display="none"),this.isRestoring||this.clearAllSelections(n)})};t.addEventListener("change",r),e.addEventListener("change",r),r()}clearAllSelections(t){t.querySelectorAll('.power-checkbox input[type="checkbox"]').forEach(n=>n.checked=!1),t.querySelectorAll('.bracket-checkbox input[type="checkbox"]').forEach(n=>n.checked=!1);let s=t.querySelector(".power-selector-btn"),a=t.querySelector(".bracket-selector-btn");s&&(s.textContent="Select Power Levels",s.classList.remove("has-selection")),a&&(a.textContent="Select Brackets",a.classList.remove("has-selection"))}initializeHelpModal(){let t=document.getElementById("help-modal");t.querySelector(".help-close").addEventListener("click",()=>this.hideHelpModal()),t.addEventListener("click",r=>{r.target===t&&this.hideHelpModal()}),document.addEventListener("keydown",r=>{r.key==="Escape"&&t.style.display==="block"&&this.hideHelpModal()})}showHelpModal(){let t=document.getElementById("help-modal");t.style.display="block",document.body.style.overflow="hidden"}hideHelpModal(){let t=document.getElementById("help-modal");t.style.display="none",document.body.style.overflow=""}calculateValidBracketRange(t){let e=t.players.flatMap(n=>"players"in n?n.players:[n]);if(e.length===0)return"Unknown";let r=[],s=new Set;e.forEach(n=>{n.brackets&&n.brackets.forEach(o=>s.add(o))});for(let n of s)e.every(l=>l.brackets&&l.brackets.includes(n))&&r.push(n);let a=["1","2","3","4","cedh"];if(r.sort((n,o)=>a.indexOf(n)-a.indexOf(o)),r.length===0)return"Unknown";if(r.length===1)return r[0];{let n=r.filter(l=>l!=="cedh");return n.length>1&&n.every((l,i)=>{if(i===0)return!0;let u=parseInt(l),p=parseInt(n[i-1]);return u===p+1})&&n.length===r.length&&r.length>1?`${r[0]}-${r[r.length-1]}`:r.join(", ")}}triggerValidationForAllFields(){let t=this.getPlayerRowsOptimized();for(let e=0;e<t.length;e++){let r=t[e],s=r.querySelector(".player-name");s.value.trim()||s.classList.add("input-error");let n=r.querySelector(".power-selector-btn"),o=r.querySelector(".bracket-selector-btn");if(n&&(n.dataset.validationTriggered="true"),o&&(o.dataset.validationTriggered="true"),document.getElementById("bracket-radio").checked){let u=r.querySelectorAll('.bracket-checkbox input[type="checkbox"]');Array.from(u).some(d=>d.checked)||o.classList.add("error")}else{let u=r.querySelectorAll('.power-checkbox input[type="checkbox"]');Array.from(u).some(d=>d.checked)||n.classList.add("error")}}}updateButtonTextsForRow(t){let e=t.querySelectorAll('.power-checkbox input[type="checkbox"]'),r=t.querySelector(".power-selector-btn");if(r){let n=[];if(e.forEach(o=>{o.checked&&n.push(parseFloat(o.value))}),n.length===0)r.textContent="Select Power Levels",r.classList.remove("has-selection");else{n.sort((l,i)=>l-i);let o;if(n.length===1)o=`Power: ${n[0]}`;else{let l=n[0],i=n[n.length-1];n.every((p,d)=>{if(d===0)return!0;let b=p-n[d-1];return b===.5||b===1})&&n.length>2?o=`Power: ${l}-${i}`:n.length<=4?o=`Power: ${n.join(", ")}`:o=`Power: ${l}-${i} (${n.length} levels)`}r.textContent=o,r.classList.add("has-selection")}}let s=t.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),a=t.querySelector(".bracket-selector-btn");if(a){let n=[];if(s.forEach(o=>{o.checked&&n.push(o.value)}),n.length===0)a.textContent="Select Brackets",a.classList.remove("has-selection");else{let o;n.length===1?o=`Bracket: ${n[0]}`:o=`Brackets: ${n.join(", ")}`,a.textContent=o,a.classList.add("has-selection")}}}updatePlayerNumbers(){this.playerRowsContainer.querySelectorAll(".player-row").forEach((e,r)=>{let s=e.querySelector(".player-number");s&&(s.textContent=(r+1).toString())})}};function X(){let e=Math.floor(Math.random()*360),r=25,s=[];for(let o=0;o<50;o++){let i=(e+o*137.5)%360;s.push(Math.round(i))}let a="";for(let o=1;o<=50;o++){let l=s[o-1],i=70+Math.floor(Math.random()*20),u=50,p=28+Math.floor(Math.random()*8);a+=`
.player-row .group-select.group-${o} {
    border-color: hsl(${l}, ${i}%, ${u}%) !important;
    background-color: hsl(${l}, ${i}%, ${p}%) !important;
}`,a+=`
.group-select option[value="group-${o}"] {
    background-color: hsl(${l}, ${i}%, ${p}%);
}`}let n=document.createElement("style");n.id="dynamic-group-colors",n.textContent=a,document.head.appendChild(n)}document.addEventListener("DOMContentLoaded",()=>{X(),new U().resetAll()});})();
