"use strict";(()=>{function j(c){if(c<3)return[];if(c===3)return[3];if(c===4)return[4];if(c===5)return[5];if(c===6)return[3,3];if(c===7)return[4,3];if(c===8)return[4,4];if(c===9)return[3,3,3];if(c===10)return[5,5];let e=Math.floor(c/4),t=c%4;return t===0?Array(e).fill(4):t===1?e>=2?[...Array(e-2).fill(4),5,4]:[3,3,3,2]:t===2?e>=1?[...Array(e-1).fill(4),3,3]:[3,3,3,3]:t===3?[...Array(e).fill(4),3]:[]}function ce(c){if(c<3)return[];if(c<9)return j(c);if(c===9)return[3,3,3];if(c===10)return[4,3,3];if(c===11)return[4,4,3];if(c===12)return[4,4,4];if(c===13)return[4,3,3,3];if(c===14)return[4,4,3,3];if(c===15)return[4,4,4,3];let e=[],t=c;for(;t>=7;)e.push(4),t-=4;if(t===6)e.push(3,3);else if(t===5)if(e.length>0)e.pop(),t+=4,e.push(3,3,3);else return j(c);else t===4?e.push(4):t===3&&e.push(3);return e.sort((r,n)=>n-r)}function de(){let c=document.getElementById("avoid-five-pods-radio");return c&&c.checked?"avoid-five":"balanced"}function ue(){let c=document.getElementById("bracket-radio");if(c&&c.checked)return{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0};let e=document.getElementById("no-leniency-radio"),t=document.getElementById("leniency-radio");return document.getElementById("super-leniency-radio").checked?{allowLeniency:!0,allowSuperLeniency:!0,maxTolerance:1}:t.checked?{allowLeniency:!0,allowSuperLeniency:!1,maxTolerance:.5}:{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0}}function pe(c){let e=[];if(c.forEach(n=>{if(n.checked){let o=parseFloat(n.value);isNaN(o)||e.push(o)}}),e.length===0)return{availablePowers:[],powerRange:"",averagePower:0};e.sort((n,o)=>n-o);let t;e.length===1?t=e[0].toString():t=e.join(", ");let r=e.reduce((n,o)=>n+o,0)/e.length;return{availablePowers:e,powerRange:t,averagePower:Math.round(r*2)/2}}function me(){let c=document.querySelector("#leniency-radio");return document.querySelector("#super-leniency-radio")?.checked?1:c?.checked?.5:0}function _(c){let e=c.players.flatMap(o=>"players"in o?o.players:[o]);if(e.length===0)return c.power.toString();let t=me(),r=[],n=new Set;e.forEach(o=>{o.availablePowers.forEach(a=>n.add(a))});for(let o of n)e.every(s=>s.availablePowers.some(i=>Math.abs(o-i)<=t))&&r.push(o);return r.sort((o,a)=>o-a),r.length===0?c.power.toString():r.length===1?r[0].toString():r.every((a,s)=>s===0||a-r[s-1]<=.5)&&r.length>2?`${r[0]}-${r[r.length-1]}`:r.join(", ")}function U(c,e){let t=[];if(Array.isArray(c.availablePowers))t=c.availablePowers;else if(typeof c.powerRange=="string")if(c.powerRange.includes("-")){let[n,o]=c.powerRange.split("-").map(a=>parseFloat(a.trim()));for(let a=n;a<=o;a+=.5)t.push(a)}else t=c.powerRange.split(",").map(n=>parseFloat(n.trim()));return t.map(n=>e.includes(n)?`<span class="power-highlight">${n}</span>`:n.toString()).join(", ")}function he(c,e){let t=[];if(Array.isArray(c.availableBrackets))t=c.availableBrackets;else if(typeof c.bracketRange=="string")if(c.bracketRange.includes("-")){let[n,o]=c.bracketRange.split("-").map(i=>i.trim()),a=parseInt(n),s=parseInt(o);if(!isNaN(a)&&!isNaN(s))for(let i=a;i<=s;i++)t.push(i.toString());else t=[n,o]}else t=c.bracketRange.split(",").map(n=>n.trim());return t.map(n=>e.includes(n)?`<span class="bracket-highlight">${n}</span>`:n.toString()).join(", ")}function W(c){let e=c.players.flatMap(a=>"players"in a?a.players:[a]);if(e.length===0)return[];let t=new Map,r=new Set;if(e.forEach(a=>{a.availablePowers.length===1&&r.add(a.availablePowers[0]),a.availablePowers.forEach(s=>{t.set(s,(t.get(s)||0)+1)})}),t.size===0)return[];let n=Math.max(...t.values()),o=[];for(let[a,s]of t.entries())(s===n||r.has(a))&&o.push(a);return o.sort((a,s)=>a-s),o}var Y=class{constructor(){this.groups=new Map;this.nextPlayerId=0;this.nextGroupId=1;this.availableColors=[];this.groupColorAssignments=new Map;this.initializeAvailableColors()}initializeAvailableColors(){this.availableColors=Array.from({length:50},(e,t)=>t+1),this.shuffleArray(this.availableColors)}shuffleArray(e){for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}}assignRandomColor(e){if(this.groupColorAssignments.has(e))return this.groupColorAssignments.get(e);this.availableColors.length===0&&this.initializeAvailableColors();let t=this.availableColors.pop();return this.groupColorAssignments.set(e,t),t}releaseColor(e){let t=this.groupColorAssignments.get(e);t&&(this.availableColors.push(t),this.groupColorAssignments.delete(e))}getNextPlayerId(){return this.nextPlayerId++}resetPlayerIds(){this.nextPlayerId=0}getNextGroupId(){let e=new Set;document.querySelectorAll(".group-select").forEach(r=>{if(r.value.startsWith("group-")){let n=parseInt(r.value.split("-")[1]);isNaN(n)||e.add(n)}if(r.value==="new-group"&&r.dataset.createdGroupId&&r.dataset.createdGroupId.startsWith("group-")){let n=parseInt(r.dataset.createdGroupId.split("-")[1]);isNaN(n)||e.add(n)}});for(let r=1;r<=50;r++)if(!e.has(r))return r;return this.nextGroupId++}resetGroupIds(){this.nextGroupId=1}getGroups(){return this.groups}clearGroups(){this.groups.clear()}getPlayerFromRow(e){let t=e.querySelector(".player-name");t.classList.remove("input-error");let r=t.value.trim();if(!r)return t.classList.add("input-error"),null;if(document.getElementById("bracket-radio").checked){let a=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),s=[];if(a.forEach(p=>{p.checked&&s.push(p.value)}),s.length===0)return e.querySelector(".bracket-selector-btn").classList.add("error"),null;e.querySelector(".bracket-selector-btn").classList.remove("error");let i={1:1,2:2,3:3,4:4,cedh:10},l=s.map(p=>i[p]),d=l.reduce((p,u)=>p+u,0)/l.length;return{id:parseInt(e.dataset.playerId),name:r,power:Math.round(d*2)/2,availablePowers:l,powerRange:s.join(", "),brackets:s,bracketRange:s.join(", "),rowElement:e}}else{let a=e.querySelectorAll('.power-checkbox input[type="checkbox"]'),s=pe(a);return s.availablePowers.length===0?(e.querySelector(".power-selector-btn").classList.add("error"),null):(e.querySelector(".power-selector-btn").classList.remove("error"),{id:parseInt(e.dataset.playerId),name:r,power:s.averagePower,availablePowers:s.availablePowers,powerRange:s.powerRange,rowElement:e})}}handleGroupChange(e){this.groups.clear();let t=Array.from(e.querySelectorAll(".player-row"));t.forEach(n=>{for(let o=1;o<=50;o++)n.querySelector(".group-select").classList.remove(`group-${o}`)});let r=new Set;t.forEach(n=>{let o=n.querySelector(".group-select");o.dataset.createdGroupId?r.add(o.dataset.createdGroupId):o.value.startsWith("group-")&&r.add(o.value)}),t.forEach(n=>{let o=n.querySelector(".group-select"),a="";if(o.value==="new-group"){o.dataset.createdGroupId?a=o.dataset.createdGroupId:(a=`group-${this.getNextGroupId()}`,r.add(a),o.dataset.createdGroupId=a);let s=this.getPlayerFromRow(n);s&&(this.groups.has(a)||this.groups.set(a,[]),this.groups.get(a).push(s))}else if(o.value.startsWith("group-")){a=o.value;let s=this.getPlayerFromRow(n);s&&(this.groups.has(o.value)||this.groups.set(o.value,[]),this.groups.get(o.value).push(s))}else o.dataset.createdGroupId&&delete o.dataset.createdGroupId;if(a){let s=parseInt(a.split("-")[1]);s>=1&&s<=50&&o.classList.add(`group-${s}`)}}),this.cleanupUnusedGroups(r),this.updateAllGroupDropdowns(e)}updateAllGroupDropdowns(e){let t=new Set,r=Array.from(e.querySelectorAll(".player-row"));r.forEach(n=>{let o=n.querySelector(".group-select");o.value==="new-group"&&o.dataset.createdGroupId?t.add(o.dataset.createdGroupId):o.value.startsWith("group-")&&t.add(o.value)}),r.forEach(n=>{let o=n.querySelector(".group-select"),a=o.value,s=o.dataset.createdGroupId;if(Array.from(o.options).forEach(l=>{l.value.startsWith("group-")&&o.remove(l.index)}),t.forEach(l=>{let d=l.split("-")[1],p=new Option(`Group ${d}`,l);o.add(p)}),s&&t.has(s)&&(a==="new-group"||a==="no-group")){o.value=s;let l=parseInt(s.split("-")[1]);l>=1&&l<=50&&o.classList.add(`group-${l}`)}else if(a.startsWith("group-")&&t.has(a)){o.value=a;let l=parseInt(a.split("-")[1]);l>=1&&l<=50&&o.classList.add(`group-${l}`)}else{o.value="no-group";for(let l=1;l<=50;l++)o.classList.remove(`group-${l}`)}})}arePlayersCompatible(e,t,r){return e.availablePowers.some(o=>t.availablePowers.some(a=>Math.abs(o-a)<.01))?!0:r.allowLeniency?e.availablePowers.some(o=>t.availablePowers.some(a=>Math.abs(o-a)<=r.maxTolerance)):!1}findAllCommonPowers(e,t){return e.length===0?[]:[...new Set(e.flatMap(n=>n.availablePowers))].sort((n,o)=>n-o).filter(n=>e.every(o=>o.availablePowers.some(a=>{let s=Math.abs(a-n);return s<.01||t.allowLeniency&&s<=t.maxTolerance})))}findBestCommonPowerLevel(e){if(e.length===0)return null;let t=new Map;for(let o of e)for(let a of o.availablePowers)t.set(a,(t.get(a)||0)+1);if(t.size===0)return null;let r=e[0].availablePowers[0],n=0;for(let[o,a]of t.entries())a>n&&(n=a,r=o);return r}calculatePodPower(e){if(e.length===0)return 0;let t=e.reduce((r,n)=>{if("players"in n)return r+n.averagePower;{let o=n.powerRange.split(",").map(s=>parseFloat(s.trim())),a=o.reduce((s,i)=>s+i,0)/o.length;return r+a}},0);return Math.round(t/e.length*10)/10}cleanupUnusedGroups(e){Array.from(this.groupColorAssignments.keys()).forEach(o=>{e.has(o)||this.releaseColor(o)}),Array.from(this.groups.keys()).forEach(o=>{e.has(o)||this.groups.delete(o)}),document.querySelectorAll(".group-select").forEach(o=>{let a=o.dataset.createdGroupId;a&&!e.has(a)&&delete o.dataset.createdGroupId})}};var J=class{constructor(){this.shuffleSeed=null;this.sizeCache=new Map}setShuffleSeed(e){this.shuffleSeed=e,this.sizeCache.clear()}seededRandom(e){let t=e;return()=>(t=t*1103515245+12345&2147483647,t/2147483647)}shuffleArray(e){let t=[...e],r;this.shuffleSeed!==null?r=this.seededRandom(this.shuffleSeed):r=Math.random;for(let n=t.length-1;n>0;n--){let o=Math.floor(r()*(n+1));[t[n],t[o]]=[t[o],t[n]]}return t}getItemSize(e){let t="players"in e?`group-${e.id}`:`player-${e.id}`;if(!this.sizeCache.has(t)){let r="players"in e?e.size:1;this.sizeCache.set(t,r)}return this.sizeCache.get(t)}getItemId(e){return"players"in e?e.id:e.id.toString()}generatePodsWithBacktracking(e,t,r){let n=this.shuffleArray(e),o=n.reduce((l,d)=>l+("size"in d?d.size:1),0);if(o>=3&&o<=5){let l=n.flatMap(p=>"players"in p?p.players:[p]),d=this.findBestCommonPowerLevel(l);return d!==null?{pods:[{players:n,power:d}],unassigned:[]}:{pods:[],unassigned:n}}let a=this.findOptimalPodAssignment(n,t,r),s=new Set;for(let l of a)for(let d of l.players)"players"in d?s.add(d.id):s.add(d.id.toString());let i=n.filter(l=>"players"in l?!s.has(l.id):!s.has(l.id.toString()));return{pods:a,unassigned:i}}findOptimalPodAssignment(e,t,r){return this.optimizeVirtualPlayerAssignmentUnified(e,t,r)}optimizeVirtualPlayerAssignmentUnified(e,t,r){if(e.length===0)return[];let n=this.createVirtualPlayersUnified(e),o=new Map;for(let s of n)o.has(s.powerLevel)||o.set(s.powerLevel,[]),o.get(s.powerLevel).push(s);let a={pods:[],totalPods:0};return r.allowLeniency?this.backtrackVirtualPlayersWithLeniencyUnified(n,t,r.maxTolerance,[],new Set,t,a):this.backtrackVirtualPlayersUnified(Array.from(o.entries()),[],new Set,t,a),a.pods}createVirtualPlayersUnified(e){let t=[];for(let r of e)if("players"in r){let n=r.players.flatMap(d=>d.availablePowers),o=Math.min(...n),a=Math.max(...n),i=[r.averagePower,o,a],l=[...new Set(i)];for(let d of l)t.push({item:r,powerLevel:d})}else for(let n of r.availablePowers)t.push({item:r,powerLevel:n});return t}backtrackVirtualPlayersUnified(e,t,r,n,o){if(n.length===0){t.length>o.totalPods&&(o.pods=[...t],o.totalPods=t.length);return}if(t.length+n.length<=o.totalPods)return;let a=n[0],s=n.slice(1);for(let[i,l]of e){let d=l.filter(b=>{let f=this.getItemId(b.item);return!r.has(f)}),p=0;for(let b=0;b<d.length;b++)p+=this.getItemSize(d[b].item);let u=Math.max(3,a);if(p>=u){let b=d.sort((h,w)=>{let g=this.getItemSize(h.item);return this.getItemSize(w.item)-g}),f=[],M=new Set,m=0;for(let h of b){let w=this.getItemId(h.item),g=this.getItemSize(h.item);if(!M.has(w)&&m+g<=a&&(f.push(h),M.add(w),m+=g,m===a))break}if(m>=3){let h=f.map(y=>y.item),w={players:h,power:i},g=new Set(r);for(let y of h){let k="players"in y?y.id:y.id.toString();g.add(k)}this.backtrackVirtualPlayersUnified(e,[...t,w],g,s,o)}}}this.backtrackVirtualPlayersUnified(e,t,r,s,o)}backtrackVirtualPlayersWithLeniencyUnified(e,t,r,n,o,a,s){if(a.length===0){n.length>s.totalPods&&(s.pods=[...n],s.totalPods=n.length);return}if(n.length+a.length<=s.totalPods)return;let i=a[0],l=a.slice(1),d=e.filter(u=>{let b="players"in u.item?u.item.id:u.item.id.toString();return!o.has(b)}),p=[...new Set(d.map(u=>u.powerLevel))].sort((u,b)=>u-b);for(let u of p){let b=d.filter(g=>("players"in g.item,Math.abs(g.powerLevel-u)<=r)),f=new Map;for(let g of b){let y="players"in g.item?g.item.id:g.item.id.toString();if(!f.has(y))f.set(y,g);else{let k=f.get(y),x=Math.abs(k.powerLevel-u);Math.abs(g.powerLevel-u)<x&&f.set(y,g)}}let m=Array.from(f.values()).sort((g,y)=>{if("players"in g.item&&"players"in y.item){let k=Math.abs(g.powerLevel-g.item.averagePower)<.01,x=Math.abs(y.powerLevel-y.item.averagePower)<.01;return k&&!x?-1:!k&&x?1:Math.abs(g.powerLevel-u)-Math.abs(y.powerLevel-u)}return"players"in g.item&&!("players"in y.item)?1:!("players"in g.item)&&"players"in y.item?-1:Math.abs(g.powerLevel-u)-Math.abs(y.powerLevel-u)}),h=0;for(let g=0;g<m.length;g++)h+=this.getItemSize(m[g].item);let w=Math.max(3,i);if(h>=w){let g=m.sort((v,L)=>{let E=this.getItemSize(v.item);return this.getItemSize(L.item)-E}),y=[],k=new Set,x=0;for(let v of g){let L=this.getItemId(v.item),E=this.getItemSize(v.item);if(!k.has(L)&&x+E<=i&&(y.push(v),k.add(L),x+=E,x===i))break}if(x>=3){let v=y.map(C=>C.item);if(!this.isPodPowerSpreadValid(y,r))continue;let L=y.reduce((C,G)=>C+G.powerLevel,0)/y.length,E={players:v,power:Math.round(L*2)/2},S=new Set(o);for(let C of v){let G="players"in C?C.id:C.id.toString();S.add(G),e.forEach(q=>{let le="players"in q.item?q.item.id:q.item.id.toString();le===G&&S.add(le)})}this.backtrackVirtualPlayersWithLeniencyUnified(e,t,r,[...n,E],S,l,s)}}}this.backtrackVirtualPlayersWithLeniencyUnified(e,t,r,n,o,l,s)}isPodPowerSpreadValid(e,t){if(e.length===0)return!0;let r=e.map(s=>s.powerLevel),n=Math.min(...r);return Math.max(...r)-n<=t}findBestCommonPowerLevel(e){if(e.length===0)return null;let t=new Map;for(let o of e)for(let a of o.availablePowers)t.set(a,(t.get(a)||0)+1);if(t.size===0)return null;let r=e[0].availablePowers[0],n=0;for(let[o,a]of t.entries())a>n&&(n=a,r=o);return r}};var X=class{constructor(e,t){this.draggedElement=null;this.draggedItemData=null;this.currentPods=[];this.currentUnassigned=[];this.handleDragStart=e=>{let t=e.target;this.draggedElement=t,t.classList.add("dragging"),this.draggedItemData={type:t.dataset.itemType,id:t.dataset.itemId,podIndex:t.dataset.podIndex,itemIndex:t.dataset.itemIndex},e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",t.outerHTML)};this.handleDragEnd=e=>{e.target.classList.remove("dragging"),this.draggedElement=null,this.draggedItemData=null};this.handleDragOver=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",e.currentTarget.classList.add("drag-over")};this.handleDragLeave=e=>{e.currentTarget.classList.remove("drag-over")};this.handleDrop=e=>{e.preventDefault();let t=e.currentTarget;if(t.classList.remove("drag-over"),!this.draggedItemData)return;let r=t.dataset.podIndex,n=this.draggedItemData.podIndex;r!==n&&this.moveItemBetweenPods(this.draggedItemData,r)};this.playerManager=e,this.onPodsChanged=t}setCurrentPods(e,t=[]){this.currentPods=[...e],this.currentUnassigned=[...t]}moveItemBetweenPods(e,t){let r=e.podIndex,n=parseInt(e.itemIndex),o=null;if(r==="unassigned")o=this.currentUnassigned[n],this.currentUnassigned.splice(n,1);else{let a=this.currentPods[parseInt(r)];o=a.players[n],a.players.splice(n,1),a.power=this.playerManager.calculatePodPower(a.players)}if(o){if(t==="unassigned")this.currentUnassigned.push(o);else if(t==="new-pod"){let a={players:[o],power:this.playerManager.calculatePodPower([o])};this.currentPods.push(a)}else{let a=this.currentPods[parseInt(t)];a.players.push(o),a.power=this.playerManager.calculatePodPower(a.players)}this.cleanupEmptyPods(),this.onPodsChanged(this.currentPods,this.currentUnassigned)}}cleanupEmptyPods(){this.currentPods=this.currentPods.filter(e=>e.players.length>0)}};var re=class{constructor(){this.pools=new Map;this.POOL_SIZE=15}get(e){let t=this.pools.get(e.toLowerCase())||[];if(t.length>0){let r=t.pop();return this.resetElement(r),r}return document.createElement(e)}release(e){let t=e.tagName.toLowerCase(),r=this.pools.get(t);r||(r=[],this.pools.set(t,r)),r.length<this.POOL_SIZE&&(this.resetElement(e),r.push(e))}resetElement(e){e.innerHTML="",e.className="",e.removeAttribute("style"),e.removeAttribute("draggable"),e.removeAttribute("id"),Object.keys(e.dataset).forEach(t=>{delete e.dataset[t]})}clear(){this.pools.clear()}getStats(){let e={};return this.pools.forEach((t,r)=>{e[r]=t.length}),e}preWarm(){[{tag:"div",count:8},{tag:"li",count:6},{tag:"ul",count:4},{tag:"h3",count:3},{tag:"p",count:3},{tag:"strong",count:3},{tag:"button",count:2}].forEach(({tag:t,count:r})=>{let n=[];for(let o=0;o<r;o++){let a=document.createElement(t);this.resetElement(a),n.push(a)}this.pools.set(t,n)})}},B=new re;B.preWarm();var Q=class{constructor(){this.isDisplayMode=!1;this.handleKeyDown=null;this.borderColors=["#FF6B6B","#4ECDC4","#45B7D1","#FFA726","#66BB6A","#AB47BC","#EF5350","#26A69A","#42A5F5","#FF7043","#9CCC65","#7E57C2","#EC407A","#29B6F6","#FFCA28","#8BC34A","#673AB7","#F06292","#00BCD4","#FFEB3B","#795548","#607D8B","#E91E63","#009688","#FF9800"]}getShuffledColors(e){let t=[...this.borderColors];for(let r=t.length-1;r>0;r--){let n=Math.floor(Math.random()*(r+1));[t[r],t[n]]=[t[n],t[r]]}if(e>t.length){let r=[];for(let n=0;n<e;n++)r.push(t[n%t.length]);return r}return t.slice(0,e)}calculateOptimalWidthForText(e){let t=0;for(let o of e)o===" "?t+=.3:/[iIl1]/.test(o)?t+=.4:/[mwMW]/.test(o)?t+=.8:/[A-Z]/.test(o)?t+=.7:t+=.6;let r=t*1.2,n=Math.min(85,Math.max(25,r/25*85));return Math.round(n)}calculateFontSizeForPod(e,t,r){let n=e*t,o=Math.ceil(Math.sqrt(r)),a=Math.ceil(r/o),s=(e-(o-1)*10)/o,i=(t-(a-1)*10)/a,l=Math.min(s,i),d=Math.min(l*.25,i*.35),p=Math.max(.9,1-(r-3)*.02),u=Math.max(24,Math.min(72,d*p));return`${Math.round(u)}px`}calculateValidBracketRange(e){let t=e.players.flatMap(a=>"players"in a?a.players:[a]);if(t.length===0)return"Unknown";let r=[],n=new Set;t.forEach(a=>{a.brackets&&a.brackets.forEach(s=>n.add(s))});for(let a of n)t.every(i=>i.brackets&&i.brackets.includes(a))&&r.push(a);let o=["1","2","3","4","cedh"];if(r.sort((a,s)=>o.indexOf(a)-o.indexOf(s)),r.length===0)return"Unknown";if(r.length===1)return r[0];{let a=r.filter(i=>i!=="cedh");return a.length>1&&a.every((i,l)=>{if(l===0)return!0;let d=parseInt(i),p=parseInt(a[l-1]);return d===p+1})&&a.length===r.length&&r.length>1?`${r[0]}-${r[r.length-1]}`:r.join(", ")}}getValidBracketsArrayForPod(e){let t=e.players.flatMap(s=>"players"in s?s.players:[s]);if(t.length===0)return[];let r=new Map;if(t.forEach(s=>{s.brackets&&s.brackets.forEach(i=>{r.set(i,(r.get(i)||0)+1)})}),r.size===0)return[];let n=Math.ceil(t.length/2),o=[];for(let[s,i]of r.entries())i>=n&&o.push(s);let a=["1","2","3","4","cedh"];return o.sort((s,i)=>a.indexOf(s)-a.indexOf(i)),o}enterDisplayMode(e){if(e.length===0)return;this.isDisplayMode=!0,document.body.classList.add("display-mode");let t=Math.ceil(Math.sqrt(e.length)),r=B.get("div");r.className="display-mode-container",r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="100vw",r.style.height="100vh",r.style.background="#1a1a1a",r.style.zIndex="1000",r.style.padding="20px",r.style.boxSizing="border-box",r.style.overflow="hidden",r.innerHTML=`
            <div class="display-mode-controls">
                <button id="exit-display-btn">Exit Display Mode</button>
            </div>
            <h1 style="text-align: center; margin: 0 0 20px 0; font-size: 2.5rem; color: white;">MTG Commander Pods</h1>
            <div id="display-output" style="flex-grow: 1; height: calc(100vh - 140px);"></div>
        `;let n=document.querySelector(".container");n&&(n.style.display="none"),document.body.appendChild(r);let o=r.querySelector("#display-output"),a=B.get("div");a.style.display="grid",a.style.gap="20px",a.style.height="100%",a.style.gridTemplateColumns=`repeat(${t}, 1fr)`,a.style.gridTemplateRows=`repeat(${t}, 1fr)`;let s=this.getShuffledColors(e.length);e.forEach((l,d)=>{let p=B.get("div");p.style.display="flex",p.style.flexDirection="column",p.style.background="#2a2a2a",p.style.border=`3px solid ${s[d]}`,p.style.borderRadius="8px",p.style.padding="15px",p.style.boxSizing="border-box",p.style.minHeight="0",p.style.boxShadow=`0 0 10px ${s[d]}40`,p.classList.add("pod",`pod-color-${d%10}`);let u=B.get("h3"),b=document.getElementById("bracket-radio"),f=b&&b.checked;if(f){let v=this.calculateValidBracketRange(l);u.textContent=`Pod ${d+1} (Bracket: ${v})`}else{let v=_(l);u.textContent=`Pod ${d+1} (Power: ${v})`}u.style.fontSize="1.6rem",u.style.margin="0 0 15px 0",u.style.textAlign="center",u.style.color=s[d],u.style.fontWeight="bold",u.style.flexShrink="0",u.style.textShadow="1px 1px 2px rgba(0,0,0,0.8)",p.appendChild(u);let M=0;l.players.forEach(v=>{"players"in v?M+=v.players.length:M+=1});let m="";l.players.forEach(v=>{if("players"in v)v.players.forEach(L=>{let E=f&&L.bracketRange?`${L.name} (B: ${L.bracketRange})`:`${L.name} (P: ${L.powerRange})`;E.length>m.length&&(m=E)});else{let L=f&&v.bracketRange?`${v.name} (B: ${v.bracketRange})`:`${v.name} (P: ${v.powerRange})`;L.length>m.length&&(m=L)}});let h=B.get("ul");h.style.flexGrow="1",h.style.display="flex";let w=Math.ceil(Math.sqrt(M)),g=Math.ceil(M/w);h.style.display="grid",h.style.gridTemplateColumns=`repeat(${w}, 1fr)`,h.style.gridTemplateRows=`repeat(${g}, 1fr)`,h.style.gap="12px",h.style.margin="0",h.style.padding="0",h.style.listStyle="none",h.style.width="100%",h.style.height="100%",h.style.alignItems="stretch",h.style.justifyItems="stretch";let y=[];l.players.forEach(v=>{"players"in v?v.players.forEach(L=>y.push(L)):y.push(v)});let k=document.getElementById("bracket-radio"),x=k&&k.checked;y.forEach((v,L)=>{let E=B.get("li"),S=B.get("div");S.textContent=v.name,S.className="player-name";let C=B.get("div");if(x&&v.bracketRange){let G=this.getValidBracketsArrayForPod(l),q=he(v,G);C.innerHTML=`B: ${q}`}else{let G=W(l),q=U(v,G);C.innerHTML=`P: ${q}`}C.className="player-power",E.appendChild(S),E.appendChild(C),E.style.display="flex",E.style.flexDirection="column",E.style.justifyContent="center",E.style.alignItems="center",E.style.backgroundColor="rgba(255, 255, 255, 0.12)",E.style.border="2px solid rgba(255, 255, 255, 0.2)",E.style.borderRadius="12px",E.style.padding="8px",E.style.boxSizing="border-box",E.style.textAlign="center",E.style.height="100%",S.style.color="#ffffff",S.style.fontWeight="bold",S.style.lineHeight="1.1",S.style.marginBottom="4px",S.style.wordBreak="break-word",S.style.hyphens="auto",S.style.flexGrow="1",S.style.display="flex",S.style.alignItems="center",S.style.justifyContent="center",C.style.color="#b0b0b0",C.style.fontWeight="500",C.style.lineHeight="1",C.style.opacity="0.9",E.dataset.podRef=d.toString(),E.classList.add("dynamic-font-item"),h.appendChild(E)}),p.appendChild(h),a.appendChild(p)}),o.appendChild(a),requestAnimationFrame(()=>{a.querySelectorAll(".pod").forEach((d,p)=>{let u=d.getBoundingClientRect(),b=u.width,f=u.height,M=0;e[p].players.forEach(w=>{"players"in w?M+=w.players.length:M+=1});let m=this.calculateFontSizeForPod(b,f,M);d.querySelectorAll(".dynamic-font-item").forEach(w=>{let g=w.querySelector(".player-name"),y=w.querySelector(".player-power");if(g&&(g.style.fontSize=m),y){let k=Math.round(parseInt(m)*.75);y.style.fontSize=`${k}px`}})})}),r.querySelector("#exit-display-btn").addEventListener("click",()=>this.exitDisplayMode()),this.handleKeyDown=l=>{l.key==="Escape"&&this.isDisplayMode&&this.exitDisplayMode()},document.addEventListener("keydown",this.handleKeyDown)}exitDisplayMode(){this.isDisplayMode=!1,document.body.classList.remove("display-mode");let e=document.querySelector(".container");e&&(e.style.display="");let t=document.querySelector(".display-mode-container");t&&t.remove(),this.handleKeyDown&&(document.removeEventListener("keydown",this.handleKeyDown),this.handleKeyDown=null)}getIsDisplayMode(){return this.isDisplayMode}};var Z=class{constructor(){this.currentStep=0;this.tourSteps=[];this.tourOverlay=null;this.tourHighlight=null;this.tourTooltip=null;this.isActive=!1;this.originalScrollPosition=0;this.handleTourKeydown=e=>{if(this.isActive)switch(e.key){case"Escape":e.preventDefault(),e.stopPropagation(),this.endTour().catch(console.error);break;case"ArrowRight":case"Enter":e.preventDefault(),e.stopPropagation(),this.currentStep>=this.tourSteps.length-1?this.endTour().catch(console.error):this.nextStep().catch(console.error);break;case"ArrowLeft":e.preventDefault(),e.stopPropagation(),this.previousStep().catch(console.error);break}};this.initializeTourSteps()}initializeTourSteps(){this.tourSteps=[{id:"welcome",title:"\u{1F3AF} Welcome to Commander Pod Generator!",content:"This interactive tour will guide you through all the features step by step. You can exit at any time by pressing Escape or clicking the \u2715 Exit Tour button.",target:".container",position:"bottom",action:"none"},{id:"ranking-system",title:"\u2699\uFE0F Choose Your Ranking System",content:"First, choose between Power Level (1-10 scale) or Bracket (1,2,3,4,cEDH) system. Power Level gives more granular control, while Brackets are simpler and tournament-friendly.",target:"fieldset:first-of-type",position:"bottom",action:"none"},{id:"add-players",title:"\u{1F465} Adding Players",content:'Player names are entered here. The "Add Player" button and keyboard shortcut Ctrl+Enter are available for quickly adding more players when you use the app.',target:".player-row:first-child .player-name",position:"right",action:"type",actionData:"Alice",beforeStep:()=>this.ensurePlayerRows(1)},{id:"power-levels",title:"\u26A1 Setting Power Levels",content:'This button opens the power level selector. Individual levels or ranges can be selected, and typing shortcuts like "7-8" are supported for quick range selection.',target:".player-row:first-child .power-selector-btn",position:"left",action:"click",beforeStep:()=>this.ensurePowerMode()},{id:"power-selection",title:"\u{1F3AF} Power Level Selection",content:`Multiple power levels can be selected for each player. The quick range buttons (6-7, 7-8, 8-9) make common selections easy. We'll now select "7-8" for a medium power deck.`,target:".player-row:first-child .power-selector-dropdown",position:"right",action:"none",beforeStep:()=>{let e=document.querySelector(".player-row:first-child .power-selector-btn");e&&e.click(),setTimeout(()=>{let t=document.querySelector('.player-row:first-child .range-btn[data-range="7-8"]');t&&t.click()},200)}},{id:"add-more-players",title:"\u{1F680} Quick Player Addition",content:`The "Add 4 Players" button enables bulk addition, and Ctrl+Enter can be pressed repeatedly for individual players. We'll add more players for our demonstration.`,target:"#bulk-add-btn",position:"bottom",action:"click"},{id:"fill-players",title:"\u{1F4DD} Complete Player Information",content:"The remaining players will be filled with names and power levels. The tour will automatically provide example data to demonstrate the features.",target:".player-row:nth-child(2) .player-name",position:"right",action:"none",beforeStep:()=>this.fillExamplePlayers()},{id:"groups",title:"\u{1F46B} Creating Groups",content:'This dropdown allows grouping players who want to play together. "Start a New Group" creates a group, then other players can "Join Group" to join them.',target:".player-row:first-child .group-select",position:"left",action:"none"},{id:"group-demo",title:"\u{1F465} Group Creation Demo",content:"Now we'll create a group! Alice and Henry will be grouped together to demonstrate how the system works with compatible power levels.",target:".player-row:first-child .group-select",position:"left",action:"none",beforeStep:()=>this.createGroupDemo()},{id:"tolerance",title:"\u{1F39A}\uFE0F Power Level Tolerance",content:'In Power Level mode, tolerance can be adjusted. "No Leniency" requires exact matches, while "Regular" and "Super" leniency allow \xB10.5 and \xB11.0 differences respectively.',target:"fieldset:nth-of-type(2)",position:"top",action:"none",beforeStep:()=>this.ensurePowerMode()},{id:"pod-size-preference",title:"\u{1F4CF} Pod Size Preference",content:'Pod size preference determines how pods are organized. "Balanced" allows 3-5 player pods for flexibility, while "Avoid Large Pods" prefers smaller 3-4 player pods for more intimate games.',target:"fieldset:nth-of-type(3)",position:"top",action:"none"},{id:"generate",title:"\u{1F3B2} Generate Pods",content:"Once all players have names and power levels, this button generates balanced pods. The algorithm creates 3-4 player pods with similar power levels.",target:"#generate-pods-btn",position:"top",action:"click"},{id:"results",title:"\u{1F3C6} Pod Results",content:"Here are the generated pods! Players are grouped by compatible power levels. Players can be moved between pods using drag and drop if needed.",target:"#output-section",position:"top",action:"none"},{id:"unassigned-players",title:"\u26A0\uFE0F Unassigned Players",content:`If players can't be balanced into pods (due to power level mismatches or odd numbers), they'll appear as "unassigned." They can be manually dragged into existing pods.`,target:"#output-section",position:"top",action:"none"},{id:"drag-drop",title:"\u{1F5B1}\uFE0F Drag and Drop",content:"Pods can be reorganized by dragging players between them. This is useful for manual adjustments or accommodating player preferences after initial pod generation.",target:"#output-section",position:"top",action:"none"},{id:"display-mode",title:"\u{1F4FA} Display Mode",content:"This button enters Display Mode - a clean, full-screen view perfect for showing pods to players on a projector or large screen.",target:"#display-mode-btn",position:"bottom",action:"click"},{id:"display-features",title:"\u{1F3A8} Display Mode Features",content:"In Display Mode, pod titles show power level ranges, player names are clearly displayed, and automatic font scaling ensures readability. All editing controls are hidden for a clean presentation view.",target:".display-mode-container",position:"top",action:"none"},{id:"exit-display",title:"\u{1F6AA} Exit Display Mode",content:"This button exits Display Mode and returns to the main interface where changes can be made.",target:"#exit-display-btn",position:"bottom",action:"click"},{id:"reset",title:"\u{1F504} Reset and Undo",content:"The Reset All button clears everything. It includes a smart confirmation system and an undo feature that lasts 30 seconds - so experimentation is safe!",target:"#reset-all-btn",position:"top",action:"none"},{id:"keyboard-shortcuts",title:"\u2328\uFE0F Keyboard Shortcuts",content:'Pro tip: Ctrl+Enter adds players quickly, power ranges like "7-8" can be typed in selector buttons, and Escape closes any dropdown. The help contains the full list of shortcuts!',target:"#help-btn",position:"left",action:"none"},{id:"complete",title:"\u{1F389} Tour Complete!",content:"Congratulations! You now know all the main features. The Help button contains detailed information about keyboard shortcuts and advanced features. Happy pod organizing!",target:"#help-btn",position:"left",action:"none"}]}async startTour(){this.isActive||(this.isActive=!0,this.currentStep=0,this.originalScrollPosition=window.scrollY,this.createTourUI(),await this.showStep(0),this.setupTourEventListeners())}async endTour(){if(!this.isActive)return;this.isActive=!1,this.tourOverlay&&this.tourOverlay.classList.add("tour-ending"),this.tourHighlight&&this.tourHighlight.classList.add("tour-ending"),this.tourTooltip&&this.tourTooltip.classList.add("tour-ending");let e=document.querySelector(".tour-progress");if(e&&e.classList.add("tour-ending"),this.removeEventListeners(),document.body.classList.contains("display-mode")){let r=document.getElementById("exit-display-btn");r&&(r.click(),await this.waitForCondition(()=>!document.body.classList.contains("display-mode"),2e3))}setTimeout(()=>{this.removeTourUI(),this.cleanupRemainingElements()},50);let t=document.getElementById("reset-all-btn");if(t){let r=window.confirm;window.confirm=()=>!0,t.click(),setTimeout(()=>{window.confirm=r},100)}window.scrollTo(0,this.originalScrollPosition)}async forceEndTour(){if(this.isActive=!1,document.body.classList.contains("display-mode")){let t=document.getElementById("exit-display-btn");t&&(t.click(),await this.waitForCondition(()=>!document.body.classList.contains("display-mode"),2e3))}this.removeTourUI(),this.cleanupRemainingElements();let e=document.getElementById("reset-all-btn");if(e){let t=window.confirm;window.confirm=()=>!0,e.click(),setTimeout(()=>{window.confirm=t},100)}window.scrollTo(0,this.originalScrollPosition)}createTourUI(){this.tourOverlay=document.createElement("div"),this.tourOverlay.className="tour-overlay",this.tourOverlay.innerHTML=`
            <style>
                .tour-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0, 0, 0, 0.7);
                    z-index: 9998;
                    pointer-events: none;
                    opacity: 1;
                    transition: opacity 0.1s ease;
                }
                
                .tour-overlay.tour-ending {
                    opacity: 0;
                    pointer-events: none;
                }
                
                .tour-highlight {
                    position: absolute;
                    border: 5px solid #4CAF50;
                    border-radius: 8px;
                    box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.85), 
                               0 0 40px rgba(76, 175, 80, 1.2),
                               inset 0 0 0 2px rgba(255, 255, 255, 0.3);
                    z-index: 9999;
                    pointer-events: none;
                    transition: all 0.1s ease;
                    opacity: 1;
                }
                
                .tour-highlight.tour-ending {
                    opacity: 0;
                    pointer-events: none;
                }
                
                .tour-tooltip {
                    position: absolute;
                    background: linear-gradient(135deg, #2a2a2a, #3a3a3a);
                    color: white;
                    padding: 20px;
                    border-radius: 12px;
                    max-width: 350px;
                    z-index: 10000;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
                    border: 1px solid #4CAF50;
                    pointer-events: auto;
                    opacity: 1;
                    transition: opacity 0.15s ease;
                }
                
                .tour-tooltip.tour-ending {
                    opacity: 0;
                    pointer-events: none;
                }
                
                .tour-tooltip h3 {
                    margin: 0 0 10px 0;
                    color: #4CAF50;
                    font-size: 1.2rem;
                }
                
                .tour-tooltip p {
                    margin: 0 0 15px 0;
                    line-height: 1.5;
                }
                
                .tour-tooltip-buttons {
                    display: flex;
                    gap: 10px;
                    justify-content: flex-end;
                }
                
                .tour-btn {
                    padding: 8px 16px;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 0.9rem;
                    transition: all 0.2s ease;
                }
                
                .tour-btn-primary {
                    background: #4CAF50;
                    color: white;
                }
                
                .tour-btn-primary:hover {
                    background: #45a049;
                }
                
                .tour-btn-secondary {
                    background: #666;
                    color: white;
                }
                
                .tour-btn-secondary:hover {
                    background: #777;
                }
                
                .tour-progress {
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: rgba(42, 42, 42, 0.9);
                    color: white;
                    padding: 10px 15px;
                    border-radius: 20px;
                    font-size: 0.9rem;
                    z-index: 10001;
                    border: 1px solid #4CAF50;
                    opacity: 1;
                    transition: opacity 0.1s ease;
                    pointer-events: none;
                }
                
                .tour-progress.tour-ending {
                    opacity: 0;
                    pointer-events: none;
                }
            </style>
        `,this.tourHighlight=document.createElement("div"),this.tourHighlight.className="tour-highlight",this.tourTooltip=document.createElement("div"),this.tourTooltip.className="tour-tooltip",document.body.appendChild(this.tourOverlay),document.body.appendChild(this.tourHighlight),document.body.appendChild(this.tourTooltip)}async showStep(e){if(e>=this.tourSteps.length){await this.endTour();return}let t=this.tourSteps[e];this.currentStep=e,t.beforeStep&&t.beforeStep(),setTimeout(()=>{this.positionHighlight(t),this.showTooltip(t),this.updateProgress()},20)}positionHighlight(e){let t=document.querySelector(e.target);if(!t||!this.tourHighlight)return;if(e.target.includes("dropdown")){let a=t.closest(".player-row")?.querySelector(".power-selector-btn, .bracket-selector-btn");if(a&&t.style.display==="none"){a.click(),setTimeout(()=>this.positionHighlight(e),100);return}}let r=t.getBoundingClientRect(),n=window.scrollX,o=window.scrollY;this.tourHighlight.style.left=`${r.left+n-5}px`,this.tourHighlight.style.top=`${r.top+o-5}px`,this.tourHighlight.style.width=`${r.width+10}px`,this.tourHighlight.style.height=`${r.height+10}px`,t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}showTooltip(e){if(!this.tourTooltip)return;let r=this.currentStep===this.tourSteps.length-1?"Finish Tour":"Next";this.tourTooltip.innerHTML=`
            <h3>${e.title}</h3>
            <p>${e.content}</p>
            <div class="tour-tooltip-buttons">
                <button class="tour-btn tour-btn-secondary" id="tour-exit-btn">
                    \u2715 Exit Tour
                </button>
                ${this.currentStep>0?'<button class="tour-btn tour-btn-secondary" id="tour-prev-btn">Previous</button>':""}
                <button class="tour-btn tour-btn-primary" id="tour-next-btn">
                    ${r}
                </button>
            </div>
        `;let n=this.tourTooltip.querySelector("#tour-exit-btn"),o=this.tourTooltip.querySelector("#tour-prev-btn"),a=this.tourTooltip.querySelector("#tour-next-btn");n&&n.addEventListener("click",()=>this.endTour().catch(console.error)),o&&o.addEventListener("click",()=>this.previousStep().catch(console.error)),a&&a.addEventListener("click",()=>this.nextStep().catch(console.error)),this.positionTooltip(e)}positionTooltip(e){let t=document.querySelector(e.target);if(!t||!this.tourTooltip)return;let r=t.getBoundingClientRect(),n=this.tourTooltip.getBoundingClientRect(),o=window.scrollX,a=window.scrollY,s,i;switch(e.position){case"top":s=r.left+o+r.width/2-n.width/2,i=r.top+a-n.height-15;break;case"bottom":s=r.left+o+r.width/2-n.width/2,i=r.bottom+a+15;break;case"left":s=r.left+o-n.width-15,i=r.top+a+r.height/2-n.height/2;break;case"right":s=r.right+o+15,i=r.top+a+r.height/2-n.height/2;break}let l=window.innerWidth-n.width-20,d=window.innerHeight-n.height-20;s=Math.max(20,Math.min(s,l)),i=Math.max(20,Math.min(i,d)),this.tourTooltip.style.left=`${s}px`,this.tourTooltip.style.top=`${i}px`}updateProgress(){if(document.querySelectorAll(".tour-progress").forEach(r=>{r.parentNode&&r.parentNode.removeChild(r)}),!this.isActive)return;let t=document.createElement("div");t.className="tour-progress",t.textContent=`Step ${this.currentStep+1} of ${this.tourSteps.length}`,document.body.appendChild(t)}async nextStep(){if(this.currentStep>=this.tourSteps.length-1){await this.endTour();return}let e=this.tourSteps[this.currentStep];e.action&&e.action!=="none"&&this.performStepAction(e),e.afterStep&&e.afterStep();try{await this.waitForActionCompletion(e),await this.showStep(this.currentStep+1)}catch(t){console.warn("Tour step completion timed out, proceeding anyway:",t),await this.showStep(this.currentStep+1)}}async waitForActionCompletion(e){if(!e.action||e.action==="none")return Promise.resolve();switch(e.id){case"display-mode":return this.waitForCondition(()=>document.body.classList.contains("display-mode"),3e3);case"exit-display":return this.waitForCondition(()=>!document.body.classList.contains("display-mode"),3e3);case"generate":return this.waitForCondition(()=>document.querySelectorAll(".pod").length>0,5e3);case"reset":return this.waitForCondition(()=>document.querySelectorAll(".player-row").length<=1,3e3);case"add-player":return this.waitForCondition(()=>document.querySelectorAll(".player-row").length>1,2e3);case"type-text":return new Promise(t=>setTimeout(t,100));default:return new Promise(t=>setTimeout(t,50))}}waitForCondition(e,t=3e3){return new Promise((r,n)=>{let o=Date.now(),a=()=>{if(e()){r();return}if(Date.now()-o>=t){n(new Error(`Timeout waiting for condition after ${t}ms`));return}setTimeout(a,50)};a()})}async previousStep(){this.currentStep>0&&await this.showStep(this.currentStep-1)}performStepAction(e){let t=document.querySelector(e.target);if(t)switch(e.action){case"click":t.click();break;case"type":e.actionData&&t instanceof HTMLInputElement&&(t.value=e.actionData,t.dispatchEvent(new Event("input",{bubbles:!0})));break;case"hover":let r=new MouseEvent("mouseenter",{bubbles:!0});t.dispatchEvent(r);break}}setupTourEventListeners(){document.addEventListener("keydown",this.handleTourKeydown),window.tourManager=this}removeEventListeners(){document.removeEventListener("keydown",this.handleTourKeydown),delete window.tourManager}removeTourUI(){[this.tourOverlay,this.tourHighlight,this.tourTooltip].forEach(t=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),document.querySelectorAll(".tour-progress").forEach(t=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),this.tourOverlay=null,this.tourHighlight=null,this.tourTooltip=null}cleanupRemainingElements(){document.querySelectorAll(".tour-overlay, .tour-highlight, .tour-tooltip, .tour-progress").forEach(t=>{t&&t.parentNode&&t.parentNode.removeChild(t)})}ensurePlayerRows(e){let t=document.querySelectorAll(".player-row").length;if(t<e){let r=document.getElementById("add-player-btn");for(let n=t;n<e;n++)r?.click()}}ensurePowerMode(){let e=document.getElementById("power-level-radio");e&&!e.checked&&e.click()}fillExamplePlayers(){let e=[{name:"Henry",power:"8"},{name:"Charlie",power:"7"},{name:"Diana",power:"7"},{name:"Bob",power:"7"},{name:"Eve",power:"7"},{name:"Frank",power:"8"},{name:"Grace",power:"8"},{name:"Ivy",power:"8"}],t=document.querySelectorAll(".player-row");for(let r=1;r<t.length;r++){let n=t[r],o=n.querySelector(".player-name"),a=n.querySelector(".power-selector-btn"),s=r-1;if(s>=e.length)break;let i=e[s];o&&o.value.trim()===""&&(o.value=i.name,o.dispatchEvent(new Event("input",{bubbles:!0}))),a&&(n.querySelector(".power-checkbox input:checked")||(a.click(),setTimeout(()=>{let d=n.querySelector(`.power-checkbox input[value="${i.power}"]`);d&&(d.checked=!0,d.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{a.click()},50))},100)))}}createGroupDemo(){let e=document.querySelector(".player-row:first-child"),t=document.querySelector(".player-row:nth-child(2)");if(e&&t){let r=e.querySelector(".group-select");if(r&&Array.from(r.options).find(o=>o.value==="new-group")){r.value="new-group";let o=new Event("change",{bubbles:!0});r.dispatchEvent(o),setTimeout(()=>{let a=r.dataset.createdGroupId;if(a){let s=t.querySelector(".group-select");if(s){if(Array.from(s.options).find(l=>l.value===a)){s.value=a;let l=new Event("change",{bubbles:!0});s.dispatchEvent(l)}else if(Array.from(s.options).find(d=>d.value==="group-1")){s.value="group-1";let d=new Event("change",{bubbles:!0});s.dispatchEvent(d)}}}},800)}}}};var ne=class{constructor(){this.listeners=new Map;this.abortController=new AbortController}addEventListener(e,t,r,n){let o=this.generateId(),a={...typeof n=="object"?n:{capture:n},signal:this.abortController.signal};return e.addEventListener(t,r,a),this.listeners.set(o,{element:e,type:t,listener:r,options:a}),o}removeEventListener(e){let t=this.listeners.get(e);return t?(t.element.removeEventListener(t.type,t.listener,t.options),this.listeners.delete(e),!0):!1}removeAllFromElement(e){let t=0;for(let[r,n]of this.listeners.entries())n.element===e&&(n.element.removeEventListener(n.type,n.listener,n.options),this.listeners.delete(r),t++);return t}removeAll(){this.abortController.abort(),this.abortController=new AbortController,this.listeners.clear()}getListenerCount(){return this.listeners.size}generateId(){return`listener_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}},oe=new ne;var T=class{static clearDuplicateErrors(e){e.forEach(t=>{let r=t.querySelector(".player-name");r&&r.classList.remove("name-duplicate-error",...this.DUPLICATE_ERROR_CLASSES)})}static highlightDuplicateNames(e){this.clearDuplicateErrors(e);let t=new Map;e.forEach(o=>{let a=o.querySelector(".player-name");if(a){let s=a.value.trim().toLowerCase();s&&(t.has(s)||t.set(s,[]),t.get(s).push(a))}});let r=[],n=0;return t.forEach((o,a)=>{if(o.length>1){r.push(a);let s=this.DUPLICATE_ERROR_CLASSES[n];o.forEach(i=>{i.classList.add(s)}),n=(n+1)%this.DUPLICATE_ERROR_CLASSES.length}}),r}static hasSelectedCheckboxes(e){return Array.from(e).some(t=>t.checked)}static getSelectedCheckboxValues(e){return Array.from(e).filter(t=>t.checked).map(t=>t.value)}static addValidationError(e,t="error"){e.classList.add(t),e.dataset&&(e.dataset.validationTriggered="true")}static removeValidationError(e,t="error"){e.classList.remove(t)}static hasValidationError(e,t="error"){return e.classList.contains(t)}};T.DUPLICATE_ERROR_CLASSES=["name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5"];var $=class{static formatPowerButtonText(e){if(e.length===0)return"Select Power Levels";if(e.sort((o,a)=>o-a),e.length===1)return`Power: ${e[0]}`;let t=e[0],r=e[e.length-1];return e.every((o,a)=>{if(a===0)return!0;let s=o-e[a-1];return s===.5||s===1})&&e.length>2?`Power: ${t}-${r}`:e.length<=4?`Power: ${e.join(", ")}`:`Power: ${t}-${r} (${e.length} levels)`}static formatBracketButtonText(e){return e.length===0?"Select Brackets":e.length===1?`Bracket: ${e[0]==="cedh"?"cEDH":e[0]}`:e.length<=3?`Brackets: ${e.join(", ")}`:`Brackets: ${e.length} selected`}static updateButtonState(e,t,r){e.textContent=t,r?(e.classList.add("has-selection"),T.removeValidationError(e)):(e.classList.remove("has-selection"),e.dataset.validationTriggered==="true"&&T.addValidationError(e))}},D=class{static getElement(e,t,r){let n=e.querySelector(t);return n?r&&!r(n)?(console.warn(`Element ${t} found but failed type check`),null):n:null}static getAllElements(e,t,r){let n=Array.from(e.querySelectorAll(t));return r?n.filter(r):n}static setClasses(e,t,r=!0){r?e.classList.add(...t):e.classList.remove(...t)}static toggleClass(e,t,r){r?e.classList.add(t):e.classList.remove(t)}},z=class{static addEventListener(e,t,r,n){return e.addEventListener(t,r,n),()=>{e.removeEventListener(t,r,n)}}static debounce(e,t){let r;return(...n)=>{clearTimeout(r),r=window.setTimeout(()=>e(...n),t)}}static throttle(e,t){let r;return(...n)=>{r||(e(...n),r=!0,setTimeout(()=>r=!1,t))}}};var I=class{static updatePowerButton(e){let t=D.getElement(e,".power-selector-btn");if(!t)return;let r=e.querySelectorAll('.power-checkbox input[type="checkbox"]'),n=[];r.forEach(s=>{s.checked&&n.push(parseFloat(s.value))});let o=$.formatPowerButtonText(n),a=n.length>0;$.updateButtonState(t,o,a)}static updateBracketButton(e){let t=D.getElement(e,".bracket-selector-btn");if(!t)return;let r=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),n=T.getSelectedCheckboxValues(r),o=$.formatBracketButtonText(n),a=n.length>0;$.updateButtonState(t,o,a)}static updateAllButtonsForRow(e){this.updatePowerButton(e),this.updateBracketButton(e)}static updateAllButtons(e){D.getAllElements(e,".player-row").forEach(r=>this.updateAllButtonsForRow(r))}static createPowerButtonUpdater(e){return()=>this.updatePowerButton(e)}static createBracketButtonUpdater(e){return()=>this.updateBracketButton(e)}static createRowButtonUpdater(e){return()=>this.updateAllButtonsForRow(e)}static triggerValidationForRow(e){let r=document.getElementById("bracket-radio")?.checked??!1,n=D.getElement(e,".power-selector-btn"),o=D.getElement(e,".bracket-selector-btn");if(n&&(n.dataset.validationTriggered="true"),o&&(o.dataset.validationTriggered="true"),r&&o){let a=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]');T.hasSelectedCheckboxes(a)||T.addValidationError(o)}else if(n){let a=e.querySelectorAll('.power-checkbox input[type="checkbox"]');T.hasSelectedCheckboxes(a)||T.addValidationError(n)}}static triggerValidationForAllRows(e){D.getAllElements(e,".player-row").forEach(r=>this.triggerValidationForRow(r))}};var ae=class{constructor(){this.cache=new Map;this.weakRefCache=new WeakMap}get(e,t=document){let r=this.getCacheKey(e,t);if(this.cache.has(r)){let o=this.cache.get(r);if(o&&o.isConnected)return o;this.cache.delete(r)}let n=t.querySelector(e);return n&&this.cache.set(r,n),n}getAll(e,t=document){let r=this.getCacheKey(e+":all",t);if(this.cache.has(r)){let o=this.cache.get(r);if(o&&o.length>0&&o[0].isConnected)return o;this.cache.delete(r)}let n=t.querySelectorAll(e);return this.cache.set(r,n),n}getFromRow(e,t){let r=this.weakRefCache.get(e);if(r||(r=new Map,this.weakRefCache.set(e,r)),r.has(t)){let o=r.get(t);if(o&&o.isConnected)return o;r.delete(t)}let n=e.querySelector(t);return n&&r.set(t,n),n}getAllFromRow(e,t){let r=this.weakRefCache.get(e);r||(r=new Map,this.weakRefCache.set(e,r));let n=t+":all";if(r.has(n)){let a=r.get(n);if(a&&a.length>0&&a[0].isConnected)return a;r.delete(n)}let o=e.querySelectorAll(t);return r.set(n,o),o}invalidate(e,t=document){if(e){let r=this.getCacheKey(e,t);this.cache.delete(r),this.cache.delete(r+":all")}else this.cache.clear()}clear(){this.cache.clear()}getCacheKey(e,t){return t===document?e:`${e}@${t.tagName}:${t.className}`}},P=new ae;var F=class F{constructor(){this.nameValidationCallbacks=new Map;this.duplicateCheckCallback=null}setupNameValidation(e,t){this.duplicateCheckCallback||(this.duplicateCheckCallback=z.debounce(t,F.VALIDATION_DEBOUNCE_MS));let r=z.debounce(()=>{e.dataset.touched="true",!e.value.trim()&&e.dataset.touched==="true"?T.addValidationError(e,"input-error"):T.removeValidationError(e,"input-error"),this.duplicateCheckCallback&&this.duplicateCheckCallback()},F.VALIDATION_DEBOUNCE_MS);this.nameValidationCallbacks.set(e,r),e.addEventListener("input",r)}setupDropdownToggle(e,t,r){let n=z.throttle(o=>{o.preventDefault();let a=t.style.display!=="none";r(),a||(t.style.display="block",e.classList.add("open"),setTimeout(()=>t.classList.add("show"),10))},F.DROPDOWN_THROTTLE_MS);e.addEventListener("click",n)}batchValidateRows(e){let t=performance.now(),r=Array.from(e.querySelectorAll(".player-row")),n=!1,o=T.highlightDuplicateNames(r);return o.length>0&&(n=!0),r.forEach(s=>{let i=s.querySelector(".player-name");i.value.trim()||(T.addValidationError(i,"input-error"),n=!0)}),I.triggerValidationForAllRows(e),{validationTime:performance.now()-t,duplicateNames:o,hasErrors:n}}cleanup(){this.nameValidationCallbacks.clear(),this.duplicateCheckCallback=null}static trackValidationPerformance(e){e>100&&console.warn(`Slow validation detected: ${e.toFixed(2)}ms`),"performance"in window&&"mark"in performance&&performance.mark(`validation-${Date.now()}`)}};F.VALIDATION_DEBOUNCE_MS=300,F.DROPDOWN_THROTTLE_MS=100;var se=F,ee=new se;var ie=class{constructor(){this.metrics={bundleSize:"59.2kb",memoryUsage:0,domCacheHits:0,validationTime:0,podGenerationTime:0,lastUpdated:new Date}}updateMemoryUsage(){"memory"in performance&&(this.metrics.memoryUsage=Math.round((performance.memory?.usedJSHeapSize||0)/1024/1024*100)/100),this.metrics.lastUpdated=new Date}trackValidationTime(e){this.metrics.validationTime=Math.round(e*100)/100,this.metrics.lastUpdated=new Date}trackPodGenerationTime(e){this.metrics.podGenerationTime=Math.round(e*100)/100,this.metrics.lastUpdated=new Date}getMetrics(){return this.updateMemoryUsage(),{...this.metrics}}logMetrics(){let e=this.getMetrics();console.group("\u{1F50D} Performance Analysis"),console.log("\u{1F4E6} Bundle Size:",e.bundleSize,"(+7.1kb from 52.1kb baseline)"),console.log("\u{1F4CA} Growth Rate: +13.6% (efficient for added functionality)"),console.log("\u{1F4BE} Memory Usage:",`${e.memoryUsage}MB`),console.log("\u26A1 Validation Time:",`${e.validationTime}ms`),console.log("\u{1F3AF} Pod Generation:",`${e.podGenerationTime}ms`),console.group("\u{1F4C8} Helper Module Impact"),console.log("\u2705 ButtonTextManager: +2.7kb (display state management)"),console.log("\u2705 DOMCache: +1.2kb (query optimization)"),console.log("\u2705 RealTimeValidator: +1.5kb (instant feedback)"),console.log("\u2705 TypeGuards: +0.7kb (runtime type safety)"),console.log("\u2705 PerformanceMonitor: +1.0kb (metrics tracking)"),console.groupEnd(),console.log("\u{1F3AF} Next: Validation consolidation & event optimization"),console.groupEnd()}},K=new ie;function A(c){return c instanceof HTMLElement}function V(c){return c instanceof HTMLInputElement}function N(c){return c instanceof HTMLButtonElement}function H(c,e){let t=document.getElementById(c);return t?e(t)?t:(console.warn(`Element #${c} exists but is not the expected type`),null):null}function O(c,e){let t=c.target;return!t||!e(t)?null:t}function R(c,e){if(c==null)throw new Error(e||"Assertion failed: value is null or undefined");return c}var te=class{constructor(){this.displayModeManager=null;this.tourManager=null;this.currentPods=[];this.currentUnassigned=[];this.lastResetData=null;this.isRestoring=!1;this.displayModeBtnBottom=null;this.reusablePlayerArray=[];this.reusableItemArray=[];this.reusablePlayerObject={};this.reusableGroupObject={};this.containerClickHandler=null;this.containerChangeHandler=null;this.containerInputHandler=null;this.documentClickHandler=null;try{this.playerRowsContainer=R(H("player-rows",A),"player-rows container is required"),this.outputSection=R(H("output-section",A),"output-section is required"),this.resultsCard=R(document.querySelector(".results-card"),"results-card is required"),this.displayModeBtn=R(H("display-mode-btn",N),"display-mode-btn is required"),this.playerRowTemplate=R(document.getElementById("player-row-template"),"player-row-template is required"),this.playerManager=new Y,this.podGenerator=new J,this.dragDropManager=new X(this.playerManager,(e,t)=>this.renderPods(e,t)),this.safeInitialization(),window.performanceMonitor=K}catch(e){console.error("Critical error during UIManager initialization:",e),this.showErrorMessage(`Failed to initialize the application. Please refresh the page. Error: ${e instanceof Error?e.message:"Unknown error"}`)}}safeInitialization(){try{this.initializeEventListeners()}catch(e){console.error("Error initializing event listeners:",e)}try{this.initializeRankingModeToggle()}catch(e){console.error("Error initializing ranking mode toggle:",e)}try{this.setupRealTimeValidationForExistingRows()}catch(e){console.error("Error setting up real-time validation:",e)}}initializeEventListeners(){let e=R(H("add-player-btn",N),"add-player-btn is required"),t=R(H("bulk-add-btn",N),"bulk-add-btn is required"),r=R(H("generate-pods-btn",N),"generate-pods-btn is required"),n=R(H("reset-all-btn",N),"reset-all-btn is required"),o=R(H("help-btn",N),"help-btn is required");e.addEventListener("click",()=>this.addPlayerRow()),t.addEventListener("click",()=>this.bulkAddPlayers(4)),r.addEventListener("click",()=>this.generatePods()),n.addEventListener("click",()=>this.resetAllWithConfirmation()),this.displayModeBtn.addEventListener("click",()=>this.enterDisplayModeWithWarning()),o.addEventListener("click",()=>this.showHelpModal());let a=R(H("settings-toggle",N),"settings-toggle is required"),s=R(H("sidebar-close",N),"sidebar-close is required"),i=R(H("settings-sidebar",A),"settings-sidebar is required");a.addEventListener("click",()=>{let l=i.classList.contains("open");this.toggleSidebar(!l)}),s.addEventListener("click",()=>this.toggleSidebar(!1)),document.addEventListener("click",l=>{let d=O(l,A);d&&!i.contains(d)&&!a.contains(d)&&i.classList.contains("open")&&this.toggleSidebar(!1)}),this.setupEventDelegation(),this.initializeHelpModal(),this.initializeKeyboardShortcuts()}clearDOMCache(){P.clear(),B.clear()}showErrorMessage(e){console.error("UIManager Error:",e),alert(e)}showSuccessMessage(e){console.log("UIManager Success:",e),alert(e)}processGroupsSafely(){let e=new Map;try{this.playerManager.getGroups().forEach((t,r)=>{if(!t||t.length===0){console.warn(`Skipping empty group: ${r}`);return}if(!t.every(a=>a&&typeof a.power=="number")){console.warn(`Skipping group with invalid player data: ${r}`);return}let n=t.reduce((a,s)=>a+s.power,0),o=Math.round(n/t.length*2)/2;Object.assign(this.reusableGroupObject,{id:r,players:t,averagePower:o,size:t.length}),e.set(r,{...this.reusableGroupObject})})}catch(t){console.error("Error processing groups:",t)}return e}addEventListenerWithTracking(e,t,r){oe.addEventListener(e,t,r)}removeAllEventListeners(e){oe.removeAllFromElement(e)}setupEventDelegation(){this.containerClickHandler||(this.containerClickHandler=e=>this.handleContainerClick(e),this.playerRowsContainer.addEventListener("click",this.containerClickHandler)),this.containerChangeHandler||(this.containerChangeHandler=e=>this.handleContainerChange(e),this.playerRowsContainer.addEventListener("change",this.containerChangeHandler)),this.containerInputHandler||(this.containerInputHandler=e=>this.handleContainerInput(e),this.playerRowsContainer.addEventListener("input",this.containerInputHandler)),this.documentClickHandler||(this.documentClickHandler=e=>this.handleDocumentClick(e),document.addEventListener("click",this.documentClickHandler))}setupRealTimeValidationForExistingRows(){P.getAll(".player-row",this.playerRowsContainer).forEach(t=>{let r=P.getFromRow(t,".player-name");r&&ee.setupNameValidation(r,()=>this.clearDuplicateErrorsOnInput())})}handleContainerClick(e){let t=O(e,A);if(t){if(t.classList.contains("power-selector-btn")){this.handlePowerSelectorClick(e,t);return}if(t.classList.contains("bracket-selector-btn")){this.handleBracketSelectorClick(e,t);return}if(t.classList.contains("range-btn")){this.handleRangeButtonClick(t);return}if(t.classList.contains("bracket-range-btn")){this.handleBracketRangeButtonClick(t);return}if(t.classList.contains("clear-btn")||t.classList.contains("bracket-clear-btn")){this.handleClearButtonClick(t);return}if(t.classList.contains("remove-player-btn")){this.handleRemoveButtonClick(t);return}}}handleContainerChange(e){let t=O(e,A);if(t){if(t.classList.contains("group-select")){this.playerManager.handleGroupChange(this.playerRowsContainer);return}if(V(t)&&t.type==="checkbox"&&t.closest(".power-checkbox")){this.handlePowerCheckboxChange(t);return}if(V(t)&&t.type==="checkbox"&&t.closest(".bracket-checkbox")){this.handleBracketCheckboxChange(t);return}if(t.classList.contains("player-name")&&V(t)){this.handlePlayerNameChange(t);return}}}handleContainerInput(e){let t=O(e,A);if(t&&t.classList.contains("player-name")){let r=O(e,V);r&&this.handlePlayerNameChange(r);return}}handleDocumentClick(e){let t=O(e,A);t&&!t.closest(".power-selector-btn")&&!t.closest(".power-selector-dropdown")&&!t.closest(".bracket-selector-btn")&&!t.closest(".bracket-selector-dropdown")&&this.closeAllDropdowns()}closeAllDropdowns(){document.querySelectorAll(".bracket-selector-dropdown, .power-selector-dropdown").forEach(n=>{n.style.display="none",n.classList.remove("show")}),document.querySelectorAll(".power-selector-btn, .bracket-selector-btn").forEach(n=>{n.classList.remove("open")}),document.querySelectorAll(".player-row").forEach(n=>{n.classList.remove("dropdown-open")})}handlePowerSelectorClick(e,t){e.preventDefault(),this.handleDropdownToggle(t,".power-selector-dropdown")}handleBracketSelectorClick(e,t){e.preventDefault(),this.handleDropdownToggle(t,".bracket-selector-dropdown")}findPlayerRow(e){return e.closest(".player-row")}handleDropdownToggle(e,t){let r=this.findPlayerRow(e);if(!r)return;let n=P.getFromRow(r,t);if(!n)return;let o=n.style.display!=="none";this.closeAllDropdowns(),o||(n.style.display="block",e.classList.add("open"),r.classList.add("dropdown-open"),setTimeout(()=>n.classList.add("show"),10))}handleRangeButtonClick(e){let t=this.findPlayerRow(e);if(!t||!t)return;let r=e.dataset.range,n=P.getAllFromRow(t,'.power-checkbox input[type="checkbox"]');n.forEach(s=>s.checked=!1);let[o,a]=r.split("-").map(Number);n.forEach(s=>{let i=parseFloat(s.value);(i===o||i===a)&&(s.checked=!0)}),I.updatePowerButton(t)}handleBracketRangeButtonClick(e){let t=this.findPlayerRow(e);if(!t)return;let r=e.dataset.range,n=P.getAllFromRow(t,'.bracket-checkbox input[type="checkbox"]');if(n.forEach(o=>o.checked=!1),r==="cedh"){let o=Array.from(n).find(a=>a.value==="cedh");o&&(o.checked=!0)}else{let[o,a]=r.split("-").map(s=>s==="cedh"?s:parseInt(s));n.forEach(s=>{let i=s.value==="cedh"?"cedh":parseInt(s.value);(i===o||i===a)&&(s.checked=!0)})}I.updateBracketButton(t)}handleClearButtonClick(e){let t=this.findPlayerRow(e);t&&(e.classList.contains("clear-btn")?(P.getAllFromRow(t,'.power-checkbox input[type="checkbox"]').forEach(n=>n.checked=!1),I.updatePowerButton(t)):e.classList.contains("bracket-clear-btn")&&(P.getAllFromRow(t,'.bracket-checkbox input[type="checkbox"]').forEach(n=>n.checked=!1),I.updateBracketButton(t)))}handleRemoveButtonClick(e){let t=this.findPlayerRow(e);t&&(this.removeAllEventListeners(t),this.playerRowsContainer.removeChild(t),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.updatePlayerNumbers(),this.clearDOMCache())}handlePowerCheckboxChange(e){let t=this.findPlayerRow(e);t&&I.updatePowerButton(t)}handleBracketCheckboxChange(e){let t=this.findPlayerRow(e);t&&I.updateBracketButton(t)}handlePlayerNameChange(e){}getPlayerRowsOptimized(){let e=P.getAll(".player-row",this.playerRowsContainer),t=[];for(let r=0;r<e.length;r++)t.push(e[r]);return t}clearReusableArrays(){this.reusablePlayerArray.length=0,this.reusableItemArray.length=0,this.reusablePlayerObject={},this.reusableGroupObject={}}createElement(e){return B.get(e)}addPlayerRow(){let t=this.playerRowTemplate.content.cloneNode(!0).querySelector(".player-row"),r=this.playerManager.getNextPlayerId();t.dataset.playerId=r.toString(),I.updatePowerButton(t),I.updateBracketButton(t),this.playerRowsContainer.appendChild(t);let n=P.getFromRow(t,".player-name");n&&ee.setupNameValidation(n,()=>this.clearDuplicateErrorsOnInput()),this.clearDOMCache(),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.clearDOMCache(),this.updatePlayerNumbers();let a=H("bracket-radio",V)?.checked??!1,s=P.getFromRow(t,".power-levels"),i=P.getFromRow(t,".bracket-levels");a&&s&&i?(s.style.display="none",i.style.display="block"):s&&i&&(s.style.display="block",i.style.display="none")}bulkAddPlayers(e){for(let t=0;t<e;t++)this.addPlayerRow()}initializeKeyboardShortcuts(){let e="",t=null,r="",n=null;document.addEventListener("keydown",o=>{if(o.ctrlKey&&o.key==="p"){o.preventDefault(),K.logMetrics();return}if(o.ctrlKey&&o.key==="Enter"){o.preventDefault(),this.addPlayerRow();let s=P.getAll(".player-row",this.playerRowsContainer),i=s[s.length-1],l=P.getFromRow(i,".player-name");l&&l.focus();return}let a=document.activeElement;if(A(a)&&a.classList.contains("power-selector-btn")){if(o.key==="Escape"){o.preventDefault(),this.closeAllDropdowns();return}if(o.key==="Enter"){o.preventDefault(),e.trim()&&(this.selectPowerByKeyboard(a,e.trim()),e="",t&&(clearTimeout(t),t=null));return}if(o.key.match(/[0-9.\-]/)||o.key==="Backspace"){o.preventDefault(),o.key==="Backspace"?e=e.slice(0,-1):e+=o.key,t&&clearTimeout(t),t=setTimeout(()=>{e.trim()&&(this.selectPowerByKeyboard(a,e.trim()),e=""),t=null},1e3);return}}if(A(a)&&a.classList.contains("bracket-selector-btn")){if(o.key==="Escape"){o.preventDefault(),this.closeAllDropdowns();return}if(o.key==="Enter"){o.preventDefault(),r.trim()&&(this.selectBracketByKeyboard(a,r.trim()),r="",n&&(clearTimeout(n),n=null));return}if(o.key.match(/[1-5c\-]/)||o.key==="Backspace"||o.key==="C"){o.preventDefault(),o.key==="Backspace"?r=r.slice(0,-1):r+=o.key.toLowerCase(),n&&clearTimeout(n),n=setTimeout(()=>{r.trim()&&(this.selectBracketByKeyboard(a,r.trim()),r=""),n=null},1e3);return}}})}selectBracketByKeyboard(e,t){let r=this.findPlayerRow(e);if(!r)return;let n=P.getAllFromRow(r,'.bracket-checkbox input[type="checkbox"]');if(n.forEach(a=>a.checked=!1),t.includes("-")){let a=t.split("-");if(a.length===2){let s=a[0].trim(),i=a[1].trim(),l=u=>u==="cedh"||u==="c"?5:parseInt(u),d=l(s),p=l(i);!isNaN(d)&&!isNaN(p)&&d<=p&&n.forEach(u=>{let b=l(u.value);b>=d&&b<=p&&(u.checked=!0)})}}else{let a=t;t==="c"&&(a="cedh"),t==="5"&&(a="cedh");let s=P.getFromRow(r,`.bracket-checkbox input[value="${a}"]`);s&&(s.checked=!0)}let o=Array.from(n).filter(a=>a.checked);o.forEach(a=>{a.dispatchEvent(new Event("change",{bubbles:!0}))}),o.length===0&&n[0]?.dispatchEvent(new Event("change",{bubbles:!0})),this.closeAllDropdowns()}selectPowerByKeyboard(e,t){let r=this.findPlayerRow(e);if(!r)return;let n=P.getAllFromRow(r,'.power-checkbox input[type="checkbox"]');if(n.forEach(a=>a.checked=!1),t.includes("-")){let a=t.split("-");if(a.length===2){let s=parseFloat(a[0]),i=parseFloat(a[1]);if(!isNaN(s)&&!isNaN(i)&&s<=i){let l=Number.isInteger(s)&&Number.isInteger(i);n.forEach(d=>{let p=parseFloat(d.value);if(p>=s&&p<=i){if(l&&!Number.isInteger(p))return;d.checked=!0}})}}}else{let a=parseFloat(t);if(!isNaN(a)){let s=P.getFromRow(r,`.power-checkbox input[value="${a}"]`);s&&(s.checked=!0)}}let o=Array.from(n).filter(a=>a.checked);o.forEach(a=>{a.dispatchEvent(new Event("change",{bubbles:!0}))}),o.length===0&&n[0]?.dispatchEvent(new Event("change",{bubbles:!0})),this.closeAllDropdowns()}cleanupBottomDisplayButton(){if(this.displayModeBtnBottom){let e=this.displayModeBtnBottom.parentNode;e&&e.parentNode&&e.parentNode.removeChild(e),this.displayModeBtnBottom=null}}generatePods(){this.triggerValidationForAllFields(),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.updateResultsCardVisibility(),this.playerManager.handleGroupChange(this.playerRowsContainer),this.clearReusableArrays();let e=this.getPlayerRowsOptimized();T.clearDuplicateErrors(e);let t=T.highlightDuplicateNames(e),r=t.length>0;for(let h=0;h<e.length;h++){let w=this.playerManager.getPlayerFromRow(e[h]);w?this.reusablePlayerArray.push(w):r=!0}if(r){let h="Please fix the errors before generating pods.";t.length>0&&(h+=`

Duplicate player names found: ${t.join(", ")}`),this.showErrorMessage(h);return}let n=new Map;this.playerManager.getGroups().forEach((h,w)=>{let g=h.reduce((k,x)=>k+x.power,0),y=Math.round(g/h.length*2)/2;Object.assign(this.reusableGroupObject,{id:w,players:h,averagePower:y,size:h.length}),n.set(w,{...this.reusableGroupObject})});let o=new Set([...this.playerManager.getGroups().values()].flat().map(h=>h.id)),a=this.reusablePlayerArray.filter(h=>!o.has(h.id));this.reusableItemArray.length=0,this.reusableItemArray.push(...a),n.forEach(h=>{this.reusableItemArray.push({id:h.id,players:h.players,averagePower:h.averagePower,size:h.size})});let s=this.reusablePlayerArray.length;if(s<3){this.showErrorMessage("You need at least 3 players to form a pod.");return}let l=de()==="avoid-five"?ce(s):j(s),d=ue();if(typeof window<"u"&&(window.location.protocol==="file:"||window.__playwright!==void 0||window.playwright!==void 0)){let h=this.reusablePlayerArray.map(g=>g.name).join(""),w=Array.from(h).reduce((g,y)=>g+y.charCodeAt(0),0);this.podGenerator.setShuffleSeed(w)}else this.podGenerator.setShuffleSeed(null);let u=performance.now(),b=this.podGenerator.generatePodsWithBacktracking(this.reusableItemArray,l,d),f=performance.now();K.trackPodGenerationTime(f-u);let M=b.pods,m=b.unassigned;this.currentPods=[...M],this.currentUnassigned=[...m],this.renderPods(M,m)}renderPods(e,t=[]){try{if(!Array.isArray(e))throw new Error("Invalid pods array provided to renderPods");if(!Array.isArray(t))throw new Error("Invalid unassignedPlayers array provided to renderPods");if(this.currentPods=[...e],this.currentUnassigned=[...t],this.dragDropManager.setCurrentPods(this.currentPods,this.currentUnassigned),this.cleanupBottomDisplayButton(),!this.outputSection)throw new Error("Output section not found - cannot render pods");if(this.outputSection.innerHTML="",this.updateResultsCardVisibility(),e.length===0){this.outputSection.textContent="Could not form pods with the given players.",this.displayModeBtn&&(this.displayModeBtn.style.display="none");return}this.displayModeBtn&&(this.displayModeBtn.style.display="inline-block"),this.renderPodsToDOM(e,t)}catch(r){console.error("Error in renderPods:",r),this.showErrorMessage(`Failed to display pods: ${r instanceof Error?r.message:"Unknown error"}. Please try generating pods again.`),this.outputSection&&(this.outputSection.textContent="Error displaying pods. Please try again."),this.displayModeBtn&&(this.displayModeBtn.style.display="none")}}renderPodsToDOM(e,t){let r=Math.ceil(Math.sqrt(e.length)),n=document.createDocumentFragment(),o=this.createElement("div");if(o.classList.add("pods-container"),o.style.gridTemplateColumns=`repeat(${r}, 1fr)`,o.style.gridTemplateRows=`repeat(${r}, 1fr)`,e.forEach((s,i)=>{let l=this.createElement("div");l.classList.add("pod",`pod-color-${i%10}`),l.dataset.podIndex=i.toString(),l.addEventListener("dragover",this.dragDropManager.handleDragOver),l.addEventListener("drop",this.dragDropManager.handleDrop),l.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let d=this.createElement("h3"),p=document.getElementById("bracket-radio");if(p&&p.checked){let f=this.calculateValidBracketRange(s);d.textContent=`Pod ${i+1} (Bracket: ${f})`}else{let f=_(s);d.textContent=`Pod ${i+1} (Power: ${f})`}l.appendChild(d);let b=this.createElement("ul");s.players.forEach((f,M)=>{if("players"in f){let m=this.createElement("li");m.classList.add("pod-group"),m.draggable=!0,m.dataset.itemType="group",m.dataset.itemId=f.id,m.dataset.podIndex=i.toString(),m.dataset.itemIndex=M.toString(),m.addEventListener("dragstart",this.dragDropManager.handleDragStart),m.addEventListener("dragend",this.dragDropManager.handleDragEnd);let h=document.getElementById("bracket-radio"),w=h&&h.checked,g=this.createElement("strong");w?g.textContent=`Group ${f.id.split("-")[1]}:`:g.textContent=`Group ${f.id.split("-")[1]} (Avg Power: ${f.averagePower}):`,m.appendChild(g);let y=this.createElement("ul");f.players.forEach(k=>{let x=this.createElement("li");if(w&&k.bracketRange)x.textContent=`${k.name} (B: ${k.bracketRange})`;else{let v=W(s),L=U(k,v);x.innerHTML=`${k.name} (P: ${L})`}y.appendChild(x)}),m.appendChild(y),b.appendChild(m)}else{let m=this.createElement("li");m.classList.add("pod-player"),m.draggable=!0,m.dataset.itemType="player",m.dataset.itemId=f.id.toString(),m.dataset.podIndex=i.toString(),m.dataset.itemIndex=M.toString(),m.addEventListener("dragstart",this.dragDropManager.handleDragStart),m.addEventListener("dragend",this.dragDropManager.handleDragEnd);let h=document.getElementById("bracket-radio");if(h&&h.checked&&f.bracketRange)m.textContent=`${f.name} (B: ${f.bracketRange})`;else{let g=W(s),y=U(f,g);m.innerHTML=`${f.name} (P: ${y})`}b.appendChild(m)}}),l.appendChild(b),o.appendChild(l)}),e.length>0){let s=this.createElement("div");s.classList.add("pod","new-pod","new-pod-target"),s.style.borderColor="#4CAF50",s.style.backgroundColor="#1f2a1f",s.style.borderStyle="dashed",s.dataset.podIndex="new-pod",s.addEventListener("dragover",this.dragDropManager.handleDragOver),s.addEventListener("drop",this.dragDropManager.handleDrop),s.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let i=this.createElement("h3");i.textContent="Create New Pod",i.style.color="#4CAF50",s.appendChild(i);let l=this.createElement("p");l.textContent="Drag players or groups here to create a new pod",l.style.color="#999",l.style.fontStyle="italic",l.style.textAlign="center",l.style.margin="20px 0",s.appendChild(l),o.appendChild(s)}if(t.length>0){let s=this.createElement("div");s.classList.add("pod","unassigned-pod"),s.style.borderColor="#ff6b6b",s.style.backgroundColor="#2a1f1f",s.dataset.podIndex="unassigned",s.addEventListener("dragover",this.dragDropManager.handleDragOver),s.addEventListener("drop",this.dragDropManager.handleDrop),s.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let i=this.createElement("h3");i.textContent="Unassigned Players",i.style.color="#ff6b6b",s.appendChild(i);let l=this.createElement("ul");t.forEach((d,p)=>{if("players"in d){let u=this.createElement("li");u.classList.add("pod-group"),u.draggable=!0,u.dataset.itemType="group",u.dataset.itemId=d.id,u.dataset.podIndex="unassigned",u.dataset.itemIndex=p.toString(),u.addEventListener("dragstart",this.dragDropManager.handleDragStart),u.addEventListener("dragend",this.dragDropManager.handleDragEnd);let b=document.getElementById("bracket-radio"),f=b&&b.checked;f?u.innerHTML=`<strong>Group ${d.id.split("-")[1]}:</strong>`:u.innerHTML=`<strong>Group ${d.id.split("-")[1]} (Avg Power: ${d.averagePower}):</strong>`;let M=this.createElement("ul");d.players.forEach(m=>{let h=this.createElement("li");f&&m.bracketRange?h.textContent=`${m.name} (B: ${m.bracketRange})`:h.textContent=`${m.name} (P: ${m.powerRange})`,M.appendChild(h)}),u.appendChild(M),l.appendChild(u)}else{let u=this.createElement("li");u.classList.add("pod-player"),u.draggable=!0,u.dataset.itemType="player",u.dataset.itemId=d.id.toString(),u.dataset.podIndex="unassigned",u.dataset.itemIndex=p.toString(),u.addEventListener("dragstart",this.dragDropManager.handleDragStart),u.addEventListener("dragend",this.dragDropManager.handleDragEnd);let b=document.getElementById("bracket-radio");b&&b.checked&&d.bracketRange?u.textContent=`${d.name} (B: ${d.bracketRange})`:u.textContent=`${d.name} (P: ${d.powerRange})`,l.appendChild(u)}}),s.appendChild(l),o.appendChild(s)}n.appendChild(o),this.outputSection.appendChild(n),this.updateResultsCardVisibility();let a=document.querySelector(".help-section");if(a&&a.parentNode){let s=this.createElement("div");s.style.textAlign="center",s.style.marginTop="20px",s.style.marginBottom="20px",this.displayModeBtnBottom=this.displayModeBtn.cloneNode(!0),this.displayModeBtnBottom.id="display-mode-btn-bottom",this.displayModeBtnBottom.style.display="inline-block",this.displayModeBtnBottom.addEventListener("click",()=>this.enterDisplayModeWithWarning()),s.appendChild(this.displayModeBtnBottom),a.parentNode.insertBefore(s,a)}}captureCurrentPlayerData(){let e=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),t=[];e.forEach(n=>{let o=n.querySelector(".player-name"),a=n.querySelector(".group-select"),s=n.querySelectorAll('.power-checkbox input[type="checkbox"]'),i=[];s.forEach(p=>{p.checked&&i.push(p.value)});let l=n.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),d=[];l.forEach(p=>{p.checked&&d.push(p.value)}),t.push({name:o.value.trim(),groupValue:a.value,createdGroupId:a.dataset.createdGroupId,selectedPowers:i,selectedBrackets:d})});let r={noLeniency:document.getElementById("no-leniency-radio")?.checked||!1,leniency:document.getElementById("leniency-radio")?.checked||!1,superLeniency:document.getElementById("super-leniency-radio")?.checked||!1,bracket:document.getElementById("bracket-radio")?.checked||!1};return{players:t,leniencySettings:r,currentPods:[...this.currentPods],currentUnassigned:[...this.currentUnassigned]}}resetAllWithConfirmation(){if(!Array.from(this.playerRowsContainer.querySelectorAll(".player-row")).some(n=>{if(n.querySelector(".player-name").value.trim())return!0;let a=n.querySelectorAll('input[type="checkbox"]');return Array.from(a).some(s=>s.checked)})){this.resetAll();return}confirm(`Are you sure you want to reset all player data?

This will clear all players, groups, and generated pods. You will be able to undo this action immediately after.`)&&(this.lastResetData=this.captureCurrentPlayerData(),this.resetAll(),this.showUndoResetButton())}enterDisplayModeWithWarning(){if(this.currentUnassigned.length>0){let e=this.currentUnassigned.length;if(!confirm(`Warning: There ${e===1?"is":"are"} ${e} unassigned ${e===1?"player":"players"}.

These players will not be displayed in display mode. Do you want to continue without assigning them?`))return}this.getDisplayModeManager().enterDisplayMode(this.currentPods)}showUndoResetButton(){let e=document.getElementById("undo-reset-btn");e&&e.remove();let t=this.createElement("button");t.id="undo-reset-btn",t.textContent="Undo Reset",t.style.marginLeft="10px",t.style.backgroundColor="#28a745",t.style.color="white",t.style.border="none",t.style.padding="8px 16px",t.style.borderRadius="4px",t.style.cursor="pointer",t.style.fontSize="14px",t.addEventListener("click",()=>this.undoReset());let r=document.getElementById("reset-all-btn");r.parentNode.insertBefore(t,r.nextSibling),setTimeout(()=>{document.getElementById("undo-reset-btn")&&(t.remove(),this.lastResetData=null)},3e4)}undoReset(){if(!this.lastResetData){this.showErrorMessage("No reset data available to restore.");return}this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.updateResultsCardVisibility(),this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds();let e=this.lastResetData.leniencySettings;e.noLeniency&&(document.getElementById("no-leniency-radio").checked=!0),e.leniency&&(document.getElementById("leniency-radio").checked=!0),e.superLeniency&&(document.getElementById("super-leniency-radio").checked=!0),e.bracket&&(document.getElementById("bracket-radio").checked=!0),this.lastResetData.players.forEach(n=>{this.addPlayerRow();let o=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),a=o[o.length-1],s=a.querySelector(".player-name");s.value=n.name;let i=a.querySelector(".group-select");n.createdGroupId&&(i.dataset.createdGroupId=n.createdGroupId),i.value=n.groupValue}),this.isRestoring=!0;let t=document.getElementById("no-leniency-radio"),r=document.getElementById("bracket-radio");if(t&&r){let n=new Event("change",{bubbles:!0});e.bracket?r.dispatchEvent(n):t.dispatchEvent(n)}setTimeout(()=>{this.restorePlayerSelections()},200)}restorePlayerSelections(){if(!this.lastResetData)return;this.lastResetData.players.forEach((t,r)=>{let o=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[r];if(!o)return;t.selectedPowers.forEach(i=>{let l=o.querySelector(`.power-checkbox input[type="checkbox"][value="${i}"]`);l&&(l.checked=!0)}),t.selectedBrackets.forEach(i=>{let l=o.querySelector(`.bracket-checkbox input[type="checkbox"][value="${i}"]`);l&&(l.checked=!0)}),o.querySelectorAll('input[type="checkbox"]').forEach(i=>{i.checked&&i.dispatchEvent(new Event("change",{bubbles:!0}))}),this.updateButtonTextsForRow(o);let s=o.querySelector(".group-select");t.groupValue&&t.groupValue!=="no-group"&&t.groupValue.startsWith("group-")&&(t.createdGroupId?s.dataset.createdGroupId=t.createdGroupId:s.dataset.createdGroupId=t.groupValue,s.value="new-group",s.dispatchEvent(new Event("change",{bubbles:!0})))}),this.lastResetData.players.forEach((t,r)=>{let a=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[r].querySelector(".group-select");t.groupValue&&t.groupValue!=="no-group"&&t.groupValue.startsWith("group-")&&(a.value=t.groupValue,a.dispatchEvent(new Event("change",{bubbles:!0})))}),this.currentPods=[...this.lastResetData.currentPods],this.currentUnassigned=[...this.lastResetData.currentUnassigned],(this.currentPods.length>0||this.currentUnassigned.length>0)&&this.renderPods(this.currentPods,this.currentUnassigned),this.playerManager.handleGroupChange(this.playerRowsContainer),this.isRestoring=!1;let e=document.getElementById("undo-reset-btn");e&&e.remove(),this.lastResetData=null,this.showSuccessMessage("Reset has been undone successfully!")}resetAll(){this.closeAllDropdowns(),this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.updateResultsCardVisibility(),this.displayModeBtn.style.display="none",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds(),this.currentPods=[],this.currentUnassigned=[];let e=document.getElementById("no-leniency-radio");e.checked=!0;for(let t=0;t<4;t++)this.addPlayerRow()}clearDuplicateErrorsOnInput(){let e=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"));T.clearDuplicateErrors(e),T.highlightDuplicateNames(e)}initializeRankingModeToggle(){let e=document.getElementById("power-level-radio"),t=document.getElementById("bracket-radio"),r=()=>{let n=t.checked;if(n){document.body.classList.add("bracket-mode");let a=document.getElementById("no-leniency-radio");a&&(a.checked=!0)}else document.body.classList.remove("bracket-mode");this.playerRowsContainer.querySelectorAll(".player-row").forEach(a=>{let s=a.querySelector(".power-levels"),i=a.querySelector(".bracket-levels");n?(s.style.display="none",i.style.display="block"):(s.style.display="block",i.style.display="none"),this.isRestoring||this.clearAllSelections(a)})};e.addEventListener("change",r),t.addEventListener("change",r),r()}clearAllSelections(e){e.querySelectorAll('.power-checkbox input[type="checkbox"]').forEach(n=>n.checked=!1),e.querySelectorAll('.bracket-checkbox input[type="checkbox"]').forEach(n=>n.checked=!1),I.updatePowerButton(e),I.updateBracketButton(e)}initializeHelpModal(){let e=document.getElementById("help-modal"),t=e.querySelector(".help-close"),r=document.getElementById("start-tour-btn");t.addEventListener("click",()=>this.hideHelpModal()),e.addEventListener("click",n=>{n.target===e&&this.hideHelpModal()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&e.style.display==="block"&&this.hideHelpModal()}),r&&r.addEventListener("click",()=>{this.hideHelpModal(),this.startInteractiveTour().catch(console.error)})}showHelpModal(){let e=document.getElementById("help-modal");e.style.display="block",document.body.style.overflow="hidden"}toggleSidebar(e){let t=R(H("settings-sidebar",A),"settings-sidebar is required");e?t.classList.add("open"):t.classList.remove("open")}getDisplayModeManager(){return this.displayModeManager||(this.displayModeManager=new Q),this.displayModeManager}getTourManager(){return this.tourManager||(this.tourManager=new Z),this.tourManager}async startInteractiveTour(){await this.getTourManager().startTour()}hideHelpModal(){let e=document.getElementById("help-modal");e.style.display="none",document.body.style.overflow=""}calculateValidBracketRange(e){let t=e.players.flatMap(a=>"players"in a?a.players:[a]);if(t.length===0)return"Unknown";let r=[],n=new Set;t.forEach(a=>{a.brackets&&a.brackets.forEach(s=>n.add(s))});for(let a of n)t.every(i=>i.brackets&&i.brackets.includes(a))&&r.push(a);let o=["1","2","3","4","cedh"];if(r.sort((a,s)=>o.indexOf(a)-o.indexOf(s)),r.length===0)return"Unknown";if(r.length===1)return r[0];{let a=r.filter(i=>i!=="cedh");return a.length>1&&a.every((i,l)=>{if(l===0)return!0;let d=parseInt(i),p=parseInt(a[l-1]);return d===p+1})&&a.length===r.length&&r.length>1?`${r[0]}-${r[r.length-1]}`:r.join(", ")}}triggerValidationForAllFields(){let e=ee.batchValidateRows(this.playerRowsContainer);K.trackValidationTime(e.validationTime),e.validationTime>100&&console.warn(`Slow validation detected: ${e.validationTime.toFixed(2)}ms`)}updateButtonTextsForRow(e){I.updateAllButtonsForRow(e)}updatePlayerNumbers(){this.playerRowsContainer.querySelectorAll(".player-row").forEach((t,r)=>{let n=t.querySelector(".player-number");n&&(n.textContent=(r+1).toString())})}updateResultsCardVisibility(){this.outputSection.children.length>0&&this.outputSection.innerHTML.trim()!==""?(this.resultsCard.style.display="block",this.resultsCard.classList.add("has-content")):(this.resultsCard.style.display="none",this.resultsCard.classList.remove("has-content"))}};function ge(){let t=Math.floor(Math.random()*360),r=25,n=[];for(let s=0;s<50;s++){let l=(t+s*137.5)%360;n.push(Math.round(l))}let o="";for(let s=1;s<=50;s++){let i=n[s-1],l=70+Math.floor(Math.random()*20),d=50,p=28+Math.floor(Math.random()*8);o+=`
.player-row .group-select.group-${s} {
    border-color: hsl(${i}, ${l}%, ${d}%) !important;
    background-color: hsl(${i}, ${l}%, ${p}%) !important;
}`,o+=`
.group-select option[value="group-${s}"] {
    background-color: hsl(${i}, ${l}%, ${p}%);
}`}let a=B.get("style");a.id="dynamic-group-colors",a.textContent=o,document.head.appendChild(a)}document.addEventListener("DOMContentLoaded",()=>{ge(),new te().resetAll()});})();
