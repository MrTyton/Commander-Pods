"use strict";(()=>{function Z(c){if(c<3)return[];if(c===3)return[3];if(c===4)return[4];if(c===5)return[5];if(c===6)return[3,3];if(c===7)return[4,3];if(c===8)return[4,4];if(c===9)return[3,3,3];if(c===10)return[5,5];let e=Math.floor(c/4),t=c%4;return t===0?Array(e).fill(4):t===1?e>=2?[...Array(e-2).fill(4),5,4]:[3,3,3,2]:t===2?e>=1?[...Array(e-1).fill(4),3,3]:[3,3,3,3]:t===3?[...Array(e).fill(4),3]:[]}function ye(c){if(c<3)return[];if(c<9)return Z(c);if(c===9)return[3,3,3];if(c===10)return[4,3,3];if(c===11)return[4,4,3];if(c===12)return[4,4,4];if(c===13)return[4,3,3,3];if(c===14)return[4,4,3,3];if(c===15)return[4,4,4,3];let e=[],t=c;for(;t>=7;)e.push(4),t-=4;if(t===6)e.push(3,3);else if(t===5)if(e.length>0)e.pop(),t+=4,e.push(3,3,3);else return Z(c);else t===4?e.push(4):t===3&&e.push(3);return e.sort((r,n)=>n-r)}function fe(){let c=document.getElementById("avoid-five-pods-radio");return c&&c.checked?"avoid-five":"balanced"}function ve(){let c=document.getElementById("bracket-radio");if(c&&c.checked)return{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0};let e=document.getElementById("no-leniency-radio"),t=document.getElementById("leniency-radio");return document.getElementById("super-leniency-radio").checked?{allowLeniency:!0,allowSuperLeniency:!0,maxTolerance:1}:t.checked?{allowLeniency:!0,allowSuperLeniency:!1,maxTolerance:.5}:{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0}}function be(c){let e=[];if(c.forEach(n=>{if(n.checked){let o=parseFloat(n.value);isNaN(o)||e.push(o)}}),e.length===0)return{availablePowers:[],powerRange:"",averagePower:0};e.sort((n,o)=>n-o);let t;e.length===1?t=e[0].toString():t=e.join(", ");let r=e.reduce((n,o)=>n+o,0)/e.length;return{availablePowers:e,powerRange:t,averagePower:Math.round(r*2)/2}}function Me(){let c=document.querySelector("#leniency-radio");return document.querySelector("#super-leniency-radio")?.checked?1:c?.checked?.5:0}function J(c){let e=c.players.flatMap(o=>"players"in o?o.players:[o]);if(e.length===0)return c.power.toString();let t=Me(),r=[],n=new Set;e.forEach(o=>{o.availablePowers.forEach(s=>n.add(s))});for(let o of n)e.every(a=>a.availablePowers.some(i=>Math.abs(o-i)<=t))&&r.push(o);return r.sort((o,s)=>o-s),r.length===0?c.power.toString():r.length===1?r[0].toString():r.every((s,a)=>a===0||s-r[a-1]<=.5)&&r.length>2?`${r[0]}-${r[r.length-1]}`:r.join(", ")}function j(c,e){let t=[];if(Array.isArray(c.availablePowers))t=c.availablePowers;else if(typeof c.powerRange=="string")if(c.powerRange.includes("-")){let[n,o]=c.powerRange.split("-").map(s=>parseFloat(s.trim()));for(let s=n;s<=o;s+=.5)t.push(s)}else t=c.powerRange.split(",").map(n=>parseFloat(n.trim()));return t.map(n=>e.includes(n)?`<span class="power-highlight">${n}</span>`:n.toString()).join(", ")}function Ee(c,e){let t=[];if(Array.isArray(c.availableBrackets))t=c.availableBrackets;else if(typeof c.bracketRange=="string")if(c.bracketRange.includes("-")){let[n,o]=c.bracketRange.split("-").map(i=>i.trim()),s=parseInt(n),a=parseInt(o);if(!isNaN(s)&&!isNaN(a))for(let i=s;i<=a;i++)t.push(i.toString());else t=[n,o]}else t=c.bracketRange.split(",").map(n=>n.trim());return t.map(n=>e.includes(n)?`<span class="bracket-highlight">${n}</span>`:n.toString()).join(", ")}function Y(c){let e=c.players.flatMap(s=>"players"in s?s.players:[s]);if(e.length===0)return[];let t=new Map,r=new Set;if(e.forEach(s=>{s.availablePowers.length===1&&r.add(s.availablePowers[0]),s.availablePowers.forEach(a=>{t.set(a,(t.get(a)||0)+1)})}),t.size===0)return[];let n=Math.max(...t.values()),o=[];for(let[s,a]of t.entries())(a===n||r.has(s))&&o.push(s);return o.sort((s,a)=>s-a),o}var X=class{constructor(){this.groups=new Map;this.nextPlayerId=0;this.nextGroupId=1;this.availableColors=[];this.groupColorAssignments=new Map;this.initializeAvailableColors()}initializeAvailableColors(){this.availableColors=Array.from({length:50},(e,t)=>t+1),this.shuffleArray(this.availableColors)}shuffleArray(e){for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}}assignRandomColor(e){if(this.groupColorAssignments.has(e))return this.groupColorAssignments.get(e);this.availableColors.length===0&&this.initializeAvailableColors();let t=this.availableColors.pop();return this.groupColorAssignments.set(e,t),t}releaseColor(e){let t=this.groupColorAssignments.get(e);t&&(this.availableColors.push(t),this.groupColorAssignments.delete(e))}getNextPlayerId(){return this.nextPlayerId++}resetPlayerIds(){this.nextPlayerId=0}getNextGroupId(){let e=new Set;document.querySelectorAll(".group-select").forEach(r=>{if(r.value.startsWith("group-")){let n=parseInt(r.value.split("-")[1]);isNaN(n)||e.add(n)}if(r.value==="new-group"&&r.dataset.createdGroupId&&r.dataset.createdGroupId.startsWith("group-")){let n=parseInt(r.dataset.createdGroupId.split("-")[1]);isNaN(n)||e.add(n)}});for(let r=1;r<=50;r++)if(!e.has(r))return r;return this.nextGroupId++}resetGroupIds(){this.nextGroupId=1}getGroups(){return this.groups}clearGroups(){this.groups.clear()}getPlayerFromRow(e){let t=e.querySelector(".player-name");t.classList.remove("input-error");let r=t.value.trim();if(!r)return t.classList.add("input-error"),null;if(document.getElementById("bracket-radio").checked){let s=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),a=[];if(s.forEach(p=>{p.checked&&a.push(p.value)}),a.length===0)return e.querySelector(".bracket-selector-btn").classList.add("error"),null;e.querySelector(".bracket-selector-btn").classList.remove("error");let i={1:1,2:2,3:3,4:4,cedh:10},l=a.map(p=>i[p]),d=l.reduce((p,u)=>p+u,0)/l.length;return{id:parseInt(e.dataset.playerId),name:r,power:Math.round(d*2)/2,availablePowers:l,powerRange:a.join(", "),brackets:a,bracketRange:a.join(", "),rowElement:e}}else{let s=e.querySelectorAll('.power-checkbox input[type="checkbox"]'),a=be(s);return a.availablePowers.length===0?(e.querySelector(".power-selector-btn").classList.add("error"),null):(e.querySelector(".power-selector-btn").classList.remove("error"),{id:parseInt(e.dataset.playerId),name:r,power:a.averagePower,availablePowers:a.availablePowers,powerRange:a.powerRange,rowElement:e})}}handleGroupChange(e){this.groups.clear();let t=Array.from(e.querySelectorAll(".player-row"));t.forEach(n=>{for(let o=1;o<=50;o++)n.querySelector(".group-select").classList.remove(`group-${o}`)});let r=new Set;t.forEach(n=>{let o=n.querySelector(".group-select");o.dataset.createdGroupId?r.add(o.dataset.createdGroupId):o.value.startsWith("group-")&&r.add(o.value)}),t.forEach(n=>{let o=n.querySelector(".group-select"),s="";if(o.value==="new-group"){o.dataset.createdGroupId?s=o.dataset.createdGroupId:(s=`group-${this.getNextGroupId()}`,r.add(s),o.dataset.createdGroupId=s);let a=this.getPlayerFromRow(n);a&&(this.groups.has(s)||this.groups.set(s,[]),this.groups.get(s).push(a))}else if(o.value.startsWith("group-")){s=o.value;let a=this.getPlayerFromRow(n);a&&(this.groups.has(o.value)||this.groups.set(o.value,[]),this.groups.get(o.value).push(a))}else o.dataset.createdGroupId&&delete o.dataset.createdGroupId;if(s){let a=parseInt(s.split("-")[1]);a>=1&&a<=50&&o.classList.add(`group-${a}`)}}),this.cleanupUnusedGroups(r),this.updateAllGroupDropdowns(e)}updateAllGroupDropdowns(e){let t=new Set,r=Array.from(e.querySelectorAll(".player-row"));r.forEach(n=>{let o=n.querySelector(".group-select");o.value==="new-group"&&o.dataset.createdGroupId?t.add(o.dataset.createdGroupId):o.value.startsWith("group-")&&t.add(o.value)}),r.forEach(n=>{let o=n.querySelector(".group-select"),s=o.value,a=o.dataset.createdGroupId;if(Array.from(o.options).forEach(l=>{l.value.startsWith("group-")&&o.remove(l.index)}),t.forEach(l=>{let d=l.split("-")[1],p=new Option(`Group ${d}`,l);o.add(p)}),a&&t.has(a)&&(s==="new-group"||s==="no-group")){o.value=a;let l=parseInt(a.split("-")[1]);l>=1&&l<=50&&o.classList.add(`group-${l}`)}else if(s.startsWith("group-")&&t.has(s)){o.value=s;let l=parseInt(s.split("-")[1]);l>=1&&l<=50&&o.classList.add(`group-${l}`)}else{o.value="no-group";for(let l=1;l<=50;l++)o.classList.remove(`group-${l}`)}})}arePlayersCompatible(e,t,r){return e.availablePowers.some(o=>t.availablePowers.some(s=>Math.abs(o-s)<.01))?!0:r.allowLeniency?e.availablePowers.some(o=>t.availablePowers.some(s=>Math.abs(o-s)<=r.maxTolerance)):!1}findAllCommonPowers(e,t){return e.length===0?[]:[...new Set(e.flatMap(n=>n.availablePowers))].sort((n,o)=>n-o).filter(n=>e.every(o=>o.availablePowers.some(s=>{let a=Math.abs(s-n);return a<.01||t.allowLeniency&&a<=t.maxTolerance})))}findBestCommonPowerLevel(e){if(e.length===0)return null;let t=new Map;for(let o of e)for(let s of o.availablePowers)t.set(s,(t.get(s)||0)+1);if(t.size===0)return null;let r=e[0].availablePowers[0],n=0;for(let[o,s]of t.entries())s>n&&(n=s,r=o);return r}calculatePodPower(e){if(e.length===0)return 0;let t=e.reduce((r,n)=>{if("players"in n)return r+n.averagePower;{let o=n.powerRange.split(",").map(a=>parseFloat(a.trim())),s=o.reduce((a,i)=>a+i,0)/o.length;return r+s}},0);return Math.round(t/e.length*10)/10}cleanupUnusedGroups(e){Array.from(this.groupColorAssignments.keys()).forEach(o=>{e.has(o)||this.releaseColor(o)}),Array.from(this.groups.keys()).forEach(o=>{e.has(o)||this.groups.delete(o)}),document.querySelectorAll(".group-select").forEach(o=>{let s=o.dataset.createdGroupId;s&&!e.has(s)&&delete o.dataset.createdGroupId})}};var ee=class{constructor(){this.shuffleSeed=null;this.sizeCache=new Map}setShuffleSeed(e){this.shuffleSeed=e,this.sizeCache.clear()}seededRandom(e){let t=e;return()=>(t=t*1103515245+12345&2147483647,t/2147483647)}shuffleArray(e){let t=[...e],r;this.shuffleSeed!==null?r=this.seededRandom(this.shuffleSeed):r=Math.random;for(let n=t.length-1;n>0;n--){let o=Math.floor(r()*(n+1));[t[n],t[o]]=[t[o],t[n]]}return t}getItemSize(e){let t="players"in e?`group-${e.id}`:`player-${e.id}`;if(!this.sizeCache.has(t)){let r="players"in e?e.size:1;this.sizeCache.set(t,r)}return this.sizeCache.get(t)}getItemId(e){return"players"in e?e.id:e.id.toString()}generatePodsWithBacktracking(e,t,r){let n=this.shuffleArray(e),o=n.reduce((l,d)=>l+("size"in d?d.size:1),0);if(o>=3&&o<=5){let l=n.flatMap(p=>"players"in p?p.players:[p]),d=this.findBestCommonPowerLevel(l);return d!==null?{pods:[{players:n,power:d}],unassigned:[]}:{pods:[],unassigned:n}}let s=this.findOptimalPodAssignment(n,t,r),a=new Set;for(let l of s)for(let d of l.players)"players"in d?a.add(d.id):a.add(d.id.toString());let i=n.filter(l=>"players"in l?!a.has(l.id):!a.has(l.id.toString()));return{pods:s,unassigned:i}}findOptimalPodAssignment(e,t,r){return this.optimizeVirtualPlayerAssignmentUnified(e,t,r)}optimizeVirtualPlayerAssignmentUnified(e,t,r){if(e.length===0)return[];let n=this.createVirtualPlayersUnified(e),o=new Map;for(let a of n)o.has(a.powerLevel)||o.set(a.powerLevel,[]),o.get(a.powerLevel).push(a);let s={pods:[],totalPods:0};return r.allowLeniency?this.backtrackVirtualPlayersWithLeniencyUnified(n,t,r.maxTolerance,[],new Set,t,s):this.backtrackVirtualPlayersUnified(Array.from(o.entries()),[],new Set,t,s),s.pods}createVirtualPlayersUnified(e){let t=[];for(let r of e)if("players"in r){let n=r.players.flatMap(d=>d.availablePowers),o=Math.min(...n),s=Math.max(...n),i=[r.averagePower,o,s],l=[...new Set(i)];for(let d of l)t.push({item:r,powerLevel:d})}else for(let n of r.availablePowers)t.push({item:r,powerLevel:n});return t}backtrackVirtualPlayersUnified(e,t,r,n,o){if(n.length===0){t.length>o.totalPods&&(o.pods=[...t],o.totalPods=t.length);return}if(t.length+n.length<=o.totalPods)return;let s=n[0],a=n.slice(1);for(let[i,l]of e){let d=l.filter(E=>{let f=this.getItemId(E.item);return!r.has(f)}),p=0;for(let E=0;E<d.length;E++)p+=this.getItemSize(d[E].item);let u=Math.max(3,s);if(p>=u){let E=d.sort((v,m)=>{let h=this.getItemSize(v.item);return this.getItemSize(m.item)-h}),f=[],P=new Set,g=0;for(let v of E){let m=this.getItemId(v.item),h=this.getItemSize(v.item);if(!P.has(m)&&g+h<=s&&(f.push(v),P.add(m),g+=h,g===s))break}if(g>=3){let v=f.map(y=>y.item),m={players:v,power:i},h=new Set(r);for(let y of v){let w="players"in y?y.id:y.id.toString();h.add(w)}this.backtrackVirtualPlayersUnified(e,[...t,m],h,a,o)}}}this.backtrackVirtualPlayersUnified(e,t,r,a,o)}backtrackVirtualPlayersWithLeniencyUnified(e,t,r,n,o,s,a){if(s.length===0){n.length>a.totalPods&&(a.pods=[...n],a.totalPods=n.length);return}if(n.length+s.length<=a.totalPods)return;let i=s[0],l=s.slice(1),d=e.filter(u=>{let E="players"in u.item?u.item.id:u.item.id.toString();return!o.has(E)}),p=[...new Set(d.map(u=>u.powerLevel))].sort((u,E)=>u-E);for(let u of p){let E=d.filter(h=>("players"in h.item,Math.abs(h.powerLevel-u)<=r)),f=new Map;for(let h of E){let y="players"in h.item?h.item.id:h.item.id.toString();if(!f.has(y))f.set(y,h);else{let w=f.get(y),k=Math.abs(w.powerLevel-u);Math.abs(h.powerLevel-u)<k&&f.set(y,h)}}let g=Array.from(f.values()).sort((h,y)=>{if("players"in h.item&&"players"in y.item){let w=Math.abs(h.powerLevel-h.item.averagePower)<.01,k=Math.abs(y.powerLevel-y.item.averagePower)<.01;return w&&!k?-1:!w&&k?1:Math.abs(h.powerLevel-u)-Math.abs(y.powerLevel-u)}return"players"in h.item&&!("players"in y.item)?1:!("players"in h.item)&&"players"in y.item?-1:Math.abs(h.powerLevel-u)-Math.abs(y.powerLevel-u)}),v=0;for(let h=0;h<g.length;h++)v+=this.getItemSize(g[h].item);let m=Math.max(3,i);if(v>=m){let h=g.sort((b,L)=>{let T=this.getItemSize(b.item);return this.getItemSize(L.item)-T}),y=[],w=new Set,k=0;for(let b of h){let L=this.getItemId(b.item),T=this.getItemSize(b.item);if(!w.has(L)&&k+T<=i&&(y.push(b),w.add(L),k+=T,k===i))break}if(k>=3){let b=y.map(I=>I.item);if(!this.isPodPowerSpreadValid(y,r))continue;let L=y.reduce((I,$)=>I+$.powerLevel,0)/y.length,T={players:b,power:Math.round(L*2)/2},S=new Set(o);for(let I of b){let $="players"in I?I.id:I.id.toString();S.add($),e.forEach(G=>{let ae="players"in G.item?G.item.id:G.item.id.toString();ae===$&&S.add(ae)})}this.backtrackVirtualPlayersWithLeniencyUnified(e,t,r,[...n,T],S,l,a)}}}this.backtrackVirtualPlayersWithLeniencyUnified(e,t,r,n,o,l,a)}isPodPowerSpreadValid(e,t){if(e.length===0)return!0;let r=e.map(a=>a.powerLevel),n=Math.min(...r);return Math.max(...r)-n<=t}findBestCommonPowerLevel(e){if(e.length===0)return null;let t=new Map;for(let o of e)for(let s of o.availablePowers)t.set(s,(t.get(s)||0)+1);if(t.size===0)return null;let r=e[0].availablePowers[0],n=0;for(let[o,s]of t.entries())s>n&&(n=s,r=o);return r}};var te=class{constructor(e,t){this.draggedElement=null;this.draggedItemData=null;this.currentPods=[];this.currentUnassigned=[];this.handleDragStart=e=>{let t=e.target;this.draggedElement=t,t.classList.add("dragging"),this.draggedItemData={type:t.dataset.itemType,id:t.dataset.itemId,podIndex:t.dataset.podIndex,itemIndex:t.dataset.itemIndex},e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",t.outerHTML)};this.handleDragEnd=e=>{e.target.classList.remove("dragging"),this.draggedElement=null,this.draggedItemData=null};this.handleDragOver=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",e.currentTarget.classList.add("drag-over")};this.handleDragLeave=e=>{e.currentTarget.classList.remove("drag-over")};this.handleDrop=e=>{e.preventDefault();let t=e.currentTarget;if(t.classList.remove("drag-over"),!this.draggedItemData)return;let r=t.dataset.podIndex,n=this.draggedItemData.podIndex;r!==n&&this.moveItemBetweenPods(this.draggedItemData,r)};this.playerManager=e,this.onPodsChanged=t}setCurrentPods(e,t=[]){this.currentPods=[...e],this.currentUnassigned=[...t]}moveItemBetweenPods(e,t){let r=e.podIndex,n=parseInt(e.itemIndex),o=null;if(r==="unassigned")o=this.currentUnassigned[n],this.currentUnassigned.splice(n,1);else{let s=this.currentPods[parseInt(r)];o=s.players[n],s.players.splice(n,1),s.power=this.playerManager.calculatePodPower(s.players)}if(o){if(t==="unassigned")this.currentUnassigned.push(o);else if(t==="new-pod"){let s={players:[o],power:this.playerManager.calculatePodPower([o])};this.currentPods.push(s)}else{let s=this.currentPods[parseInt(t)];s.players.push(o),s.power=this.playerManager.calculatePodPower(s.players)}this.cleanupEmptyPods(),this.onPodsChanged(this.currentPods,this.currentUnassigned)}}cleanupEmptyPods(){this.currentPods=this.currentPods.filter(e=>e.players.length>0)}};var ie=class{constructor(){this.pools=new Map;this.POOL_SIZE=15}get(e){let t=this.pools.get(e.toLowerCase())||[];if(t.length>0){let r=t.pop();return this.resetElement(r),r}return document.createElement(e)}release(e){let t=e.tagName.toLowerCase(),r=this.pools.get(t);r||(r=[],this.pools.set(t,r)),r.length<this.POOL_SIZE&&(this.resetElement(e),r.push(e))}resetElement(e){e.innerHTML="",e.className="",e.removeAttribute("style"),e.removeAttribute("draggable"),e.removeAttribute("id"),Object.keys(e.dataset).forEach(t=>{delete e.dataset[t]})}clear(){this.pools.clear()}getStats(){let e={};return this.pools.forEach((t,r)=>{e[r]=t.length}),e}preWarm(){[{tag:"div",count:8},{tag:"li",count:6},{tag:"ul",count:4},{tag:"h3",count:3},{tag:"p",count:3},{tag:"strong",count:3},{tag:"button",count:2}].forEach(({tag:t,count:r})=>{let n=[];for(let o=0;o<r;o++){let s=document.createElement(t);this.resetElement(s),n.push(s)}this.pools.set(t,n)})}},A=new ie;A.preWarm();var re=class{constructor(){this.isDisplayMode=!1;this.handleKeyDown=null;this.borderColors=["#FF6B6B","#4ECDC4","#45B7D1","#FFA726","#66BB6A","#AB47BC","#EF5350","#26A69A","#42A5F5","#FF7043","#9CCC65","#7E57C2","#EC407A","#29B6F6","#FFCA28","#8BC34A","#673AB7","#F06292","#00BCD4","#FFEB3B","#795548","#607D8B","#E91E63","#009688","#FF9800"]}getShuffledColors(e){let t=[...this.borderColors];for(let r=t.length-1;r>0;r--){let n=Math.floor(Math.random()*(r+1));[t[r],t[n]]=[t[n],t[r]]}if(e>t.length){let r=[];for(let n=0;n<e;n++)r.push(t[n%t.length]);return r}return t.slice(0,e)}calculateOptimalWidthForText(e){let t=0;for(let o of e)o===" "?t+=.3:/[iIl1]/.test(o)?t+=.4:/[mwMW]/.test(o)?t+=.8:/[A-Z]/.test(o)?t+=.7:t+=.6;let r=t*1.2,n=Math.min(85,Math.max(25,r/25*85));return Math.round(n)}calculateFontSizeForPod(e,t,r){let n=e*t,o=Math.ceil(Math.sqrt(r)),s=Math.ceil(r/o),a=(e-(o-1)*10)/o,i=(t-(s-1)*10)/s,l=Math.min(a,i),d=Math.min(l*.25,i*.35),p=Math.max(.9,1-(r-3)*.02),u=Math.max(24,Math.min(72,d*p));return`${Math.round(u)}px`}calculateValidBracketRange(e){let t=e.players.flatMap(s=>"players"in s?s.players:[s]);if(t.length===0)return"Unknown";let r=[],n=new Set;t.forEach(s=>{s.brackets&&s.brackets.forEach(a=>n.add(a))});for(let s of n)t.every(i=>i.brackets&&i.brackets.includes(s))&&r.push(s);let o=["1","2","3","4","cedh"];if(r.sort((s,a)=>o.indexOf(s)-o.indexOf(a)),r.length===0)return"Unknown";if(r.length===1)return r[0];{let s=r.filter(i=>i!=="cedh");return s.length>1&&s.every((i,l)=>{if(l===0)return!0;let d=parseInt(i),p=parseInt(s[l-1]);return d===p+1})&&s.length===r.length&&r.length>1?`${r[0]}-${r[r.length-1]}`:r.join(", ")}}getValidBracketsArrayForPod(e){let t=e.players.flatMap(a=>"players"in a?a.players:[a]);if(t.length===0)return[];let r=new Map;if(t.forEach(a=>{a.brackets&&a.brackets.forEach(i=>{r.set(i,(r.get(i)||0)+1)})}),r.size===0)return[];let n=Math.ceil(t.length/2),o=[];for(let[a,i]of r.entries())i>=n&&o.push(a);let s=["1","2","3","4","cedh"];return o.sort((a,i)=>s.indexOf(a)-s.indexOf(i)),o}enterDisplayMode(e){if(e.length===0)return;this.isDisplayMode=!0,document.body.classList.add("display-mode");let t=Math.ceil(Math.sqrt(e.length)),r=A.get("div");r.className="display-mode-container",r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="100vw",r.style.height="100vh",r.style.background="#1a1a1a",r.style.zIndex="1000",r.style.padding="20px",r.style.boxSizing="border-box",r.style.overflow="hidden",r.innerHTML=`
            <div class="display-mode-controls">
                <button id="exit-display-btn">Exit Display Mode</button>
            </div>
            <h1 style="text-align: center; margin: 0 0 20px 0; font-size: 2.5rem; color: white;">MTG Commander Pods</h1>
            <div id="display-output" style="flex-grow: 1; height: calc(100vh - 140px);"></div>
        `;let n=document.querySelector(".container");n&&(n.style.display="none"),document.body.appendChild(r);let o=r.querySelector("#display-output"),s=A.get("div");s.style.display="grid",s.style.gap="20px",s.style.height="100%",s.style.gridTemplateColumns=`repeat(${t}, 1fr)`,s.style.gridTemplateRows=`repeat(${t}, 1fr)`;let a=this.getShuffledColors(e.length);e.forEach((l,d)=>{let p=A.get("div");p.style.display="flex",p.style.flexDirection="column",p.style.background="#2a2a2a",p.style.border=`3px solid ${a[d]}`,p.style.borderRadius="8px",p.style.padding="15px",p.style.boxSizing="border-box",p.style.minHeight="0",p.style.boxShadow=`0 0 10px ${a[d]}40`,p.classList.add("pod",`pod-color-${d%10}`);let u=A.get("h3"),E=document.getElementById("bracket-radio"),f=E&&E.checked;if(f){let b=this.calculateValidBracketRange(l);u.textContent=`Pod ${d+1} (Bracket: ${b})`}else{let b=J(l);u.textContent=`Pod ${d+1} (Power: ${b})`}u.style.fontSize="1.6rem",u.style.margin="0 0 15px 0",u.style.textAlign="center",u.style.color=a[d],u.style.fontWeight="bold",u.style.flexShrink="0",u.style.textShadow="1px 1px 2px rgba(0,0,0,0.8)",p.appendChild(u);let P=0;l.players.forEach(b=>{"players"in b?P+=b.players.length:P+=1});let g="";l.players.forEach(b=>{if("players"in b)b.players.forEach(L=>{let T=f&&L.bracketRange?`${L.name} (B: ${L.bracketRange})`:`${L.name} (P: ${L.powerRange})`;T.length>g.length&&(g=T)});else{let L=f&&b.bracketRange?`${b.name} (B: ${b.bracketRange})`:`${b.name} (P: ${b.powerRange})`;L.length>g.length&&(g=L)}});let v=A.get("ul");v.style.flexGrow="1",v.style.display="flex";let m=Math.ceil(Math.sqrt(P)),h=Math.ceil(P/m);v.style.display="grid",v.style.gridTemplateColumns=`repeat(${m}, 1fr)`,v.style.gridTemplateRows=`repeat(${h}, 1fr)`,v.style.gap="12px",v.style.margin="0",v.style.padding="0",v.style.listStyle="none",v.style.width="100%",v.style.height="100%",v.style.alignItems="stretch",v.style.justifyItems="stretch";let y=[];l.players.forEach(b=>{"players"in b?b.players.forEach(L=>y.push(L)):y.push(b)});let w=document.getElementById("bracket-radio"),k=w&&w.checked;y.forEach((b,L)=>{let T=A.get("li"),S=A.get("div");S.textContent=b.name,S.className="player-name";let I=A.get("div");if(k&&b.bracketRange){let $=this.getValidBracketsArrayForPod(l),G=Ee(b,$);I.innerHTML=`B: ${G}`}else{let $=Y(l),G=j(b,$);I.innerHTML=`P: ${G}`}I.className="player-power",T.appendChild(S),T.appendChild(I),T.style.display="flex",T.style.flexDirection="column",T.style.justifyContent="center",T.style.alignItems="center",T.style.backgroundColor="rgba(255, 255, 255, 0.12)",T.style.border="2px solid rgba(255, 255, 255, 0.2)",T.style.borderRadius="12px",T.style.padding="8px",T.style.boxSizing="border-box",T.style.textAlign="center",T.style.height="100%",S.style.color="#ffffff",S.style.fontWeight="bold",S.style.lineHeight="1.1",S.style.marginBottom="4px",S.style.wordBreak="break-word",S.style.hyphens="auto",S.style.flexGrow="1",S.style.display="flex",S.style.alignItems="center",S.style.justifyContent="center",I.style.color="#b0b0b0",I.style.fontWeight="500",I.style.lineHeight="1",I.style.opacity="0.9",T.dataset.podRef=d.toString(),T.classList.add("dynamic-font-item"),v.appendChild(T)}),p.appendChild(v),s.appendChild(p)}),o.appendChild(s),requestAnimationFrame(()=>{s.querySelectorAll(".pod").forEach((d,p)=>{let u=d.getBoundingClientRect(),E=u.width,f=u.height,P=0;e[p].players.forEach(m=>{"players"in m?P+=m.players.length:P+=1});let g=this.calculateFontSizeForPod(E,f,P);d.querySelectorAll(".dynamic-font-item").forEach(m=>{let h=m.querySelector(".player-name"),y=m.querySelector(".player-power");if(h&&(h.style.fontSize=g),y){let w=Math.round(parseInt(g)*.75);y.style.fontSize=`${w}px`}})})}),r.querySelector("#exit-display-btn").addEventListener("click",()=>this.exitDisplayMode()),this.handleKeyDown=l=>{l.key==="Escape"&&this.isDisplayMode&&this.exitDisplayMode()},document.addEventListener("keydown",this.handleKeyDown)}exitDisplayMode(){this.isDisplayMode=!1,document.body.classList.remove("display-mode");let e=document.querySelector(".container");e&&(e.style.display="");let t=document.querySelector(".display-mode-container");t&&t.remove(),this.handleKeyDown&&(document.removeEventListener("keydown",this.handleKeyDown),this.handleKeyDown=null)}getIsDisplayMode(){return this.isDisplayMode}};var ne=class{constructor(){this.currentStep=0;this.tourSteps=[];this.tourOverlay=null;this.tourHighlight=null;this.tourTooltip=null;this.isActive=!1;this.originalScrollPosition=0;this.handleTourKeydown=e=>{if(this.isActive)switch(e.key){case"Escape":e.preventDefault(),e.stopPropagation(),this.endTour().catch(console.error);break;case"ArrowRight":case"Enter":e.preventDefault(),e.stopPropagation(),this.currentStep>=this.tourSteps.length-1?this.endTour().catch(console.error):this.nextStep().catch(console.error);break;case"ArrowLeft":e.preventDefault(),e.stopPropagation(),this.previousStep().catch(console.error);break}};this.initializeTourSteps()}initializeTourSteps(){this.tourSteps=[{id:"welcome",title:"\u{1F3AF} Welcome to Commander Pod Generator!",content:"This interactive tour will guide you through all the features step by step. You can exit at any time by pressing Escape or clicking the \u2715 Exit Tour button.",target:".container",position:"bottom",action:"none"},{id:"settings-button",title:"\u2699\uFE0F Settings Button",content:"This gear icon opens the settings panel where you can configure your ranking system (Power Level vs Bracket), manage players, and access help resources. Click it to access all configuration options.",target:"#settings-toggle",position:"bottom",action:"none"},{id:"ranking-system",title:"\u2699\uFE0F Choose Your Ranking System",content:"First, choose between Power Level (1-10 scale) or Bracket (1,2,3,4,cEDH) system. Power Level gives more granular control, while Brackets are simpler and tournament-friendly.",target:"fieldset:first-of-type",position:"bottom",action:"none",beforeStep:()=>this.openSettingsForTour(),afterStep:()=>this.closeSettingsAfterTour()},{id:"add-players",title:"\u{1F465} Adding Players",content:'Player names are entered here. The "Add Player" button and keyboard shortcut Ctrl+Enter are available for quickly adding more players when you use the app.',target:".player-row:first-child .player-name",position:"right",action:"type",actionData:"Alice",beforeStep:()=>this.ensurePlayerRows(1)},{id:"power-levels",title:"\u26A1 Setting Power Levels",content:'This button opens the power level selector. Individual levels or ranges can be selected, and typing shortcuts like "7-8" are supported for quick range selection.',target:".player-row:first-child .power-selector-btn",position:"left",action:"click",beforeStep:()=>this.ensurePowerMode()},{id:"power-selection",title:"\u{1F3AF} Power Level Selection",content:`Multiple power levels can be selected for each player. The quick range buttons (6-7, 7-8, 8-9) make common selections easy. We'll now select "7-8" for a medium power deck.`,target:".player-row:first-child .power-selector-dropdown",position:"right",action:"none",beforeStep:()=>{let e=document.querySelector(".player-row:first-child .power-selector-btn");e&&e.click(),setTimeout(()=>{let t=document.querySelector('.player-row:first-child .range-btn[data-range="7-8"]');t&&t.click()},200)}},{id:"add-more-players",title:"\u{1F680} Quick Player Addition",content:`The "Add 4 Players" button enables bulk addition, and Ctrl+Enter can be pressed repeatedly for individual players. We'll add more players for our demonstration.`,target:"#bulk-add-btn",position:"bottom",action:"click"},{id:"fill-players",title:"\u{1F4DD} Complete Player Information",content:"The remaining players will be filled with names and power levels. The tour will automatically provide example data to demonstrate the features.",target:".player-row:nth-child(2) .player-name",position:"right",action:"none",beforeStep:()=>this.fillExamplePlayers()},{id:"groups",title:"\u{1F46B} Creating Groups",content:'This dropdown allows grouping players who want to play together. "Start a New Group" creates a group, then other players can "Join Group" to join them.',target:".player-row:first-child .group-select",position:"left",action:"none"},{id:"group-demo",title:"\u{1F465} Group Creation Demo",content:"Now we'll create a group! Alice and Henry will be grouped together to demonstrate how the system works with compatible power levels.",target:".player-row:first-child .group-select",position:"left",action:"none",beforeStep:()=>this.createGroupDemo()},{id:"tolerance",title:"\u{1F39A}\uFE0F Power Level Tolerance",content:'In Power Level mode, tolerance can be adjusted. "No Leniency" requires exact matches, while "Regular" and "Super" leniency allow \xB10.5 and \xB11.0 differences respectively.',target:"fieldset:nth-of-type(2)",position:"top",action:"none",beforeStep:()=>{this.ensurePowerMode(),this.openSettingsForTour()},afterStep:()=>this.closeSettingsAfterTour()},{id:"pod-size-preference",title:"\u{1F4CF} Pod Size Preference",content:'Pod size preference determines how pods are organized. "Balanced" allows 3-5 player pods for flexibility, while "Avoid Large Pods" prefers smaller 3-4 player pods for more intimate games.',target:"fieldset:nth-of-type(3)",position:"top",action:"none",beforeStep:()=>this.openSettingsForTour(),afterStep:()=>this.closeSettingsAfterTour()},{id:"generate",title:"\u{1F3B2} Generate Pods",content:"Once all players have names and power levels, this button generates balanced pods. The algorithm creates 3-4 player pods with similar power levels.",target:"#generate-pods-btn",position:"top",action:"click"},{id:"results",title:"\u{1F3C6} Pod Results",content:"Here are the generated pods! Players are grouped by compatible power levels. Players can be moved between pods using drag and drop if needed.",target:"#output-section",position:"top",action:"none"},{id:"unassigned-players",title:"\u26A0\uFE0F Unassigned Players",content:`If players can't be balanced into pods (due to power level mismatches or odd numbers), they'll appear as "unassigned." They can be manually dragged into existing pods.`,target:"#output-section",position:"top",action:"none"},{id:"drag-drop",title:"\u{1F5B1}\uFE0F Drag and Drop",content:"Pods can be reorganized by dragging players between them. This is useful for manual adjustments or accommodating player preferences after initial pod generation.",target:"#output-section",position:"top",action:"none"},{id:"display-mode",title:"\u{1F4FA} Display Mode",content:"This button enters Display Mode - a clean, full-screen view perfect for showing pods to players on a projector or large screen.",target:"#display-mode-btn",position:"bottom",action:"click"},{id:"display-features",title:"\u{1F3A8} Display Mode Features",content:"In Display Mode, pod titles show power level ranges, player names are clearly displayed, and automatic font scaling ensures readability. All editing controls are hidden for a clean presentation view.",target:".display-mode-container",position:"top",action:"none"},{id:"exit-display",title:"\u{1F6AA} Exit Display Mode",content:"This button exits Display Mode and returns to the main interface where changes can be made.",target:"#exit-display-btn",position:"bottom",action:"click"},{id:"reset",title:"\u{1F504} Reset and Undo",content:"The Reset All button clears everything. It includes a smart confirmation system and an undo feature that lasts 30 seconds - so experimentation is safe!",target:"#reset-all-btn",position:"top",action:"none"},{id:"keyboard-shortcuts",title:"\u2328\uFE0F Keyboard Shortcuts",content:'Pro tip: Ctrl+Enter adds players quickly, power ranges like "7-8" can be typed in selector buttons, and Escape closes any dropdown. The help contains the full list of shortcuts!',target:"#help-btn",position:"left",action:"none"},{id:"support-donation",title:"\u{1F49D} Support This Project",content:"If you find this tool helpful for organizing your Commander games, please consider supporting its development! Your donations help keep this tool free, ad-free, and continuously improved for the entire Magic: The Gathering community. Every contribution, no matter how small, is greatly appreciated!",target:'div[id*="kofi-widget-overlay"], [class*="floatingchat-donate"], img[class*="kofiImg"]',position:"top",action:"none"},{id:"complete",title:"\u{1F389} Tour Complete!",content:"Congratulations! You now know all the main features. The Help button contains detailed information about keyboard shortcuts and advanced features. Happy pod organizing!",target:"#help-btn",position:"left",action:"none"}]}async startTour(){this.isActive||(this.isActive=!0,this.currentStep=0,this.originalScrollPosition=window.scrollY,this.createTourUI(),await this.showStep(0),this.setupTourEventListeners())}async endTour(){if(!this.isActive)return;this.isActive=!1,this.tourOverlay&&this.tourOverlay.classList.add("tour-ending"),this.tourHighlight&&this.tourHighlight.classList.add("tour-ending"),this.tourTooltip&&this.tourTooltip.classList.add("tour-ending");let e=document.querySelector(".tour-progress");if(e&&e.classList.add("tour-ending"),this.removeEventListeners(),document.body.classList.contains("display-mode")){let r=document.getElementById("exit-display-btn");r&&(r.click(),await this.waitForCondition(()=>!document.body.classList.contains("display-mode"),2e3))}setTimeout(()=>{this.removeTourUI(),this.cleanupRemainingElements()},50);let t=document.getElementById("reset-all-btn");t&&(t.click(),setTimeout(async()=>{let r=document.querySelector(".modal-confirm");r&&r.click()},50)),window.scrollTo(0,this.originalScrollPosition)}async forceEndTour(){if(this.isActive=!1,document.body.classList.contains("display-mode")){let t=document.getElementById("exit-display-btn");t&&(t.click(),await this.waitForCondition(()=>!document.body.classList.contains("display-mode"),2e3))}this.removeTourUI(),this.cleanupRemainingElements();let e=document.getElementById("reset-all-btn");e&&(e.click(),setTimeout(async()=>{let t=document.querySelector(".modal-confirm");t&&t.click()},50)),window.scrollTo(0,this.originalScrollPosition)}createTourUI(){this.tourOverlay=document.createElement("div"),this.tourOverlay.className="tour-overlay",this.tourOverlay.innerHTML=`
            <style>
                .tour-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0, 0, 0, 0.7);
                    z-index: 9998;
                    pointer-events: none;
                    opacity: 1;
                    transition: opacity 0.1s ease;
                }
                
                .tour-overlay.tour-ending {
                    opacity: 0;
                    pointer-events: none;
                }
                
                .tour-highlight {
                    position: absolute;
                    border: 5px solid #4CAF50;
                    border-radius: 8px;
                    box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.85), 
                               0 0 40px rgba(76, 175, 80, 1.2),
                               inset 0 0 0 2px rgba(255, 255, 255, 0.3);
                    z-index: 9999;
                    pointer-events: none;
                    transition: all 0.1s ease;
                    opacity: 1;
                }
                
                .tour-highlight.tour-ending {
                    opacity: 0;
                    pointer-events: none;
                }
                
                .tour-tooltip {
                    position: absolute;
                    background: linear-gradient(135deg, #2a2a2a, #3a3a3a);
                    color: white;
                    padding: 20px;
                    border-radius: 12px;
                    max-width: 350px;
                    z-index: 10000;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
                    border: 1px solid #4CAF50;
                    pointer-events: auto;
                    opacity: 1;
                    transition: opacity 0.15s ease;
                }
                
                .tour-tooltip.tour-ending {
                    opacity: 0;
                    pointer-events: none;
                }
                
                .tour-tooltip h3 {
                    margin: 0 0 10px 0;
                    color: #4CAF50;
                    font-size: 1.2rem;
                }
                
                .tour-tooltip p {
                    margin: 0 0 15px 0;
                    line-height: 1.5;
                }
                
                .tour-tooltip-buttons {
                    display: flex;
                    gap: 10px;
                    justify-content: flex-end;
                }
                
                .tour-btn {
                    padding: 8px 16px;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 0.9rem;
                    transition: all 0.2s ease;
                }
                
                .tour-btn-primary {
                    background: #4CAF50;
                    color: white;
                }
                
                .tour-btn-primary:hover {
                    background: #45a049;
                }
                
                .tour-btn-secondary {
                    background: #666;
                    color: white;
                }
                
                .tour-btn-secondary:hover {
                    background: #777;
                }
                
                .tour-progress {
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: rgba(42, 42, 42, 0.9);
                    color: white;
                    padding: 10px 15px;
                    border-radius: 20px;
                    font-size: 0.9rem;
                    z-index: 10001;
                    border: 1px solid #4CAF50;
                    opacity: 1;
                    transition: opacity 0.1s ease;
                    pointer-events: none;
                }
                
                .tour-progress.tour-ending {
                    opacity: 0;
                    pointer-events: none;
                }
            </style>
        `,this.tourHighlight=document.createElement("div"),this.tourHighlight.className="tour-highlight",this.tourTooltip=document.createElement("div"),this.tourTooltip.className="tour-tooltip",document.body.appendChild(this.tourOverlay),document.body.appendChild(this.tourHighlight),document.body.appendChild(this.tourTooltip)}async showStep(e){if(e>=this.tourSteps.length){await this.endTour();return}let t=this.tourSteps[e];this.currentStep=e,t.beforeStep&&t.beforeStep(),setTimeout(()=>{this.positionHighlight(t),this.showTooltip(t),this.updateProgress()},20)}positionHighlight(e){let t=document.querySelector(e.target);if((e.target.includes("kofi")||e.id==="support-donation")&&!t){this.tourHighlight&&(this.tourHighlight.style.left="25px",this.tourHighlight.style.top=`${window.innerHeight-80}px`,this.tourHighlight.style.width="120px",this.tourHighlight.style.height="40px",this.tourHighlight.style.position="fixed");return}if(!t||!this.tourHighlight){if(e.target.includes("kofi")){setTimeout(()=>this.positionHighlight(e),200);return}return}if(e.target.includes("dropdown")){let a=t.closest(".player-row")?.querySelector(".power-selector-btn, .bracket-selector-btn");if(a&&t.style.display==="none"){a.click(),setTimeout(()=>this.positionHighlight(e),100);return}}let r=t.getBoundingClientRect(),n=window.scrollX,o=window.scrollY;if(this.tourHighlight.style.position="absolute",this.tourHighlight.style.left=`${r.left+n-5}px`,this.tourHighlight.style.top=`${r.top+o-5}px`,this.tourHighlight.style.width=`${r.width+10}px`,this.tourHighlight.style.height=`${r.height+10}px`,!(t.closest("#settings-sidebar")!==null))t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});else{let a=r.top+r.height/2,i=window.innerHeight/2;(a<100||a>window.innerHeight-100)&&window.scrollTo({left:0,top:window.scrollY+(a-i),behavior:"smooth"})}}showTooltip(e){if(!this.tourTooltip)return;let r=this.currentStep===this.tourSteps.length-1?"Finish Tour":"Next";this.tourTooltip.innerHTML=`
            <h3>${e.title}</h3>
            <p>${e.content}</p>
            <div class="tour-tooltip-buttons">
                <button class="tour-btn tour-btn-secondary" id="tour-exit-btn">
                    \u2715 Exit Tour
                </button>
                ${this.currentStep>0?'<button class="tour-btn tour-btn-secondary" id="tour-prev-btn">Previous</button>':""}
                <button class="tour-btn tour-btn-primary" id="tour-next-btn">
                    ${r}
                </button>
            </div>
        `;let n=this.tourTooltip.querySelector("#tour-exit-btn"),o=this.tourTooltip.querySelector("#tour-prev-btn"),s=this.tourTooltip.querySelector("#tour-next-btn");n&&n.addEventListener("click",()=>this.endTour().catch(console.error)),o&&o.addEventListener("click",()=>this.previousStep().catch(console.error)),s&&s.addEventListener("click",()=>this.nextStep().catch(console.error)),this.positionTooltip(e)}positionTooltip(e){let t=document.querySelector(e.target);if(!t||!this.tourTooltip)return;let r=t.getBoundingClientRect(),n=this.tourTooltip.getBoundingClientRect(),o=window.scrollX,s=window.scrollY,a,i;switch(e.position){case"top":a=r.left+o+r.width/2-n.width/2,i=r.top+s-n.height-15;break;case"bottom":a=r.left+o+r.width/2-n.width/2,i=r.bottom+s+15;break;case"left":a=r.left+o-n.width-15,i=r.top+s+r.height/2-n.height/2;break;case"right":a=r.right+o+15,i=r.top+s+r.height/2-n.height/2;break}let l=window.innerWidth-n.width-20,d=window.innerHeight-n.height-20;a=Math.max(20,Math.min(a,l)),i=Math.max(20,Math.min(i,d)),this.tourTooltip.style.left=`${a}px`,this.tourTooltip.style.top=`${i}px`}updateProgress(){if(document.querySelectorAll(".tour-progress").forEach(r=>{r.parentNode&&r.parentNode.removeChild(r)}),!this.isActive)return;let t=document.createElement("div");t.className="tour-progress",t.textContent=`Step ${this.currentStep+1} of ${this.tourSteps.length}`,document.body.appendChild(t)}async nextStep(){if(this.currentStep>=this.tourSteps.length-1){await this.endTour();return}let e=this.tourSteps[this.currentStep];e.action&&e.action!=="none"&&this.performStepAction(e),e.afterStep&&e.afterStep();try{await this.waitForActionCompletion(e),await this.showStep(this.currentStep+1)}catch(t){console.warn("Tour step completion timed out, proceeding anyway:",t),await this.showStep(this.currentStep+1)}}async waitForActionCompletion(e){if(!e.action||e.action==="none")return Promise.resolve();switch(e.id){case"display-mode":return this.waitForCondition(()=>document.body.classList.contains("display-mode"),3e3);case"exit-display":return this.waitForCondition(()=>!document.body.classList.contains("display-mode"),3e3);case"generate":return this.waitForCondition(()=>document.querySelectorAll(".pod").length>0,5e3);case"reset":return this.waitForCondition(()=>document.querySelectorAll(".player-row").length<=1,3e3);case"add-player":return this.waitForCondition(()=>document.querySelectorAll(".player-row").length>1,2e3);case"type-text":return new Promise(t=>setTimeout(t,100));default:return new Promise(t=>setTimeout(t,50))}}waitForCondition(e,t=3e3){return new Promise((r,n)=>{let o=Date.now(),s=()=>{if(e()){r();return}if(Date.now()-o>=t){n(new Error(`Timeout waiting for condition after ${t}ms`));return}setTimeout(s,50)};s()})}async previousStep(){this.currentStep>0&&await this.showStep(this.currentStep-1)}performStepAction(e){let t=document.querySelector(e.target);if(t)switch(e.action){case"click":t.click();break;case"type":e.actionData&&t instanceof HTMLInputElement&&(t.value=e.actionData,t.dispatchEvent(new Event("input",{bubbles:!0})));break;case"hover":let r=new MouseEvent("mouseenter",{bubbles:!0});t.dispatchEvent(r);break}}setupTourEventListeners(){document.addEventListener("keydown",this.handleTourKeydown),window.tourManager=this}removeEventListeners(){document.removeEventListener("keydown",this.handleTourKeydown),delete window.tourManager}removeTourUI(){[this.tourOverlay,this.tourHighlight,this.tourTooltip].forEach(t=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),document.querySelectorAll(".tour-progress").forEach(t=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),this.tourOverlay=null,this.tourHighlight=null,this.tourTooltip=null}cleanupRemainingElements(){document.querySelectorAll(".tour-overlay, .tour-highlight, .tour-tooltip, .tour-progress").forEach(t=>{t&&t.parentNode&&t.parentNode.removeChild(t)})}ensurePlayerRows(e){let t=document.querySelectorAll(".player-row").length;if(t<e){let r=document.getElementById("add-player-btn");for(let n=t;n<e;n++)r?.click()}}ensurePowerMode(){let e=document.getElementById("power-level-radio");e&&!e.checked&&e.click()}fillExamplePlayers(){let e=[{name:"Henry",power:"8"},{name:"Charlie",power:"7"},{name:"Diana",power:"7"},{name:"Bob",power:"7"},{name:"Eve",power:"7"},{name:"Frank",power:"8"},{name:"Grace",power:"8"},{name:"Ivy",power:"8"}],t=document.querySelectorAll(".player-row");for(let r=1;r<t.length;r++){let n=t[r],o=n.querySelector(".player-name"),s=n.querySelector(".power-selector-btn"),a=r-1;if(a>=e.length)break;let i=e[a];o&&o.value.trim()===""&&(o.value=i.name,o.dispatchEvent(new Event("input",{bubbles:!0}))),s&&(n.querySelector(".power-checkbox input:checked")||(s.click(),setTimeout(()=>{let d=n.querySelector(`.power-checkbox input[value="${i.power}"]`);d&&(d.checked=!0,d.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{s.click()},50))},100)))}}createGroupDemo(){let e=document.querySelector(".player-row:first-child"),t=document.querySelector(".player-row:nth-child(2)");if(e&&t){let r=e.querySelector(".group-select");if(r&&Array.from(r.options).find(o=>o.value==="new-group")){r.value="new-group";let o=new Event("change",{bubbles:!0});r.dispatchEvent(o),setTimeout(()=>{let s=r.dataset.createdGroupId;if(s){let a=t.querySelector(".group-select");if(a){if(Array.from(a.options).find(l=>l.value===s)){a.value=s;let l=new Event("change",{bubbles:!0});a.dispatchEvent(l)}else if(Array.from(a.options).find(d=>d.value==="group-1")){a.value="group-1";let d=new Event("change",{bubbles:!0});a.dispatchEvent(d)}}}},800)}}}openSettingsForTour(){setTimeout(()=>{let e=document.getElementById("settings-sidebar");e&&(e.classList.add("open"),window.scrollTo({left:0,top:0,behavior:"smooth"}),setTimeout(()=>{let t=this.tourSteps[this.currentStep];t&&this.positionHighlight(t)},400))},50)}closeSettingsAfterTour(){let e=document.getElementById("settings-sidebar");e&&e.classList.remove("open")}};var le=class{constructor(){this.listeners=new Map;this.abortController=new AbortController}addEventListener(e,t,r,n){let o=this.generateId(),s={...typeof n=="object"?n:{capture:n},signal:this.abortController.signal};return e.addEventListener(t,r,s),this.listeners.set(o,{element:e,type:t,listener:r,options:s}),o}removeEventListener(e){let t=this.listeners.get(e);return t?(t.element.removeEventListener(t.type,t.listener,t.options),this.listeners.delete(e),!0):!1}removeAllFromElement(e){let t=0;for(let[r,n]of this.listeners.entries())n.element===e&&(n.element.removeEventListener(n.type,n.listener,n.options),this.listeners.delete(r),t++);return t}removeAll(){this.abortController.abort(),this.abortController=new AbortController,this.listeners.clear()}getListenerCount(){return this.listeners.size}generateId(){return`listener_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}},ce=new le;var C=class{static clearDuplicateErrors(e){e.forEach(t=>{let r=t.querySelector(".player-name");r&&r.classList.remove("name-duplicate-error",...this.DUPLICATE_ERROR_CLASSES)})}static highlightDuplicateNames(e){this.clearDuplicateErrors(e);let t=new Map;e.forEach(o=>{let s=o.querySelector(".player-name");if(s){let a=s.value.trim().toLowerCase();a&&(t.has(a)||t.set(a,[]),t.get(a).push(s))}});let r=[],n=0;return t.forEach((o,s)=>{if(o.length>1){r.push(s);let a=this.DUPLICATE_ERROR_CLASSES[n];o.forEach(i=>{i.classList.add(a)}),n=(n+1)%this.DUPLICATE_ERROR_CLASSES.length}}),r}static hasSelectedCheckboxes(e){return Array.from(e).some(t=>t.checked)}static getSelectedCheckboxValues(e){return Array.from(e).filter(t=>t.checked).map(t=>t.value)}static addValidationError(e,t="error"){e.classList.add(t),e.dataset&&(e.dataset.validationTriggered="true")}static removeValidationError(e,t="error"){e.classList.remove(t)}static hasValidationError(e,t="error"){return e.classList.contains(t)}};C.DUPLICATE_ERROR_CLASSES=["name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5"];var V=class{static formatPowerButtonText(e){if(e.length===0)return"Select Power Levels";if(e.sort((o,s)=>o-s),e.length===1)return`Power: ${e[0]}`;let t=e[0],r=e[e.length-1];return e.every((o,s)=>{if(s===0)return!0;let a=o-e[s-1];return a===.5||a===1})&&e.length>2?`Power: ${t}-${r}`:e.length<=4?`Power: ${e.join(", ")}`:`Power: ${t}-${r} (${e.length} levels)`}static formatBracketButtonText(e){return e.length===0?"Select Brackets":e.length===1?`Bracket: ${e[0]==="cedh"?"cEDH":e[0]}`:e.length<=3?`Brackets: ${e.join(", ")}`:`Brackets: ${e.length} selected`}static updateButtonState(e,t,r){e.textContent=t,r?(e.classList.add("has-selection"),C.removeValidationError(e)):(e.classList.remove("has-selection"),e.dataset.validationTriggered==="true"&&C.addValidationError(e))}},q=class{static getElement(e,t,r){let n=e.querySelector(t);return n?r&&!r(n)?(console.warn(`Element ${t} found but failed type check`),null):n:null}static getAllElements(e,t,r){let n=Array.from(e.querySelectorAll(t));return r?n.filter(r):n}static setClasses(e,t,r=!0){r?e.classList.add(...t):e.classList.remove(...t)}static toggleClass(e,t,r){r?e.classList.add(t):e.classList.remove(t)}},_=class{static addEventListener(e,t,r,n){return e.addEventListener(t,r,n),()=>{e.removeEventListener(t,r,n)}}static debounce(e,t){let r;return(...n)=>{clearTimeout(r),r=window.setTimeout(()=>e(...n),t)}}static throttle(e,t){let r;return(...n)=>{r||(e(...n),r=!0,setTimeout(()=>r=!1,t))}}};var R=class{static updatePowerButton(e){let t=q.getElement(e,".power-selector-btn");if(!t)return;let r=e.querySelectorAll('.power-checkbox input[type="checkbox"]'),n=[];r.forEach(a=>{a.checked&&n.push(parseFloat(a.value))});let o=V.formatPowerButtonText(n),s=n.length>0;V.updateButtonState(t,o,s)}static updateBracketButton(e){let t=q.getElement(e,".bracket-selector-btn");if(!t)return;let r=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),n=C.getSelectedCheckboxValues(r),o=V.formatBracketButtonText(n),s=n.length>0;V.updateButtonState(t,o,s)}static updateAllButtonsForRow(e){this.updatePowerButton(e),this.updateBracketButton(e)}static updateAllButtons(e){q.getAllElements(e,".player-row").forEach(r=>this.updateAllButtonsForRow(r))}static createPowerButtonUpdater(e){return()=>this.updatePowerButton(e)}static createBracketButtonUpdater(e){return()=>this.updateBracketButton(e)}static createRowButtonUpdater(e){return()=>this.updateAllButtonsForRow(e)}static triggerValidationForRow(e){let r=document.getElementById("bracket-radio")?.checked??!1,n=q.getElement(e,".power-selector-btn"),o=q.getElement(e,".bracket-selector-btn");if(n&&(n.dataset.validationTriggered="true"),o&&(o.dataset.validationTriggered="true"),r&&o){let s=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]');C.hasSelectedCheckboxes(s)||C.addValidationError(o)}else if(n){let s=e.querySelectorAll('.power-checkbox input[type="checkbox"]');C.hasSelectedCheckboxes(s)||C.addValidationError(n)}}static triggerValidationForAllRows(e){q.getAllElements(e,".player-row").forEach(r=>this.triggerValidationForRow(r))}};var de=class{constructor(){this.cache=new Map;this.weakRefCache=new WeakMap}get(e,t=document){let r=this.getCacheKey(e,t);if(this.cache.has(r)){let o=this.cache.get(r);if(o&&o.isConnected)return o;this.cache.delete(r)}let n=t.querySelector(e);return n&&this.cache.set(r,n),n}getAll(e,t=document){let r=this.getCacheKey(e+":all",t);if(this.cache.has(r)){let o=this.cache.get(r);if(o&&o.length>0&&o[0].isConnected)return o;this.cache.delete(r)}let n=t.querySelectorAll(e);return this.cache.set(r,n),n}getFromRow(e,t){let r=this.weakRefCache.get(e);if(r||(r=new Map,this.weakRefCache.set(e,r)),r.has(t)){let o=r.get(t);if(o&&o.isConnected)return o;r.delete(t)}let n=e.querySelector(t);return n&&r.set(t,n),n}getAllFromRow(e,t){let r=this.weakRefCache.get(e);r||(r=new Map,this.weakRefCache.set(e,r));let n=t+":all";if(r.has(n)){let s=r.get(n);if(s&&s.length>0&&s[0].isConnected)return s;r.delete(n)}let o=e.querySelectorAll(t);return r.set(n,o),o}invalidate(e,t=document){if(e){let r=this.getCacheKey(e,t);this.cache.delete(r),this.cache.delete(r+":all")}else this.cache.clear()}clear(){this.cache.clear()}getCacheKey(e,t){return t===document?e:`${e}@${t.tagName}:${t.className}`}},x=new de;var U=class U{constructor(){this.nameValidationCallbacks=new Map;this.duplicateCheckCallback=null}setupNameValidation(e,t){this.duplicateCheckCallback||(this.duplicateCheckCallback=_.debounce(t,U.VALIDATION_DEBOUNCE_MS));let r=_.debounce(()=>{e.dataset.touched="true",!e.value.trim()&&e.dataset.touched==="true"?C.addValidationError(e,"input-error"):C.removeValidationError(e,"input-error"),this.duplicateCheckCallback&&this.duplicateCheckCallback()},U.VALIDATION_DEBOUNCE_MS);this.nameValidationCallbacks.set(e,r),e.addEventListener("input",r)}setupDropdownToggle(e,t,r){let n=_.throttle(o=>{o.preventDefault();let s=t.style.display!=="none";r(),s||(t.style.display="block",e.classList.add("open"),setTimeout(()=>t.classList.add("show"),10))},U.DROPDOWN_THROTTLE_MS);e.addEventListener("click",n)}batchValidateRows(e){let t=performance.now(),r=Array.from(e.querySelectorAll(".player-row")),n=!1,o=C.highlightDuplicateNames(r);return o.length>0&&(n=!0),r.forEach(a=>{let i=a.querySelector(".player-name");i.value.trim()||(C.addValidationError(i,"input-error"),n=!0)}),R.triggerValidationForAllRows(e),{validationTime:performance.now()-t,duplicateNames:o,hasErrors:n}}cleanup(){this.nameValidationCallbacks.clear(),this.duplicateCheckCallback=null}static trackValidationPerformance(e){e>100&&console.warn(`Slow validation detected: ${e.toFixed(2)}ms`),"performance"in window&&"mark"in performance&&performance.mark(`validation-${Date.now()}`)}};U.VALIDATION_DEBOUNCE_MS=300,U.DROPDOWN_THROTTLE_MS=100;var ue=U,oe=new ue;var pe=class{constructor(){this.metrics={bundleSize:"59.2kb",memoryUsage:0,domCacheHits:0,validationTime:0,podGenerationTime:0,lastUpdated:new Date}}updateMemoryUsage(){"memory"in performance&&(this.metrics.memoryUsage=Math.round((performance.memory?.usedJSHeapSize||0)/1024/1024*100)/100),this.metrics.lastUpdated=new Date}trackValidationTime(e){this.metrics.validationTime=Math.round(e*100)/100,this.metrics.lastUpdated=new Date}trackPodGenerationTime(e){this.metrics.podGenerationTime=Math.round(e*100)/100,this.metrics.lastUpdated=new Date}getMetrics(){return this.updateMemoryUsage(),{...this.metrics}}logMetrics(){let e=this.getMetrics();console.group("\u{1F50D} Performance Analysis"),console.log("\u{1F4E6} Bundle Size:",e.bundleSize,"(+7.1kb from 52.1kb baseline)"),console.log("\u{1F4CA} Growth Rate: +13.6% (efficient for added functionality)"),console.log("\u{1F4BE} Memory Usage:",`${e.memoryUsage}MB`),console.log("\u26A1 Validation Time:",`${e.validationTime}ms`),console.log("\u{1F3AF} Pod Generation:",`${e.podGenerationTime}ms`),console.group("\u{1F4C8} Helper Module Impact"),console.log("\u2705 ButtonTextManager: +2.7kb (display state management)"),console.log("\u2705 DOMCache: +1.2kb (query optimization)"),console.log("\u2705 RealTimeValidator: +1.5kb (instant feedback)"),console.log("\u2705 TypeGuards: +0.7kb (runtime type safety)"),console.log("\u2705 PerformanceMonitor: +1.0kb (metrics tracking)"),console.groupEnd(),console.log("\u{1F3AF} Next: Validation consolidation & event optimization"),console.groupEnd()}},Q=new pe;var he=class c{constructor(){this.toastContainer=null;this.modalContainer=null;this.activeToasts=new Set;this.toastCounter=0;this.initializeContainers()}static getInstance(){return c.instance||(c.instance=new c),c.instance}initializeContainers(){this.toastContainer=document.createElement("div"),this.toastContainer.id="toast-container",this.toastContainer.className="toast-container",document.body.appendChild(this.toastContainer),this.modalContainer=document.createElement("div"),this.modalContainer.id="modal-container",this.modalContainer.className="modal-container",document.body.appendChild(this.modalContainer)}showToast(e){if(!this.toastContainer)return;let t=`toast-${++this.toastCounter}`,r=document.createElement("div");r.id=t,r.className=`toast toast-${e.type}`;let n=this.getIconForType(e.type),o=e.actions?this.createActionsHtml(e.actions,t):"",s=e.suggestions?this.createSuggestionsHtml(e.suggestions):"";r.innerHTML=`
            <div class="toast-header">
                <span class="toast-icon">${n}</span>
                <h4 class="toast-title">${e.title}</h4>
                <button class="toast-close" data-toast-id="${t}" aria-label="Close">
                    <span class="btn-icon">\u2716\uFE0F</span>
                </button>
            </div>
            <div class="toast-body">
                <p class="toast-message">${e.message}</p>
                ${s}
                ${o}
            </div>
        `,this.setupToastEventListeners(r,t),this.toastContainer.appendChild(r),this.activeToasts.add(r),requestAnimationFrame(()=>{r.classList.add("toast-show")}),e.duration&&e.duration>0&&setTimeout(()=>{this.hideToast(t)},e.duration)}async showConfirm(e){return this.modalContainer?new Promise(t=>{let r=`modal-${++this.toastCounter}`,n=document.createElement("div");n.id=r,n.className="modal-overlay";let o=e.icon||this.getIconForConfirmStyle(e.confirmStyle||"primary"),s=e.confirmText||"Confirm",a=e.cancelText||"Cancel",i=`btn btn-${e.confirmStyle||"primary"}`;n.innerHTML=`
                <div class="modal-dialog">
                    <div class="modal-header">
                        <span class="modal-icon">${o}</span>
                        <h3 class="modal-title">${e.title}</h3>
                    </div>
                    <div class="modal-body">
                        <p class="modal-message">${e.message}</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary modal-cancel" data-modal-id="${r}">
                            ${a}
                        </button>
                        <button class="${i} modal-confirm" data-modal-id="${r}">
                            ${s}
                        </button>
                    </div>
                </div>
            `;let l=n.querySelector(".modal-confirm"),d=n.querySelector(".modal-cancel"),p=n,u=()=>{this.hideModal(r),t(!0)},E=()=>{this.hideModal(r),t(!1)};l.addEventListener("click",u),d.addEventListener("click",E),p.addEventListener("click",g=>{g.target===p&&E()});let f=g=>{g.key==="Escape"?E():g.key==="Enter"&&u()};document.addEventListener("keydown",f);let P=()=>{document.removeEventListener("keydown",f)};n.addEventListener("modal-hidden",P,{once:!0}),this.modalContainer&&this.modalContainer.appendChild(n),requestAnimationFrame(()=>{n.classList.add("modal-show")})}):!1}hideToast(e){let t=document.getElementById(e);t&&this.activeToasts.has(t)&&(t.classList.add("toast-hide"),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),this.activeToasts.delete(t)},300))}hideModal(e){let t=document.getElementById(e);t&&(t.classList.add("modal-hide"),t.dispatchEvent(new CustomEvent("modal-hidden")),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300))}setupToastEventListeners(e,t){let r=e.querySelector(".toast-close");r&&r.addEventListener("click",()=>{this.hideToast(t)}),e.querySelectorAll("[data-toast-action]").forEach(o=>{o.addEventListener("click",()=>{this.hideToast(t)})})}getIconForType(e){let t={error:"\u274C",warning:"\u26A0\uFE0F",success:"\u2705",info:"\u2139\uFE0F"};return t[e]||t.info}getIconForConfirmStyle(e){let t={danger:"\u26A0\uFE0F",warning:"\u26A0\uFE0F",primary:"\u2753"};return t[e]||t.primary}createActionsHtml(e,t){return!e||e.length===0?"":`<div class="toast-actions">${e.map(n=>`<button class="btn btn-${n.style||"secondary"} btn-sm" data-toast-action="${t}" onclick="(${n.action.toString()})()">
                ${n.label}
            </button>`).join("")}</div>`}createSuggestionsHtml(e){return`
            <div class="toast-suggestions">
                <h5>Problems:</h5>
                <ul>${e.map(r=>`<li>${r}</li>`).join("")}</ul>
            </div>
        `}clearAllToasts(){this.activeToasts.forEach(e=>{e.id&&this.hideToast(e.id)})}async clearErrorToasts(){let e=Array.from(this.activeToasts).filter(r=>r.classList.contains("toast-error"));if(e.length===0)return Promise.resolve();let t=e.map(r=>r.id?new Promise(n=>{let o=()=>{r.removeEventListener("transitionend",o),r.parentNode&&r.parentNode.removeChild(r),n()};r.addEventListener("transitionend",o),this.hideToast(r.id)}):Promise.resolve());await Promise.all(t),await new Promise(r=>setTimeout(r,50))}alert(e,t="Alert"){this.showToast({type:"info",title:t,message:e,duration:5e3})}async confirm(e,t="Confirm"){return this.showConfirm({title:t,message:e})}async showError(e,t,r){await this.clearErrorToasts(),this.showToast({type:"error",title:e,message:t,suggestions:r,duration:0})}showSuccess(e,t="Success"){this.showToast({type:"success",title:t,message:e,duration:3e3})}showWarning(e,t,r){this.showToast({type:"warning",title:e,message:t,suggestions:r,duration:0})}},H=he.getInstance();var Pe={E001:{title:"Player Name Required",message:"All players must have a name before generating pods.",suggestions:["Fill in the empty name field(s) highlighted in red","Use unique names for each player"]},E002:{title:"Duplicate Player Names",message:"Multiple players have the same name.",suggestions:["Change one of the highlighted duplicate names","Each player must have a unique name"]},E003:{title:"Power Level Selection Required",message:"Each player must have at least one power level selected.",suggestions:["Click the power level button for highlighted players","Use keyboard shortcuts: 7, 7-9, 6.5-8","Check at least one power level for each player"]},E004:{title:"Bracket Selection Required",message:"Each player must have at least one bracket selected.",suggestions:["Click the bracket button for highlighted players","Check at least one bracket level for each player","Switch to Power Level mode if preferred"]},E005:{title:"Not Enough Players",message:"You need at least 3 players to form a pod.",suggestions:['Add more players using the "Add Player" button','Use "Add 4 Players" for quick setup',"Remove unused empty player rows"]},E009:{title:"Validation Errors Found",message:"Please fix the highlighted errors before generating pods.",suggestions:["Check red highlighted fields for missing information","Ensure all names are unique","Verify power levels or brackets are selected"]},E010:{title:"Incompatible Power Levels",message:"Some players have power levels too far apart to form balanced pods.",suggestions:["Increase the leniency setting to allow wider power ranges","Adjust player power levels to be closer together","Consider grouping players manually to keep them together"]},E011:{title:"Incompatible Bracket Levels",message:"Some players have brackets with no overlap for balanced pods.",suggestions:["Select additional brackets for flexibility","Group incompatible players manually","Adjust bracket selections to have some overlap"]},E012:{title:"Group Configuration Issues",message:"Some groups have internal conflicts preventing pod assignment.",suggestions:["Check grouped players have compatible power/bracket levels","Consider splitting problematic groups","Adjust group member selections for better compatibility"]},E006:{title:"Pod Generation Failed",message:"Unable to create balanced pods with current settings.",suggestions:["Try enabling leniency for more flexible matching","Adjust player power levels or brackets","Reduce group sizes or ungroup some players"]},E007:{title:"Display Mode Error",message:"Unable to switch to display mode.",suggestions:["Generate pods first before using display mode","Refresh the page if issues persist"]},E008:{title:"Initialization Error",message:"Application failed to start properly.",suggestions:["Refresh the page","Clear browser cache","Check browser console for details"]}},M=class{static get(e){return Pe[e]||{title:"Unknown Error",message:"An unexpected error occurred.",suggestions:["Try refreshing the page","Check browser console for details"]}}static getSimple(e,t){let r=this.get(e);return t?`${r.message}: ${t}`:r.message}static showEnhanced(e,t){let r=this.get(e);console.error(`[${e}] ${r.title}: ${r.message}`),H.showError(r.title,t?`${r.message}

Details: ${t}`:r.message,r.suggestions)}static show(e,t){let r=this.get(e),n=t?`${r.message}: ${t}`:r.message;console.error(`[${e}] ${n}`),H.showError(r.title,n,r.suggestions)}static showSuccess(e){console.log(`\u2705 ${e}`),H.showSuccess(e)}};M.PLAYER_NAME_REQUIRED="E001",M.PLAYER_NAME_DUPLICATE="E002",M.POWER_LEVEL_REQUIRED="E003",M.BRACKET_LEVEL_REQUIRED="E004",M.INSUFFICIENT_PLAYERS="E005",M.GENERATION_FAILED="E006",M.DISPLAY_MODE_FAILED="E007",M.INITIALIZATION_FAILED="E008",M.VALIDATION_FAILED="E009",M.INCOMPATIBLE_POWER_LEVELS="E010",M.INCOMPATIBLE_BRACKETS="E011",M.GROUP_CONFLICTS="E012";function N(c){return c instanceof HTMLElement}function W(c){return c instanceof HTMLInputElement}function F(c){return c instanceof HTMLButtonElement}function D(c,e){let t=document.getElementById(c);return t?e(t)?t:(console.warn(`Element #${c} exists but is not the expected type`),null):null}function z(c,e){let t=c.target;return!t||!e(t)?null:t}function B(c,e){if(c==null)throw new Error(e||"Assertion failed: value is null or undefined");return c}var se=class{constructor(){this.displayModeManager=null;this.tourManager=null;this.currentPods=[];this.currentUnassigned=[];this.lastResetData=null;this.isRestoring=!1;this.displayModeBtnBottom=null;this.reusablePlayerArray=[];this.reusableItemArray=[];this.reusablePlayerObject={};this.reusableGroupObject={};this.containerClickHandler=null;this.containerChangeHandler=null;this.containerInputHandler=null;this.documentClickHandler=null;try{this.playerRowsContainer=B(D("player-rows",N),"player-rows container is required"),this.outputSection=B(D("output-section",N),"output-section is required"),this.resultsCard=B(document.querySelector(".results-card"),"results-card is required"),this.displayModeBtn=B(D("display-mode-btn",F),"display-mode-btn is required"),this.playerRowTemplate=B(document.getElementById("player-row-template"),"player-row-template is required"),this.playerManager=new X,this.podGenerator=new ee,this.dragDropManager=new te(this.playerManager,(e,t)=>this.renderPods(e,t)),this.safeInitialization(),window.performanceMonitor=Q}catch(e){console.error("Critical error during UIManager initialization:",e),M.show(M.INITIALIZATION_FAILED)}}safeInitialization(){try{this.initializeEventListeners()}catch(e){console.error("Error initializing event listeners:",e)}try{this.initializeRankingModeToggle()}catch(e){console.error("Error initializing ranking mode toggle:",e)}try{this.setupRealTimeValidationForExistingRows()}catch(e){console.error("Error setting up real-time validation:",e)}}initializeEventListeners(){let e=B(D("add-player-btn",F),"add-player-btn is required"),t=B(D("bulk-add-btn",F),"bulk-add-btn is required"),r=B(D("generate-pods-btn",F),"generate-pods-btn is required"),n=B(D("reset-all-btn",F),"reset-all-btn is required"),o=B(D("help-btn",F),"help-btn is required");e.addEventListener("click",()=>this.addPlayerRow()),t.addEventListener("click",()=>this.bulkAddPlayers(4)),r.addEventListener("click",async()=>await this.generatePods()),n.addEventListener("click",async()=>await this.resetAllWithConfirmation()),this.displayModeBtn.addEventListener("click",async()=>await this.enterDisplayModeWithWarning()),o.addEventListener("click",()=>this.showHelpModal());let s=B(D("settings-toggle",F),"settings-toggle is required"),a=B(D("sidebar-close",F),"sidebar-close is required"),i=B(D("settings-sidebar",N),"settings-sidebar is required");s.addEventListener("click",()=>{let l=i.classList.contains("open");this.toggleSidebar(!l)}),a.addEventListener("click",()=>this.toggleSidebar(!1)),document.addEventListener("click",l=>{let d=z(l,N);d&&!i.contains(d)&&!s.contains(d)&&!d.closest(".toast-container")&&!d.closest(".modal-container")&&i.classList.contains("open")&&this.toggleSidebar(!1)}),this.setupEventDelegation(),this.initializeHelpModal(),this.initializeKeyboardShortcuts()}clearDOMCache(){x.clear(),A.clear()}async showErrorMessage(e){console.error("UIManager Error:",e),await H.showError("Error",e)}showSuccessMessage(e){console.log("UIManager Success:",e),H.showSuccess(e)}processGroupsSafely(){let e=new Map;try{this.playerManager.getGroups().forEach((t,r)=>{if(!t||t.length===0){console.warn(`Skipping empty group: ${r}`);return}if(!t.every(s=>s&&typeof s.power=="number")){console.warn(`Skipping group with invalid player data: ${r}`);return}let n=t.reduce((s,a)=>s+a.power,0),o=Math.round(n/t.length*2)/2;Object.assign(this.reusableGroupObject,{id:r,players:t,averagePower:o,size:t.length}),e.set(r,{...this.reusableGroupObject})})}catch(t){console.error("Error processing groups:",t)}return e}addEventListenerWithTracking(e,t,r){ce.addEventListener(e,t,r)}removeAllEventListeners(e){ce.removeAllFromElement(e)}setupEventDelegation(){this.containerClickHandler||(this.containerClickHandler=e=>this.handleContainerClick(e),this.playerRowsContainer.addEventListener("click",this.containerClickHandler)),this.containerChangeHandler||(this.containerChangeHandler=e=>this.handleContainerChange(e),this.playerRowsContainer.addEventListener("change",this.containerChangeHandler)),this.containerInputHandler||(this.containerInputHandler=e=>this.handleContainerInput(e),this.playerRowsContainer.addEventListener("input",this.containerInputHandler)),this.documentClickHandler||(this.documentClickHandler=e=>this.handleDocumentClick(e),document.addEventListener("click",this.documentClickHandler))}setupRealTimeValidationForExistingRows(){x.getAll(".player-row",this.playerRowsContainer).forEach(t=>{let r=x.getFromRow(t,".player-name");r&&oe.setupNameValidation(r,()=>this.clearDuplicateErrorsOnInput())})}handleContainerClick(e){let t=z(e,N);if(t){if(t.classList.contains("power-selector-btn")){this.handlePowerSelectorClick(e,t);return}if(t.classList.contains("bracket-selector-btn")){this.handleBracketSelectorClick(e,t);return}if(t.classList.contains("range-btn")){this.handleRangeButtonClick(t);return}if(t.classList.contains("bracket-range-btn")){this.handleBracketRangeButtonClick(t);return}if(t.classList.contains("clear-btn")||t.classList.contains("bracket-clear-btn")){this.handleClearButtonClick(t);return}if(t.classList.contains("remove-player-btn")){this.handleRemoveButtonClick(t);return}}}handleContainerChange(e){let t=z(e,N);if(t){if(t.classList.contains("group-select")){this.playerManager.handleGroupChange(this.playerRowsContainer);return}if(W(t)&&t.type==="checkbox"&&t.closest(".power-checkbox")){this.handlePowerCheckboxChange(t);return}if(W(t)&&t.type==="checkbox"&&t.closest(".bracket-checkbox")){this.handleBracketCheckboxChange(t);return}if(t.classList.contains("player-name")&&W(t)){this.handlePlayerNameChange(t);return}}}handleContainerInput(e){let t=z(e,N);if(t&&t.classList.contains("player-name")){let r=z(e,W);r&&this.handlePlayerNameChange(r);return}}handleDocumentClick(e){let t=z(e,N);t&&!t.closest(".power-selector-btn")&&!t.closest(".power-selector-dropdown")&&!t.closest(".bracket-selector-btn")&&!t.closest(".bracket-selector-dropdown")&&this.closeAllDropdowns()}closeAllDropdowns(){document.querySelectorAll(".bracket-selector-dropdown, .power-selector-dropdown").forEach(n=>{n.style.display="none",n.classList.remove("show")}),document.querySelectorAll(".power-selector-btn, .bracket-selector-btn").forEach(n=>{n.classList.remove("open")}),document.querySelectorAll(".player-row").forEach(n=>{n.classList.remove("dropdown-open")})}handlePowerSelectorClick(e,t){e.preventDefault(),this.handleDropdownToggle(t,".power-selector-dropdown")}handleBracketSelectorClick(e,t){e.preventDefault(),this.handleDropdownToggle(t,".bracket-selector-dropdown")}findPlayerRow(e){return e.closest(".player-row")}handleDropdownToggle(e,t){let r=this.findPlayerRow(e);if(!r)return;let n=x.getFromRow(r,t);if(!n)return;let o=n.style.display!=="none";this.closeAllDropdowns(),o||(n.style.display="block",e.classList.add("open"),r.classList.add("dropdown-open"),setTimeout(()=>n.classList.add("show"),10))}handleRangeButtonClick(e){let t=this.findPlayerRow(e);if(!t||!t)return;let r=e.dataset.range,n=x.getAllFromRow(t,'.power-checkbox input[type="checkbox"]');n.forEach(a=>a.checked=!1);let[o,s]=r.split("-").map(Number);n.forEach(a=>{let i=parseFloat(a.value);(i===o||i===s)&&(a.checked=!0)}),R.updatePowerButton(t)}handleBracketRangeButtonClick(e){let t=this.findPlayerRow(e);if(!t)return;let r=e.dataset.range,n=x.getAllFromRow(t,'.bracket-checkbox input[type="checkbox"]');if(n.forEach(o=>o.checked=!1),r==="cedh"){let o=Array.from(n).find(s=>s.value==="cedh");o&&(o.checked=!0)}else{let[o,s]=r.split("-").map(a=>a==="cedh"?a:parseInt(a));n.forEach(a=>{let i=a.value==="cedh"?"cedh":parseInt(a.value);(i===o||i===s)&&(a.checked=!0)})}R.updateBracketButton(t)}handleClearButtonClick(e){let t=this.findPlayerRow(e);t&&(e.classList.contains("clear-btn")?(x.getAllFromRow(t,'.power-checkbox input[type="checkbox"]').forEach(n=>n.checked=!1),R.updatePowerButton(t)):e.classList.contains("bracket-clear-btn")&&(x.getAllFromRow(t,'.bracket-checkbox input[type="checkbox"]').forEach(n=>n.checked=!1),R.updateBracketButton(t)))}handleRemoveButtonClick(e){let t=this.findPlayerRow(e);t&&(this.removeAllEventListeners(t),this.playerRowsContainer.removeChild(t),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.updatePlayerNumbers(),this.clearDOMCache())}handlePowerCheckboxChange(e){let t=this.findPlayerRow(e);t&&R.updatePowerButton(t)}handleBracketCheckboxChange(e){let t=this.findPlayerRow(e);t&&R.updateBracketButton(t)}handlePlayerNameChange(e){}getPlayerRowsOptimized(){let e=x.getAll(".player-row",this.playerRowsContainer),t=[];for(let r=0;r<e.length;r++)t.push(e[r]);return t}clearReusableArrays(){this.reusablePlayerArray.length=0,this.reusableItemArray.length=0,this.reusablePlayerObject={},this.reusableGroupObject={}}createElement(e){return A.get(e)}addPlayerRow(){let t=this.playerRowTemplate.content.cloneNode(!0).querySelector(".player-row"),r=this.playerManager.getNextPlayerId();t.dataset.playerId=r.toString(),R.updatePowerButton(t),R.updateBracketButton(t),this.playerRowsContainer.appendChild(t);let n=x.getFromRow(t,".player-name");n&&oe.setupNameValidation(n,()=>this.clearDuplicateErrorsOnInput()),this.clearDOMCache(),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.clearDOMCache(),this.updatePlayerNumbers();let s=D("bracket-radio",W)?.checked??!1,a=x.getFromRow(t,".power-levels"),i=x.getFromRow(t,".bracket-levels");s&&a&&i?(a.style.display="none",i.style.display="block"):a&&i&&(a.style.display="block",i.style.display="none")}bulkAddPlayers(e){for(let t=0;t<e;t++)this.addPlayerRow()}initializeKeyboardShortcuts(){let e="",t=null,r="",n=null;document.addEventListener("keydown",o=>{if(o.ctrlKey&&o.key==="p"){o.preventDefault(),Q.logMetrics();return}if(o.ctrlKey&&o.key==="Enter"){o.preventDefault(),this.addPlayerRow();let a=x.getAll(".player-row",this.playerRowsContainer),i=a[a.length-1],l=x.getFromRow(i,".player-name");l&&l.focus();return}let s=document.activeElement;if(N(s)&&s.classList.contains("power-selector-btn")){if(o.key==="Escape"){o.preventDefault(),this.closeAllDropdowns();return}if(o.key==="Enter"){o.preventDefault(),e.trim()&&(this.selectPowerByKeyboard(s,e.trim()),e="",t&&(clearTimeout(t),t=null));return}if(o.key.match(/[0-9.\-]/)||o.key==="Backspace"){o.preventDefault(),o.key==="Backspace"?e=e.slice(0,-1):e+=o.key,t&&clearTimeout(t),t=setTimeout(()=>{e.trim()&&(this.selectPowerByKeyboard(s,e.trim()),e=""),t=null},1e3);return}}if(N(s)&&s.classList.contains("bracket-selector-btn")){if(o.key==="Escape"){o.preventDefault(),this.closeAllDropdowns();return}if(o.key==="Enter"){o.preventDefault(),r.trim()&&(this.selectBracketByKeyboard(s,r.trim()),r="",n&&(clearTimeout(n),n=null));return}if(o.key.match(/[1-5c\-]/)||o.key==="Backspace"||o.key==="C"){o.preventDefault(),o.key==="Backspace"?r=r.slice(0,-1):r+=o.key.toLowerCase(),n&&clearTimeout(n),n=setTimeout(()=>{r.trim()&&(this.selectBracketByKeyboard(s,r.trim()),r=""),n=null},1e3);return}}})}selectBracketByKeyboard(e,t){let r=this.findPlayerRow(e);if(!r)return;let n=x.getAllFromRow(r,'.bracket-checkbox input[type="checkbox"]');if(n.forEach(s=>s.checked=!1),t.includes("-")){let s=t.split("-");if(s.length===2){let a=s[0].trim(),i=s[1].trim(),l=u=>u==="cedh"||u==="c"?5:parseInt(u),d=l(a),p=l(i);!isNaN(d)&&!isNaN(p)&&d<=p&&n.forEach(u=>{let E=l(u.value);E>=d&&E<=p&&(u.checked=!0)})}}else{let s=t;t==="c"&&(s="cedh"),t==="5"&&(s="cedh");let a=x.getFromRow(r,`.bracket-checkbox input[value="${s}"]`);a&&(a.checked=!0)}let o=Array.from(n).filter(s=>s.checked);o.forEach(s=>{s.dispatchEvent(new Event("change",{bubbles:!0}))}),o.length===0&&n[0]?.dispatchEvent(new Event("change",{bubbles:!0})),this.closeAllDropdowns()}selectPowerByKeyboard(e,t){let r=this.findPlayerRow(e);if(!r)return;let n=x.getAllFromRow(r,'.power-checkbox input[type="checkbox"]');if(n.forEach(s=>s.checked=!1),t.includes("-")){let s=t.split("-");if(s.length===2){let a=parseFloat(s[0]),i=parseFloat(s[1]);if(!isNaN(a)&&!isNaN(i)&&a<=i){let l=Number.isInteger(a)&&Number.isInteger(i);n.forEach(d=>{let p=parseFloat(d.value);if(p>=a&&p<=i){if(l&&!Number.isInteger(p))return;d.checked=!0}})}}}else{let s=parseFloat(t);if(!isNaN(s)){let a=x.getFromRow(r,`.power-checkbox input[value="${s}"]`);a&&(a.checked=!0)}}let o=Array.from(n).filter(s=>s.checked);o.forEach(s=>{s.dispatchEvent(new Event("change",{bubbles:!0}))}),o.length===0&&n[0]?.dispatchEvent(new Event("change",{bubbles:!0})),this.closeAllDropdowns()}cleanupBottomDisplayButton(){if(this.displayModeBtnBottom){let e=this.displayModeBtnBottom.parentNode;e&&e.parentNode&&e.parentNode.removeChild(e),this.displayModeBtnBottom=null}}async generatePods(){this.triggerValidationForAllFields(),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.updateResultsCardVisibility(),this.playerManager.handleGroupChange(this.playerRowsContainer),this.clearReusableArrays();let e=this.getPlayerRowsOptimized();C.clearDuplicateErrors(e);let t=C.highlightDuplicateNames(e),r=t.length>0,n=[];t.length>0&&t.forEach(m=>{let h=[];if(e.forEach((y,w)=>{let k=y.querySelector(".player-name");k&&k.value.trim().toLowerCase()===m&&h.push(w+1)}),h.length>1){let y=h.map(w=>`Player ${w}`).join(" and ");n.push(`${y} both have the same name: "${m}"`)}});for(let m=0;m<e.length;m++){let h=this.playerManager.getPlayerFromRow(e[m]);if(h)this.reusablePlayerArray.push(h);else{let y=m+1,w=e[m].querySelector(".player-name"),k=e[m].querySelector(".power-selector-btn"),b=e[m].querySelector(".bracket-selector-btn"),L=w.value.trim(),T=L.length>0,S=k&&!k.textContent?.includes("Select Power"),I=b&&!b.textContent?.includes("Select Bracket"),$=T||S||I;if((Array.from(e).some((O,K)=>{let we=O.querySelector(".player-name"),me=O.querySelector(".power-selector-btn"),ge=O.querySelector(".bracket-selector-btn"),Te=we.value.trim(),Le=me&&!me.textContent?.includes("Select Power"),ke=ge&&!ge.textContent?.includes("Select Bracket");return Te.length>0||Le||ke})||$)&&!h){r=!0;let O=[];if(T||O.push("Missing name"),!S&&!I){let K=document.getElementById("bracket-radio");K&&K.checked?O.push("No bracket selected"):O.push("No power levels selected")}if(O.length>0){let K=L?`Player ${y} (${L})`:`Player ${y}`;n.push(`${K}: ${O.join(", ")}`)}else n.push(`Player ${y}: Incomplete`)}}}if(r){if(n.length>0){let m,h=t.length>0,y=n.some(w=>!w.includes("both have the same name"));h&&!y?m="Duplicate Player Names":!h&&y&&n.length===1?n[0].includes("Missing name")?m="Player Name Required":n[0].includes("No power levels selected")?m="Power Level Required":n[0].includes("No bracket selected")?m="Bracket Required":m="Validation Error":m="Validation Errors Found",await H.showError(m,"Please fix the following issues before generating pods:",n)}else M.show(M.VALIDATION_FAILED);return}let o=new Map;this.playerManager.getGroups().forEach((m,h)=>{let y=m.reduce((k,b)=>k+b.power,0),w=Math.round(y/m.length*2)/2;Object.assign(this.reusableGroupObject,{id:h,players:m,averagePower:w,size:m.length}),o.set(h,{...this.reusableGroupObject})});let s=new Set([...this.playerManager.getGroups().values()].flat().map(m=>m.id)),a=this.reusablePlayerArray.filter(m=>!s.has(m.id));this.reusableItemArray.length=0,this.reusableItemArray.push(...a),o.forEach(m=>{this.reusableItemArray.push({id:m.id,players:m.players,averagePower:m.averagePower,size:m.size})});let i=this.reusablePlayerArray.length;if(i<3){M.show(M.INSUFFICIENT_PLAYERS);return}let d=fe()==="avoid-five"?ye(i):Z(i),p=ve();if(typeof window<"u"&&(window.location.protocol==="file:"||window.__playwright!==void 0||window.playwright!==void 0)){let m=this.reusablePlayerArray.map(y=>y.name).join(""),h=Array.from(m).reduce((y,w)=>y+w.charCodeAt(0),0);this.podGenerator.setShuffleSeed(h)}else this.podGenerator.setShuffleSeed(null);let E=performance.now(),f=this.podGenerator.generatePodsWithBacktracking(this.reusableItemArray,d,p),P=performance.now();Q.trackPodGenerationTime(P-E);let g=f.pods,v=f.unassigned;this.currentPods=[...g],this.currentUnassigned=[...v],await H.clearErrorToasts(),this.renderPods(g,v)}renderPods(e,t=[]){try{if(!Array.isArray(e))throw new Error("Invalid pods array provided to renderPods");if(!Array.isArray(t))throw new Error("Invalid unassignedPlayers array provided to renderPods");if(this.currentPods=[...e],this.currentUnassigned=[...t],this.dragDropManager.setCurrentPods(this.currentPods,this.currentUnassigned),this.cleanupBottomDisplayButton(),!this.outputSection)throw new Error("Output section not found - cannot render pods");if(this.outputSection.innerHTML="",this.updateResultsCardVisibility(),e.length===0){this.outputSection.textContent="Could not form pods with the given players.",this.displayModeBtn&&(this.displayModeBtn.style.display="none");return}this.displayModeBtn&&(this.displayModeBtn.style.display="inline-block"),this.renderPodsToDOM(e,t)}catch(r){console.error("Error in renderPods:",r),M.show(M.DISPLAY_MODE_FAILED,`Error: ${r instanceof Error?r.message:"Unknown error"}`),this.outputSection&&(this.outputSection.textContent="Error displaying pods. Please try again."),this.displayModeBtn&&(this.displayModeBtn.style.display="none")}}renderPodsToDOM(e,t){let r=Math.ceil(Math.sqrt(e.length)),n=document.createDocumentFragment(),o=this.createElement("div");if(o.classList.add("pods-container"),o.style.gridTemplateColumns=`repeat(${r}, 1fr)`,o.style.gridTemplateRows=`repeat(${r}, 1fr)`,e.forEach((a,i)=>{let l=this.createElement("div");l.classList.add("pod",`pod-color-${i%10}`),l.dataset.podIndex=i.toString(),l.addEventListener("dragover",this.dragDropManager.handleDragOver),l.addEventListener("drop",this.dragDropManager.handleDrop),l.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let d=this.createElement("h3"),p=document.getElementById("bracket-radio");if(p&&p.checked){let f=this.calculateValidBracketRange(a);d.textContent=`Pod ${i+1} (Bracket: ${f})`}else{let f=J(a);d.textContent=`Pod ${i+1} (Power: ${f})`}l.appendChild(d);let E=this.createElement("ul");a.players.forEach((f,P)=>{if("players"in f){let g=this.createElement("li");g.classList.add("pod-group"),g.draggable=!0,g.dataset.itemType="group",g.dataset.itemId=f.id,g.dataset.podIndex=i.toString(),g.dataset.itemIndex=P.toString(),g.addEventListener("dragstart",this.dragDropManager.handleDragStart),g.addEventListener("dragend",this.dragDropManager.handleDragEnd);let v=document.getElementById("bracket-radio"),m=v&&v.checked,h=this.createElement("strong");m?h.textContent=`Group ${f.id.split("-")[1]}:`:h.textContent=`Group ${f.id.split("-")[1]} (Avg Power: ${f.averagePower}):`,g.appendChild(h);let y=this.createElement("ul");f.players.forEach(w=>{let k=this.createElement("li");if(m&&w.bracketRange)k.textContent=`${w.name} (B: ${w.bracketRange})`;else{let b=Y(a),L=j(w,b);k.innerHTML=`${w.name} (P: ${L})`}y.appendChild(k)}),g.appendChild(y),E.appendChild(g)}else{let g=this.createElement("li");g.classList.add("pod-player"),g.draggable=!0,g.dataset.itemType="player",g.dataset.itemId=f.id.toString(),g.dataset.podIndex=i.toString(),g.dataset.itemIndex=P.toString(),g.addEventListener("dragstart",this.dragDropManager.handleDragStart),g.addEventListener("dragend",this.dragDropManager.handleDragEnd);let v=document.getElementById("bracket-radio");if(v&&v.checked&&f.bracketRange)g.textContent=`${f.name} (B: ${f.bracketRange})`;else{let h=Y(a),y=j(f,h);g.innerHTML=`${f.name} (P: ${y})`}E.appendChild(g)}}),l.appendChild(E),o.appendChild(l)}),e.length>0){let a=this.createElement("div");a.classList.add("pod","new-pod","new-pod-target"),a.style.borderColor="#4CAF50",a.style.backgroundColor="#1f2a1f",a.style.borderStyle="dashed",a.dataset.podIndex="new-pod",a.addEventListener("dragover",this.dragDropManager.handleDragOver),a.addEventListener("drop",this.dragDropManager.handleDrop),a.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let i=this.createElement("h3");i.textContent="Create New Pod",i.style.color="#4CAF50",a.appendChild(i);let l=this.createElement("p");l.textContent="Drag players or groups here to create a new pod",l.style.color="#999",l.style.fontStyle="italic",l.style.textAlign="center",l.style.margin="20px 0",a.appendChild(l),o.appendChild(a)}if(t.length>0){let a=this.createElement("div");a.classList.add("pod","unassigned-pod"),a.style.borderColor="#ff6b6b",a.style.backgroundColor="#2a1f1f",a.dataset.podIndex="unassigned",a.addEventListener("dragover",this.dragDropManager.handleDragOver),a.addEventListener("drop",this.dragDropManager.handleDrop),a.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let i=this.createElement("h3");i.textContent="Unassigned Players",i.style.color="#ff6b6b",a.appendChild(i);let l=this.createElement("ul");t.forEach((d,p)=>{if("players"in d){let u=this.createElement("li");u.classList.add("pod-group"),u.draggable=!0,u.dataset.itemType="group",u.dataset.itemId=d.id,u.dataset.podIndex="unassigned",u.dataset.itemIndex=p.toString(),u.addEventListener("dragstart",this.dragDropManager.handleDragStart),u.addEventListener("dragend",this.dragDropManager.handleDragEnd);let E=document.getElementById("bracket-radio"),f=E&&E.checked;f?u.innerHTML=`<strong>Group ${d.id.split("-")[1]}:</strong>`:u.innerHTML=`<strong>Group ${d.id.split("-")[1]} (Avg Power: ${d.averagePower}):</strong>`;let P=this.createElement("ul");d.players.forEach(g=>{let v=this.createElement("li");f&&g.bracketRange?v.textContent=`${g.name} (B: ${g.bracketRange})`:v.textContent=`${g.name} (P: ${g.powerRange})`,P.appendChild(v)}),u.appendChild(P),l.appendChild(u)}else{let u=this.createElement("li");u.classList.add("pod-player"),u.draggable=!0,u.dataset.itemType="player",u.dataset.itemId=d.id.toString(),u.dataset.podIndex="unassigned",u.dataset.itemIndex=p.toString(),u.addEventListener("dragstart",this.dragDropManager.handleDragStart),u.addEventListener("dragend",this.dragDropManager.handleDragEnd);let E=document.getElementById("bracket-radio");E&&E.checked&&d.bracketRange?u.textContent=`${d.name} (B: ${d.bracketRange})`:u.textContent=`${d.name} (P: ${d.powerRange})`,l.appendChild(u)}}),a.appendChild(l),o.appendChild(a)}n.appendChild(o),this.outputSection.appendChild(n),this.updateResultsCardVisibility();let s=document.querySelector(".help-section");if(s&&s.parentNode){let a=this.createElement("div");a.style.textAlign="center",a.style.marginTop="20px",a.style.marginBottom="20px",this.displayModeBtnBottom=this.displayModeBtn.cloneNode(!0),this.displayModeBtnBottom.id="display-mode-btn-bottom",this.displayModeBtnBottom.style.display="inline-block",this.displayModeBtnBottom.addEventListener("click",async()=>await this.enterDisplayModeWithWarning()),a.appendChild(this.displayModeBtnBottom),s.parentNode.insertBefore(a,s)}}captureCurrentPlayerData(){let e=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),t=[];e.forEach(n=>{let o=n.querySelector(".player-name"),s=n.querySelector(".group-select"),a=n.querySelectorAll('.power-checkbox input[type="checkbox"]'),i=[];a.forEach(p=>{p.checked&&i.push(p.value)});let l=n.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),d=[];l.forEach(p=>{p.checked&&d.push(p.value)}),t.push({name:o.value.trim(),groupValue:s.value,createdGroupId:s.dataset.createdGroupId,selectedPowers:i,selectedBrackets:d})});let r={noLeniency:document.getElementById("no-leniency-radio")?.checked||!1,leniency:document.getElementById("leniency-radio")?.checked||!1,superLeniency:document.getElementById("super-leniency-radio")?.checked||!1,bracket:document.getElementById("bracket-radio")?.checked||!1};return{players:t,leniencySettings:r,currentPods:[...this.currentPods],currentUnassigned:[...this.currentUnassigned]}}async resetAllWithConfirmation(){if(!Array.from(this.playerRowsContainer.querySelectorAll(".player-row")).some(n=>{if(n.querySelector(".player-name").value.trim())return!0;let s=n.querySelectorAll('input[type="checkbox"]');return Array.from(s).some(a=>a.checked)})){this.resetAll();return}await H.showConfirm({title:"Reset All Player Data",message:`Are you sure you want to reset all player data?

This will clear all players, groups, and generated pods. You will be able to undo this action immediately after.`,confirmText:"Reset All",cancelText:"Cancel",confirmStyle:"danger",icon:"\u26A0\uFE0F"})&&(this.lastResetData=this.captureCurrentPlayerData(),this.resetAll(),this.showUndoResetButton())}async enterDisplayModeWithWarning(){if(this.currentUnassigned.length>0){let e=this.currentUnassigned.length,t=e===1?"player":"players";if(!await H.showConfirm({title:"Unassigned Players Warning",message:`Warning: There ${e===1?"is":"are"} ${e} unassigned ${t}.

These players will not be displayed in display mode. Do you want to continue without assigning them?`,confirmText:"Continue",cancelText:"Cancel",confirmStyle:"warning",icon:"\u26A0\uFE0F"}))return}this.getDisplayModeManager().enterDisplayMode(this.currentPods)}showUndoResetButton(){let e=document.getElementById("undo-reset-btn");e&&e.remove();let t=this.createElement("button");t.id="undo-reset-btn",t.textContent="Undo Reset",t.style.marginLeft="10px",t.style.backgroundColor="#28a745",t.style.color="white",t.style.border="none",t.style.padding="8px 16px",t.style.borderRadius="4px",t.style.cursor="pointer",t.style.fontSize="14px",t.addEventListener("click",async()=>await this.undoReset());let r=document.getElementById("reset-all-btn");r.parentNode.insertBefore(t,r.nextSibling),setTimeout(()=>{document.getElementById("undo-reset-btn")&&(t.remove(),this.lastResetData=null)},3e4)}async undoReset(){if(!this.lastResetData){await H.showError("No Reset Data","No reset data available to restore.");return}this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.updateResultsCardVisibility(),this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds();let e=this.lastResetData.leniencySettings;e.noLeniency&&(document.getElementById("no-leniency-radio").checked=!0),e.leniency&&(document.getElementById("leniency-radio").checked=!0),e.superLeniency&&(document.getElementById("super-leniency-radio").checked=!0),e.bracket&&(document.getElementById("bracket-radio").checked=!0),this.lastResetData.players.forEach(n=>{this.addPlayerRow();let o=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),s=o[o.length-1],a=s.querySelector(".player-name");a.value=n.name;let i=s.querySelector(".group-select");n.createdGroupId&&(i.dataset.createdGroupId=n.createdGroupId),i.value=n.groupValue}),this.isRestoring=!0;let t=document.getElementById("no-leniency-radio"),r=document.getElementById("bracket-radio");if(t&&r){let n=new Event("change",{bubbles:!0});e.bracket?r.dispatchEvent(n):t.dispatchEvent(n)}setTimeout(()=>{this.restorePlayerSelections()},200)}restorePlayerSelections(){if(!this.lastResetData)return;this.lastResetData.players.forEach((t,r)=>{let o=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[r];if(!o)return;t.selectedPowers.forEach(i=>{let l=o.querySelector(`.power-checkbox input[type="checkbox"][value="${i}"]`);l&&(l.checked=!0)}),t.selectedBrackets.forEach(i=>{let l=o.querySelector(`.bracket-checkbox input[type="checkbox"][value="${i}"]`);l&&(l.checked=!0)}),o.querySelectorAll('input[type="checkbox"]').forEach(i=>{i.checked&&i.dispatchEvent(new Event("change",{bubbles:!0}))}),this.updateButtonTextsForRow(o);let a=o.querySelector(".group-select");t.groupValue&&t.groupValue!=="no-group"&&t.groupValue.startsWith("group-")&&(t.createdGroupId?a.dataset.createdGroupId=t.createdGroupId:a.dataset.createdGroupId=t.groupValue,a.value="new-group",a.dispatchEvent(new Event("change",{bubbles:!0})))}),this.lastResetData.players.forEach((t,r)=>{let s=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[r].querySelector(".group-select");t.groupValue&&t.groupValue!=="no-group"&&t.groupValue.startsWith("group-")&&(s.value=t.groupValue,s.dispatchEvent(new Event("change",{bubbles:!0})))}),this.currentPods=[...this.lastResetData.currentPods],this.currentUnassigned=[...this.lastResetData.currentUnassigned],(this.currentPods.length>0||this.currentUnassigned.length>0)&&this.renderPods(this.currentPods,this.currentUnassigned),this.playerManager.handleGroupChange(this.playerRowsContainer),this.isRestoring=!1;let e=document.getElementById("undo-reset-btn");e&&e.remove(),this.lastResetData=null,this.showSuccessMessage("Reset has been undone successfully!")}resetAll(){this.closeAllDropdowns(),this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.updateResultsCardVisibility(),this.displayModeBtn.style.display="none",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds(),this.currentPods=[],this.currentUnassigned=[];let e=document.getElementById("no-leniency-radio");e.checked=!0;for(let t=0;t<4;t++)this.addPlayerRow()}clearDuplicateErrorsOnInput(){let e=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"));C.clearDuplicateErrors(e),C.highlightDuplicateNames(e)}initializeRankingModeToggle(){let e=document.getElementById("power-level-radio"),t=document.getElementById("bracket-radio"),r=()=>{let n=t.checked;if(n){document.body.classList.add("bracket-mode");let s=document.getElementById("no-leniency-radio");s&&(s.checked=!0)}else document.body.classList.remove("bracket-mode");this.playerRowsContainer.querySelectorAll(".player-row").forEach(s=>{let a=s.querySelector(".power-levels"),i=s.querySelector(".bracket-levels");n?(a.style.display="none",i.style.display="block"):(a.style.display="block",i.style.display="none"),this.isRestoring||this.clearAllSelections(s)})};e.addEventListener("change",r),t.addEventListener("change",r),r()}clearAllSelections(e){e.querySelectorAll('.power-checkbox input[type="checkbox"]').forEach(n=>n.checked=!1),e.querySelectorAll('.bracket-checkbox input[type="checkbox"]').forEach(n=>n.checked=!1),R.updatePowerButton(e),R.updateBracketButton(e)}initializeHelpModal(){let e=document.getElementById("help-modal"),t=e.querySelector(".help-close"),r=document.getElementById("start-tour-btn");t.addEventListener("click",()=>this.hideHelpModal()),e.addEventListener("click",n=>{n.target===e&&this.hideHelpModal()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&e.style.display==="block"&&this.hideHelpModal()}),r&&r.addEventListener("click",()=>{this.hideHelpModal(),this.startInteractiveTour().catch(console.error)})}showHelpModal(){let e=document.getElementById("help-modal");e.style.display="block",document.body.style.overflow="hidden"}toggleSidebar(e){let t=B(D("settings-sidebar",N),"settings-sidebar is required");e?t.classList.add("open"):t.classList.remove("open")}getDisplayModeManager(){return this.displayModeManager||(this.displayModeManager=new re),this.displayModeManager}getTourManager(){return this.tourManager||(this.tourManager=new ne),this.tourManager}async startInteractiveTour(){await this.getTourManager().startTour()}hideHelpModal(){let e=document.getElementById("help-modal");e.style.display="none",document.body.style.overflow=""}calculateValidBracketRange(e){let t=e.players.flatMap(s=>"players"in s?s.players:[s]);if(t.length===0)return"Unknown";let r=[],n=new Set;t.forEach(s=>{s.brackets&&s.brackets.forEach(a=>n.add(a))});for(let s of n)t.every(i=>i.brackets&&i.brackets.includes(s))&&r.push(s);let o=["1","2","3","4","cedh"];if(r.sort((s,a)=>o.indexOf(s)-o.indexOf(a)),r.length===0)return"Unknown";if(r.length===1)return r[0];{let s=r.filter(i=>i!=="cedh");return s.length>1&&s.every((i,l)=>{if(l===0)return!0;let d=parseInt(i),p=parseInt(s[l-1]);return d===p+1})&&s.length===r.length&&r.length>1?`${r[0]}-${r[r.length-1]}`:r.join(", ")}}triggerValidationForAllFields(){let e=oe.batchValidateRows(this.playerRowsContainer);Q.trackValidationTime(e.validationTime),e.validationTime>100&&console.warn(`Slow validation detected: ${e.validationTime.toFixed(2)}ms`)}updateButtonTextsForRow(e){R.updateAllButtonsForRow(e)}updatePlayerNumbers(){this.playerRowsContainer.querySelectorAll(".player-row").forEach((t,r)=>{let n=t.querySelector(".player-number");n&&(n.textContent=(r+1).toString())})}updateResultsCardVisibility(){this.outputSection.children.length>0&&this.outputSection.innerHTML.trim()!==""?(this.resultsCard.style.display="block",this.resultsCard.classList.add("has-content")):(this.resultsCard.style.display="none",this.resultsCard.classList.remove("has-content"))}};function Se(){let t=Math.floor(Math.random()*360),r=25,n=[];for(let a=0;a<50;a++){let l=(t+a*137.5)%360;n.push(Math.round(l))}let o="";for(let a=1;a<=50;a++){let i=n[a-1],l=70+Math.floor(Math.random()*20),d=50,p=28+Math.floor(Math.random()*8);o+=`
.player-row .group-select.group-${a} {
    border-color: hsl(${i}, ${l}%, ${d}%) !important;
    background-color: hsl(${i}, ${l}%, ${p}%) !important;
}`,o+=`
.group-select option[value="group-${a}"] {
    background-color: hsl(${i}, ${l}%, ${p}%);
}`}let s=A.get("style");s.id="dynamic-group-colors",s.textContent=o,document.head.appendChild(s)}document.addEventListener("DOMContentLoaded",()=>{Se(),H.clearAllToasts(),new se().resetAll()});})();
