"use strict";(()=>{function G(h){if(h<3)return[];if(h===3)return[3];if(h===4)return[4];if(h===5)return[5];if(h===6)return[3,3];if(h===7)return[4,3];if(h===8)return[4,4];if(h===9)return[3,3,3];if(h===10)return[5,5];let r=Math.floor(h/4),e=h%4;return e===0?Array(r).fill(4):e===1?r>=2?[...Array(r-2).fill(4),5,4]:[3,3,3,2]:e===2?r>=1?[...Array(r-1).fill(4),3,3]:[3,3,3,3]:e===3?[...Array(r).fill(4),3]:[]}function W(h){if(h<3)return[];if(h<9)return G(h);if(h===9)return[3,3,3];if(h===10)return[4,3,3];if(h===11)return[4,4,3];if(h===12)return[4,4,4];if(h===13)return[4,3,3,3];if(h===14)return[4,4,3,3];if(h===15)return[4,4,4,3];let r=[],e=h;for(;e>=7;)r.push(4),e-=4;if(e===6)r.push(3,3);else if(e===5)if(r.length>0)r.pop(),e+=4,r.push(3,3,3);else return G(h);else e===4?r.push(4):e===3&&r.push(3);return r.sort((a,o)=>o-a)}function j(){let h=document.getElementById("avoid-five-pods-radio");return h&&h.checked?"avoid-five":"balanced"}function K(){let h=document.getElementById("bracket-radio");if(h&&h.checked)return{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0};let r=document.getElementById("no-leniency-radio"),e=document.getElementById("leniency-radio");return document.getElementById("super-leniency-radio").checked?{allowLeniency:!0,allowSuperLeniency:!0,maxTolerance:1}:e.checked?{allowLeniency:!0,allowSuperLeniency:!1,maxTolerance:.5}:{allowLeniency:!1,allowSuperLeniency:!1,maxTolerance:0}}function _(h){let r=[];if(h.forEach(o=>{if(o.checked){let n=parseFloat(o.value);isNaN(n)||r.push(n)}}),r.length===0)return{availablePowers:[],powerRange:"",averagePower:0};r.sort((o,n)=>o-n);let e;r.length===1?e=r[0].toString():e=r.join(", ");let a=r.reduce((o,n)=>o+n,0)/r.length;return{availablePowers:r,powerRange:e,averagePower:Math.round(a*2)/2}}function Q(){let h=document.querySelector("#leniency-radio");return document.querySelector("#super-leniency-radio")?.checked?1:h?.checked?.5:0}function N(h){let r=h.players.flatMap(n=>"players"in n?n.players:[n]);if(r.length===0)return h.power.toString();let e=Q(),a=[],o=new Set;r.forEach(n=>{n.availablePowers.forEach(t=>o.add(t))});for(let n of o)r.every(s=>s.availablePowers.some(l=>Math.abs(n-l)<=e))&&a.push(n);return a.sort((n,t)=>n-t),a.length===0?h.power.toString():a.length===1?a[0].toString():a.every((t,s)=>s===0||t-a[s-1]<=.5)&&a.length>2?`${a[0]}-${a[a.length-1]}`:a.join(", ")}function q(h,r){let e=[];if(Array.isArray(h.availablePowers))e=h.availablePowers;else if(typeof h.powerRange=="string")if(h.powerRange.includes("-")){let[o,n]=h.powerRange.split("-").map(t=>parseFloat(t.trim()));for(let t=o;t<=n;t+=.5)e.push(t)}else e=h.powerRange.split(",").map(o=>parseFloat(o.trim()));return e.map(o=>r.includes(o)?`<span class="power-highlight">${o}</span>`:o.toString()).join(", ")}function Y(h,r){let e=[];if(Array.isArray(h.availableBrackets))e=h.availableBrackets;else if(typeof h.bracketRange=="string")if(h.bracketRange.includes("-")){let[o,n]=h.bracketRange.split("-").map(l=>l.trim()),t=parseInt(o),s=parseInt(n);if(!isNaN(t)&&!isNaN(s))for(let l=t;l<=s;l++)e.push(l.toString());else e=[o,n]}else e=h.bracketRange.split(",").map(o=>o.trim());return e.map(o=>r.includes(o)?`<span class="bracket-highlight">${o}</span>`:o.toString()).join(", ")}function $(h){let r=h.players.flatMap(t=>"players"in t?t.players:[t]);if(r.length===0)return[];let e=new Map,a=new Set;if(r.forEach(t=>{t.availablePowers.length===1&&a.add(t.availablePowers[0]),t.availablePowers.forEach(s=>{e.set(s,(e.get(s)||0)+1)})}),e.size===0)return[];let o=Math.max(...e.values()),n=[];for(let[t,s]of e.entries())(s===o||a.has(t))&&n.push(t);return n.sort((t,s)=>t-s),n}var F=class{constructor(){this.groups=new Map;this.nextPlayerId=0;this.nextGroupId=1;this.availableColors=[];this.groupColorAssignments=new Map;this.initializeAvailableColors()}initializeAvailableColors(){this.availableColors=Array.from({length:50},(r,e)=>e+1),this.shuffleArray(this.availableColors)}shuffleArray(r){for(let e=r.length-1;e>0;e--){let a=Math.floor(Math.random()*(e+1));[r[e],r[a]]=[r[a],r[e]]}}assignRandomColor(r){if(this.groupColorAssignments.has(r))return this.groupColorAssignments.get(r);this.availableColors.length===0&&this.initializeAvailableColors();let e=this.availableColors.pop();return this.groupColorAssignments.set(r,e),e}releaseColor(r){let e=this.groupColorAssignments.get(r);e&&(this.availableColors.push(e),this.groupColorAssignments.delete(r))}getNextPlayerId(){return this.nextPlayerId++}resetPlayerIds(){this.nextPlayerId=0}getNextGroupId(){let r=new Set;document.querySelectorAll(".group-select").forEach(a=>{if(a.value.startsWith("group-")){let o=parseInt(a.value.split("-")[1]);isNaN(o)||r.add(o)}if(a.value==="new-group"&&a.dataset.createdGroupId&&a.dataset.createdGroupId.startsWith("group-")){let o=parseInt(a.dataset.createdGroupId.split("-")[1]);isNaN(o)||r.add(o)}});for(let a=1;a<=50;a++)if(!r.has(a))return a;return this.nextGroupId++}resetGroupIds(){this.nextGroupId=1}getGroups(){return this.groups}clearGroups(){this.groups.clear()}getPlayerFromRow(r){let e=r.querySelector(".player-name");e.classList.remove("input-error");let a=e.value.trim();if(!a)return e.classList.add("input-error"),null;if(document.getElementById("bracket-radio").checked){let t=r.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),s=[];if(t.forEach(c=>{c.checked&&s.push(c.value)}),s.length===0)return r.querySelector(".bracket-selector-btn").classList.add("error"),null;r.querySelector(".bracket-selector-btn").classList.remove("error");let l={1:1,2:2,3:3,4:4,cedh:10},i=s.map(c=>l[c]),m=i.reduce((c,u)=>c+u,0)/i.length;return{id:parseInt(r.dataset.playerId),name:a,power:Math.round(m*2)/2,availablePowers:i,powerRange:s.join(", "),brackets:s,bracketRange:s.join(", "),rowElement:r}}else{let t=r.querySelectorAll('.power-checkbox input[type="checkbox"]'),s=_(t);return s.availablePowers.length===0?(r.querySelector(".power-selector-btn").classList.add("error"),null):(r.querySelector(".power-selector-btn").classList.remove("error"),{id:parseInt(r.dataset.playerId),name:a,power:s.averagePower,availablePowers:s.availablePowers,powerRange:s.powerRange,rowElement:r})}}handleGroupChange(r){this.groups.clear();let e=Array.from(r.querySelectorAll(".player-row"));e.forEach(o=>{for(let n=1;n<=50;n++)o.querySelector(".group-select").classList.remove(`group-${n}`)});let a=new Set;e.forEach(o=>{let n=o.querySelector(".group-select");n.dataset.createdGroupId?a.add(n.dataset.createdGroupId):n.value.startsWith("group-")&&a.add(n.value)}),e.forEach(o=>{let n=o.querySelector(".group-select"),t="";if(n.value==="new-group"){n.dataset.createdGroupId?t=n.dataset.createdGroupId:(t=`group-${this.getNextGroupId()}`,a.add(t),n.dataset.createdGroupId=t);let s=this.getPlayerFromRow(o);s&&(this.groups.has(t)||this.groups.set(t,[]),this.groups.get(t).push(s))}else if(n.value.startsWith("group-")){t=n.value;let s=this.getPlayerFromRow(o);s&&(this.groups.has(n.value)||this.groups.set(n.value,[]),this.groups.get(n.value).push(s))}else n.dataset.createdGroupId&&delete n.dataset.createdGroupId;if(t){let s=parseInt(t.split("-")[1]);s>=1&&s<=50&&n.classList.add(`group-${s}`)}}),this.cleanupUnusedGroups(a),this.updateAllGroupDropdowns(r)}updateAllGroupDropdowns(r){let e=new Set,a=Array.from(r.querySelectorAll(".player-row"));a.forEach(o=>{let n=o.querySelector(".group-select");n.value==="new-group"&&n.dataset.createdGroupId?e.add(n.dataset.createdGroupId):n.value.startsWith("group-")&&e.add(n.value)}),a.forEach(o=>{let n=o.querySelector(".group-select"),t=n.value,s=n.dataset.createdGroupId;if(Array.from(n.options).forEach(i=>{i.value.startsWith("group-")&&n.remove(i.index)}),e.forEach(i=>{let m=i.split("-")[1],c=new Option(`Group ${m}`,i);n.add(c)}),s&&e.has(s)&&(t==="new-group"||t==="no-group")){n.value=s;let i=parseInt(s.split("-")[1]);i>=1&&i<=50&&n.classList.add(`group-${i}`)}else if(t.startsWith("group-")&&e.has(t)){n.value=t;let i=parseInt(t.split("-")[1]);i>=1&&i<=50&&n.classList.add(`group-${i}`)}else{n.value="no-group";for(let i=1;i<=50;i++)n.classList.remove(`group-${i}`)}})}arePlayersCompatible(r,e,a){return r.availablePowers.some(n=>e.availablePowers.some(t=>Math.abs(n-t)<.01))?!0:a.allowLeniency?r.availablePowers.some(n=>e.availablePowers.some(t=>Math.abs(n-t)<=a.maxTolerance)):!1}findAllCommonPowers(r,e){return r.length===0?[]:[...new Set(r.flatMap(o=>o.availablePowers))].sort((o,n)=>o-n).filter(o=>r.every(n=>n.availablePowers.some(t=>{let s=Math.abs(t-o);return s<.01||e.allowLeniency&&s<=e.maxTolerance})))}findBestCommonPowerLevel(r){if(r.length===0)return null;let e=new Map;for(let n of r)for(let t of n.availablePowers)e.set(t,(e.get(t)||0)+1);if(e.size===0)return null;let a=r[0].availablePowers[0],o=0;for(let[n,t]of e.entries())t>o&&(o=t,a=n);return a}calculatePodPower(r){if(r.length===0)return 0;let e=r.reduce((a,o)=>{if("players"in o)return a+o.averagePower;{let n=o.powerRange.split(",").map(s=>parseFloat(s.trim())),t=n.reduce((s,l)=>s+l,0)/n.length;return a+t}},0);return Math.round(e/r.length*10)/10}cleanupUnusedGroups(r){Array.from(this.groupColorAssignments.keys()).forEach(n=>{r.has(n)||this.releaseColor(n)}),Array.from(this.groups.keys()).forEach(n=>{r.has(n)||this.groups.delete(n)}),document.querySelectorAll(".group-select").forEach(n=>{let t=n.dataset.createdGroupId;t&&!r.has(t)&&delete n.dataset.createdGroupId})}};var z=class{constructor(){this.shuffleSeed=null}setShuffleSeed(r){this.shuffleSeed=r}seededRandom(r){let e=r;return()=>(e=e*1103515245+12345&2147483647,e/2147483647)}shuffleArray(r){let e=[...r],a;this.shuffleSeed!==null?a=this.seededRandom(this.shuffleSeed):a=Math.random;for(let o=e.length-1;o>0;o--){let n=Math.floor(a()*(o+1));[e[o],e[n]]=[e[n],e[o]]}return e}generatePodsWithBacktracking(r,e,a){let o=this.shuffleArray(r),n=o.reduce((i,m)=>i+("size"in m?m.size:1),0);if(n>=3&&n<=5){let i=o.flatMap(c=>"players"in c?c.players:[c]),m=this.findBestCommonPowerLevel(i);return m!==null?{pods:[{players:o,power:m}],unassigned:[]}:{pods:[],unassigned:o}}let t=this.findOptimalPodAssignment(o,e,a),s=new Set;for(let i of t)for(let m of i.players)"players"in m?s.add(m.id):s.add(m.id.toString());let l=o.filter(i=>"players"in i?!s.has(i.id):!s.has(i.id.toString()));return{pods:t,unassigned:l}}findOptimalPodAssignment(r,e,a){return this.optimizeVirtualPlayerAssignmentUnified(r,e,a)}optimizeVirtualPlayerAssignmentUnified(r,e,a){if(r.length===0)return[];let o=this.createVirtualPlayersUnified(r),n=new Map;for(let s of o)n.has(s.powerLevel)||n.set(s.powerLevel,[]),n.get(s.powerLevel).push(s);let t={pods:[],totalPods:0};return a.allowLeniency?this.backtrackVirtualPlayersWithLeniencyUnified(o,e,a.maxTolerance,[],new Set,e,t):this.backtrackVirtualPlayersUnified(Array.from(n.entries()),[],new Set,e,t),t.pods}createVirtualPlayersUnified(r){let e=[];for(let a of r)if("players"in a){let o=a.players.flatMap(m=>m.availablePowers),n=Math.min(...o),t=Math.max(...o),l=[a.averagePower,n,t],i=[...new Set(l)];for(let m of i)e.push({item:a,powerLevel:m})}else for(let o of a.availablePowers)e.push({item:a,powerLevel:o});return e}backtrackVirtualPlayersUnified(r,e,a,o,n){if(o.length===0){e.length>n.totalPods&&(n.pods=[...e],n.totalPods=e.length);return}if(e.length+o.length<=n.totalPods)return;let t=o[0],s=o.slice(1);for(let[l,i]of r){let m=i.filter(u=>{let g="players"in u.item?u.item.id:u.item.id.toString();return!a.has(g)});if(m.reduce((u,g)=>u+("players"in g.item?g.item.size:1),0)>=Math.max(3,t)){let u=m.sort((w,k)=>{let f="players"in w.item?w.item.size:1;return("players"in k.item?k.item.size:1)-f}),g=[],L=new Set,y=0;for(let w of u){let k="players"in w.item?w.item.id:w.item.id.toString(),f="players"in w.item?w.item.size:1;if(!L.has(k)&&y+f<=t&&(g.push(w),L.add(k),y+=f,y===t))break}if(y>=3){let w=g.map(d=>d.item),k={players:w,power:l},f=new Set(a);for(let d of w){let M="players"in d?d.id:d.id.toString();f.add(M)}this.backtrackVirtualPlayersUnified(r,[...e,k],f,s,n)}}}this.backtrackVirtualPlayersUnified(r,e,a,s,n)}backtrackVirtualPlayersWithLeniencyUnified(r,e,a,o,n,t,s){if(t.length===0){o.length>s.totalPods&&(s.pods=[...o],s.totalPods=o.length);return}if(o.length+t.length<=s.totalPods)return;let l=t[0],i=t.slice(1),m=r.filter(u=>{let g="players"in u.item?u.item.id:u.item.id.toString();return!n.has(g)}),c=[...new Set(m.map(u=>u.powerLevel))].sort((u,g)=>u-g);for(let u of c){let g=m.filter(f=>("players"in f.item,Math.abs(f.powerLevel-u)<=a)),L=new Map;for(let f of g){let d="players"in f.item?f.item.id:f.item.id.toString();if(!L.has(d))L.set(d,f);else{let M=L.get(d),E=Math.abs(M.powerLevel-u);Math.abs(f.powerLevel-u)<E&&L.set(d,f)}}let w=Array.from(L.values()).sort((f,d)=>{if("players"in f.item&&"players"in d.item){let M=Math.abs(f.powerLevel-f.item.averagePower)<.01,E=Math.abs(d.powerLevel-d.item.averagePower)<.01;return M&&!E?-1:!M&&E?1:Math.abs(f.powerLevel-u)-Math.abs(d.powerLevel-u)}return"players"in f.item&&!("players"in d.item)?1:!("players"in f.item)&&"players"in d.item?-1:Math.abs(f.powerLevel-u)-Math.abs(d.powerLevel-u)});if(w.reduce((f,d)=>f+("players"in d.item?d.item.size:1),0)>=Math.max(3,l)){let f=w.sort((B,P)=>{let T="players"in B.item?B.item.size:1;return("players"in P.item?P.item.size:1)-T}),d=[],M=new Set,E=0;for(let B of f){let P="players"in B.item?B.item.id:B.item.id.toString(),T="players"in B.item?B.item.size:1;if(!M.has(P)&&E+T<=l&&(d.push(B),M.add(P),E+=T,E===l))break}if(E>=3){let B=d.map(x=>x.item);if(!this.isPodPowerSpreadValid(d,a))continue;let P=d.reduce((x,p)=>x+p.powerLevel,0)/d.length,T={players:B,power:Math.round(P*2)/2},S=new Set(n);for(let x of B){let p="players"in x?x.id:x.id.toString();S.add(p),r.forEach(v=>{let b="players"in v.item?v.item.id:v.item.id.toString();b===p&&S.add(b)})}this.backtrackVirtualPlayersWithLeniencyUnified(r,e,a,[...o,T],S,i,s)}}}this.backtrackVirtualPlayersWithLeniencyUnified(r,e,a,o,n,i,s)}isPodPowerSpreadValid(r,e){if(r.length===0)return!0;let a=r.map(s=>s.powerLevel),o=Math.min(...a);return Math.max(...a)-o<=e}findBestCommonPowerLevel(r){if(r.length===0)return null;let e=new Map;for(let n of r)for(let t of n.availablePowers)e.set(t,(e.get(t)||0)+1);if(e.size===0)return null;let a=r[0].availablePowers[0],o=0;for(let[n,t]of e.entries())t>o&&(o=t,a=n);return a}};var V=class{constructor(r,e){this.draggedElement=null;this.draggedItemData=null;this.currentPods=[];this.currentUnassigned=[];this.handleDragStart=r=>{let e=r.target;this.draggedElement=e,e.classList.add("dragging"),this.draggedItemData={type:e.dataset.itemType,id:e.dataset.itemId,podIndex:e.dataset.podIndex,itemIndex:e.dataset.itemIndex},r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("text/html",e.outerHTML)};this.handleDragEnd=r=>{r.target.classList.remove("dragging"),this.draggedElement=null,this.draggedItemData=null};this.handleDragOver=r=>{r.preventDefault(),r.dataTransfer.dropEffect="move",r.currentTarget.classList.add("drag-over")};this.handleDragLeave=r=>{r.currentTarget.classList.remove("drag-over")};this.handleDrop=r=>{r.preventDefault();let e=r.currentTarget;if(e.classList.remove("drag-over"),!this.draggedItemData)return;let a=e.dataset.podIndex,o=this.draggedItemData.podIndex;a!==o&&this.moveItemBetweenPods(this.draggedItemData,a)};this.playerManager=r,this.onPodsChanged=e}setCurrentPods(r,e=[]){this.currentPods=[...r],this.currentUnassigned=[...e]}moveItemBetweenPods(r,e){let a=r.podIndex,o=parseInt(r.itemIndex),n=null;if(a==="unassigned")n=this.currentUnassigned[o],this.currentUnassigned.splice(o,1);else{let t=this.currentPods[parseInt(a)];n=t.players[o],t.players.splice(o,1),t.power=this.playerManager.calculatePodPower(t.players)}if(n){if(e==="unassigned")this.currentUnassigned.push(n);else if(e==="new-pod"){let t={players:[n],power:this.playerManager.calculatePodPower([n])};this.currentPods.push(t)}else{let t=this.currentPods[parseInt(e)];t.players.push(n),t.power=this.playerManager.calculatePodPower(t.players)}this.cleanupEmptyPods(),this.onPodsChanged(this.currentPods,this.currentUnassigned)}}cleanupEmptyPods(){this.currentPods=this.currentPods.filter(r=>r.players.length>0)}};var O=class{constructor(){this.isDisplayMode=!1;this.handleKeyDown=null;this.borderColors=["#FF6B6B","#4ECDC4","#45B7D1","#FFA726","#66BB6A","#AB47BC","#EF5350","#26A69A","#42A5F5","#FF7043","#9CCC65","#7E57C2","#EC407A","#29B6F6","#FFCA28","#8BC34A","#673AB7","#F06292","#00BCD4","#FFEB3B","#795548","#607D8B","#E91E63","#009688","#FF9800"]}getShuffledColors(r){let e=[...this.borderColors];for(let a=e.length-1;a>0;a--){let o=Math.floor(Math.random()*(a+1));[e[a],e[o]]=[e[o],e[a]]}if(r>e.length){let a=[];for(let o=0;o<r;o++)a.push(e[o%e.length]);return a}return e.slice(0,r)}calculateOptimalWidthForText(r){let e=0;for(let n of r)n===" "?e+=.3:/[iIl1]/.test(n)?e+=.4:/[mwMW]/.test(n)?e+=.8:/[A-Z]/.test(n)?e+=.7:e+=.6;let a=e*1.2,o=Math.min(85,Math.max(25,a/25*85));return Math.round(o)}calculateFontSizeForPod(r,e,a){let o=r*e,n=Math.ceil(Math.sqrt(a)),t=Math.ceil(a/n),s=(r-(n-1)*10)/n,l=(e-(t-1)*10)/t,i=Math.min(s,l),m=Math.min(i*.25,l*.35),c=Math.max(.9,1-(a-3)*.02),u=Math.max(24,Math.min(72,m*c));return`${Math.round(u)}px`}calculateValidBracketRange(r){let e=r.players.flatMap(t=>"players"in t?t.players:[t]);if(e.length===0)return"Unknown";let a=[],o=new Set;e.forEach(t=>{t.brackets&&t.brackets.forEach(s=>o.add(s))});for(let t of o)e.every(l=>l.brackets&&l.brackets.includes(t))&&a.push(t);let n=["1","2","3","4","cedh"];if(a.sort((t,s)=>n.indexOf(t)-n.indexOf(s)),a.length===0)return"Unknown";if(a.length===1)return a[0];{let t=a.filter(l=>l!=="cedh");return t.length>1&&t.every((l,i)=>{if(i===0)return!0;let m=parseInt(l),c=parseInt(t[i-1]);return m===c+1})&&t.length===a.length&&a.length>1?`${a[0]}-${a[a.length-1]}`:a.join(", ")}}getValidBracketsArrayForPod(r){let e=r.players.flatMap(s=>"players"in s?s.players:[s]);if(e.length===0)return[];let a=new Map;if(e.forEach(s=>{s.brackets&&s.brackets.forEach(l=>{a.set(l,(a.get(l)||0)+1)})}),a.size===0)return[];let o=Math.ceil(e.length/2),n=[];for(let[s,l]of a.entries())l>=o&&n.push(s);let t=["1","2","3","4","cedh"];return n.sort((s,l)=>t.indexOf(s)-t.indexOf(l)),n}enterDisplayMode(r){if(r.length===0)return;this.isDisplayMode=!0,document.body.classList.add("display-mode");let e=Math.ceil(Math.sqrt(r.length)),a=document.createElement("div");a.className="display-mode-container",a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.width="100vw",a.style.height="100vh",a.style.background="#1a1a1a",a.style.zIndex="1000",a.style.padding="20px",a.style.boxSizing="border-box",a.style.overflow="hidden",a.innerHTML=`
            <div class="display-mode-controls">
                <button id="exit-display-btn">Exit Display Mode</button>
            </div>
            <h1 style="text-align: center; margin: 0 0 20px 0; font-size: 2.5rem; color: white;">MTG Commander Pods</h1>
            <div id="display-output" style="flex-grow: 1; height: calc(100vh - 140px);"></div>
        `;let o=document.querySelector(".container");o&&(o.style.display="none"),document.body.appendChild(a);let n=a.querySelector("#display-output"),t=document.createElement("div");t.style.display="grid",t.style.gap="20px",t.style.height="100%",t.style.gridTemplateColumns=`repeat(${e}, 1fr)`,t.style.gridTemplateRows=`repeat(${e}, 1fr)`;let s=this.getShuffledColors(r.length);r.forEach((i,m)=>{let c=document.createElement("div");c.style.display="flex",c.style.flexDirection="column",c.style.background="#2a2a2a",c.style.border=`3px solid ${s[m]}`,c.style.borderRadius="8px",c.style.padding="15px",c.style.boxSizing="border-box",c.style.minHeight="0",c.style.boxShadow=`0 0 10px ${s[m]}40`,c.classList.add("pod",`pod-color-${m%10}`);let u=document.createElement("h3"),g=document.getElementById("bracket-radio"),L=g&&g.checked;if(L){let P=this.calculateValidBracketRange(i);u.textContent=`Pod ${m+1} (Bracket: ${P})`}else{let P=N(i);u.textContent=`Pod ${m+1} (Power: ${P})`}u.style.fontSize="1.6rem",u.style.margin="0 0 15px 0",u.style.textAlign="center",u.style.color=s[m],u.style.fontWeight="bold",u.style.flexShrink="0",u.style.textShadow="1px 1px 2px rgba(0,0,0,0.8)",c.appendChild(u);let y=0;i.players.forEach(P=>{"players"in P?y+=P.players.length:y+=1});let w="";i.players.forEach(P=>{if("players"in P)P.players.forEach(T=>{let S=L&&T.bracketRange?`${T.name} (B: ${T.bracketRange})`:`${T.name} (P: ${T.powerRange})`;S.length>w.length&&(w=S)});else{let T=L&&P.bracketRange?`${P.name} (B: ${P.bracketRange})`:`${P.name} (P: ${P.powerRange})`;T.length>w.length&&(w=T)}});let k=document.createElement("ul");k.style.flexGrow="1",k.style.display="flex";let f=Math.ceil(Math.sqrt(y)),d=Math.ceil(y/f);k.style.display="grid",k.style.gridTemplateColumns=`repeat(${f}, 1fr)`,k.style.gridTemplateRows=`repeat(${d}, 1fr)`,k.style.gap="12px",k.style.margin="0",k.style.padding="0",k.style.listStyle="none",k.style.width="100%",k.style.height="100%",k.style.alignItems="stretch",k.style.justifyItems="stretch";let M=[];i.players.forEach(P=>{"players"in P?P.players.forEach(T=>M.push(T)):M.push(P)});let E=document.getElementById("bracket-radio"),B=E&&E.checked;M.forEach((P,T)=>{let S=document.createElement("li"),x=document.createElement("div");x.textContent=P.name,x.className="player-name";let p=document.createElement("div");if(B&&P.bracketRange){let v=this.getValidBracketsArrayForPod(i),b=Y(P,v);p.innerHTML=`B: ${b}`}else{let v=$(i),b=q(P,v);p.innerHTML=`P: ${b}`}p.className="player-power",S.appendChild(x),S.appendChild(p),S.style.display="flex",S.style.flexDirection="column",S.style.justifyContent="center",S.style.alignItems="center",S.style.backgroundColor="rgba(255, 255, 255, 0.12)",S.style.border="2px solid rgba(255, 255, 255, 0.2)",S.style.borderRadius="12px",S.style.padding="8px",S.style.boxSizing="border-box",S.style.textAlign="center",S.style.height="100%",x.style.color="#ffffff",x.style.fontWeight="bold",x.style.lineHeight="1.1",x.style.marginBottom="4px",x.style.wordBreak="break-word",x.style.hyphens="auto",x.style.flexGrow="1",x.style.display="flex",x.style.alignItems="center",x.style.justifyContent="center",p.style.color="#b0b0b0",p.style.fontWeight="500",p.style.lineHeight="1",p.style.opacity="0.9",S.dataset.podRef=m.toString(),S.classList.add("dynamic-font-item"),k.appendChild(S)}),c.appendChild(k),t.appendChild(c)}),n.appendChild(t),requestAnimationFrame(()=>{t.querySelectorAll(".pod").forEach((m,c)=>{let u=m.getBoundingClientRect(),g=u.width,L=u.height,y=0;r[c].players.forEach(f=>{"players"in f?y+=f.players.length:y+=1});let w=this.calculateFontSizeForPod(g,L,y);m.querySelectorAll(".dynamic-font-item").forEach(f=>{let d=f.querySelector(".player-name"),M=f.querySelector(".player-power");if(d&&(d.style.fontSize=w),M){let E=Math.round(parseInt(w)*.75);M.style.fontSize=`${E}px`}})})}),a.querySelector("#exit-display-btn").addEventListener("click",()=>this.exitDisplayMode()),this.handleKeyDown=i=>{i.key==="Escape"&&this.isDisplayMode&&this.exitDisplayMode()},document.addEventListener("keydown",this.handleKeyDown)}exitDisplayMode(){this.isDisplayMode=!1,document.body.classList.remove("display-mode");let r=document.querySelector(".container");r&&(r.style.display="");let e=document.querySelector(".display-mode-container");e&&e.remove(),this.handleKeyDown&&(document.removeEventListener("keydown",this.handleKeyDown),this.handleKeyDown=null)}getIsDisplayMode(){return this.isDisplayMode}};var U=class{constructor(){this.currentPods=[];this.currentUnassigned=[];this.lastResetData=null;this.isRestoring=!1;this.displayModeBtnBottom=null;this.playerRowsContainer=document.getElementById("player-rows"),this.outputSection=document.getElementById("output-section"),this.displayModeBtn=document.getElementById("display-mode-btn"),this.playerRowTemplate=document.getElementById("player-row-template"),this.playerManager=new F,this.podGenerator=new z,this.dragDropManager=new V(this.playerManager,(r,e)=>this.renderPods(r,e)),this.displayModeManager=new O,this.initializeEventListeners(),this.initializeRankingModeToggle()}initializeEventListeners(){let r=document.getElementById("add-player-btn"),e=document.getElementById("bulk-add-btn"),a=document.getElementById("generate-pods-btn"),o=document.getElementById("reset-all-btn"),n=document.getElementById("help-btn");r.addEventListener("click",()=>this.addPlayerRow()),e.addEventListener("click",()=>this.bulkAddPlayers(4)),a.addEventListener("click",()=>this.generatePods()),o.addEventListener("click",()=>this.resetAllWithConfirmation()),this.displayModeBtn.addEventListener("click",()=>this.displayModeManager.enterDisplayMode(this.currentPods)),n.addEventListener("click",()=>this.showHelpModal()),this.initializeHelpModal(),this.initializeKeyboardShortcuts()}addPlayerRow(){let e=this.playerRowTemplate.content.cloneNode(!0).querySelector(".player-row"),a=this.playerManager.getNextPlayerId();e.dataset.playerId=a.toString();let o=e.querySelector(".power-selector-btn"),n=e.querySelector(".power-selector-dropdown"),t=e.querySelectorAll(".range-btn"),s=()=>{let p=e.querySelectorAll('.power-checkbox input[type="checkbox"]'),v=[];if(p.forEach(b=>{b.checked&&v.push(parseFloat(b.value))}),v.length===0)o.textContent="Select Power Levels",o.classList.remove("has-selection"),o.dataset.validationTriggered==="true"&&o.classList.add("error");else{o.classList.remove("error"),v.sort((C,I)=>C-I);let b;if(v.length===1)b=`Power: ${v[0]}`;else{let C=v[0],I=v[v.length-1];v.every((D,H)=>{if(H===0)return!0;let A=D-v[H-1];return A===.5||A===1})&&v.length>2?b=`Power: ${C}-${I}`:v.length<=4?b=`Power: ${v.join(", ")}`:b=`Power: ${C}-${I} (${v.length} levels)`}o.textContent=b,o.classList.add("has-selection")}};o.addEventListener("click",p=>{p.preventDefault();let v=n.style.display!=="none";document.querySelectorAll(".power-selector-dropdown").forEach(b=>{b.style.display="none",b.classList.remove("show")}),document.querySelectorAll(".power-selector-btn").forEach(b=>{b.classList.remove("open")}),v||(n.style.display="block",o.classList.add("open"),setTimeout(()=>n.classList.add("show"),10))}),document.addEventListener("click",p=>{!o.contains(p.target)&&!n.contains(p.target)&&(n.classList.remove("show"),o.classList.remove("open"),setTimeout(()=>{n.classList.contains("show")||(n.style.display="none")},200))});let l=e.querySelectorAll('.power-checkbox input[type="checkbox"]');l.forEach(p=>{p.addEventListener("change",s)}),t.forEach(p=>{p.addEventListener("click",()=>{let v=p.dataset.range;l.forEach(I=>I.checked=!1);let[b,C]=v.split("-").map(Number);l.forEach(I=>{let R=parseFloat(I.value);(R===b||R===C)&&(I.checked=!0)}),s()})}),e.querySelector(".clear-btn").addEventListener("click",()=>{l.forEach(p=>p.checked=!1),s()});let m=()=>{n.classList.remove("show"),o.classList.remove("open"),setTimeout(()=>{n.classList.contains("show")||(n.style.display="none")},200)},c="",u=null;document.addEventListener("keydown",p=>{let v=n.style.display==="block"&&n.classList.contains("show"),b=document.activeElement===o;(v||b)&&(p.key==="Escape"?(p.preventDefault(),v&&(m(),o.focus()),c="",u&&clearTimeout(u)):(p.key>="1"&&p.key<="9"||p.key==="."||p.key==="0"||p.key==="-")&&(p.preventDefault(),c+=p.key,u&&clearTimeout(u),u=setTimeout(()=>{if(c.includes("-")){let C=c.split("-");if(C.length===2){let I=parseFloat(C[0]),R=parseFloat(C[1]),D=C[0].includes(".")||C[1].includes(".");!isNaN(I)&&!isNaN(R)&&I>=1&&I<=10&&R>=1&&R<=10&&I<=R&&(l.forEach(H=>H.checked=!1),l.forEach(H=>{let A=parseFloat(H.value);if(A>=I&&A<=R){let J=A%1===0,Z=A%1===.5;(J||D&&Z)&&(H.checked=!0)}}),s(),v&&m())}}else{let C=parseFloat(c);if(!isNaN(C)&&C>=1&&C<=10){l.forEach(R=>R.checked=!1);let I=Array.from(l).find(R=>Math.abs(parseFloat(R.value)-C)<.01);I&&(I.checked=!0,s(),v&&m())}}c=""},500)))}),s();let g=e.querySelector(".bracket-selector-btn"),L=e.querySelector(".bracket-selector-dropdown"),y=e.querySelectorAll(".bracket-range-btn"),w=()=>{let p=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),v=[];if(p.forEach(b=>{b.checked&&v.push(b.value)}),v.length===0)g.textContent="Select Brackets",g.classList.remove("has-selection"),g.dataset.validationTriggered==="true"&&g.classList.add("error");else{g.classList.remove("error");let b;v.length===1?b=`Bracket: ${v[0]}`:b=`Brackets: ${v.join(", ")}`,g.textContent=b,g.classList.add("has-selection")}};g.addEventListener("click",p=>{p.preventDefault();let v=L.style.display!=="none";document.querySelectorAll(".bracket-selector-dropdown, .power-selector-dropdown").forEach(b=>{b.style.display="none",b.classList.remove("show")}),document.querySelectorAll(".bracket-selector-btn, .power-selector-btn").forEach(b=>{b.classList.remove("open")}),v||(L.style.display="block",g.classList.add("open"),setTimeout(()=>L.classList.add("show"),10))}),document.addEventListener("click",p=>{!g.contains(p.target)&&!L.contains(p.target)&&(L.classList.remove("show"),g.classList.remove("open"),setTimeout(()=>{L.classList.contains("show")||(L.style.display="none")},200))});let k=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]');k.forEach(p=>{p.addEventListener("change",w)}),y.forEach(p=>{p.addEventListener("click",()=>{let v=p.dataset.range;if(k.forEach(b=>b.checked=!1),v==="cedh")k.forEach(b=>{b.value==="cedh"&&(b.checked=!0)});else{let[b,C]=v.split("-"),I=parseInt(b),R=parseInt(C);k.forEach(D=>{let H=D.value;if(H!=="cedh"){let A=parseInt(H);A>=I&&A<=R&&(D.checked=!0)}})}w()})}),e.querySelector(".bracket-clear-btn").addEventListener("click",()=>{k.forEach(p=>p.checked=!1),w()});let d=()=>{L.classList.remove("show"),g.classList.remove("open"),setTimeout(()=>{L.classList.contains("show")||(L.style.display="none")},200)};document.addEventListener("keydown",p=>{let v=L.style.display==="block"&&L.classList.contains("show"),b=document.activeElement===g;if(v||b){if(p.key==="Escape")p.preventDefault(),v&&(d(),g.focus());else if(p.key>="1"&&p.key<="4"){p.preventDefault();let C=p.key;k.forEach(R=>R.checked=!1);let I=Array.from(k).find(R=>R.value===C);I&&(I.checked=!0,w(),v&&d())}else if(p.key==="5"||p.key.toLowerCase()==="c"){p.preventDefault(),k.forEach(I=>I.checked=!1);let C=Array.from(k).find(I=>I.value==="cedh");C&&(C.checked=!0,w(),v&&d())}}}),w(),e.querySelector(".remove-player-btn").addEventListener("click",()=>{this.playerRowsContainer.removeChild(e),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.updatePlayerNumbers()});let E=e.querySelector(".player-name");E.addEventListener("input",()=>{E.dataset.touched="true",!E.value.trim()&&E.dataset.touched==="true"?E.classList.add("input-error"):E.classList.remove("input-error"),this.clearDuplicateErrorsOnInput()}),e.querySelector(".group-select").addEventListener("change",()=>{this.playerManager.handleGroupChange(this.playerRowsContainer)}),this.playerRowsContainer.appendChild(e),this.playerManager.updateAllGroupDropdowns(this.playerRowsContainer),this.updatePlayerNumbers();let T=document.getElementById("bracket-radio").checked,S=e.querySelector(".power-levels"),x=e.querySelector(".bracket-levels");T?(S.style.display="none",x.style.display="block"):(S.style.display="block",x.style.display="none")}bulkAddPlayers(r){for(let e=0;e<r;e++)this.addPlayerRow()}initializeKeyboardShortcuts(){document.addEventListener("keydown",r=>{if(r.ctrlKey&&r.key==="Enter"){r.preventDefault(),this.addPlayerRow();let e=this.playerRowsContainer.querySelectorAll(".player-row"),o=e[e.length-1].querySelector(".player-name");o&&o.focus()}})}cleanupBottomDisplayButton(){if(this.displayModeBtnBottom){let r=this.displayModeBtnBottom.parentNode;r&&r.parentNode&&r.parentNode.removeChild(r),this.displayModeBtnBottom=null}}generatePods(){this.triggerValidationForAllFields(),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.playerManager.handleGroupChange(this.playerRowsContainer);let r=[],e=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),a=!1;e.forEach(d=>{d.querySelector(".player-name").classList.remove("name-duplicate-error","name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5")});for(let d of e){let M=this.playerManager.getPlayerFromRow(d);M?r.push(M):a=!0}let o=new Map;e.forEach(d=>{let E=d.querySelector(".player-name").value.trim().toLowerCase();E&&(o.has(E)||o.set(E,[]),o.get(E).push(d))});let n=[],t=1;if(o.forEach((d,M)=>{if(d.length>1){n.push(M);let E=`name-duplicate-error-${t}`;d.forEach(B=>{B.querySelector(".player-name").classList.add(E)}),t=t%5+1,a=!0}}),a){let d="Please fix the errors before generating pods.";n.length>0&&(d+=`

Duplicate player names found: ${n.join(", ")}`),alert(d);return}let s=new Map;this.playerManager.getGroups().forEach((d,M)=>{let E=d.reduce((P,T)=>P+T.power,0),B=Math.round(E/d.length*2)/2;s.set(M,{id:M,players:d,averagePower:B,size:d.length})});let l=new Set([...this.playerManager.getGroups().values()].flat().map(d=>d.id)),m=[...r.filter(d=>!l.has(d.id))];s.forEach(d=>{m.push({id:d.id,players:d.players,averagePower:d.averagePower,size:d.size})});let c=r.length;if(c<3){alert("You need at least 3 players to form a pod.");return}let g=j()==="avoid-five"?W(c):G(c),L=K();if(typeof window<"u"&&(window.location.protocol==="file:"||window.__playwright!==void 0||window.playwright!==void 0)){let d=r.map(E=>E.name).join(""),M=Array.from(d).reduce((E,B)=>E+B.charCodeAt(0),0);this.podGenerator.setShuffleSeed(M)}else this.podGenerator.setShuffleSeed(null);let w=this.podGenerator.generatePodsWithBacktracking(m,g,L),k=w.pods,f=w.unassigned;this.currentPods=[...k],this.currentUnassigned=[...f],this.renderPods(k,f)}renderPods(r,e=[]){if(this.currentPods=[...r],this.currentUnassigned=[...e],this.dragDropManager.setCurrentPods(this.currentPods,this.currentUnassigned),this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",r.length===0){this.outputSection.textContent="Could not form pods with the given players.",this.displayModeBtn.style.display="none";return}this.displayModeBtn.style.display="inline-block";let a=Math.ceil(Math.sqrt(r.length)),o=document.createElement("div");if(o.classList.add("pods-container"),o.style.gridTemplateColumns=`repeat(${a}, 1fr)`,o.style.gridTemplateRows=`repeat(${a}, 1fr)`,r.forEach((t,s)=>{let l=document.createElement("div");l.classList.add("pod",`pod-color-${s%10}`),l.dataset.podIndex=s.toString(),l.addEventListener("dragover",this.dragDropManager.handleDragOver),l.addEventListener("drop",this.dragDropManager.handleDrop),l.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let i=document.createElement("h3"),m=document.getElementById("bracket-radio");if(m&&m.checked){let g=this.calculateValidBracketRange(t);i.textContent=`Pod ${s+1} (Bracket: ${g})`}else{let g=N(t);i.textContent=`Pod ${s+1} (Power: ${g})`}l.appendChild(i);let u=document.createElement("ul");t.players.forEach((g,L)=>{if("players"in g){let y=document.createElement("li");y.classList.add("pod-group"),y.draggable=!0,y.dataset.itemType="group",y.dataset.itemId=g.id,y.dataset.podIndex=s.toString(),y.dataset.itemIndex=L.toString(),y.addEventListener("dragstart",this.dragDropManager.handleDragStart),y.addEventListener("dragend",this.dragDropManager.handleDragEnd);let w=document.getElementById("bracket-radio"),k=w&&w.checked;k?y.innerHTML=`<strong>Group ${g.id.split("-")[1]}:</strong>`:y.innerHTML=`<strong>Group ${g.id.split("-")[1]} (Avg Power: ${g.averagePower}):</strong>`;let f=document.createElement("ul");g.players.forEach(d=>{let M=document.createElement("li");if(k&&d.bracketRange)M.textContent=`${d.name} (B: ${d.bracketRange})`;else{let E=$(t),B=q(d,E);M.innerHTML=`${d.name} (P: ${B})`}f.appendChild(M)}),y.appendChild(f),u.appendChild(y)}else{let y=document.createElement("li");y.classList.add("pod-player"),y.draggable=!0,y.dataset.itemType="player",y.dataset.itemId=g.id.toString(),y.dataset.podIndex=s.toString(),y.dataset.itemIndex=L.toString(),y.addEventListener("dragstart",this.dragDropManager.handleDragStart),y.addEventListener("dragend",this.dragDropManager.handleDragEnd);let w=document.getElementById("bracket-radio");if(w&&w.checked&&g.bracketRange)y.textContent=`${g.name} (B: ${g.bracketRange})`;else{let f=$(t),d=q(g,f);y.innerHTML=`${g.name} (P: ${d})`}u.appendChild(y)}}),l.appendChild(u),o.appendChild(l)}),r.length>0){let t=document.createElement("div");t.classList.add("pod","new-pod","new-pod-target"),t.style.borderColor="#4CAF50",t.style.backgroundColor="#1f2a1f",t.style.borderStyle="dashed",t.dataset.podIndex="new-pod",t.addEventListener("dragover",this.dragDropManager.handleDragOver),t.addEventListener("drop",this.dragDropManager.handleDrop),t.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let s=document.createElement("h3");s.textContent="Create New Pod",s.style.color="#4CAF50",t.appendChild(s);let l=document.createElement("p");l.textContent="Drag players or groups here to create a new pod",l.style.color="#999",l.style.fontStyle="italic",l.style.textAlign="center",l.style.margin="20px 0",t.appendChild(l),o.appendChild(t)}if(e.length>0){let t=document.createElement("div");t.classList.add("pod","unassigned-pod"),t.style.borderColor="#ff6b6b",t.style.backgroundColor="#2a1f1f",t.dataset.podIndex="unassigned",t.addEventListener("dragover",this.dragDropManager.handleDragOver),t.addEventListener("drop",this.dragDropManager.handleDrop),t.addEventListener("dragleave",this.dragDropManager.handleDragLeave);let s=document.createElement("h3");s.textContent="Unassigned Players",s.style.color="#ff6b6b",t.appendChild(s);let l=document.createElement("ul");e.forEach((i,m)=>{if("players"in i){let c=document.createElement("li");c.classList.add("pod-group"),c.draggable=!0,c.dataset.itemType="group",c.dataset.itemId=i.id,c.dataset.podIndex="unassigned",c.dataset.itemIndex=m.toString(),c.addEventListener("dragstart",this.dragDropManager.handleDragStart),c.addEventListener("dragend",this.dragDropManager.handleDragEnd);let u=document.getElementById("bracket-radio"),g=u&&u.checked;g?c.innerHTML=`<strong>Group ${i.id.split("-")[1]}:</strong>`:c.innerHTML=`<strong>Group ${i.id.split("-")[1]} (Avg Power: ${i.averagePower}):</strong>`;let L=document.createElement("ul");i.players.forEach(y=>{let w=document.createElement("li");g&&y.bracketRange?w.textContent=`${y.name} (B: ${y.bracketRange})`:w.textContent=`${y.name} (P: ${y.powerRange})`,L.appendChild(w)}),c.appendChild(L),l.appendChild(c)}else{let c=document.createElement("li");c.classList.add("pod-player"),c.draggable=!0,c.dataset.itemType="player",c.dataset.itemId=i.id.toString(),c.dataset.podIndex="unassigned",c.dataset.itemIndex=m.toString(),c.addEventListener("dragstart",this.dragDropManager.handleDragStart),c.addEventListener("dragend",this.dragDropManager.handleDragEnd);let u=document.getElementById("bracket-radio");u&&u.checked&&i.bracketRange?c.textContent=`${i.name} (B: ${i.bracketRange})`:c.textContent=`${i.name} (P: ${i.powerRange})`,l.appendChild(c)}}),t.appendChild(l),o.appendChild(t)}this.outputSection.appendChild(o);let n=document.querySelector(".help-section");if(n&&n.parentNode){let t=document.createElement("div");t.style.textAlign="center",t.style.marginTop="20px",t.style.marginBottom="20px",this.displayModeBtnBottom=this.displayModeBtn.cloneNode(!0),this.displayModeBtnBottom.id="display-mode-btn-bottom",this.displayModeBtnBottom.style.display="inline-block",this.displayModeBtnBottom.addEventListener("click",()=>this.displayModeManager.enterDisplayMode(this.currentPods)),t.appendChild(this.displayModeBtnBottom),n.parentNode.insertBefore(t,n)}}captureCurrentPlayerData(){let r=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),e=[];r.forEach(o=>{let n=o.querySelector(".player-name"),t=o.querySelector(".group-select"),s=o.querySelectorAll('.power-checkbox input[type="checkbox"]'),l=[];s.forEach(c=>{c.checked&&l.push(c.value)});let i=o.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),m=[];i.forEach(c=>{c.checked&&m.push(c.value)}),e.push({name:n.value.trim(),groupValue:t.value,createdGroupId:t.dataset.createdGroupId,selectedPowers:l,selectedBrackets:m})});let a={noLeniency:document.getElementById("no-leniency-radio")?.checked||!1,leniency:document.getElementById("leniency-radio")?.checked||!1,superLeniency:document.getElementById("super-leniency-radio")?.checked||!1,bracket:document.getElementById("bracket-radio")?.checked||!1};return{players:e,leniencySettings:a,currentPods:[...this.currentPods],currentUnassigned:[...this.currentUnassigned]}}resetAllWithConfirmation(){if(!Array.from(this.playerRowsContainer.querySelectorAll(".player-row")).some(o=>{if(o.querySelector(".player-name").value.trim())return!0;let t=o.querySelectorAll('input[type="checkbox"]');return Array.from(t).some(s=>s.checked)})){this.resetAll();return}confirm(`Are you sure you want to reset all player data?

This will clear all players, groups, and generated pods. You will be able to undo this action immediately after.`)&&(this.lastResetData=this.captureCurrentPlayerData(),this.resetAll(),this.showUndoResetButton())}showUndoResetButton(){let r=document.getElementById("undo-reset-btn");r&&r.remove();let e=document.createElement("button");e.id="undo-reset-btn",e.textContent="Undo Reset",e.style.marginLeft="10px",e.style.backgroundColor="#28a745",e.style.color="white",e.style.border="none",e.style.padding="8px 16px",e.style.borderRadius="4px",e.style.cursor="pointer",e.style.fontSize="14px",e.addEventListener("click",()=>this.undoReset());let a=document.getElementById("reset-all-btn");a.parentNode.insertBefore(e,a.nextSibling),setTimeout(()=>{document.getElementById("undo-reset-btn")&&(e.remove(),this.lastResetData=null)},3e4)}undoReset(){if(!this.lastResetData){alert("No reset data available to restore.");return}this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds();let r=this.lastResetData.leniencySettings;r.noLeniency&&(document.getElementById("no-leniency-radio").checked=!0),r.leniency&&(document.getElementById("leniency-radio").checked=!0),r.superLeniency&&(document.getElementById("super-leniency-radio").checked=!0),r.bracket&&(document.getElementById("bracket-radio").checked=!0),this.lastResetData.players.forEach(o=>{this.addPlayerRow();let n=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),t=n[n.length-1],s=t.querySelector(".player-name");s.value=o.name;let l=t.querySelector(".group-select");o.createdGroupId&&(l.dataset.createdGroupId=o.createdGroupId),l.value=o.groupValue}),this.isRestoring=!0;let e=document.getElementById("no-leniency-radio"),a=document.getElementById("bracket-radio");if(e&&a){let o=new Event("change",{bubbles:!0});r.bracket?a.dispatchEvent(o):e.dispatchEvent(o)}setTimeout(()=>{this.restorePlayerSelections()},200)}restorePlayerSelections(){if(!this.lastResetData)return;this.lastResetData.players.forEach((e,a)=>{let n=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[a];if(!n)return;e.selectedPowers.forEach(l=>{let i=n.querySelector(`.power-checkbox input[type="checkbox"][value="${l}"]`);i&&(i.checked=!0)}),e.selectedBrackets.forEach(l=>{let i=n.querySelector(`.bracket-checkbox input[type="checkbox"][value="${l}"]`);i&&(i.checked=!0)}),n.querySelectorAll('input[type="checkbox"]').forEach(l=>{l.checked&&l.dispatchEvent(new Event("change",{bubbles:!0}))}),this.updateButtonTextsForRow(n);let s=n.querySelector(".group-select");e.groupValue&&e.groupValue!=="no-group"&&e.groupValue.startsWith("group-")&&(e.createdGroupId?s.dataset.createdGroupId=e.createdGroupId:s.dataset.createdGroupId=e.groupValue,s.value="new-group",s.dispatchEvent(new Event("change",{bubbles:!0})))}),this.lastResetData.players.forEach((e,a)=>{let t=Array.from(this.playerRowsContainer.querySelectorAll(".player-row"))[a].querySelector(".group-select");e.groupValue&&e.groupValue!=="no-group"&&e.groupValue.startsWith("group-")&&(t.value=e.groupValue,t.dispatchEvent(new Event("change",{bubbles:!0})))}),this.currentPods=[...this.lastResetData.currentPods],this.currentUnassigned=[...this.lastResetData.currentUnassigned],(this.currentPods.length>0||this.currentUnassigned.length>0)&&this.renderPods(this.currentPods,this.currentUnassigned),this.playerManager.handleGroupChange(this.playerRowsContainer),this.isRestoring=!1;let r=document.getElementById("undo-reset-btn");r&&r.remove(),this.lastResetData=null,alert("Reset has been undone successfully!")}resetAll(){this.playerRowsContainer.innerHTML="",this.cleanupBottomDisplayButton(),this.outputSection.innerHTML="",this.displayModeBtn.style.display="none",this.playerManager.clearGroups(),this.playerManager.resetPlayerIds(),this.playerManager.resetGroupIds(),this.currentPods=[],this.currentUnassigned=[];let r=document.getElementById("no-leniency-radio");r.checked=!0;for(let e=0;e<4;e++)this.addPlayerRow()}clearDuplicateErrorsOnInput(){let r=Array.from(this.playerRowsContainer.querySelectorAll(".player-row")),e=new Map;r.forEach(o=>{let n=o.querySelector(".player-name"),t=n.value.trim().toLowerCase();t&&(e.has(t)||e.set(t,[]),e.get(t).push(n))}),r.forEach(o=>{o.querySelector(".player-name").classList.remove("name-duplicate-error","name-duplicate-error-1","name-duplicate-error-2","name-duplicate-error-3","name-duplicate-error-4","name-duplicate-error-5")});let a=1;e.forEach((o,n)=>{if(o.length>1){let t=`name-duplicate-error-${a}`;o.forEach(s=>{s.classList.add(t)}),a=a%5+1}})}initializeRankingModeToggle(){let r=document.getElementById("power-level-radio"),e=document.getElementById("bracket-radio"),a=()=>{let o=e.checked;if(o){document.body.classList.add("bracket-mode");let t=document.getElementById("no-leniency-radio");t&&(t.checked=!0)}else document.body.classList.remove("bracket-mode");this.playerRowsContainer.querySelectorAll(".player-row").forEach(t=>{let s=t.querySelector(".power-levels"),l=t.querySelector(".bracket-levels");o?(s.style.display="none",l.style.display="block"):(s.style.display="block",l.style.display="none"),this.isRestoring||this.clearAllSelections(t)})};r.addEventListener("change",a),e.addEventListener("change",a),a()}clearAllSelections(r){r.querySelectorAll('.power-checkbox input[type="checkbox"]').forEach(t=>t.checked=!1),r.querySelectorAll('.bracket-checkbox input[type="checkbox"]').forEach(t=>t.checked=!1);let o=r.querySelector(".power-selector-btn"),n=r.querySelector(".bracket-selector-btn");o&&(o.textContent="Select Power Levels",o.classList.remove("has-selection")),n&&(n.textContent="Select Brackets",n.classList.remove("has-selection"))}initializeHelpModal(){let r=document.getElementById("help-modal");r.querySelector(".help-close").addEventListener("click",()=>this.hideHelpModal()),r.addEventListener("click",a=>{a.target===r&&this.hideHelpModal()}),document.addEventListener("keydown",a=>{a.key==="Escape"&&r.style.display==="block"&&this.hideHelpModal()})}showHelpModal(){let r=document.getElementById("help-modal");r.style.display="block",document.body.style.overflow="hidden"}hideHelpModal(){let r=document.getElementById("help-modal");r.style.display="none",document.body.style.overflow=""}calculateValidBracketRange(r){let e=r.players.flatMap(t=>"players"in t?t.players:[t]);if(e.length===0)return"Unknown";let a=[],o=new Set;e.forEach(t=>{t.brackets&&t.brackets.forEach(s=>o.add(s))});for(let t of o)e.every(l=>l.brackets&&l.brackets.includes(t))&&a.push(t);let n=["1","2","3","4","cedh"];if(a.sort((t,s)=>n.indexOf(t)-n.indexOf(s)),a.length===0)return"Unknown";if(a.length===1)return a[0];{let t=a.filter(l=>l!=="cedh");return t.length>1&&t.every((l,i)=>{if(i===0)return!0;let m=parseInt(l),c=parseInt(t[i-1]);return m===c+1})&&t.length===a.length&&a.length>1?`${a[0]}-${a[a.length-1]}`:a.join(", ")}}triggerValidationForAllFields(){Array.from(this.playerRowsContainer.querySelectorAll(".player-row")).forEach(e=>{let a=e.querySelector(".player-name");a.value.trim()||a.classList.add("input-error");let n=e.querySelector(".power-selector-btn"),t=e.querySelector(".bracket-selector-btn");if(n&&(n.dataset.validationTriggered="true"),t&&(t.dataset.validationTriggered="true"),document.getElementById("bracket-radio").checked){let i=e.querySelectorAll('.bracket-checkbox input[type="checkbox"]');Array.from(i).some(c=>c.checked)||t.classList.add("error")}else{let i=e.querySelectorAll('.power-checkbox input[type="checkbox"]');Array.from(i).some(c=>c.checked)||n.classList.add("error")}})}updateButtonTextsForRow(r){let e=r.querySelectorAll('.power-checkbox input[type="checkbox"]'),a=r.querySelector(".power-selector-btn");if(a){let t=[];if(e.forEach(s=>{s.checked&&t.push(parseFloat(s.value))}),t.length===0)a.textContent="Select Power Levels",a.classList.remove("has-selection");else{t.sort((l,i)=>l-i);let s;if(t.length===1)s=`Power: ${t[0]}`;else{let l=t[0],i=t[t.length-1];t.every((c,u)=>{if(u===0)return!0;let g=c-t[u-1];return g===.5||g===1})&&t.length>2?s=`Power: ${l}-${i}`:t.length<=4?s=`Power: ${t.join(", ")}`:s=`Power: ${l}-${i} (${t.length} levels)`}a.textContent=s,a.classList.add("has-selection")}}let o=r.querySelectorAll('.bracket-checkbox input[type="checkbox"]'),n=r.querySelector(".bracket-selector-btn");if(n){let t=[];if(o.forEach(s=>{s.checked&&t.push(s.value)}),t.length===0)n.textContent="Select Brackets",n.classList.remove("has-selection");else{let s;t.length===1?s=`Bracket: ${t[0]}`:s=`Brackets: ${t.join(", ")}`,n.textContent=s,n.classList.add("has-selection")}}}updatePlayerNumbers(){this.playerRowsContainer.querySelectorAll(".player-row").forEach((e,a)=>{let o=e.querySelector(".player-number");o&&(o.textContent=(a+1).toString())})}};function X(){let e=Math.floor(Math.random()*360),a=25,o=[];for(let s=0;s<50;s++){let i=(e+s*137.5)%360;o.push(Math.round(i))}let n="";for(let s=1;s<=50;s++){let l=o[s-1],i=70+Math.floor(Math.random()*20),m=50,c=28+Math.floor(Math.random()*8);n+=`
.player-row .group-select.group-${s} {
    border-color: hsl(${l}, ${i}%, ${m}%) !important;
    background-color: hsl(${l}, ${i}%, ${c}%) !important;
}`,n+=`
.group-select option[value="group-${s}"] {
    background-color: hsl(${l}, ${i}%, ${c}%);
}`}let t=document.createElement("style");t.id="dynamic-group-colors",t.textContent=n,document.head.appendChild(t)}document.addEventListener("DOMContentLoaded",()=>{X(),new U().resetAll()});})();
